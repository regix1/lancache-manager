import{r as d,j as e,R as Xe,X as et,C as Z,K as Ce,x as tt,y as ie,H as at,z as Fe,B as de,b as Q,F as He,J as Le,N as De,O as st,P as je,Q as rt,V as ot,Y as we,_ as ke,D as Te,o as lt,E as Re,v as le,$ as nt,a0 as ct,I as Ne,a1 as ne,a2 as it,a3 as dt,q as mt,a4 as ut,a5 as ft,A as ht,m as Se,e as Be,a6 as Pe,k as Me,a7 as Ae,a8 as gt,a9 as xt,i as Ie}from"./react-vendor-LpjEarnW.js";import{a as G,A as D,t as L,b as $e,u as pt}from"./index-D136qoTd.js";import{f as ee,C as Y}from"./Card-BYRdqdPd.js";import{A as z}from"./Alert-CMXzdTu4.js";import{H as bt}from"./signalr-C7Jyn4vH.js";import"./vendor-BmYUbuLR.js";import"./tanstack-CPlEqbpz.js";async function yt(o){try{const m=await fetch(o,{signal:AbortSignal.timeout(5e3)});return m.ok?{ok:!0,data:await m.json()}:{ok:!1,error:`HTTP ${m.status}`}}catch(m){return{ok:!1,error:m.message}}}const ce={},vt=()=>{if(!(typeof import.meta<"u"&&(ce!=null&&ce.VITE_API_URL)))return""},K=vt();class Ct{async getState(m){const s=await yt(`${K}/api/operationstate/${m}`);return s.ok?s.data:null}async saveState(m,s,l,c=30){try{const a=await fetch(`${K}/api/operationstate`,{method:"POST",headers:{"Content-Type":"application/json",...G.getAuthHeaders()},body:JSON.stringify({key:m,type:s,data:l,expirationMinutes:c})});if(!a.ok){const i=await a.text();throw new Error(`Failed to save state: ${i}`)}return await a.json()}catch(a){throw console.error("Error saving state:",a),a}}async updateState(m,s){try{const l=`${K}/api/operationstate/${encodeURIComponent(m)}`;console.log("Updating state at:",l);const c=await fetch(l,{method:"PATCH",headers:{"Content-Type":"application/json",...G.getAuthHeaders()},body:JSON.stringify({updates:s||{}})});if(!c.ok){const a=await c.text();throw console.error("Update state response:",c.status,a),new Error(`Failed to update state: ${c.status} - ${a}`)}return await c.json()}catch(l){return console.error("Error updating state:",l),null}}async removeState(m){try{const s=await fetch(`${K}/api/operationstate/${encodeURIComponent(m)}`,{method:"DELETE",headers:G.getAuthHeaders()});if(!s.ok)throw new Error("Failed to remove state");return await s.json()}catch(s){throw console.error("Error removing state:",s),s}}async getAllStates(m=null){try{const s=m?`${K}/api/operationstate?type=${m}`:`${K}/api/operationstate`,l=await fetch(s,{headers:G.getAuthHeaders()});if(!l.ok)throw new Error("Failed to get states");return await l.json()}catch(s){return console.error("Error getting all states:",s),[]}}async migrateFromLocalStorage(){const m=["activeCacheClearOperation","activeLogProcessing","activeServiceRemoval"];let s=0;for(const l of m)try{const c=localStorage.getItem(l);if(c){const a=JSON.parse(c);let i="general";l.includes("CacheClear")?i="cacheClearing":l.includes("LogProcessing")?i="logProcessing":l.includes("ServiceRemoval")&&(i="serviceRemoval"),await this.saveState(l,i,a,120),localStorage.removeItem(l),s++,console.log(`Migrated ${l} from localStorage to backend`)}}catch(c){console.error(`Failed to migrate ${l}:`,c)}return s>0&&console.log(`Successfully migrated ${s} operations to backend storage`),s}}const J=new Ct,me=(o,m="general",s=30)=>{const[l,c]=d.useState(null),[a,i]=d.useState(!1),[b,x]=d.useState(null),S=d.useCallback(async f=>{i(!0),x(null);try{await J.saveState(o,m,f,s);const n={key:o,type:m,data:f,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return c(n),n}catch(n){throw console.error(`Failed to save ${o}:`,n),x(n.message),n}finally{i(!1)}},[o,m,s]),g=d.useCallback(async()=>{i(!0),x(null);try{const f=await J.getState(o);if(f){const n=f,N={key:n.key||o,type:n.type||m,data:n.data||{},createdAt:n.createdAt||new Date().toISOString(),updatedAt:n.updatedAt||n.createdAt||new Date().toISOString()};return c(N),N}return null}catch(f){return console.error(`Failed to load ${o}:`,f),x(f.message),null}finally{i(!1)}},[o,m]),T=d.useCallback(async()=>{i(!0),x(null);try{await J.removeState(o),c(null)}catch(f){throw console.error(`Failed to clear ${o}:`,f),x(f.message),f}finally{i(!1)}},[o]),P=d.useCallback(async f=>{i(!0),x(null);try{await J.updateState(o,f),c(n=>n?{...n,data:{...n.data,...f},updatedAt:new Date().toISOString()}:null)}catch(n){throw console.error(`Failed to update ${o}:`,n),x(n.message),n}finally{i(!1)}},[o]);return d.useEffect(()=>{o&&g()},[o]),{operation:l,save:S,load:g,clear:T,update:P,loading:a,error:b}},F=({children:o,variant:m="default",color:s="blue",size:l="md",loading:c=!1,leftSection:a,rightSection:i,fullWidth:b=!1,className:x="",disabled:S,...g})=>{const T=()=>m==="filled"?{blue:"themed-button-primary",green:"action-process",red:"action-delete",yellow:"action-reset",purple:"themed-button-primary",gray:"bg-themed-hover hover:bg-themed-tertiary text-themed-primary",orange:"action-reset"}[s]:m==="subtle"?"bg-transparent hover:bg-themed-hover text-themed-secondary":m==="outline"?"border border-themed-secondary hover:bg-themed-hover text-themed-primary":"bg-themed-tertiary hover:bg-themed-hover text-themed-primary",P={xs:"px-2 py-1 text-xs",sm:"px-3 py-1.5 text-sm",md:"px-4 py-2",lg:"px-6 py-3 text-lg"};return e.jsxs("button",{className:`
        ${T()}
        ${P[l]}
        ${b?"w-full":""}
        rounded-lg font-medium
        smooth-transition
        disabled:opacity-50 disabled:cursor-not-allowed
        flex items-center justify-center gap-2
        button-press
        ${x}
      `,disabled:S||c,...g,children:[c&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current"}),a,o,i]})},te=({opened:o,onClose:m,title:s,children:l,size:c="md"})=>{const a={sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"};return Xe.useEffect(()=>(o?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[o]),o?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:`themed-card rounded-lg ${a[c]} w-full mx-4 max-h-[90vh] overflow-y-auto custom-scrollbar`,children:[s&&e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-themed-secondary",children:[e.jsx("div",{className:"text-lg font-semibold text-themed-primary",children:s}),e.jsx("button",{onClick:m,className:"p-1 hover:bg-themed-hover rounded-lg smooth-transition",children:e.jsx(et,{className:"w-5 h-5 text-themed-muted"})})]}),e.jsx("div",{className:"p-6",children:l})]})}):null},jt=({onAuthChange:o,onError:m,onSuccess:s})=>{const[l,c]=d.useState(!1),[a,i]=d.useState(!0),[b,x]=d.useState(!1),[S,g]=d.useState(""),[T,P]=d.useState(""),[f,n]=d.useState(!1);d.useEffect(()=>{N()},[]);const N=async()=>{i(!0);try{const A=await G.checkAuth();c(A.isAuthenticated),o==null||o(A.isAuthenticated),!A.isAuthenticated&&G.isRegistered()&&G.clearAuth()}catch(A){console.error("Auth check failed:",A),c(!1),o==null||o(!1)}finally{i(!1)}},M=async()=>{if(!S.trim()){P("Please enter an API key");return}n(!0),P("");try{const A=await G.register(S);A.success?(c(!0),o==null||o(!0),x(!1),g(""),s==null||s("Authentication successful! You can now use management features.")):P(A.message||"Authentication failed")}catch(A){console.error("Authentication error:",A),P(A.message||"Authentication failed")}finally{n(!1)}},_=async()=>{if(window.confirm(`WARNING: This will:

1. Generate a NEW API key on the server
2. Revoke ALL existing device registrations
3. Require ALL users to re-authenticate
4. You must check the container logs for the new key

This cannot be undone. Continue?`)){n(!0);try{const p=await G.regenerateApiKey();p.success?(c(!1),o==null||o(!1),x(!1),m==null||m("API KEY REGENERATED - Check container logs for new key!"),s==null||s(p.message),setTimeout(()=>{x(!0)},3e3)):m==null||m(p.message||"Failed to regenerate API key")}catch(p){console.error("Error regenerating key:",p),m==null||m("Failed to regenerate API key: "+p.message)}finally{n(!1)}}};return a?null:e.jsxs(e.Fragment,{children:[e.jsx(z,{color:l?"green":"yellow",icon:l?e.jsx(tt,{className:"w-5 h-5"}):e.jsx(ie,{className:"w-5 h-5"}),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:l?"Authenticated":"Not Authenticated"}),e.jsx("p",{className:"text-xs mt-1 opacity-75",children:l?"Management features enabled":"Management features require API key"})]}),l?e.jsx(F,{variant:"filled",color:"red",size:"sm",leftSection:e.jsx(Z,{className:"w-3 h-3"}),onClick:_,loading:f,children:"Regenerate Key"}):e.jsx(F,{variant:"filled",color:"yellow",leftSection:e.jsx(Ce,{className:"w-4 h-4"}),onClick:()=>x(!0),children:"Authenticate"})]})}),e.jsx(te,{opened:b,onClose:()=>{x(!1),g(""),P("")},title:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ce,{className:"w-6 h-6 text-themed-warning"}),e.jsx("span",{children:"Authentication Required"})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-themed-secondary",children:"Management operations require authentication. Please enter your API key to continue."}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-themed-secondary mb-2",children:"API Key"}),e.jsx("input",{type:"password",value:S,onChange:A=>g(A.target.value),onKeyPress:A=>A.key==="Enter"&&M(),placeholder:"lm_xxxxxxxxxxxxxxxxxxxxx",className:"w-full px-3 py-2 themed-input text-themed-primary placeholder-themed-muted focus:outline-none",disabled:f})]}),T&&e.jsx(z,{color:"red",children:T}),e.jsx(z,{color:"blue",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium mb-2",children:"To find your API key:"}),e.jsxs("ol",{className:"list-decimal list-inside text-xs space-y-1",children:[e.jsx("li",{children:"SSH into your server"}),e.jsxs("li",{children:["Check the file:"," ",e.jsx("code",{className:"bg-themed-tertiary px-1 rounded",children:"/data/api_key.txt"})]}),e.jsx("li",{children:"Or check the API container logs on startup"})]})]})}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-themed-secondary",children:[e.jsx(F,{variant:"default",onClick:()=>{x(!1),g(""),P("")},disabled:f,children:"Cancel"}),e.jsx(F,{variant:"filled",color:"blue",leftSection:e.jsx(ie,{className:"w-4 h-4"}),onClick:M,loading:f,disabled:!S.trim(),children:"Authenticate"})]})]})})]})},wt=({isAuthenticated:o,mockMode:m,onError:s,onSuccess:l,onBackgroundOperation:c})=>{var E;const[a,i]=d.useState(null),[b,x]=d.useState(!1),[S,g]=d.useState(!1),[T,P]=d.useState({cachePath:"/cache",logPath:"/logs/access.log",services:[]}),f=me("activeCacheClearOperation","cacheClearing",30);d.useEffect(()=>{var j;((j=f.operation)==null?void 0:j.data)&&!b&&a&&["Running","Preparing"].includes(a.status)&&c?c({bytesDeleted:a.bytesDeleted,progress:a.percentComplete||a.progress||0,showModal:()=>x(!0)}):c&&c(null)},[f.operation,b,a,c]),d.useEffect(()=>{n(),N()},[]);const n=async()=>{try{const w=await D.getConfig();P(w)}catch(w){console.error("Failed to load config:",w)}},N=async()=>{var j;const w=await f.load();if((j=w==null?void 0:w.data)!=null&&j.operationId)try{const u=await D.getCacheClearStatus(w.data.operationId);u&&["Running","Preparing"].includes(u.status)?(i(u),M(w.data.operationId)):await f.clear()}catch{await f.clear()}},M=w=>{const j=setInterval(async()=>{try{const u=await D.getCacheClearStatus(w);i(u),["Running","Preparing"].includes(u.status)?await f.update({lastProgress:u.percentComplete||u.progress||0}):(_(u),clearInterval(j))}catch(u){console.error("Error polling cache clear status:",u),clearInterval(j)}},1e3)},_=async w=>{await f.clear(),w.status==="Completed"?(l==null||l(`Cache cleared successfully! ${ee(w.bytesDeleted||0)} freed.`),setTimeout(()=>{x(!1),i(null)},2e3)):w.status==="Failed"?(s==null||s(`Cache clearing failed: ${w.error||w.message||"Unknown error"}`),setTimeout(()=>{x(!1),i(null)},5e3)):w.status==="Cancelled"&&(l==null||l("Cache clearing cancelled"),x(!1),i(null))},A=async()=>{if(!o){s==null||s("Authentication required");return}if(window.confirm("This will clear ALL cached game files. Continue?")){g(!0);try{const w=await D.clearAllCache();w.operationId&&(await f.save({operationId:w.operationId}),i({operationId:w.operationId,status:"Preparing",statusMessage:"Starting cache clear...",percentComplete:0,bytesDeleted:0,totalBytesToDelete:0}),x(!0),M(w.operationId))}catch(w){s==null||s("Failed to start cache clearing: "+w.message)}finally{g(!1)}}},p=async()=>{var j;const w=f.operation;if((j=w==null?void 0:w.data)!=null&&j.operationId)try{i(u=>u?{...u,status:"Cancelling",statusMessage:"Cancelling operation..."}:null),await D.cancelCacheClear(w.data.operationId),await f.clear(),setTimeout(()=>{x(!1),i(null),l==null||l("Cache clearing operation cancelled")},1500)}catch(u){console.error("Failed to cancel cache clear:",u),x(!1),i(null),await f.clear()}},I=((E=f.operation)==null?void 0:E.data)&&!b&&a&&["Running","Preparing"].includes(a.status),R=(a==null?void 0:a.percentComplete)||(a==null?void 0:a.progress)||0;return e.jsxs(e.Fragment,{children:[e.jsxs(Y,{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(at,{className:"w-5 h-5 text-themed-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-themed-primary",children:"Disk Cache Management"})]}),e.jsxs("p",{className:"text-themed-muted text-sm mb-4",children:["Manage cached game files in"," ",e.jsx("code",{className:"bg-themed-tertiary px-2 py-1 rounded",children:T.cachePath})]}),e.jsx(F,{fullWidth:!0,variant:"filled",color:"red",leftSection:e.jsx(Fe,{className:"w-4 h-4"}),onClick:A,disabled:S||m||I||f.loading||!o,loading:S||f.loading,children:I?"Cache Clearing in Progress...":"Clear All Cached Files"}),e.jsx("p",{className:"text-xs text-themed-muted mt-2",children:"⚠️ This deletes ALL cached game files from disk"})]}),e.jsx(te,{opened:b&&a!==null,onClose:()=>{["Running","Preparing"].includes((a==null?void 0:a.status)||"")||(x(!1),i(null))},title:"Clearing Cache",size:"lg",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[(a==null?void 0:a.status)==="Completed"?e.jsx(de,{className:"w-5 h-5 cache-hit"}):(a==null?void 0:a.status)==="Failed"?e.jsx(Z,{className:"w-5 h-5 text-themed-error"}):e.jsx(Q,{className:"w-5 h-5 text-themed-primary animate-spin"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-themed-primary font-medium",children:a==null?void 0:a.status}),((a==null?void 0:a.statusMessage)||(a==null?void 0:a.message))&&e.jsx("p",{className:"text-sm text-themed-muted",children:(a==null?void 0:a.statusMessage)||(a==null?void 0:a.message)})]})]}),a&&["Running","Preparing"].includes(a.status)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full progress-track rounded-full h-4 relative overflow-hidden",children:[e.jsx("div",{className:"progress-bar-medium h-4 rounded-full smooth-transition",style:{width:`${Math.min(100,R)}%`}}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("span",{className:"text-xs text-themed-primary font-medium",children:[R.toFixed(0),"%"]})})]}),a.bytesDeleted!==void 0&&a.totalBytesToDelete&&a.totalBytesToDelete>0&&e.jsxs("div",{className:"text-sm text-themed-muted text-center",children:[e.jsx("span",{className:"cache-hit font-semibold",children:ee(a.bytesDeleted||0)})," / ",e.jsx("span",{className:"text-themed-primary",children:ee(a.totalBytesToDelete)})," cleared"]})]}),(a==null?void 0:a.error)&&e.jsx(z,{color:"red",children:a.error}),e.jsx("div",{className:"flex justify-end space-x-3 pt-4 border-t border-themed-secondary",children:a&&["Running","Preparing"].includes(a.status)?e.jsxs(e.Fragment,{children:[e.jsx(F,{variant:"filled",color:"red",leftSection:e.jsx(He,{className:"w-4 h-4"}),onClick:p,children:"Cancel"}),e.jsx(F,{variant:"default",onClick:()=>x(!1),children:"Run in Background"})]}):e.jsx(F,{variant:"default",onClick:()=>{x(!1),i(null)},children:"Close"})})]})}),f.error&&e.jsxs(z,{color:"orange",children:["Backend storage error: ",f.error]})]})},kt=({isAuthenticated:o,mockMode:m,onError:s,onSuccess:l,onDataRefresh:c,onBackgroundOperation:a})=>{const[i,b]=d.useState(!1),[x,S]=d.useState(null),[g,T]=d.useState(!1),[P,f]=d.useState(!1),n=me("activeLogProcessing","logProcessing",120),N=d.useRef(null),M=d.useRef(null),_=d.useRef(null);d.useEffect(()=>{i&&x&&a?a({message:x.message,detailMessage:x.detailMessage,progress:x.progress,estimatedTime:x.estimatedTime,status:x.status,onCancel:w}):a&&a(null)},[i,x,a]),d.useEffect(()=>(A(),p(),()=>{M.current&&clearInterval(M.current),_.current&&clearTimeout(_.current),N.current&&N.current.stop()}),[]);const A=async()=>{var u,H;const j=await n.load();if(j!=null&&j.data){const v=await D.getProcessingStatus().catch(()=>null);v!=null&&v.isProcessing?(b(!0),S({message:`Processing: ${((u=v.mbProcessed)==null?void 0:u.toFixed(1))||0} MB of ${((H=v.mbTotal)==null?void 0:H.toFixed(1))||0} MB`,detailMessage:v.processingRate?`Speed: ${v.processingRate.toFixed(1)} MB/s`:"",progress:v.percentComplete||v.progress||0,estimatedTime:v.estimatedTime,status:v.status||"processing"}),I()):await n.clear()}},p=async()=>{try{const j=new bt().withUrl("/hubs/downloads").withAutomaticReconnect([0,2e3,5e3,1e4,3e4]).build();j.on("ProcessingProgress",async u=>{console.log("Processing progress received:",u),S(H=>{var v,$;return(H==null?void 0:H.status)==="complete"?H:{message:`Processing: ${((v=u.mbProcessed)==null?void 0:v.toFixed(1))||0} MB of ${(($=u.mbTotal)==null?void 0:$.toFixed(1))||0} MB`,detailMessage:`${u.entriesProcessed||0} entries from ${u.linesProcessed||0} lines`,progress:u.percentComplete||u.progress||0,status:"processing"}}),b(!0),await n.update({lastProgress:u.percentComplete||u.progress||0,mbProcessed:u.mbProcessed,mbTotal:u.mbTotal,entriesProcessed:u.entriesProcessed,linesProcessed:u.linesProcessed})}),j.on("BulkProcessingComplete",async u=>{var H,v,$;console.log("Bulk processing complete:",u),M.current&&clearInterval(M.current),S({message:"Processing Complete!",detailMessage:`Successfully processed ${(H=u.entriesProcessed)==null?void 0:H.toLocaleString()} entries from ${(v=u.linesProcessed)==null?void 0:v.toLocaleString()} lines in ${($=u.elapsed)==null?void 0:$.toFixed(1)} minutes`,progress:100,status:"complete"}),b(!0),await n.clear(),setTimeout(async()=>{b(!1),S(null),c==null||c()},1e4)}),j.onreconnecting(u=>{console.log("SignalR reconnecting:",u),f(!1)}),j.onreconnected(u=>{console.log("SignalR reconnected:",u),f(!0)}),j.onclose(u=>{console.error("SignalR disconnected:",u),f(!1),i&&(console.log("SignalR disconnected during processing, falling back to polling"),I()),_.current=setTimeout(()=>{p()},5e3)}),await j.start(),N.current=j,f(!0),console.log("SignalR connected")}catch(j){console.error("SignalR connection failed, falling back to polling:",j),f(!1),i&&I()}},I=()=>{M.current&&clearInterval(M.current);const j=async()=>{var u,H,v;try{const $=x;if(($==null?void 0:$.status)==="complete")return;const y=await D.getProcessingStatus();y!=null&&y.isProcessing?(b(!0),S({message:`Processing: ${((u=y.mbProcessed)==null?void 0:u.toFixed(1))||0} MB of ${((H=y.mbTotal)==null?void 0:H.toFixed(1))||0} MB`,detailMessage:y.processingRate?`Speed: ${y.processingRate.toFixed(1)} MB/s`:"",progress:y.percentComplete||y.progress||0,estimatedTime:y.estimatedTime,status:y.status||"processing"}),await n.update({lastProgress:y.percentComplete||y.progress||0,mbProcessed:y.mbProcessed,mbTotal:y.mbTotal})):((y==null?void 0:y.percentComplete)||(y==null?void 0:y.progress)||0)>=100?(M.current&&clearInterval(M.current),S({message:"Processing Complete!",detailMessage:`Processed ${((v=y.mbTotal)==null?void 0:v.toFixed(1))||0} MB`,progress:100,status:"complete"}),b(!0),await n.clear(),setTimeout(()=>{b(!1),S(null),c==null||c()},1e4)):(b(!1),await n.clear(),M.current&&clearInterval(M.current))}catch($){console.error("Error checking processing status:",$)}};j(),M.current=setInterval(j,3e3)},R=async()=>{if(!o){s==null||s("Authentication required");return}T(!0);try{const j=await D.resetLogPosition();j&&(l==null||l(j.message||"Log position reset successfully"),setTimeout(()=>c==null?void 0:c(),2e3))}catch(j){s==null||s(j.message||"Failed to reset log position")}finally{T(!1)}},E=async()=>{var j;if(!o){s==null||s("Authentication required");return}if(window.confirm("Process entire log file?")){T(!0);try{const u=await D.processAllLogs();if(u){if(u.status==="empty_file"||u.status==="no_log_file"||u.status==="insufficient_data"){s==null||s(u.message),T(!1);return}u.logSizeMB>0?(await n.save({type:"processAll"}),b(!0),S({message:"Preparing to process logs...",detailMessage:`${((j=u.logSizeMB)==null?void 0:j.toFixed(1))||0} MB to process`,progress:0,estimatedTime:`Estimated: ${u.estimatedTimeMinutes} minutes`,status:"starting"}),P||setTimeout(()=>I(),5e3)):(s==null||s("Log file appears to be empty or invalid"),await n.clear())}else await n.clear()}catch(u){await n.clear(),s==null||s(u.message||"Failed to process logs")}finally{T(!1)}}},w=async()=>{if(!o){s==null||s("Authentication required");return}if(window.confirm("Cancel log processing?")){T(!0);try{await D.cancelProcessing(),b(!1),await n.clear(),M.current&&clearInterval(M.current),l==null||l("Processing cancelled"),setTimeout(()=>{S(null),c==null||c()},5e3)}catch{s==null||s("Failed to cancel processing")}finally{T(!1)}}};return e.jsxs(Y,{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(Le,{className:"w-5 h-5 cache-hit"}),e.jsx("h3",{className:"text-lg font-semibold text-themed-primary",children:"Log Processing"})]}),e.jsx("p",{className:"text-themed-muted text-sm mb-4",children:"Control how access.log is processed for statistics"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(F,{variant:"filled",color:"yellow",leftSection:e.jsx(De,{className:"w-4 h-4"}),onClick:R,disabled:g||i||m||n.loading||!o,fullWidth:!0,children:"Reset Log Position"}),e.jsx(F,{variant:"filled",color:"green",leftSection:e.jsx(st,{className:"w-4 h-4"}),onClick:E,disabled:g||i||m||n.loading||!o,loading:n.loading,fullWidth:!0,children:"Process All Logs"})]}),e.jsx("div",{className:"mt-4 p-3 bg-themed-tertiary rounded-lg",children:e.jsxs("p",{className:"text-xs text-themed-muted",children:[e.jsx("strong",{children:"Reset:"})," Start from current end of log",e.jsx("br",{}),e.jsx("strong",{children:"Process All:"})," Import entire log history"]})}),n.error&&e.jsxs(z,{color:"orange",children:["Backend storage error: ",n.error]})]})},Tt=({isAuthenticated:o})=>{const[m,s]=d.useState([]),[l,c]=d.useState("dark-default"),[a,i]=d.useState(!1),[b,x]=d.useState(!1),[S,g]=d.useState(null),[T,P]=d.useState(null),[f,n]=d.useState(null),[N,M]=d.useState(!1),[_,A]=d.useState(!1),[p,I]=d.useState(null),[R,E]=d.useState(["core","backgrounds","navigation"]),[w,j]=d.useState(null),[u,H]=d.useState({}),[v,$]=d.useState({}),[y,U]=d.useState({name:"",description:"",author:"",version:"1.0.0",isDark:!0,primaryColor:"#3b82f6",secondaryColor:"#8b5cf6",accentColor:"#06b6d4",bgPrimary:"#111827",bgSecondary:"#1f2937",bgTertiary:"#374151",bgHover:"#4b5563",textPrimary:"#ffffff",textSecondary:"#d1d5db",textMuted:"#9ca3af",textAccent:"#60a5fa",dragHandleColor:"#6b7280",dragHandleHover:"#60a5fa",borderPrimary:"#374151",borderSecondary:"#4b5563",borderFocus:"#3b82f6",navBg:"#1f2937",navBorder:"#374151",navTabActive:"#3b82f6",navTabInactive:"#9ca3af",navTabHover:"#ffffff",navTabActiveBorder:"#3b82f6",navMobileMenuBg:"#1f2937",navMobileItemHover:"#374151",success:"#10b981",successBg:"#064e3b",successText:"#34d399",warning:"#f59e0b",warningBg:"#78350f",warningText:"#fbbf24",error:"#ef4444",errorBg:"#7f1d1d",errorText:"#fca5a5",info:"#3b82f6",infoBg:"#1e3a8a",infoText:"#93c5fd",steamColor:"#1e40af",epicColor:"#7c3aed",originColor:"#ea580c",blizzardColor:"#0891b2",wsusColor:"#16a34a",riotColor:"#dc2626",cardBg:"#1f2937",cardBorder:"#374151",buttonBg:"#3b82f6",buttonHover:"#2563eb",buttonText:"#ffffff",inputBg:"#374151",inputBorder:"#4b5563",inputFocus:"#3b82f6",badgeBg:"#3b82f6",badgeText:"#ffffff",progressBar:"#3b82f6",progressBg:"#374151",iconBgBlue:"#3b82f6",iconBgGreen:"#10b981",iconBgEmerald:"#10b981",iconBgPurple:"#8b5cf6",iconBgIndigo:"#6366f1",iconBgOrange:"#f97316",iconBgYellow:"#eab308",iconBgCyan:"#06b6d4",iconBgRed:"#ef4444",chartColor1:"#3b82f6",chartColor2:"#10b981",chartColor3:"#f59e0b",chartColor4:"#ef4444",chartColor5:"#8b5cf6",chartColor6:"#06b6d4",chartColor7:"#f97316",chartColor8:"#ec4899",chartBorderColor:"#1f2937",chartGridColor:"#374151",chartTextColor:"#9ca3af",chartCacheHitColor:"#10b981",chartCacheMissColor:"#f59e0b",scrollbarTrack:"#374151",scrollbarThumb:"#6B7280",scrollbarHover:"#9CA3AF",customCSS:""}),ue=d.useRef(null),fe=[{name:"core",icon:je,description:"Main theme colors used throughout the interface",colors:[{key:"primaryColor",label:"Primary Color",description:"Main brand color",affects:["Buttons","Links","Active states","Focus rings"]},{key:"secondaryColor",label:"Secondary Color",description:"Complementary accent color",affects:["Secondary buttons","Highlights","Purple text elements"]},{key:"accentColor",label:"Accent Color",description:"Additional accent for special elements",affects:["Special badges","Tooltips","Notifications"]}]},{name:"backgrounds",icon:ne,description:"Background colors for different UI layers",colors:[{key:"bgPrimary",label:"Primary Background",description:"Main app background",affects:["Body background","Main container"]},{key:"bgSecondary",label:"Secondary Background",description:"Card and panel backgrounds",affects:["Cards","Panels","Modals"]},{key:"bgTertiary",label:"Tertiary Background",description:"Input and nested element backgrounds",affects:["Input fields","Dropdown menus","Code blocks"]},{key:"bgHover",label:"Hover Background",description:"Background for hover states",affects:["Button hovers","List item hovers","Menu item hovers"]}]},{name:"text",icon:it,description:"Text colors for different content hierarchies",colors:[{key:"textPrimary",label:"Primary Text",description:"Main text color",affects:["Headings","Body text","Labels"]},{key:"textSecondary",label:"Secondary Text",description:"Less prominent text",affects:["Descriptions","Subtitles","Help text"]},{key:"textMuted",label:"Muted Text",description:"Disabled or placeholder text",affects:["Placeholders","Disabled labels","Timestamps"]},{key:"textAccent",label:"Accent Text",description:"Highlighted or linked text",affects:["Links","Highlighted values","Active menu items"]},{key:"dragHandleColor",label:"Drag Handle",description:"Color for drag/reorder indicators",affects:["Drag grips","Reorder handles"]},{key:"dragHandleHover",label:"Drag Handle Hover",description:"Color when hovering over drag handles",affects:["Drag grip hover state","Active dragging"]}]},{name:"borders",icon:dt,description:"Border colors for separators and outlines",colors:[{key:"borderPrimary",label:"Primary Border",description:"Main border color",affects:["Card borders","Dividers","Table borders"]},{key:"borderSecondary",label:"Secondary Border",description:"Subtle borders",affects:["Input borders","Section dividers"]},{key:"borderFocus",label:"Focus Border",description:"Border color for focused elements",affects:["Focused inputs","Active tabs","Selected items"]}]},{name:"navigation",icon:ne,description:"Colors specifically for navigation elements",colors:[{key:"navBg",label:"Navigation Background",description:"Main navigation background color",affects:["Header navigation","Navigation bar","Menu background"]},{key:"navBorder",label:"Navigation Border",description:"Navigation border and separator color",affects:["Navigation borders","Header border","Menu separators"]},{key:"navTabActive",label:"Active Tab Color",description:"Color for active navigation tabs",affects:["Active tab text","Current page indicator"]},{key:"navTabInactive",label:"Inactive Tab Color",description:"Color for inactive navigation tabs",affects:["Inactive tab text","Unselected menu items"]},{key:"navTabHover",label:"Tab Hover Color",description:"Color when hovering over navigation tabs",affects:["Tab hover text","Menu item hover text"]},{key:"navTabActiveBorder",label:"Active Tab Border",description:"Border color for active navigation tabs",affects:["Active tab underline","Current page border"]},{key:"navMobileMenuBg",label:"Mobile Menu Background",description:"Background for mobile navigation menu",affects:["Mobile menu background","Dropdown menu background"]},{key:"navMobileItemHover",label:"Mobile Item Hover",description:"Hover color for mobile navigation items",affects:["Mobile menu item hover","Dropdown item hover"]}]},{name:"status",icon:Z,description:"Colors for status indicators and alerts",colors:[{key:"success",label:"Success",description:"Success state color",affects:["Success buttons","Progress bars","Online status"]},{key:"successBg",label:"Success Background",description:"Background for success elements",affects:["Success alerts","Success badges"]},{key:"successText",label:"Success Text",description:"Text color for success states",affects:["Success messages","Positive values"]},{key:"warning",label:"Warning",description:"Warning state color",affects:["Warning buttons","Caution indicators"]},{key:"warningBg",label:"Warning Background",description:"Background for warning elements",affects:["Warning alerts","Warning badges"]},{key:"warningText",label:"Warning Text",description:"Text color for warning states",affects:["Warning messages","Caution text"]},{key:"error",label:"Error",description:"Error state color",affects:["Error buttons","Delete actions","Offline status"]},{key:"errorBg",label:"Error Background",description:"Background for error elements",affects:["Error alerts","Error badges"]},{key:"errorText",label:"Error Text",description:"Text color for error states",affects:["Error messages","Validation errors"]},{key:"info",label:"Info",description:"Informational state color",affects:["Info buttons","Info indicators"]},{key:"infoBg",label:"Info Background",description:"Background for info elements",affects:["Info alerts","Info badges"]},{key:"infoText",label:"Info Text",description:"Text color for info states",affects:["Info messages","Help content"]}]},{name:"services",icon:mt,description:"Colors for different gaming services",colors:[{key:"steamColor",label:"Steam",description:"Steam service color",affects:["Steam badges","Steam charts","Steam stats"]},{key:"epicColor",label:"Epic Games",description:"Epic Games service color",affects:["Epic badges","Epic charts","Epic stats"]},{key:"originColor",label:"Origin/EA",description:"Origin/EA service color",affects:["Origin badges","Origin charts","Origin stats"]},{key:"blizzardColor",label:"Blizzard",description:"Blizzard service color",affects:["Blizzard badges","Blizzard charts","Blizzard stats"]},{key:"wsusColor",label:"Windows Update",description:"Windows Update service color",affects:["WSUS badges","WSUS charts","WSUS stats"]},{key:"riotColor",label:"Riot Games",description:"Riot Games service color",affects:["Riot badges","Riot charts","Riot stats"]}]},{name:"components",icon:ut,description:"Specific colors for UI components",colors:[{key:"cardBg",label:"Card Background",description:"Background for card components",affects:["Stat cards","Content cards","List items"]},{key:"cardBorder",label:"Card Border",description:"Border for card components",affects:["Card outlines","Panel borders"]},{key:"buttonBg",label:"Button Background",description:"Primary button background",affects:["Primary buttons","CTAs"]},{key:"buttonHover",label:"Button Hover",description:"Button hover state",affects:["Button hover effects"]},{key:"buttonText",label:"Button Text",description:"Button text color",affects:["Button labels"]},{key:"inputBg",label:"Input Background",description:"Form input background",affects:["Text inputs","Selects","Textareas"]},{key:"inputBorder",label:"Input Border",description:"Form input border",affects:["Input outlines"]},{key:"inputFocus",label:"Input Focus",description:"Focused input border",affects:["Active input borders"]},{key:"badgeBg",label:"Badge Background",description:"Badge background color",affects:["Status badges","Tags","Pills"]},{key:"badgeText",label:"Badge Text",description:"Badge text color",affects:["Badge labels"]},{key:"progressBar",label:"Progress Bar",description:"Progress indicator color",affects:["Progress bars","Loading bars"]},{key:"progressBg",label:"Progress Background",description:"Progress bar background",affects:["Progress track"]}]},{name:"icons",icon:ft,description:"Solid background colors for icon containers (no gradients)",colors:[{key:"iconBgBlue",label:"Blue Icon Background",description:"Blue icon container background",affects:["Database icons","Info icons"]},{key:"iconBgGreen",label:"Green Icon Background",description:"Green icon container background",affects:["Success icons","Online status"]},{key:"iconBgEmerald",label:"Emerald Icon Background",description:"Emerald icon container background",affects:["Trending icons","Growth indicators"]},{key:"iconBgPurple",label:"Purple Icon Background",description:"Purple icon container background",affects:["Special features","Premium indicators"]},{key:"iconBgIndigo",label:"Indigo Icon Background",description:"Indigo icon container background",affects:["Server icons","System indicators"]},{key:"iconBgOrange",label:"Orange Icon Background",description:"Orange icon container background",affects:["Download icons","Activity indicators"]},{key:"iconBgYellow",label:"Yellow Icon Background",description:"Yellow icon container background",affects:["Warning icons","Client indicators"]},{key:"iconBgCyan",label:"Cyan Icon Background",description:"Cyan icon container background",affects:["Activity icons","Performance indicators"]},{key:"iconBgRed",label:"Red Icon Background",description:"Red icon container background",affects:["Error icons","Critical indicators"]}]},{name:"scrollbar",icon:ne,description:"Scrollbar appearance customization",colors:[{key:"scrollbarTrack",label:"Scrollbar Track",description:"Background track for scrollbars",affects:["All scrollbar tracks","Scrollbar corners"]},{key:"scrollbarThumb",label:"Scrollbar Thumb",description:"Scrollbar draggable thumb",affects:["Scrollbar handle","Firefox scrollbar color"]},{key:"scrollbarHover",label:"Scrollbar Hover",description:"Scrollbar thumb on hover",affects:["Hover state of scrollbar thumb"]}]},{name:"charts",icon:ht,description:"Colors for data visualization and charts",colors:[{key:"chartColor1",label:"Chart Color 1",description:"Primary chart data color",affects:["First data series","Primary pie/donut slice"]},{key:"chartColor2",label:"Chart Color 2",description:"Secondary chart data color",affects:["Second data series","Secondary pie/donut slice"]},{key:"chartColor3",label:"Chart Color 3",description:"Tertiary chart data color",affects:["Third data series","Third pie/donut slice"]},{key:"chartColor4",label:"Chart Color 4",description:"Quaternary chart data color",affects:["Fourth data series","Fourth pie/donut slice"]},{key:"chartColor5",label:"Chart Color 5",description:"Fifth chart data color",affects:["Fifth data series","Fifth pie/donut slice"]},{key:"chartColor6",label:"Chart Color 6",description:"Sixth chart data color",affects:["Sixth data series","Sixth pie/donut slice"]},{key:"chartColor7",label:"Chart Color 7",description:"Seventh chart data color",affects:["Seventh data series","Seventh pie/donut slice"]},{key:"chartColor8",label:"Chart Color 8",description:"Eighth chart data color",affects:["Eighth data series","Eighth pie/donut slice"]},{key:"chartBorderColor",label:"Chart Border Color",description:"Border color between chart segments",affects:["Donut/pie borders","Bar borders"]},{key:"chartGridColor",label:"Chart Grid Color",description:"Grid lines and axes color",affects:["Grid lines","Axes","Tick marks"]},{key:"chartTextColor",label:"Chart Text Color",description:"Chart labels and legend text",affects:["Axis labels","Legend text","Data labels"]},{key:"chartCacheHitColor",label:"Cache Hit Color",description:"Color for cache hit data in charts",affects:["Cache hit ratio chart","Hit indicators"]},{key:"chartCacheMissColor",label:"Cache Miss Color",description:"Color for cache miss data in charts",affects:["Cache miss ratio chart","Miss indicators"]}]}];d.useEffect(()=>{X();const t=L.getCurrentThemeId();c(t),console.log("=== Color History in localStorage ==="),Object.keys(localStorage).forEach(r=>{r.startsWith("color_history_")&&console.log(`${r}: ${localStorage.getItem(r)}`)}),console.log("=====================================")},[]);const X=async()=>{i(!0);try{const t=await L.loadThemes();s(t)}catch(t){console.error("Failed to load themes:",t),g("Failed to load themes")}finally{i(!1)}},q=async t=>{try{if(!t){L.clearTheme(),c(""),n(null);return}const r=await L.getTheme(t);r&&(L.applyTheme(r),c(t),n(null))}catch(r){console.error("Failed to apply theme:",r),g("Failed to apply theme")}},Oe=async t=>{if(f===t)q(l),n(null);else try{const r=await L.getTheme(t);r&&(L.applyTheme(r),n(t))}catch(r){console.error("Failed to preview theme:",r)}},he=t=>{E(r=>r.includes(t)?r.filter(C=>C!==t):[...r,t])},[ze,ae]=d.useState({}),se=t=>{if(!ze[t]){const r=y[t];r&&(localStorage.setItem(`color_history_create_${t}`,r),console.log(`Saved original create color: ${t} = ${r}`)),ae(C=>({...C,[t]:!0}))}},ge=(t,r)=>{U(C=>({...C,[t]:r}))},Ee=t=>{const r=localStorage.getItem(`color_history_create_${t}`);if(r){const C=y[t];U(h=>({...h,[t]:r})),localStorage.setItem(`color_history_create_${t}`,C)}},xe=t=>localStorage.getItem(`color_history_create_${t}`),re=t=>{if(!u[t]){const r=v[t];if(r&&r.match(/^#[0-9a-fA-F]{6}$/)){const C=`color_history_${p==null?void 0:p.meta.id}_${t}`;localStorage.setItem(C,r),console.log(`Saved original color to history: ${t} = ${r}`)}H(C=>({...C,[t]:!0}))}},pe=(t,r)=>{$(C=>({...C,[t]:r}))},_e=t=>{const r=`color_history_${p==null?void 0:p.meta.id}_${t}`,C=localStorage.getItem(r);if(C){const h=v[t];console.log(`Restoring ${t}: ${h} -> ${C}`),$(k=>({...k,[t]:C})),localStorage.setItem(r,h||"")}},Ue=t=>{const r=`color_history_${p==null?void 0:p.meta.id}_${t}`,C=localStorage.getItem(r);return console.log(`getEditColorHistory: key=${t}, historyKey=${r}, value=${C}`),C},be=async t=>{try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(t);else{const r=document.createElement("textarea");r.value=t,r.style.position="fixed",r.style.left="-999999px",r.style.top="-999999px",document.body.appendChild(r),r.focus(),r.select(),document.execCommand("copy"),document.body.removeChild(r)}j(t),setTimeout(()=>j(null),2e3)}catch(r){console.error("Failed to copy color:",r)}},oe=t=>{t.preventDefault(),t.stopPropagation(),t.type==="dragenter"||t.type==="dragover"?x(!0):t.type==="dragleave"&&x(!1)},Ge=async t=>{t.preventDefault(),t.stopPropagation(),x(!1),t.dataTransfer.files&&t.dataTransfer.files[0]&&await ye(t.dataTransfer.files[0])},ye=async t=>{if(g(null),P(null),!t.name.endsWith(".toml")){g("Only TOML theme files are supported");return}if(t.size>1024*1024){g("Theme file too large (max 1MB)");return}i(!0);try{const r=await L.uploadTheme(t);await new Promise(h=>setTimeout(h,100));const C=await L.loadThemes();s(C),P(`Theme "${r.meta.name}" uploaded successfully`),setTimeout(()=>P(null),5e3)}catch(r){g(r.message)}finally{i(!1)}},We=async(t,r)=>{var h;if(["dark-default","light-default"].includes(t)){g("System themes cannot be deleted"),setTimeout(()=>g(null),5e3);return}if(!o){g("Authentication required to delete custom themes"),setTimeout(()=>g(null),5e3);return}if(window.confirm(`Delete theme "${r}"? This cannot be undone.`)){i(!0);try{const k=await fetch(`${$e}/theme/${t}`,{method:"DELETE",headers:G.getAuthHeaders()}),B=await k.json();if(k.ok&&B.success){await X(),l===t&&q("dark-default");const O=((h=B.filesDeleted)==null?void 0:h.join(", "))||"theme files";P(`Theme "${r}" deleted successfully (removed: ${O})`),setTimeout(()=>P(null),5e3)}else if(k.status===404)g(`Theme "${r}" not found on server. ${B.details||""}`),s(O=>O.filter(W=>W.meta.id!==t)),l===t&&q("dark-default"),B.availableThemes&&console.log("Available themes on server:",B.availableThemes),setTimeout(()=>g(null),1e4);else{const O=B.error||B.message||"Failed to delete theme",W=B.details?` Details: ${B.details}`:"";g(`${O}${W}`),setTimeout(()=>g(null),7e3)}}catch(k){console.error("Delete request failed:",k),g(`Failed to delete theme: ${k.message||"Network error"}`),setTimeout(()=>g(null),7e3)}finally{i(!1)}}},qe=async()=>{if(!o){g("Authentication required to clean up themes"),setTimeout(()=>g(null),5e3);return}if(window.confirm("This will DELETE all custom themes (keeping only system themes). This cannot be undone. Continue?")){i(!0);try{const t=await fetch(`${$e}/theme/cleanup`,{method:"POST",headers:{"Content-Type":"application/json",...G.getAuthHeaders()}});if(!t.ok)throw new Error("Failed to cleanup themes");const r=await t.json();await X(),m.map(h=>h.meta.id).includes(l)||q("dark-default"),P(r.message||"All custom themes have been deleted"),setTimeout(()=>P(null),5e3)}catch(t){g("Failed to cleanup themes: "+t.message),setTimeout(()=>g(null),5e3)}finally{i(!1)}}},Ke=t=>{var k;if(!o){g("Authentication required to edit themes"),setTimeout(()=>g(null),5e3);return}if(V(t.meta.id)){g("System themes cannot be edited"),setTimeout(()=>g(null),5e3);return}const r=m.find(B=>B.meta.id===t.meta.id)||t;console.log("Editing theme:",r),console.log("Theme colors:",r.colors),H({}),I(r);const C={name:r.meta.name,description:r.meta.description||"",author:r.meta.author||"",version:r.meta.version||"1.0.0",isDark:r.meta.isDark!==!1,...r.colors,customCSS:((k=r.css)==null?void 0:k.content)||""};r.colors.dragHandleColor||(C.dragHandleColor=r.meta.isDark?"#6b7280":"#9ca3af"),r.colors.dragHandleHover||(C.dragHandleHover=r.meta.isDark?"#60a5fa":"#2563eb"),console.log("Theme data for editing:",C);const h=Object.keys(C).filter(B=>!["name","description","author","version","isDark","customCSS"].includes(B));console.log("Color keys and values in theme data:"),h.forEach(B=>{console.log(`  ${B}: ${C[B]}`)}),$(C),A(!0)},Ye=async()=>{if(!o||!p)return;if(!v.name.trim()){g("Theme name is required"),setTimeout(()=>g(null),5e3);return}console.log("Saving theme with colors:",v);const t={};Object.entries(v).forEach(([B,O])=>{["name","description","author","version","isDark","customCSS"].includes(B)||(t[B]=O)});const r={meta:{id:p.meta.id,name:v.name,description:v.description,author:v.author,version:v.version,isDark:v.isDark},colors:t,css:v.customCSS?{content:v.customCSS}:void 0};console.log("Theme object to save:",r);const C=L.exportTheme(r),h=new Blob([C],{type:"text/plain"}),k=new File([h],`${r.meta.id}.toml`,{type:"text/plain"});i(!0);try{await L.uploadTheme(k),await new Promise(W=>setTimeout(W,100));const B=await L.loadThemes();s(B);const O=B.find(W=>W.meta.id===r.meta.id);if(O)l===p.meta.id&&L.applyTheme(O),P(`Theme "${O.meta.name}" updated successfully`);else throw new Error("Theme was uploaded but not found on server");Object.keys(v).forEach(W=>{const Ze=`color_history_${p.meta.id}_${W}`;localStorage.removeItem(Ze)}),H({}),A(!1),I(null),$({}),setTimeout(()=>P(null),5e3)}catch(B){g(B.message||"Failed to update theme"),i(!1);return}i(!1)},Ve=async()=>{if(!o){g("Authentication required to create themes");return}if(!y.name.trim()){g("Theme name is required"),setTimeout(()=>g(null),5e3);return}const t={meta:{id:y.name.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""),name:y.name,description:y.description,author:y.author,version:y.version,isDark:y.isDark},colors:{...y},css:y.customCSS?{content:y.customCSS}:void 0};delete t.colors.name,delete t.colors.description,delete t.colors.author,delete t.colors.version,delete t.colors.isDark,delete t.colors.customCSS;const r=L.exportTheme(t),C=new Blob([r],{type:"text/plain"}),h=new File([C],`${t.meta.id}.toml`,{type:"text/plain"});i(!0);try{await L.uploadTheme(h),await new Promise(O=>setTimeout(O,100));const k=await L.loadThemes();s(k);const B=k.find(O=>O.meta.id===t.meta.id);B&&(L.applyTheme(B),c(B.meta.id)),M(!1),Object.keys(y).forEach(O=>{localStorage.removeItem(`color_history_create_${O}`)}),ae({}),U({name:"",description:"",author:"",version:"1.0.0",isDark:!0,primaryColor:"#3b82f6",secondaryColor:"#8b5cf6",accentColor:"#06b6d4",bgPrimary:"#111827",bgSecondary:"#1f2937",bgTertiary:"#374151",bgHover:"#4b5563",textPrimary:"#ffffff",textSecondary:"#d1d5db",textMuted:"#9ca3af",textAccent:"#60a5fa",dragHandleColor:"#6b7280",dragHandleHover:"#60a5fa",borderPrimary:"#374151",borderSecondary:"#4b5563",borderFocus:"#3b82f6",navBg:"#1f2937",navBorder:"#374151",navTabActive:"#3b82f6",navTabInactive:"#9ca3af",navTabHover:"#ffffff",navTabActiveBorder:"#3b82f6",navMobileMenuBg:"#1f2937",navMobileItemHover:"#374151",success:"#10b981",successBg:"#064e3b",successText:"#34d399",warning:"#f59e0b",warningBg:"#78350f",warningText:"#fbbf24",error:"#ef4444",errorBg:"#7f1d1d",errorText:"#fca5a5",info:"#3b82f6",infoBg:"#1e3a8a",infoText:"#93c5fd",steamColor:"#1e40af",epicColor:"#7c3aed",originColor:"#ea580c",blizzardColor:"#0891b2",wsusColor:"#16a34a",riotColor:"#dc2626",cardBg:"#1f2937",cardBorder:"#374151",buttonBg:"#3b82f6",buttonHover:"#2563eb",buttonText:"#ffffff",inputBg:"#374151",inputBorder:"#4b5563",inputFocus:"#3b82f6",badgeBg:"#3b82f6",badgeText:"#ffffff",progressBar:"#3b82f6",progressBg:"#374151",iconBgBlue:"#3b82f6",iconBgGreen:"#10b981",iconBgEmerald:"#10b981",iconBgPurple:"#8b5cf6",iconBgIndigo:"#6366f1",iconBgOrange:"#f97316",iconBgYellow:"#eab308",iconBgCyan:"#06b6d4",iconBgRed:"#ef4444",chartColor1:"#3b82f6",chartColor2:"#10b981",chartColor3:"#f59e0b",chartColor4:"#ef4444",chartColor5:"#8b5cf6",chartColor6:"#06b6d4",chartColor7:"#f97316",chartColor8:"#ec4899",chartBorderColor:"#1f2937",chartGridColor:"#374151",chartTextColor:"#9ca3af",chartCacheHitColor:"#10b981",chartCacheMissColor:"#f59e0b",scrollbarTrack:"#374151",scrollbarThumb:"#6B7280",scrollbarHover:"#9CA3AF",customCSS:""}),P(`Theme "${t.meta.name}" created successfully`),setTimeout(()=>P(null),5e3)}catch(k){g(k.message||"Failed to create theme")}finally{i(!1)}},ve=t=>{U(t==="dark"?r=>({...r,isDark:!0,bgPrimary:"#111827",bgSecondary:"#1f2937",bgTertiary:"#374151",bgHover:"#4b5563",textPrimary:"#ffffff",textSecondary:"#d1d5db",textMuted:"#9ca3af",dragHandleColor:"#6b7280",dragHandleHover:"#00ff00",borderPrimary:"#374151",borderSecondary:"#4b5563",navBg:"#1f2937",navBorder:"#374151",navTabActive:"#3b82f6",navTabInactive:"#9ca3af",navTabHover:"#ffffff",navTabActiveBorder:"#3b82f6",navMobileMenuBg:"#1f2937",navMobileItemHover:"#374151",cardBg:"#1f2937",cardBorder:"#374151",inputBg:"#374151",inputBorder:"#4b5563",progressBg:"#374151",successBg:"#064e3b",successText:"#34d399",warningBg:"#78350f",warningText:"#fbbf24",errorBg:"#7f1d1d",errorText:"#fca5a5",infoBg:"#1e3a8a",infoText:"#93c5fd",chartBorderColor:"#1f2937",chartGridColor:"#374151",chartTextColor:"#9ca3af",scrollbarTrack:"#374151",scrollbarThumb:"#6B7280",scrollbarHover:"#9CA3AF"}):r=>({...r,isDark:!1,bgPrimary:"#ffffff",bgSecondary:"#f9fafb",bgTertiary:"#f3f4f6",bgHover:"#e5e7eb",textPrimary:"#111827",textSecondary:"#374151",textMuted:"#6b7280",dragHandleColor:"#9ca3af",dragHandleHover:"#2563eb",borderPrimary:"#e5e7eb",borderSecondary:"#d1d5db",navBg:"#f9fafb",navBorder:"#e5e7eb",navTabActive:"#3b82f6",navTabInactive:"#6b7280",navTabHover:"#111827",navTabActiveBorder:"#3b82f6",navMobileMenuBg:"#f9fafb",navMobileItemHover:"#e5e7eb",cardBg:"#ffffff",cardBorder:"#e5e7eb",inputBg:"#ffffff",inputBorder:"#d1d5db",progressBg:"#e5e7eb",successBg:"#d1fae5",successText:"#065f46",warningBg:"#fef3c7",warningText:"#92400e",errorBg:"#fee2e2",errorText:"#991b1b",infoBg:"#dbeafe",infoText:"#1e40af",chartBorderColor:"#e5e7eb",chartGridColor:"#d1d5db",chartTextColor:"#6b7280",scrollbarTrack:"#f3f4f6",scrollbarThumb:"#9ca3af",scrollbarHover:"#6b7280"}))},Je=t=>{const r=L.exportTheme(t),C=new Blob([r],{type:"text/plain"}),h=URL.createObjectURL(C),k=document.createElement("a");k.href=h,k.download=`${t.meta.id}.toml`,k.click(),URL.revokeObjectURL(h)},Qe=()=>{const t=`# Sample Theme for LANCache Manager
[meta]
name = "My Custom Theme"
id = "my-custom-theme"
description = "A beautiful custom theme"
author = "Your Name"
version = "1.0.0"
isDark = true

[colors]
# Core colors
primaryColor = "#3b82f6"
secondaryColor = "#8b5cf6"
accentColor = "#06b6d4"

# Backgrounds
bgPrimary = "#111827"
bgSecondary = "#1f2937"
bgTertiary = "#374151"
bgHover = "#4b5563"

# Text
textPrimary = "#ffffff"
textSecondary = "#d1d5db"
textMuted = "#9ca3af"
textAccent = "#60a5fa"
dragHandleColor = "#6b7280"
dragHandleHover = "#60a5fa"

# Borders
borderPrimary = "#374151"
borderSecondary = "#4b5563"
borderFocus = "#3b82f6"

# Navigation colors
navBg = "#1f2937"
navBorder = "#374151"
navTabActive = "#3b82f6"
navTabInactive = "#9ca3af"
navTabHover = "#ffffff"
navTabActiveBorder = "#3b82f6"
navMobileMenuBg = "#1f2937"
navMobileItemHover = "#374151"

# Hit Rate & Status Badge colors
hitRateHighBg = "#064e3b"
hitRateHighText = "#34d399"
hitRateMediumBg = "#1e3a8a"
hitRateMediumText = "#93c5fd"
hitRateLowBg = "#ea580c"
hitRateLowText = "#fb923c"
statusWarningBg = "#78350f"
statusWarningText = "#fbbf24"

# Action Button colors
actionResetBg = "#f59e0b"
actionResetHover = "#d97706"
actionProcessBg = "#10b981"
actionProcessHover = "#059669"
actionDeleteBg = "#ef4444"
actionDeleteHover = "#dc2626"

# Status colors
success = "#10b981"
successBg = "#064e3b"
successText = "#34d399"
warning = "#f59e0b"
warningBg = "#78350f"
warningText = "#fbbf24"
error = "#ef4444"
errorBg = "#7f1d1d"
errorText = "#fca5a5"
info = "#3b82f6"
infoBg = "#1e3a8a"
infoText = "#93c5fd"

# Service colors
steamColor = "#1e40af"
epicColor = "#7c3aed"
originColor = "#ea580c"
blizzardColor = "#0891b2"
wsusColor = "#16a34a"
riotColor = "#dc2626"

# Components
cardBg = "#1f2937"
cardBorder = "#374151"
buttonBg = "#3b82f6"
buttonHover = "#2563eb"
buttonText = "#ffffff"
inputBg = "#374151"
inputBorder = "#4b5563"
inputFocus = "#3b82f6"
badgeBg = "#3b82f6"
badgeText = "#ffffff"
progressBar = "#3b82f6"
progressBg = "#374151"

# Icon backgrounds (solid colors, no gradients)
iconBgBlue = "#3b82f6"
iconBgGreen = "#10b981"
iconBgEmerald = "#10b981"
iconBgPurple = "#8b5cf6"
iconBgIndigo = "#6366f1"
iconBgOrange = "#f97316"
iconBgYellow = "#eab308"
iconBgCyan = "#06b6d4"
iconBgRed = "#ef4444"

# Chart colors
chartColor1 = "#3b82f6"
chartColor2 = "#10b981"
chartColor3 = "#f59e0b"
chartColor4 = "#ef4444"
chartColor5 = "#8b5cf6"
chartColor6 = "#06b6d4"
chartColor7 = "#f97316"
chartColor8 = "#ec4899"
chartBorderColor = "#1f2937"
chartGridColor = "#374151"
chartTextColor = "#9ca3af"
chartCacheHitColor = "#10b981"
chartCacheMissColor = "#f59e0b"

[css]
content = """
/* Add any custom CSS here */
"""`,r=new Blob([t],{type:"text/plain"}),C=URL.createObjectURL(r),h=document.createElement("a");h.href=C,h.download="sample-theme.toml",h.click(),URL.revokeObjectURL(C)},V=t=>["dark-default","light-default"].includes(t);return e.jsxs(e.Fragment,{children:[e.jsxs(Y,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(je,{className:"w-5 h-5 text-themed-accent"}),e.jsx("h3",{className:"text-lg font-semibold text-themed-primary",children:"Theme Management"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[o?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>M(!0),className:"p-2 rounded-lg transition-colors",style:{color:"var(--theme-text-muted)",backgroundColor:"transparent"},onMouseEnter:t=>t.currentTarget.style.backgroundColor="var(--theme-bg-hover)",onMouseLeave:t=>t.currentTarget.style.backgroundColor="transparent",title:"Create new theme",children:e.jsx(rt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:qe,disabled:a,className:"p-2 rounded-lg transition-colors",style:{color:"var(--theme-text-muted)",backgroundColor:"transparent"},onMouseEnter:t=>t.currentTarget.style.backgroundColor="var(--theme-bg-hover)",onMouseLeave:t=>t.currentTarget.style.backgroundColor="transparent",title:"Delete all custom themes",children:e.jsx(ot,{className:"w-4 h-4"})})]}):e.jsx("button",{disabled:!0,className:"p-2 rounded-lg transition-colors opacity-50 cursor-not-allowed",style:{color:"var(--theme-text-muted)",backgroundColor:"transparent"},title:"Authentication required to create themes",children:e.jsx(ie,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>X(),disabled:a,className:"p-2 rounded-lg transition-colors",style:{color:"var(--theme-text-muted)",backgroundColor:"transparent"},onMouseEnter:t=>t.currentTarget.style.backgroundColor="var(--theme-bg-hover)",onMouseLeave:t=>t.currentTarget.style.backgroundColor="transparent",title:"Refresh themes",children:e.jsx(De,{className:`w-4 h-4 ${a?"animate-spin":""}`})})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-themed-secondary",children:"Active Theme"}),e.jsx("select",{value:f||l,onChange:t=>q(t.target.value),className:"w-full px-3 py-2 focus:outline-none themed-input",disabled:a,children:m.map(t=>e.jsxs("option",{value:t.meta.id,children:[t.meta.name," ",t.meta.author&&t.meta.author!=="System"&&`by ${t.meta.author}`,V(t.meta.id)&&" (System)",f===t.meta.id&&" (Preview)"]},t.meta.id))}),f&&e.jsx("p",{className:"text-xs mt-2",style:{color:"var(--theme-warning)"},children:"Preview mode active. Select a theme to apply it permanently."})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("h4",{className:"text-sm font-medium mb-3 text-themed-secondary",children:["Installed Themes (",m.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:m.map(t=>e.jsxs("div",{className:"rounded p-3 flex items-center justify-between border-2 transition-colors themed-card",style:{borderColor:l===t.meta.id&&!f?"var(--theme-primary)":f===t.meta.id?"var(--theme-warning)":"transparent"},children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-themed-primary",children:t.meta.name}),t.meta.isDark?e.jsx(we,{className:"w-3 h-3 text-themed-muted"}):e.jsx(ke,{className:"w-3 h-3",style:{color:"var(--theme-warning)"}}),l===t.meta.id&&!f&&e.jsx("span",{className:"px-2 py-0.5 text-xs rounded themed-button-primary",children:"Active"}),f===t.meta.id&&e.jsx("span",{className:"px-2 py-0.5 text-xs rounded",style:{backgroundColor:"var(--theme-warning)",color:"var(--theme-bg-primary)"},children:"Preview"}),V(t.meta.id)&&e.jsx("span",{className:"px-2 py-0.5 text-xs rounded",style:{backgroundColor:"var(--theme-bg-hover)",color:"var(--theme-text-muted)"},children:"System"})]}),t.meta.description&&e.jsx("p",{className:"text-xs mt-1 text-themed-muted",children:t.meta.description}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[t.meta.author&&e.jsxs("p",{className:"text-xs text-themed-muted",children:["by ",t.meta.author]}),t.meta.version&&e.jsxs("p",{className:"text-xs text-themed-muted",children:["v",t.meta.version]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>Je(t),className:"p-2 transition-colors text-themed-muted",title:"Export theme",children:e.jsx(Te,{className:"w-4 h-4"})}),l!==t.meta.id&&e.jsx("button",{onClick:()=>Oe(t.meta.id),className:"p-2 transition-colors",style:{color:f===t.meta.id?"var(--theme-warning)":"var(--theme-text-muted)"},title:f===t.meta.id?"Stop preview":"Preview theme",children:f===t.meta.id?e.jsx(lt,{className:"w-4 h-4"}):e.jsx(Re,{className:"w-4 h-4"})}),l!==t.meta.id&&e.jsx("button",{onClick:()=>q(t.meta.id),className:"p-2 transition-colors text-themed-accent",title:"Apply theme",children:e.jsx(le,{className:"w-4 h-4"})}),!V(t.meta.id)&&o&&e.jsx("button",{onClick:()=>Ke(t),disabled:a,className:"p-2 transition-colors",style:{color:"var(--theme-text-secondary)"},title:"Edit theme",children:e.jsx(nt,{className:"w-4 h-4"})}),!V(t.meta.id)&&o&&e.jsx("button",{onClick:()=>We(t.meta.id,t.meta.name),disabled:a,className:"p-2 transition-colors disabled:opacity-50",style:{color:"var(--theme-error)"},title:"Delete theme",children:e.jsx(Fe,{className:"w-4 h-4"})})]})]},t.meta.id))})]}),o&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-sm font-medium mb-3 text-themed-secondary",children:"Upload Custom Theme"}),e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${b?"border-purple-500 bg-purple-900 bg-opacity-20":""}`,style:{borderColor:b?"var(--theme-secondary)":"var(--theme-border-secondary)"},onDragEnter:oe,onDragLeave:oe,onDragOver:oe,onDrop:Ge,children:[e.jsx(ct,{className:"w-12 h-12 mx-auto mb-3 text-themed-muted"}),e.jsx("p",{className:"mb-2 text-themed-secondary",children:"Drag and drop a theme file here, or click to browse"}),e.jsx("p",{className:"text-xs mb-3 text-themed-muted",children:"TOML format, max 1MB"}),e.jsx("input",{ref:ue,type:"file",accept:".toml",onChange:t=>{var r;return((r=t.target.files)==null?void 0:r[0])&&ye(t.target.files[0])},className:"hidden"}),e.jsx(F,{variant:"filled",color:"purple",onClick:()=>{var t;return(t=ue.current)==null?void 0:t.click()},disabled:a,loading:a,children:"Browse Files"})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(F,{variant:"subtle",leftSection:e.jsx(Te,{className:"w-4 h-4"}),onClick:Qe,children:"Download Sample TOML Theme"})})]}),!o&&e.jsx(z,{color:"yellow",children:"Authentication required to create, upload, or delete custom themes"}),S&&e.jsx(z,{color:"red",withCloseButton:!0,onClose:()=>g(null),children:S}),T&&e.jsx(z,{color:"green",withCloseButton:!0,onClose:()=>P(null),children:T})]}),e.jsx(te,{opened:N,onClose:()=>{M(!1),ae({})},title:"Create Custom Theme",size:"xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-sm font-semibold flex items-center gap-2 text-themed-primary",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Theme Information"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Theme Name *"}),e.jsx("input",{type:"text",value:y.name,onChange:t=>U({...y,name:t.target.value}),placeholder:"My Custom Theme",className:"w-full px-3 py-2 focus:outline-none themed-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Author"}),e.jsx("input",{type:"text",value:y.author,onChange:t=>U({...y,author:t.target.value}),placeholder:"Your Name",className:"w-full px-3 py-2 focus:outline-none themed-input"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Description"}),e.jsx("input",{type:"text",value:y.description,onChange:t=>U({...y,description:t.target.value}),placeholder:"A beautiful custom theme",className:"w-full px-3 py-2 rounded focus:outline-none themed-input"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:y.isDark,onChange:t=>U({...y,isDark:t.target.checked}),className:"rounded"}),e.jsx("span",{className:"text-sm text-themed-secondary",children:"Dark Theme"})]}),e.jsxs("button",{onClick:()=>ve("dark"),className:"px-3 py-1 text-xs rounded-lg flex items-center gap-1",style:{backgroundColor:"var(--theme-bg-tertiary)",color:"var(--theme-text-secondary)"},children:[e.jsx(we,{className:"w-3 h-3"}),"Load Dark Preset"]}),e.jsxs("button",{onClick:()=>ve("light"),className:"px-3 py-1 text-xs rounded-lg flex items-center gap-1",style:{backgroundColor:"var(--theme-bg-tertiary)",color:"var(--theme-text-secondary)"},children:[e.jsx(ke,{className:"w-3 h-3"}),"Load Light Preset"]})]})]}),e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:fe.map(t=>{const r=t.icon,C=R.includes(t.name);return e.jsxs("div",{className:"border rounded-lg",style:{borderColor:"var(--theme-border-primary)"},children:[e.jsxs("button",{onClick:()=>he(t.name),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-opacity-50",style:{backgroundColor:C?"var(--theme-bg-tertiary)":"transparent"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(r,{className:"w-4 h-4 text-themed-accent"}),e.jsxs("div",{className:"text-left",children:[e.jsx("h5",{className:"text-sm font-semibold capitalize text-themed-primary",children:t.name.replace(/([A-Z])/g," $1").trim()}),e.jsx("p",{className:"text-xs text-themed-muted",children:t.description})]})]}),C?e.jsx(Se,{className:"w-4 h-4"}):e.jsx(Be,{className:"w-4 h-4"})]}),C&&e.jsx("div",{className:"p-4 border-t space-y-4",style:{borderColor:"var(--theme-border-primary)"},children:t.colors.map(h=>e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-themed-primary",children:h.label}),e.jsx("p",{className:"text-xs text-themed-muted",children:h.description}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:h.affects.map((k,B)=>e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded",style:{backgroundColor:"var(--theme-bg-hover)",color:"var(--theme-text-secondary)"},children:k},B))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"relative",children:e.jsx("input",{type:"color",value:y[h.key],onMouseDown:()=>se(h.key),onFocus:()=>se(h.key),onChange:k=>ge(h.key,k.target.value),className:"w-12 h-8 rounded cursor-pointer",style:{backgroundColor:y[h.key]}})}),e.jsx("input",{type:"text",value:y[h.key],onFocus:()=>se(h.key),onChange:k=>ge(h.key,k.target.value),className:"w-24 px-2 py-1 text-xs rounded font-mono themed-input"}),e.jsx("button",{onClick:()=>be(y[h.key]),className:"p-1 rounded-lg hover:bg-opacity-50",style:{backgroundColor:"var(--theme-bg-hover)"},title:"Copy color",children:w===y[h.key]?e.jsx(le,{className:"w-3 h-3",style:{color:"var(--theme-success)"}}):e.jsx(Pe,{className:"w-3 h-3 text-themed-muted"})}),xe(h.key)&&e.jsx("button",{onClick:()=>Ee(h.key),className:"p-1 rounded-lg hover:bg-opacity-50",style:{backgroundColor:"var(--theme-bg-hover)"},title:`Restore previous color: ${xe(h.key)}`,children:e.jsx(Me,{className:"w-3 h-3 text-themed-muted"})})]})]})},h.key))})]},t.name)})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Custom CSS (Optional)"}),e.jsx("textarea",{value:y.customCSS,onChange:t=>U({...y,customCSS:t.target.value}),placeholder:"/* Add any custom CSS here */",rows:4,className:"w-full px-3 py-2 rounded font-mono text-xs focus:outline-none themed-input"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",style:{borderColor:"var(--theme-border-primary)"},children:[e.jsx(F,{variant:"default",onClick:()=>M(!1),children:"Cancel"}),e.jsx(F,{variant:"filled",leftSection:e.jsx(Ae,{className:"w-4 h-4"}),onClick:Ve,disabled:!y.name||!o,className:"themed-button-primary",children:"Create Theme"})]})]})}),e.jsx(te,{opened:_,onClose:()=>{A(!1),I(null),$({}),H({})},title:`Edit Theme: ${(p==null?void 0:p.meta.name)||""}`,size:"xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-sm font-semibold flex items-center gap-2 text-themed-primary",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Theme Information"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Theme Name *"}),e.jsx("input",{type:"text",value:v.name||"",onChange:t=>$({...v,name:t.target.value}),placeholder:"My Custom Theme",className:"w-full px-3 py-2 focus:outline-none themed-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Author"}),e.jsx("input",{type:"text",value:v.author||"",onChange:t=>$({...v,author:t.target.value}),placeholder:"Your Name",className:"w-full px-3 py-2 focus:outline-none themed-input"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Description"}),e.jsx("input",{type:"text",value:v.description||"",onChange:t=>$({...v,description:t.target.value}),placeholder:"A beautiful custom theme",className:"w-full px-3 py-2 rounded focus:outline-none themed-input"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:v.isDark||!1,onChange:t=>$({...v,isDark:t.target.checked}),className:"rounded"}),e.jsx("span",{className:"text-sm text-themed-secondary",children:"Dark Theme"})]}),e.jsxs("span",{className:"text-xs text-themed-muted",children:["Theme ID: ",p==null?void 0:p.meta.id]})]})]}),e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:fe.map(t=>{const r=t.icon,C=R.includes(t.name);return e.jsxs("div",{className:"border rounded-lg",style:{borderColor:"var(--theme-border-primary)"},children:[e.jsxs("button",{onClick:()=>he(t.name),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-opacity-50",style:{backgroundColor:C?"var(--theme-bg-tertiary)":"transparent"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(r,{className:"w-4 h-4 text-themed-accent"}),e.jsxs("div",{className:"text-left",children:[e.jsx("h5",{className:"text-sm font-semibold capitalize text-themed-primary",children:t.name.replace(/([A-Z])/g," $1").trim()}),e.jsx("p",{className:"text-xs text-themed-muted",children:t.description})]})]}),C?e.jsx(Se,{className:"w-4 h-4"}):e.jsx(Be,{className:"w-4 h-4"})]}),C&&e.jsx("div",{className:"p-4 border-t space-y-4",style:{borderColor:"var(--theme-border-primary)"},children:t.colors.map(h=>e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-themed-primary",children:h.label}),e.jsx("p",{className:"text-xs text-themed-muted",children:h.description}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:h.affects.map((k,B)=>e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded",style:{backgroundColor:"var(--theme-bg-hover)",color:"var(--theme-text-secondary)"},children:k},B))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"relative",children:e.jsx("input",{type:"color",value:v[h.key]||"#000000",onMouseDown:()=>re(h.key),onFocus:()=>re(h.key),onChange:k=>pe(h.key,k.target.value),className:"w-12 h-8 rounded cursor-pointer",style:{backgroundColor:v[h.key]||"#000000"}})}),e.jsx("input",{type:"text",value:v[h.key]||"",onFocus:()=>re(h.key),onChange:k=>pe(h.key,k.target.value),className:"w-24 px-2 py-1 text-xs rounded font-mono themed-input",placeholder:h.key}),e.jsx("button",{onClick:()=>be(v[h.key]||""),className:"p-1 rounded-lg hover:bg-opacity-50",style:{backgroundColor:"var(--theme-bg-hover)"},title:"Copy color",children:w===v[h.key]?e.jsx(le,{className:"w-3 h-3",style:{color:"var(--theme-success)"}}):e.jsx(Pe,{className:"w-3 h-3 text-themed-muted"})}),(()=>{const k=Ue(h.key);return k?e.jsx("button",{onClick:()=>_e(h.key),className:"p-1 rounded-lg hover:bg-opacity-50",style:{backgroundColor:"var(--theme-bg-hover)"},title:`Restore previous color: ${k}`,children:e.jsx(Me,{className:"w-3 h-3 text-themed-muted"})}):null})()]})]})},h.key))})]},t.name)})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Custom CSS (Optional)"}),e.jsx("textarea",{value:v.customCSS||"",onChange:t=>$({...v,customCSS:t.target.value}),placeholder:"/* Add any custom CSS here */",rows:4,className:"w-full px-3 py-2 rounded font-mono text-xs focus:outline-none themed-input"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",style:{borderColor:"var(--theme-border-primary)"},children:[e.jsx(F,{variant:"default",onClick:()=>{A(!1),I(null),$({})},children:"Cancel"}),e.jsx(F,{variant:"filled",leftSection:e.jsx(Ae,{className:"w-4 h-4"}),onClick:Ye,disabled:!v.name||!o||a,className:"themed-button-primary",children:"Save Changes"})]})]})})]})},Nt=({alerts:o,onClearError:m,onClearSuccess:s})=>{var l,c;return!o||!((l=o.errors)!=null&&l.length)&&!o.success?null:e.jsxs("div",{className:"space-y-4",children:[(c=o.errors)==null?void 0:c.map(a=>e.jsx(z,{color:"red",icon:e.jsx(Z,{className:"w-5 h-5"}),withCloseButton:!0,onClose:()=>m(a.id),children:a.message},a.id)),o.success&&e.jsx(z,{color:"green",icon:e.jsx(de,{className:"w-5 h-5"}),withCloseButton:!!s,onClose:s,children:o.success})]})},St=({mockMode:o,onToggle:m,disabled:s})=>e.jsxs(Y,{children:[e.jsx("h3",{className:"text-lg font-semibold text-themed-primary mb-4",children:"Mock Mode"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-themed-secondary",children:"Enable mock data for demonstration"}),e.jsx("p",{className:"text-sm text-themed-muted mt-1",children:"Simulates realistic cache data and download activity"})]}),e.jsx(F,{onClick:m,disabled:s,variant:"filled",color:"blue",leftSection:o?e.jsx(gt,{className:"w-5 h-5"}):e.jsx(xt,{className:"w-5 h-5"}),children:o?"Enabled":"Disabled"})]}),o&&e.jsx("div",{className:"mt-4",children:e.jsx(z,{color:"blue",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Mock mode active - API actions disabled"})]})})})]}),Bt=({isAuthenticated:o,mockMode:m,onError:s,onSuccess:l,onDataRefresh:c})=>{const[a,i]=d.useState(!1),b=async()=>{if(!o){s==null||s("Authentication required");return}if(window.confirm("Delete all download history?")){i(!0);try{const x=await D.resetDatabase();x&&(l==null||l(x.message||"Database reset successfully"),setTimeout(()=>c==null?void 0:c(),2e3))}catch(x){s==null||s(x.message||"Failed to reset database")}finally{i(!1)}}};return e.jsxs(Y,{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(Ie,{className:"w-5 h-5 text-themed-accent"}),e.jsx("h3",{className:"text-lg font-semibold text-themed-primary",children:"Database Management"})]}),e.jsx("p",{className:"text-themed-muted text-sm mb-4",children:"Manage download history and statistics"}),e.jsx(F,{onClick:b,disabled:a||m||!o,loading:a,variant:"filled",color:"red",leftSection:e.jsx(Ie,{className:"w-4 h-4"}),fullWidth:!0,children:"Reset Database"}),e.jsx("p",{className:"text-xs text-themed-muted mt-2",children:"Clears all download history (does not affect cached files)"})]})},Pt=({isAuthenticated:o,mockMode:m,onError:s,onSuccess:l,onDataRefresh:c,onBackgroundOperation:a})=>{const[i,b]=d.useState({}),[x,S]=d.useState({logPath:"/logs/access.log",services:[]}),[g,T]=d.useState(null),[P,f]=d.useState(!0),n=me("activeServiceRemoval","serviceRemoval",30);d.useEffect(()=>{N(),M()},[]),d.useEffect(()=>{a==null||a(g)},[g,a]);const N=async()=>{try{const[p,I]=await Promise.all([D.getConfig(),D.getServiceLogCounts()]);S(p),b(I)}catch(p){console.error("Failed to load config:",p),S({logPath:"/logs/access.log",services:["steam","epic","origin","blizzard","wsus","riot"]})}finally{f(!1)}},M=async()=>{var I;const p=await n.load();(I=p==null?void 0:p.data)!=null&&I.service&&(T(p.data.service),l==null||l(`Removing ${p.data.service} entries from logs (operation resumed)...`),setTimeout(async()=>{await n.clear(),T(null);try{const[R,E]=await Promise.all([D.getConfig(),D.getServiceLogCounts()]);S(R),b(E)}catch(R){console.error("Failed to reload config:",R)}c==null||c()},1e4))},_=async p=>{var I;if(!o){s==null||s("Authentication required");return}if(window.confirm(`Remove all ${p} entries?`))try{T(p),await n.save({service:p});const R=await D.removeServiceFromLogs(p);R&&(l==null||l(R.message||`${p} entries removed successfully`)),await n.clear(),setTimeout(async()=>{T(null);try{const[E,w]=await Promise.all([D.getConfig(),D.getServiceLogCounts()]);S(E),b(w)}catch(E){console.error("Failed to reload config:",E)}c==null||c()},2e3)}catch(R){await n.clear(),T(null);const E=(I=R.message)!=null&&I.includes("read-only")?"Logs directory is read-only. Remove :ro from docker-compose volume mount.":R.message||"Action failed";s==null||s(E)}},A=x.services.length>0?x.services:[];return e.jsxs(Y,{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(Le,{className:"w-5 h-5 text-themed-accent"}),e.jsx("h3",{className:"text-lg font-semibold text-themed-primary",children:"Log File Management"})]}),e.jsxs("p",{className:"text-themed-muted text-sm mb-4",children:["Remove service entries from"," ",e.jsx("code",{className:"bg-themed-tertiary px-2 py-1 rounded",children:x.logPath})]}),P?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(Q,{className:"w-6 h-6 animate-spin text-themed-muted"})}):A.length>0?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:A.map(p=>{const I=g===p;return e.jsx(F,{onClick:()=>_(p),disabled:m||!!g||n.loading||!o,variant:"default",loading:I||n.loading,className:"flex flex-col items-center",fullWidth:!0,children:!I&&!n.loading?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"capitalize font-medium",children:["Clear ",p]}),i[p]!==void 0&&e.jsxs("span",{className:"text-xs text-themed-muted mt-1",children:["(",i[p].toLocaleString()," entries)"]})]}):e.jsx("span",{className:"capitalize font-medium",children:"Removing..."})},p)})}):e.jsx("div",{className:"text-center py-8 text-themed-muted",children:"No services configured"}),e.jsx("div",{className:"mt-4",children:e.jsx(z,{color:"yellow",children:e.jsxs("p",{className:"text-xs",children:[e.jsx("strong",{children:"Warning:"})," Requires write permissions to logs directory"]})})})]})},Dt=()=>{const{mockMode:o,setMockMode:m,fetchData:s}=pt(),[l,c]=d.useState(!1),[a,i]=d.useState({errors:[],success:null}),[b,x]=d.useState({}),S=d.useRef(!1),g=d.useCallback(n=>{i(N=>({...N,errors:[...N.errors,{id:Date.now(),message:n}]}))},[]),T=d.useCallback(n=>{i(N=>({...N,success:n})),setTimeout(()=>i(N=>({...N,success:null})),1e4)},[]),P=d.useCallback(n=>{i(N=>({...N,errors:N.errors.filter(M=>M.id!==n)}))},[]),f=d.useCallback(()=>{i(n=>({...n,success:null}))},[]);return d.useEffect(()=>{(async()=>{if(!S.current){const N=await J.migrateFromLocalStorage();N>0&&T(`Migrated ${N} operations from local storage to server`),S.current=!0}})()},[T]),e.jsxs("div",{className:"space-y-6",children:[e.jsx(jt,{onAuthChange:c,onError:g,onSuccess:T}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(Nt,{alerts:a,onClearError:P,onClearSuccess:f}),b.cacheClearing&&e.jsx(z,{color:"blue",icon:e.jsx(Q,{className:"w-5 h-5 animate-spin"}),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:"Cache clearing in progress..."}),b.cacheClearing.bytesDeleted>0&&e.jsxs("p",{className:"text-sm mt-1 opacity-75",children:[ee(b.cacheClearing.bytesDeleted)," cleared"]}),e.jsxs("p",{className:"text-sm mt-1 opacity-75",children:[(b.cacheClearing.progress||0).toFixed(0),"% complete"]})]}),e.jsx(F,{variant:"filled",color:"blue",size:"sm",leftSection:e.jsx(Re,{className:"w-4 h-4"}),onClick:b.cacheClearing.showModal,children:"View Details"})]})}),b.logProcessing&&e.jsx(z,{color:b.logProcessing.status==="complete"?"green":"yellow",icon:b.logProcessing.status==="complete"?e.jsx(de,{className:"w-5 h-5"}):e.jsx(Q,{className:"w-5 h-5 animate-spin"}),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:b.logProcessing.message}),b.logProcessing.detailMessage&&e.jsx("p",{className:"text-sm mt-1 opacity-75",children:b.logProcessing.detailMessage}),b.logProcessing.progress>0&&b.logProcessing.status!=="complete"&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"w-full progress-track rounded-full h-2",children:e.jsx("div",{className:"progress-bar-low h-2 rounded-full smooth-transition",style:{width:`${Math.min(b.logProcessing.progress,100)}%`}})}),e.jsxs("p",{className:"text-xs opacity-75 mt-1",children:[b.logProcessing.progress.toFixed(1),"% complete",b.logProcessing.estimatedTime&&` • ${b.logProcessing.estimatedTime} remaining`]})]})]}),b.logProcessing.status!=="complete"&&b.logProcessing.onCancel&&e.jsx(F,{variant:"filled",color:"red",size:"sm",leftSection:e.jsx(He,{className:"w-4 h-4"}),onClick:b.logProcessing.onCancel,children:"Cancel"})]})}),b.serviceRemoval&&e.jsx(z,{color:"orange",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Q,{className:"w-5 h-5 animate-spin"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["Removing ",b.serviceRemoval," entries from logs..."]}),e.jsx("p",{className:"text-sm mt-1",children:"This may take several minutes for large log files"})]})]})})]}),e.jsx(St,{mockMode:o,onToggle:()=>m(!o),disabled:!1}),e.jsx(Bt,{isAuthenticated:l,mockMode:o,onError:g,onSuccess:T,onDataRefresh:s}),e.jsx(wt,{isAuthenticated:l,mockMode:o,onError:g,onSuccess:T,onBackgroundOperation:n=>x(N=>({...N,cacheClearing:n}))}),e.jsx(kt,{isAuthenticated:l,mockMode:o,onError:g,onSuccess:T,onDataRefresh:s,onBackgroundOperation:n=>x(N=>({...N,logProcessing:n}))}),e.jsx(Pt,{isAuthenticated:l,mockMode:o,onError:g,onSuccess:T,onDataRefresh:s,onBackgroundOperation:n=>x(N=>({...N,serviceRemoval:n}))}),e.jsx(Tt,{isAuthenticated:l})]})};export{Dt as default};
//# sourceMappingURL=ManagementTab-mcRjk80V.js.map

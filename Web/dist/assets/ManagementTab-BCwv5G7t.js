import{r as u,j as e,R as ht,X as ye,C as re,K as Ae,x as Ue,y as se,H as pt,z as Ge,B as ae,b as te,F as We,J as qe,N as Ke,O as ft,P as Pe,Q as gt,V as xt,Y as $e,_ as Me,D as ie,o as bt,E as Ye,v as xe,$ as yt,a0 as vt,I as Ie,n as _e,m as Fe,e as Le,a1 as He,a2 as de,k as De,a3 as Re,a4 as jt,a5 as Oe,a6 as Ct,a7 as wt,A as Ve,q as kt,a8 as Nt,a9 as Tt,i as me,T as St,l as Bt,aa as At,ab as Pt}from"./react-vendor-RZh5xgoj.js";import{a as V,A as E,t as q,b as Ee,u as $t}from"./index-DOrk1n32.js";import{f as ne,C as J}from"./Card-DNS6svrV.js";import{A as W}from"./Alert-SgHHy14U.js";import{H as Mt}from"./signalr-C7Jyn4vH.js";import"./vendor-BmYUbuLR.js";import"./tanstack-CPlEqbpz.js";async function It(l){try{const y=await fetch(l,{signal:AbortSignal.timeout(5e3)});return y.ok?{ok:!0,data:await y.json()}:{ok:!1,error:`HTTP ${y.status}`}}catch(y){return{ok:!1,error:y.message}}}const be={},_t=()=>{if(!(typeof import.meta<"u"&&(be!=null&&be.VITE_API_URL)))return""},X=_t();class Ft{async getState(y){const a=await It(`${X}/api/operationstate/${y}`);return a.ok?a.data:null}async saveState(y,a,n,h=30){try{const r=await fetch(`${X}/api/operationstate`,{method:"POST",headers:{"Content-Type":"application/json",...V.getAuthHeaders()},body:JSON.stringify({key:y,type:a,data:n,expirationMinutes:h})});if(!r.ok){const c=await r.text();throw new Error(`Failed to save state: ${c}`)}return await r.json()}catch(r){throw console.error("Error saving state:",r),r}}async updateState(y,a){try{const n=`${X}/api/operationstate/${encodeURIComponent(y)}`;console.log("Updating state at:",n);const h=await fetch(n,{method:"PATCH",headers:{"Content-Type":"application/json",...V.getAuthHeaders()},body:JSON.stringify({updates:a||{}})});if(!h.ok){const r=await h.text();throw console.error("Update state response:",h.status,r),new Error(`Failed to update state: ${h.status} - ${r}`)}return await h.json()}catch(n){return console.error("Error updating state:",n),null}}async removeState(y){try{const a=await fetch(`${X}/api/operationstate/${encodeURIComponent(y)}`,{method:"DELETE",headers:V.getAuthHeaders()});if(!a.ok)throw new Error("Failed to remove state");return await a.json()}catch(a){throw console.error("Error removing state:",a),a}}async getAllStates(y=null){try{const a=y?`${X}/api/operationstate?type=${y}`:`${X}/api/operationstate`,n=await fetch(a,{headers:V.getAuthHeaders()});if(!n.ok)throw new Error("Failed to get states");return await n.json()}catch(a){return console.error("Error getting all states:",a),[]}}async migrateFromLocalStorage(){const y=["activeCacheClearOperation","activeLogProcessing","activeServiceRemoval"];let a=0;for(const n of y)try{const h=localStorage.getItem(n);if(h){const r=JSON.parse(h);let c="general";n.includes("CacheClear")?c="cacheClearing":n.includes("LogProcessing")?c="logProcessing":n.includes("ServiceRemoval")&&(c="serviceRemoval"),await this.saveState(n,c,r,120),localStorage.removeItem(n),a++,console.log(`Migrated ${n} from localStorage to backend`)}}catch(h){console.error(`Failed to migrate ${n}:`,h)}return a>0&&console.log(`Successfully migrated ${a} operations to backend storage`),a}}const ee=new Ft,ve=(l,y="general",a=30)=>{const[n,h]=u.useState(null),[r,c]=u.useState(!1),[j,g]=u.useState(null),$=u.useCallback(async b=>{c(!0),g(null);try{await ee.saveState(l,y,b,a);const d={key:l,type:y,data:b,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return h(d),d}catch(d){throw console.error(`Failed to save ${l}:`,d),g(d.message),d}finally{c(!1)}},[l,y,a]),x=u.useCallback(async()=>{c(!0),g(null);try{const b=await ee.getState(l);if(b){const d=b,P={key:d.key||l,type:d.type||y,data:d.data||{},createdAt:d.createdAt||new Date().toISOString(),updatedAt:d.updatedAt||d.createdAt||new Date().toISOString()};return h(P),P}return null}catch(b){return console.error(`Failed to load ${l}:`,b),g(b.message),null}finally{c(!1)}},[l,y]),S=u.useCallback(async()=>{c(!0),g(null);try{await ee.removeState(l),h(null)}catch(b){throw console.error(`Failed to clear ${l}:`,b),g(b.message),b}finally{c(!1)}},[l]),A=u.useCallback(async b=>{c(!0),g(null);try{await ee.updateState(l,b),h(d=>d?{...d,data:{...d.data,...b},updatedAt:new Date().toISOString()}:null)}catch(d){throw console.error(`Failed to update ${l}:`,d),g(d.message),d}finally{c(!1)}},[l]);return u.useEffect(()=>{l&&x()},[l]),{operation:n,save:$,load:x,clear:S,update:A,loading:r,error:j}},R=({children:l,variant:y="default",color:a="blue",size:n="md",loading:h=!1,leftSection:r,rightSection:c,fullWidth:j=!1,className:g="",disabled:$,...x})=>{const S=()=>y==="filled"?{blue:"themed-button-primary",green:"action-process",red:"action-delete",yellow:"action-reset",purple:"themed-button-primary",gray:"bg-themed-hover hover:bg-themed-tertiary text-themed-primary",orange:"action-reset"}[a]:y==="subtle"?"bg-transparent hover:bg-themed-hover text-themed-secondary":y==="outline"?"border border-themed-secondary hover:bg-themed-hover text-themed-primary":"bg-themed-tertiary hover:bg-themed-hover text-themed-primary",A={xs:"px-2 py-1 text-xs",sm:"px-3 py-1.5 text-sm",md:"px-4 py-2",lg:"px-6 py-3 text-lg"};return e.jsxs("button",{className:`
        ${S()}
        ${A[n]}
        ${j?"w-full":""}
        rounded-lg font-medium
        smooth-transition
        disabled:opacity-50 disabled:cursor-not-allowed
        flex items-center justify-center gap-2
        button-press
        ${g}
      `,disabled:$||h,...x,children:[h&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current"}),r,l,c]})},ue=({opened:l,onClose:y,title:a,children:n,size:h="md"})=>{const r={sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"};return ht.useEffect(()=>(l?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[l]),l?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:`themed-card rounded-lg ${r[h]} w-full mx-4 max-h-[90vh] overflow-y-auto custom-scrollbar`,children:[a&&e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-themed-secondary",children:[e.jsx("div",{className:"text-lg font-semibold text-themed-primary",children:a}),e.jsx("button",{onClick:y,className:"p-1 hover:bg-themed-hover rounded-lg smooth-transition",children:e.jsx(ye,{className:"w-5 h-5 text-themed-muted"})})]}),e.jsx("div",{className:"p-6",children:n})]})}):null},Lt=({onAuthChange:l,onError:y,onSuccess:a})=>{const[n,h]=u.useState(!1),[r,c]=u.useState(!0),[j,g]=u.useState(!1),[$,x]=u.useState(""),[S,A]=u.useState(""),[b,d]=u.useState(!1);u.useEffect(()=>{P()},[]);const P=async()=>{c(!0);try{const _=await V.checkAuth();h(_.isAuthenticated),l==null||l(_.isAuthenticated),!_.isAuthenticated&&V.isRegistered()&&V.clearAuth()}catch(_){console.error("Auth check failed:",_),h(!1),l==null||l(!1)}finally{c(!1)}},I=async()=>{if(!$.trim()){A("Please enter an API key");return}d(!0),A("");try{const _=await V.register($);_.success?(h(!0),l==null||l(!0),g(!1),x(""),a==null||a("Authentication successful! You can now use management features.")):A(_.message||"Authentication failed")}catch(_){console.error("Authentication error:",_),A(_.message||"Authentication failed")}finally{d(!1)}},K=async()=>{if(window.confirm(`WARNING: This will:

1. Generate a NEW API key on the server
2. Revoke ALL existing device registrations
3. Require ALL users to re-authenticate
4. You must check the container logs for the new key

This cannot be undone. Continue?`)){d(!0);try{const v=await V.regenerateApiKey();v.success?(h(!1),l==null||l(!1),g(!1),y==null||y("API KEY REGENERATED - Check container logs for new key!"),a==null||a(v.message),setTimeout(()=>{g(!0)},3e3)):y==null||y(v.message||"Failed to regenerate API key")}catch(v){console.error("Error regenerating key:",v),y==null||y("Failed to regenerate API key: "+v.message)}finally{d(!1)}}};return r?null:e.jsxs(e.Fragment,{children:[e.jsx(W,{color:n?"green":"yellow",icon:n?e.jsx(Ue,{className:"w-5 h-5"}):e.jsx(se,{className:"w-5 h-5"}),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:n?"Authenticated":"Not Authenticated"}),e.jsx("p",{className:"text-xs mt-1 opacity-75",children:n?"Management features enabled":"Management features require API key"})]}),n?e.jsx(R,{variant:"filled",color:"red",size:"sm",leftSection:e.jsx(re,{className:"w-3 h-3"}),onClick:K,loading:b,children:"Regenerate Key"}):e.jsx(R,{variant:"filled",color:"yellow",leftSection:e.jsx(Ae,{className:"w-4 h-4"}),onClick:()=>g(!0),children:"Authenticate"})]})}),e.jsx(ue,{opened:j,onClose:()=>{g(!1),x(""),A("")},title:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ae,{className:"w-6 h-6 text-themed-warning"}),e.jsx("span",{children:"Authentication Required"})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-themed-secondary",children:"Management operations require authentication. Please enter your API key to continue."}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-themed-secondary mb-2",children:"API Key"}),e.jsx("input",{type:"password",value:$,onChange:_=>x(_.target.value),onKeyPress:_=>_.key==="Enter"&&I(),placeholder:"lm_xxxxxxxxxxxxxxxxxxxxx",className:"w-full px-3 py-2 themed-input text-themed-primary placeholder-themed-muted focus:outline-none",disabled:b})]}),S&&e.jsx(W,{color:"red",children:S}),e.jsx(W,{color:"blue",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium mb-2",children:"To find your API key:"}),e.jsxs("ol",{className:"list-decimal list-inside text-xs space-y-1",children:[e.jsx("li",{children:"SSH into your server"}),e.jsxs("li",{children:["Check the file:"," ",e.jsx("code",{className:"bg-themed-tertiary px-1 rounded",children:"/data/api_key.txt"})]}),e.jsx("li",{children:"Or check the API container logs on startup"})]})]})}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-themed-secondary",children:[e.jsx(R,{variant:"default",onClick:()=>{g(!1),x(""),A("")},disabled:b,children:"Cancel"}),e.jsx(R,{variant:"filled",color:"blue",leftSection:e.jsx(se,{className:"w-4 h-4"}),onClick:I,loading:b,disabled:!$.trim(),children:"Authenticate"})]})]})})]})},Ht=({isAuthenticated:l,mockMode:y,onError:a,onSuccess:n,onBackgroundOperation:h})=>{var U;const[r,c]=u.useState(null),[j,g]=u.useState(!1),[$,x]=u.useState(!1),[S,A]=u.useState({cachePath:"/cache",logPath:"/logs/access.log",services:[]}),b=ve("activeCacheClearOperation","cacheClearing",30);u.useEffect(()=>{var i;((i=b.operation)==null?void 0:i.data)&&!j&&r&&["Running","Preparing"].includes(r.status)&&h?h({bytesDeleted:r.bytesDeleted,progress:r.percentComplete||r.progress||0,showModal:()=>g(!0)}):h&&h(null)},[b.operation,j,r,h]),u.useEffect(()=>{d(),P()},[]);const d=async()=>{try{const N=await E.getConfig();A(N)}catch(N){console.error("Failed to load config:",N)}},P=async()=>{var i;const N=await b.load();if((i=N==null?void 0:N.data)!=null&&i.operationId)try{const o=await E.getCacheClearStatus(N.data.operationId);o&&["Running","Preparing"].includes(o.status)?(c(o),I(N.data.operationId)):await b.clear()}catch{await b.clear()}},I=N=>{const i=setInterval(async()=>{try{const o=await E.getCacheClearStatus(N);c(o),["Running","Preparing"].includes(o.status)?await b.update({lastProgress:o.percentComplete||o.progress||0}):(K(o),clearInterval(i))}catch(o){console.error("Error polling cache clear status:",o),clearInterval(i)}},1e3)},K=async N=>{await b.clear(),N.status==="Completed"?(n==null||n(`Cache cleared successfully! ${ne(N.bytesDeleted||0)} freed.`),setTimeout(()=>{g(!1),c(null)},2e3)):N.status==="Failed"?(a==null||a(`Cache clearing failed: ${N.error||N.message||"Unknown error"}`),setTimeout(()=>{g(!1),c(null)},5e3)):N.status==="Cancelled"&&(n==null||n("Cache clearing cancelled"),g(!1),c(null))},_=async()=>{if(!l){a==null||a("Authentication required");return}if(window.confirm("This will clear ALL cached game files. Continue?")){x(!0);try{const N=await E.clearAllCache();N.operationId&&(await b.save({operationId:N.operationId}),c({operationId:N.operationId,status:"Preparing",statusMessage:"Starting cache clear...",percentComplete:0,bytesDeleted:0,totalBytesToDelete:0}),g(!0),I(N.operationId))}catch(N){a==null||a("Failed to start cache clearing: "+N.message)}finally{x(!1)}}},v=async()=>{var i;const N=b.operation;if((i=N==null?void 0:N.data)!=null&&i.operationId)try{c(o=>o?{...o,status:"Cancelling",statusMessage:"Cancelling operation..."}:null),await E.cancelCacheClear(N.data.operationId),await b.clear(),setTimeout(()=>{g(!1),c(null),n==null||n("Cache clearing operation cancelled")},1500)}catch(o){console.error("Failed to cancel cache clear:",o),g(!1),c(null),await b.clear()}},H=((U=b.operation)==null?void 0:U.data)&&!j&&r&&["Running","Preparing"].includes(r.status),z=(r==null?void 0:r.percentComplete)||(r==null?void 0:r.progress)||0;return e.jsxs(e.Fragment,{children:[e.jsxs(J,{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(pt,{className:"w-5 h-5 text-themed-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-themed-primary",children:"Disk Cache Management"})]}),e.jsxs("p",{className:"text-themed-muted text-sm mb-4",children:["Manage cached game files in"," ",e.jsx("code",{className:"bg-themed-tertiary px-2 py-1 rounded",children:S.cachePath})]}),e.jsx(R,{fullWidth:!0,variant:"filled",color:"red",leftSection:e.jsx(Ge,{className:"w-4 h-4"}),onClick:_,disabled:$||y||H||b.loading||!l,loading:$||b.loading,children:H?"Cache Clearing in Progress...":"Clear All Cached Files"}),e.jsx("p",{className:"text-xs text-themed-muted mt-2",children:"⚠️ This deletes ALL cached game files from disk"})]}),e.jsx(ue,{opened:j&&r!==null,onClose:()=>{["Running","Preparing"].includes((r==null?void 0:r.status)||"")||(g(!1),c(null))},title:"Clearing Cache",size:"lg",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[(r==null?void 0:r.status)==="Completed"?e.jsx(ae,{className:"w-5 h-5 cache-hit"}):(r==null?void 0:r.status)==="Failed"?e.jsx(re,{className:"w-5 h-5 text-themed-error"}):e.jsx(te,{className:"w-5 h-5 text-themed-primary animate-spin"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-themed-primary font-medium",children:r==null?void 0:r.status}),((r==null?void 0:r.statusMessage)||(r==null?void 0:r.message))&&e.jsx("p",{className:"text-sm text-themed-muted",children:(r==null?void 0:r.statusMessage)||(r==null?void 0:r.message)})]})]}),r&&["Running","Preparing"].includes(r.status)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full progress-track rounded-full h-4 relative overflow-hidden",children:[e.jsx("div",{className:"progress-bar-medium h-4 rounded-full smooth-transition",style:{width:`${Math.min(100,z)}%`}}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("span",{className:"text-xs text-themed-primary font-medium",children:[z.toFixed(0),"%"]})})]}),r.bytesDeleted!==void 0&&r.totalBytesToDelete&&r.totalBytesToDelete>0&&e.jsxs("div",{className:"text-sm text-themed-muted text-center",children:[e.jsx("span",{className:"cache-hit font-semibold",children:ne(r.bytesDeleted||0)})," / ",e.jsx("span",{className:"text-themed-primary",children:ne(r.totalBytesToDelete)})," cleared"]})]}),(r==null?void 0:r.error)&&e.jsx(W,{color:"red",children:r.error}),e.jsx("div",{className:"flex justify-end space-x-3 pt-4 border-t border-themed-secondary",children:r&&["Running","Preparing"].includes(r.status)?e.jsxs(e.Fragment,{children:[e.jsx(R,{variant:"filled",color:"red",leftSection:e.jsx(We,{className:"w-4 h-4"}),onClick:v,children:"Cancel"}),e.jsx(R,{variant:"default",onClick:()=>g(!1),children:"Run in Background"})]}):e.jsx(R,{variant:"default",onClick:()=>{g(!1),c(null)},children:"Close"})})]})}),b.error&&e.jsxs(W,{color:"orange",children:["Backend storage error: ",b.error]})]})},Dt=({isAuthenticated:l,mockMode:y,onError:a,onSuccess:n,onDataRefresh:h,onBackgroundOperation:r})=>{const[c,j]=u.useState(!1),[g,$]=u.useState(null),[x,S]=u.useState(!1),[A,b]=u.useState(!1),d=ve("activeLogProcessing","logProcessing",120),P=u.useRef(null),I=u.useRef(null),K=u.useRef(null);u.useEffect(()=>{c&&g&&r?r({message:g.message,detailMessage:g.detailMessage,progress:g.progress,estimatedTime:g.estimatedTime,status:g.status,onCancel:N}):r&&r(null)},[c,g,r]),u.useEffect(()=>(_(),v(),()=>{I.current&&clearInterval(I.current),K.current&&clearTimeout(K.current),P.current&&P.current.stop()}),[]);const _=async()=>{var o,w;const i=await d.load();if(i!=null&&i.data){const p=await E.getProcessingStatus().catch(()=>null);p!=null&&p.isProcessing?(j(!0),$({message:`Processing: ${((o=p.mbProcessed)==null?void 0:o.toFixed(1))||0} MB of ${((w=p.mbTotal)==null?void 0:w.toFixed(1))||0} MB`,detailMessage:p.processingRate?`Speed: ${p.processingRate.toFixed(1)} MB/s`:"",progress:p.percentComplete||p.progress||0,estimatedTime:p.estimatedTime,status:p.status||"processing"}),H()):await d.clear()}},v=async()=>{try{const i=new Mt().withUrl("/hubs/downloads").withAutomaticReconnect([0,2e3,5e3,1e4,3e4]).build();i.on("ProcessingProgress",async o=>{console.log("Processing progress received:",o),$(w=>{var p,O;return(w==null?void 0:w.status)==="complete"?w:{message:`Processing: ${((p=o.mbProcessed)==null?void 0:p.toFixed(1))||0} MB of ${((O=o.mbTotal)==null?void 0:O.toFixed(1))||0} MB`,detailMessage:`${o.entriesProcessed||0} entries from ${o.linesProcessed||0} lines`,progress:o.percentComplete||o.progress||0,status:"processing"}}),j(!0),await d.update({lastProgress:o.percentComplete||o.progress||0,mbProcessed:o.mbProcessed,mbTotal:o.mbTotal,entriesProcessed:o.entriesProcessed,linesProcessed:o.linesProcessed})}),i.on("BulkProcessingComplete",async o=>{var w,p,O;console.log("Bulk processing complete:",o),I.current&&clearInterval(I.current),$({message:"Processing Complete!",detailMessage:`Successfully processed ${(w=o.entriesProcessed)==null?void 0:w.toLocaleString()} entries from ${(p=o.linesProcessed)==null?void 0:p.toLocaleString()} lines in ${(O=o.elapsed)==null?void 0:O.toFixed(1)} minutes`,progress:100,status:"complete"}),j(!0),await d.clear(),setTimeout(async()=>{j(!1),$(null),h==null||h()},1e4)}),i.onreconnecting(o=>{console.log("SignalR reconnecting:",o),b(!1)}),i.onreconnected(o=>{console.log("SignalR reconnected:",o),b(!0)}),i.onclose(o=>{console.error("SignalR disconnected:",o),b(!1),c&&(console.log("SignalR disconnected during processing, falling back to polling"),H()),K.current=setTimeout(()=>{v()},5e3)}),await i.start(),P.current=i,b(!0),console.log("SignalR connected")}catch(i){console.error("SignalR connection failed, falling back to polling:",i),b(!1),c&&H()}},H=()=>{I.current&&clearInterval(I.current);const i=async()=>{var o,w,p;try{const O=g;if((O==null?void 0:O.status)==="complete")return;const B=await E.getProcessingStatus();B!=null&&B.isProcessing?(j(!0),$({message:`Processing: ${((o=B.mbProcessed)==null?void 0:o.toFixed(1))||0} MB of ${((w=B.mbTotal)==null?void 0:w.toFixed(1))||0} MB`,detailMessage:B.processingRate?`Speed: ${B.processingRate.toFixed(1)} MB/s`:"",progress:B.percentComplete||B.progress||0,estimatedTime:B.estimatedTime,status:B.status||"processing"}),await d.update({lastProgress:B.percentComplete||B.progress||0,mbProcessed:B.mbProcessed,mbTotal:B.mbTotal})):((B==null?void 0:B.percentComplete)||(B==null?void 0:B.progress)||0)>=100?(I.current&&clearInterval(I.current),$({message:"Processing Complete!",detailMessage:`Processed ${((p=B.mbTotal)==null?void 0:p.toFixed(1))||0} MB`,progress:100,status:"complete"}),j(!0),await d.clear(),setTimeout(()=>{j(!1),$(null),h==null||h()},1e4)):(j(!1),await d.clear(),I.current&&clearInterval(I.current))}catch(O){console.error("Error checking processing status:",O)}};i(),I.current=setInterval(i,3e3)},z=async()=>{if(!l){a==null||a("Authentication required");return}S(!0);try{const i=await E.resetLogPosition();i&&(n==null||n(i.message||"Log position reset successfully"),setTimeout(()=>h==null?void 0:h(),2e3))}catch(i){a==null||a(i.message||"Failed to reset log position")}finally{S(!1)}},U=async()=>{var i;if(!l){a==null||a("Authentication required");return}if(window.confirm("Process entire log file?")){S(!0);try{const o=await E.processAllLogs();if(o){if(o.status==="empty_file"||o.status==="no_log_file"||o.status==="insufficient_data"){a==null||a(o.message),S(!1);return}o.logSizeMB>0?(await d.save({type:"processAll"}),j(!0),$({message:"Preparing to process logs...",detailMessage:`${((i=o.logSizeMB)==null?void 0:i.toFixed(1))||0} MB to process`,progress:0,estimatedTime:`Estimated: ${o.estimatedTimeMinutes} minutes`,status:"starting"}),A||setTimeout(()=>H(),5e3)):(a==null||a("Log file appears to be empty or invalid"),await d.clear())}else await d.clear()}catch(o){await d.clear(),a==null||a(o.message||"Failed to process logs")}finally{S(!1)}}},N=async()=>{if(!l){a==null||a("Authentication required");return}if(window.confirm("Cancel log processing?")){S(!0);try{await E.cancelProcessing(),j(!1),await d.clear(),I.current&&clearInterval(I.current),n==null||n("Processing cancelled"),setTimeout(()=>{$(null),h==null||h()},5e3)}catch{a==null||a("Failed to cancel processing")}finally{S(!1)}}};return e.jsxs(J,{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(qe,{className:"w-5 h-5 cache-hit"}),e.jsx("h3",{className:"text-lg font-semibold text-themed-primary",children:"Log Processing"})]}),e.jsx("p",{className:"text-themed-muted text-sm mb-4",children:"Control how access.log is processed for statistics"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(R,{variant:"filled",color:"yellow",leftSection:e.jsx(Ke,{className:"w-4 h-4"}),onClick:z,disabled:x||c||y||d.loading||!l,fullWidth:!0,children:"Reset Log Position"}),e.jsx(R,{variant:"filled",color:"green",leftSection:e.jsx(ft,{className:"w-4 h-4"}),onClick:U,disabled:x||c||y||d.loading||!l,loading:d.loading,fullWidth:!0,children:"Process All Logs"})]}),e.jsx("div",{className:"mt-4 p-3 bg-themed-tertiary rounded-lg",children:e.jsxs("p",{className:"text-xs text-themed-muted",children:[e.jsx("strong",{children:"Reset:"})," Start from current end of log",e.jsx("br",{}),e.jsx("strong",{children:"Process All:"})," Import entire log history"]})}),d.error&&e.jsxs(W,{color:"orange",children:["Backend storage error: ",d.error]})]})},Rt=({isAuthenticated:l})=>{const[y,a]=u.useState([]),[n,h]=u.useState("dark-default"),[r,c]=u.useState(!1),[j,g]=u.useState(!1),[$,x]=u.useState(null),[S,A]=u.useState(null),[b,d]=u.useState(null),[P,I]=u.useState(!1),[K,_]=u.useState(!1),[v,H]=u.useState(null),[z,U]=u.useState(["core","backgrounds","text"]),[N,i]=u.useState(null),[o,w]=u.useState({}),[p,O]=u.useState(""),[B,D]=u.useState(""),[k,L]=u.useState({}),[F,Y]=u.useState({name:"",description:"",author:"",version:"1.0.0",isDark:!0,primaryColor:"#3b82f6",secondaryColor:"#8b5cf6",accentColor:"#06b6d4",bgPrimary:"#111827",bgSecondary:"#1f2937",bgTertiary:"#374151",bgHover:"#4b5563",textPrimary:"#ffffff",textSecondary:"#d1d5db",textMuted:"#9ca3af",textAccent:"#60a5fa",textPlaceholder:"#6b7280",dragHandleColor:"#6b7280",dragHandleHover:"#60a5fa",borderPrimary:"#374151",borderSecondary:"#4b5563",borderFocus:"#3b82f6",navBg:"#1f2937",navBorder:"#374151",navTabActive:"#3b82f6",navTabInactive:"#9ca3af",navTabHover:"#ffffff",navTabActiveBorder:"#3b82f6",navMobileMenuBg:"#1f2937",navMobileItemHover:"#374151",success:"#10b981",successBg:"#064e3b",successText:"#34d399",warning:"#f59e0b",warningBg:"#78350f",warningText:"#fbbf24",error:"#ef4444",errorBg:"#7f1d1d",errorText:"#fca5a5",info:"#3b82f6",infoBg:"#1e3a8a",infoText:"#93c5fd",steamColor:"#1e40af",epicColor:"#7c3aed",originColor:"#ea580c",blizzardColor:"#0891b2",wsusColor:"#16a34a",riotColor:"#dc2626",cardBg:"#1f2937",cardBorder:"#374151",buttonBg:"#3b82f6",buttonHover:"#2563eb",buttonText:"#ffffff",inputBg:"#374151",inputBorder:"#4b5563",inputFocus:"#3b82f6",badgeBg:"#3b82f6",badgeText:"#ffffff",progressBar:"#3b82f6",progressBg:"#374151",iconBgBlue:"#3b82f6",iconBgGreen:"#10b981",iconBgEmerald:"#10b981",iconBgPurple:"#8b5cf6",iconBgIndigo:"#6366f1",iconBgOrange:"#f97316",iconBgYellow:"#eab308",iconBgCyan:"#06b6d4",iconBgRed:"#ef4444",chartColor1:"#3b82f6",chartColor2:"#10b981",chartColor3:"#f59e0b",chartColor4:"#ef4444",chartColor5:"#8b5cf6",chartColor6:"#06b6d4",chartColor7:"#f97316",chartColor8:"#ec4899",chartBorderColor:"#1f2937",chartGridColor:"#374151",chartTextColor:"#9ca3af",chartCacheHitColor:"#10b981",chartCacheMissColor:"#f59e0b",scrollbarTrack:"#374151",scrollbarThumb:"#6B7280",scrollbarHover:"#9CA3AF",publicAccessBg:"rgba(16, 185, 129, 0.2)",publicAccessText:"#34d399",publicAccessBorder:"rgba(16, 185, 129, 0.3)",securedAccessBg:"rgba(245, 158, 11, 0.2)",securedAccessText:"#fbbf24",securedAccessBorder:"rgba(245, 158, 11, 0.3)",customCSS:""}),je=u.useRef(null),Je=(t,s=1)=>{const f=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);if(!f)return t;const m=parseInt(f[1],16),T=parseInt(f[2],16),C=parseInt(f[3],16);return`rgba(${m}, ${T}, ${C}, ${s})`},oe=t=>{const s=t.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)/);if(s){const f=parseInt(s[1]),m=parseInt(s[2]),T=parseInt(s[3]),C=s[4]?parseFloat(s[4]):1;return{hex:"#"+[f,m,T].map(G=>G.toString(16).padStart(2,"0")).join(""),alpha:C}}return{hex:t,alpha:1}},le=(t,s,f,m=!1)=>{const T=f<1?Je(s,f):s;m?Y(C=>({...C,[t]:T})):L(C=>({...C,[t]:T}))},Ce=(t,s)=>{if(!s.trim())return t;const f=s.toLowerCase();return t.map(m=>{const T=m.colors.filter(C=>C.label.toLowerCase().includes(f)||C.description.toLowerCase().includes(f)||C.affects.some(M=>M.toLowerCase().includes(f))||C.key.toLowerCase().includes(f));return m.name.toLowerCase().includes(f)||m.description.toLowerCase().includes(f)?m:{...m,colors:T}}).filter(m=>m.colors.length>0)},we=[{name:"foundation",icon:Pe,description:"Core brand colors that define your theme's identity",colors:[{key:"primaryColor",label:"Primary Brand Color",description:"Main brand color used throughout",affects:["Primary buttons","Links","Active states","Focus rings"],supportsAlpha:!0},{key:"secondaryColor",label:"Secondary Brand Color",description:"Complementary brand accent",affects:["Secondary buttons","Highlights","Accents"],supportsAlpha:!0},{key:"accentColor",label:"Accent Color",description:"Tertiary accent for special elements",affects:["Special badges","Tooltips","Info elements"],supportsAlpha:!0}]},{name:"content",icon:jt,description:"Text colors for content hierarchy and readability",colors:[{key:"textPrimary",label:"Primary Text",description:"Main content text color",affects:["Headings","Body text","Labels"],supportsAlpha:!0},{key:"textSecondary",label:"Secondary Text",description:"Supporting content text",affects:["Descriptions","Subtitles","Help text"],supportsAlpha:!0},{key:"textMuted",label:"Muted Text",description:"De-emphasized text",affects:["Disabled text","Timestamps","Minor labels"],supportsAlpha:!0},{key:"textAccent",label:"Accent Text",description:"Highlighted or linked text",affects:["Links","Highlighted values","Active menu items"],supportsAlpha:!0},{key:"textPlaceholder",label:"Placeholder Text",description:"Input placeholder text color",affects:["Form placeholders","Search hints","Empty states"],supportsAlpha:!0}]},{name:"layout",icon:Oe,description:"Background colors for UI surfaces and layers",colors:[{key:"bgPrimary",label:"Base Background",description:"Main application background",affects:["Body","Main container","Base layer"],supportsAlpha:!0},{key:"bgSecondary",label:"Surface Background",description:"Elevated surface backgrounds",affects:["Cards","Panels","Modals","Dialogs"],supportsAlpha:!0},{key:"bgTertiary",label:"Recessed Background",description:"Sunken or nested elements",affects:["Input fields","Wells","Code blocks"],supportsAlpha:!0},{key:"bgHover",label:"Hover State",description:"Interactive hover backgrounds",affects:["Button hovers","List hovers","Menu hovers"],supportsAlpha:!0},{key:"cardBg",label:"Card Background",description:"Card component background",affects:["Stat cards","Content cards","Widget backgrounds"],supportsAlpha:!0},{key:"cardBorder",label:"Card Border",description:"Card component borders",affects:["Card outlines","Panel borders"],supportsAlpha:!0}]},{name:"interactive",icon:Ct,description:"Interactive elements like buttons, inputs, and forms",colors:[{key:"buttonBg",label:"Button Background",description:"Primary button fill color",affects:["Primary buttons","Submit buttons","CTAs"],supportsAlpha:!0},{key:"buttonHover",label:"Button Hover",description:"Button hover state color",affects:["Button hover effects","Active button states"],supportsAlpha:!0},{key:"buttonText",label:"Button Text",description:"Button label color",affects:["Button labels","Button icons"],supportsAlpha:!0},{key:"inputBg",label:"Input Background",description:"Form input background",affects:["Text inputs","Textareas","Select boxes"],supportsAlpha:!0},{key:"inputBorder",label:"Input Border",description:"Form input border",affects:["Input outlines","Field borders"],supportsAlpha:!0},{key:"inputFocus",label:"Input Focus",description:"Focused input indicator",affects:["Active input borders","Focus rings"],supportsAlpha:!0},{key:"dragHandleColor",label:"Drag Handle",description:"Drag and reorder controls",affects:["Drag grips","Reorder handles","Move indicators"],supportsAlpha:!0},{key:"dragHandleHover",label:"Drag Handle Hover",description:"Active drag handle state",affects:["Drag grip hover","Active dragging"],supportsAlpha:!0}]},{name:"borders",icon:wt,description:"Border colors for separators and outlines",colors:[{key:"borderPrimary",label:"Primary Border",description:"Main divider and border color",affects:["Card borders","Dividers","Separators"],supportsAlpha:!0},{key:"borderSecondary",label:"Secondary Border",description:"Subtle borders and dividers",affects:["Input borders","Section dividers","Subtle lines"],supportsAlpha:!0},{key:"borderFocus",label:"Focus Border",description:"Active focus indicators",affects:["Focus rings","Active borders","Selected outlines"],supportsAlpha:!0}]},{name:"feedback",icon:re,description:"Status indicators, alerts, and feedback colors",colors:[{key:"success",label:"Success Primary",description:"Success state primary color",affects:["Success icons","Success buttons","Positive actions"],supportsAlpha:!0},{key:"successBg",label:"Success Background",description:"Success state background",affects:["Success alerts","Success badges","Success cards"],supportsAlpha:!0},{key:"successText",label:"Success Text",description:"Success state text color",affects:["Success messages","Positive values"],supportsAlpha:!0},{key:"warning",label:"Warning Primary",description:"Warning state primary color",affects:["Warning icons","Caution buttons"],supportsAlpha:!0},{key:"warningBg",label:"Warning Background",description:"Warning state background",affects:["Warning alerts","Warning badges"],supportsAlpha:!0},{key:"warningText",label:"Warning Text",description:"Warning state text color",affects:["Warning messages","Caution text"],supportsAlpha:!0},{key:"error",label:"Error Primary",description:"Error state primary color",affects:["Error icons","Delete buttons","Critical actions"],supportsAlpha:!0},{key:"errorBg",label:"Error Background",description:"Error state background",affects:["Error alerts","Error badges"],supportsAlpha:!0},{key:"errorText",label:"Error Text",description:"Error state text color",affects:["Error messages","Validation errors"],supportsAlpha:!0},{key:"info",label:"Info Primary",description:"Information state primary color",affects:["Info icons","Info buttons"],supportsAlpha:!0},{key:"infoBg",label:"Info Background",description:"Information state background",affects:["Info alerts","Info cards"],supportsAlpha:!0},{key:"infoText",label:"Info Text",description:"Information state text color",affects:["Info messages","Help content"],supportsAlpha:!0}]},{name:"navigation",icon:Oe,description:"Navigation bar and menu styling",colors:[{key:"navBg",label:"Navigation Background",description:"Navigation bar background",affects:["Header","Nav bar","Menu background"],supportsAlpha:!0},{key:"navBorder",label:"Navigation Border",description:"Navigation separators",affects:["Nav borders","Menu dividers"],supportsAlpha:!0},{key:"navTabActive",label:"Active Tab",description:"Active navigation item",affects:["Current page","Active tab"],supportsAlpha:!0},{key:"navTabInactive",label:"Inactive Tab",description:"Inactive navigation items",affects:["Unselected tabs","Inactive menu items"],supportsAlpha:!0},{key:"navTabHover",label:"Tab Hover",description:"Navigation hover state",affects:["Tab hovers","Menu hovers"],supportsAlpha:!0},{key:"navTabActiveBorder",label:"Active Tab Indicator",description:"Active tab underline/border",affects:["Tab indicators","Active borders"],supportsAlpha:!0},{key:"navMobileMenuBg",label:"Mobile Menu Background",description:"Mobile navigation background",affects:["Mobile menu","Dropdown menus"],supportsAlpha:!0},{key:"navMobileItemHover",label:"Mobile Menu Hover",description:"Mobile menu item hover",affects:["Mobile hovers","Dropdown hovers"],supportsAlpha:!0}]},{name:"dataDisplay",icon:Ve,description:"Data visualization and display elements",colors:[{key:"badgeBg",label:"Badge Background",description:"Badge and pill backgrounds",affects:["Status badges","Tags","Labels"],supportsAlpha:!0},{key:"badgeText",label:"Badge Text",description:"Badge text color",affects:["Badge labels","Tag text"],supportsAlpha:!0},{key:"progressBar",label:"Progress Bar Fill",description:"Progress indicator color",affects:["Progress bars","Loading bars","Completion indicators"],supportsAlpha:!0},{key:"progressBg",label:"Progress Track",description:"Progress bar background",affects:["Progress tracks","Empty progress state"],supportsAlpha:!0},{key:"chartColor1",label:"Chart Primary",description:"Primary chart color",affects:["First data series","Main chart color"],supportsAlpha:!0},{key:"chartColor2",label:"Chart Secondary",description:"Secondary chart color",affects:["Second data series"],supportsAlpha:!0},{key:"chartColor3",label:"Chart Tertiary",description:"Third chart color",affects:["Third data series"],supportsAlpha:!0},{key:"chartColor4",label:"Chart Quaternary",description:"Fourth chart color",affects:["Fourth data series"],supportsAlpha:!0},{key:"chartCacheHitColor",label:"Cache Hit Color",description:"Cache hit visualization",affects:["Hit rate charts","Success indicators"],supportsAlpha:!0},{key:"chartCacheMissColor",label:"Cache Miss Color",description:"Cache miss visualization",affects:["Miss rate charts","Warning indicators"],supportsAlpha:!0},{key:"chartGridColor",label:"Chart Grid",description:"Chart grid lines",affects:["Grid lines","Axes"],supportsAlpha:!0},{key:"chartTextColor",label:"Chart Text",description:"Chart labels and legends",affects:["Axis labels","Legends"],supportsAlpha:!0}]},{name:"accessControl",icon:se,description:"Security and access control indicators",colors:[{key:"publicAccessBg",label:"Public Access Background",description:"Public/open access indicator",affects:["Public badges","Open access indicators"],supportsAlpha:!0},{key:"publicAccessText",label:"Public Access Text",description:"Public access text color",affects:["Public labels","Open text"],supportsAlpha:!0},{key:"publicAccessBorder",label:"Public Access Border",description:"Public access border",affects:["Public badge borders"],supportsAlpha:!0},{key:"securedAccessBg",label:"Secured Access Background",description:"Secured/locked access indicator",affects:["Security badges","Locked indicators"],supportsAlpha:!0},{key:"securedAccessText",label:"Secured Access Text",description:"Secured access text color",affects:["Security labels","Locked text"],supportsAlpha:!0},{key:"securedAccessBorder",label:"Secured Access Border",description:"Secured access border",affects:["Security badge borders"],supportsAlpha:!0}]},{name:"platforms",icon:kt,description:"Gaming platform and service colors",colors:[{key:"steamColor",label:"Steam",description:"Steam platform color",affects:["Steam badges","Steam charts"],supportsAlpha:!0},{key:"epicColor",label:"Epic Games",description:"Epic Games platform color",affects:["Epic badges","Epic charts"],supportsAlpha:!0},{key:"originColor",label:"Origin/EA",description:"EA/Origin platform color",affects:["Origin badges","EA charts"],supportsAlpha:!0},{key:"blizzardColor",label:"Blizzard",description:"Blizzard platform color",affects:["Blizzard badges","Battle.net charts"],supportsAlpha:!0},{key:"wsusColor",label:"Windows Update",description:"Windows Update service color",affects:["WSUS badges","Update charts"],supportsAlpha:!0},{key:"riotColor",label:"Riot Games",description:"Riot Games platform color",affects:["Riot badges","LoL charts"],supportsAlpha:!0}]},{name:"utilities",icon:Nt,description:"Utility colors for specialized UI elements",colors:[{key:"scrollbarTrack",label:"Scrollbar Track",description:"Scrollbar background track",affects:["Scrollbar tracks","Scroll gutters"],supportsAlpha:!0},{key:"scrollbarThumb",label:"Scrollbar Thumb",description:"Scrollbar draggable element",affects:["Scrollbar handles"],supportsAlpha:!0},{key:"scrollbarHover",label:"Scrollbar Hover",description:"Scrollbar hover state",affects:["Scrollbar hover effects"],supportsAlpha:!0},{key:"iconBgBlue",label:"Blue Icon Background",description:"Blue icon container",affects:["Database icons","Info icons"],supportsAlpha:!0},{key:"iconBgGreen",label:"Green Icon Background",description:"Green icon container",affects:["Success icons","Online status"],supportsAlpha:!0},{key:"iconBgEmerald",label:"Emerald Icon Background",description:"Emerald icon container",affects:["Trending icons","Growth indicators"],supportsAlpha:!0},{key:"iconBgPurple",label:"Purple Icon Background",description:"Purple icon container",affects:["Special features","Premium indicators"],supportsAlpha:!0},{key:"iconBgIndigo",label:"Indigo Icon Background",description:"Indigo icon container",affects:["Server icons","System indicators"],supportsAlpha:!0},{key:"iconBgOrange",label:"Orange Icon Background",description:"Orange icon container",affects:["Download icons","Activity indicators"],supportsAlpha:!0},{key:"iconBgYellow",label:"Yellow Icon Background",description:"Yellow icon container",affects:["Warning icons","Client indicators"],supportsAlpha:!0},{key:"iconBgCyan",label:"Cyan Icon Background",description:"Cyan icon container",affects:["Activity icons","Performance indicators"],supportsAlpha:!0},{key:"iconBgRed",label:"Red Icon Background",description:"Red icon container",affects:["Error icons","Critical indicators"],supportsAlpha:!0}]}];u.useEffect(()=>{ce();const t=q.getCurrentThemeId();h(t),console.log("=== Color History in localStorage ==="),Object.keys(localStorage).forEach(s=>{s.startsWith("color_history_")&&console.log(`${s}: ${localStorage.getItem(s)}`)}),console.log("=====================================")},[]);const ce=async()=>{c(!0);try{const t=await q.loadThemes();a(t)}catch(t){console.error("Failed to load themes:",t),x("Failed to load themes")}finally{c(!1)}},Q=async t=>{try{if(!t){q.clearTheme(),h(""),d(null);return}const s=await q.getTheme(t);s&&(q.applyTheme(s),h(t),d(null))}catch(s){console.error("Failed to apply theme:",s),x("Failed to apply theme")}},Qe=async t=>{if(b===t)Q(n),d(null);else try{const s=await q.getTheme(t);s&&(q.applyTheme(s),d(t))}catch(s){console.error("Failed to preview theme:",s)}},ke=t=>{U(s=>s.includes(t)?s.filter(f=>f!==t):[...s,t])},[Xe,he]=u.useState({}),pe=t=>{if(!Xe[t]){const s=F[t];s&&(localStorage.setItem(`color_history_create_${t}`,s),console.log(`Saved original create color: ${t} = ${s}`)),he(f=>({...f,[t]:!0}))}},Ze=(t,s)=>{Y(f=>({...f,[t]:s}))},et=t=>{const s=localStorage.getItem(`color_history_create_${t}`);if(s){const f=F[t];Y(m=>({...m,[t]:s})),localStorage.setItem(`color_history_create_${t}`,f)}},Ne=t=>localStorage.getItem(`color_history_create_${t}`),fe=t=>{if(!o[t]){const s=k[t];if(s&&s.match(/^#[0-9a-fA-F]{6}$/)){const f=`color_history_${v==null?void 0:v.meta.id}_${t}`;localStorage.setItem(f,s),console.log(`Saved original color to history: ${t} = ${s}`)}w(f=>({...f,[t]:!0}))}},tt=(t,s)=>{L(f=>({...f,[t]:s}))},st=t=>{const s=`color_history_${v==null?void 0:v.meta.id}_${t}`,f=localStorage.getItem(s);if(f){const m=k[t];console.log(`Restoring ${t}: ${m} -> ${f}`),L(T=>({...T,[t]:f})),localStorage.setItem(s,m||"")}},at=t=>{const s=`color_history_${v==null?void 0:v.meta.id}_${t}`,f=localStorage.getItem(s);return console.log(`getEditColorHistory: key=${t}, historyKey=${s}, value=${f}`),f},Te=async t=>{try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(t);else{const s=document.createElement("textarea");s.value=t,s.style.position="fixed",s.style.left="-999999px",s.style.top="-999999px",document.body.appendChild(s),s.focus(),s.select(),document.execCommand("copy"),document.body.removeChild(s)}i(t),setTimeout(()=>i(null),2e3)}catch(s){console.error("Failed to copy color:",s)}},ge=t=>{t.preventDefault(),t.stopPropagation(),t.type==="dragenter"||t.type==="dragover"?g(!0):t.type==="dragleave"&&g(!1)},rt=async t=>{t.preventDefault(),t.stopPropagation(),g(!1),t.dataTransfer.files&&t.dataTransfer.files[0]&&await Se(t.dataTransfer.files[0])},Se=async t=>{if(x(null),A(null),!t.name.endsWith(".toml")){x("Only TOML theme files are supported");return}if(t.size>1024*1024){x("Theme file too large (max 1MB)");return}c(!0);try{const s=await q.uploadTheme(t);await new Promise(m=>setTimeout(m,100));const f=await q.loadThemes();a(f),A(`Theme "${s.meta.name}" uploaded successfully`),setTimeout(()=>A(null),5e3)}catch(s){x(s.message)}finally{c(!1)}},ot=async(t,s)=>{var m;if(["dark-default","light-default"].includes(t)){x("System themes cannot be deleted"),setTimeout(()=>x(null),5e3);return}if(!l){x("Authentication required to delete custom themes"),setTimeout(()=>x(null),5e3);return}if(window.confirm(`Delete theme "${s}"? This cannot be undone.`)){c(!0);try{const T=await fetch(`${Ee}/theme/${t}`,{method:"DELETE",headers:V.getAuthHeaders()}),C=await T.json();if(T.ok&&C.success){await ce(),n===t&&Q("dark-default");const M=((m=C.filesDeleted)==null?void 0:m.join(", "))||"theme files";A(`Theme "${s}" deleted successfully (removed: ${M})`),setTimeout(()=>A(null),5e3)}else if(T.status===404)x(`Theme "${s}" not found on server. ${C.details||""}`),a(M=>M.filter(G=>G.meta.id!==t)),n===t&&Q("dark-default"),C.availableThemes&&console.log("Available themes on server:",C.availableThemes),setTimeout(()=>x(null),1e4);else{const M=C.error||C.message||"Failed to delete theme",G=C.details?` Details: ${C.details}`:"";x(`${M}${G}`),setTimeout(()=>x(null),7e3)}}catch(T){console.error("Delete request failed:",T),x(`Failed to delete theme: ${T.message||"Network error"}`),setTimeout(()=>x(null),7e3)}finally{c(!1)}}},lt=async()=>{if(!l){x("Authentication required to clean up themes"),setTimeout(()=>x(null),5e3);return}if(window.confirm("This will DELETE all custom themes (keeping only system themes). This cannot be undone. Continue?")){c(!0);try{const t=await fetch(`${Ee}/theme/cleanup`,{method:"POST",headers:{"Content-Type":"application/json",...V.getAuthHeaders()}});if(!t.ok)throw new Error("Failed to cleanup themes");const s=await t.json();await ce(),y.map(m=>m.meta.id).includes(n)||Q("dark-default"),A(s.message||"All custom themes have been deleted"),setTimeout(()=>A(null),5e3)}catch(t){x("Failed to cleanup themes: "+t.message),setTimeout(()=>x(null),5e3)}finally{c(!1)}}},ct=t=>{var T;if(!l){x("Authentication required to edit themes"),setTimeout(()=>x(null),5e3);return}if(Z(t.meta.id)){x("System themes cannot be edited"),setTimeout(()=>x(null),5e3);return}const s=y.find(C=>C.meta.id===t.meta.id)||t;console.log("Editing theme:",s),console.log("Theme colors:",s.colors),w({}),H(s);const f={name:s.meta.name,description:s.meta.description||"",author:s.meta.author||"",version:s.meta.version||"1.0.0",isDark:s.meta.isDark!==!1,...s.colors,customCSS:((T=s.css)==null?void 0:T.content)||""};s.colors.dragHandleColor||(f.dragHandleColor=s.meta.isDark?"#6b7280":"#9ca3af"),s.colors.dragHandleHover||(f.dragHandleHover=s.meta.isDark?"#60a5fa":"#2563eb"),console.log("Theme data for editing:",f);const m=Object.keys(f).filter(C=>!["name","description","author","version","isDark","customCSS"].includes(C));console.log("Color keys and values in theme data:"),m.forEach(C=>{console.log(`  ${C}: ${f[C]}`)}),L(f),_(!0)},nt=async()=>{if(!l||!v)return;if(!k.name.trim()){x("Theme name is required"),setTimeout(()=>x(null),5e3);return}console.log("Saving theme with colors:",k);const t={};Object.entries(k).forEach(([C,M])=>{["name","description","author","version","isDark","customCSS"].includes(C)||(t[C]=M)});const s={meta:{id:v.meta.id,name:k.name,description:k.description,author:k.author,version:k.version,isDark:k.isDark},colors:t,css:k.customCSS?{content:k.customCSS}:void 0};console.log("Theme object to save:",s);const f=q.exportTheme(s),m=new Blob([f],{type:"text/plain"}),T=new File([m],`${s.meta.id}.toml`,{type:"text/plain"});c(!0);try{await q.uploadTheme(T),await new Promise(G=>setTimeout(G,100));const C=await q.loadThemes();a(C);const M=C.find(G=>G.meta.id===s.meta.id);if(M)n===v.meta.id&&q.applyTheme(M),A(`Theme "${M.meta.name}" updated successfully`);else throw new Error("Theme was uploaded but not found on server");Object.keys(k).forEach(G=>{const ut=`color_history_${v.meta.id}_${G}`;localStorage.removeItem(ut)}),w({}),_(!1),H(null),L({}),setTimeout(()=>A(null),5e3)}catch(C){x(C.message||"Failed to update theme"),c(!1);return}c(!1)},it=async()=>{if(!l){x("Authentication required to create themes");return}if(!F.name.trim()){x("Theme name is required"),setTimeout(()=>x(null),5e3);return}const t={meta:{id:F.name.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""),name:F.name,description:F.description,author:F.author,version:F.version,isDark:F.isDark},colors:{...F},css:F.customCSS?{content:F.customCSS}:void 0};delete t.colors.name,delete t.colors.description,delete t.colors.author,delete t.colors.version,delete t.colors.isDark,delete t.colors.customCSS;const s=q.exportTheme(t),f=new Blob([s],{type:"text/plain"}),m=new File([f],`${t.meta.id}.toml`,{type:"text/plain"});c(!0);try{await q.uploadTheme(m),await new Promise(M=>setTimeout(M,100));const T=await q.loadThemes();a(T);const C=T.find(M=>M.meta.id===t.meta.id);C&&(q.applyTheme(C),h(C.meta.id)),I(!1),Object.keys(F).forEach(M=>{localStorage.removeItem(`color_history_create_${M}`)}),he({}),Y({name:"",description:"",author:"",version:"1.0.0",isDark:!0,primaryColor:"#3b82f6",secondaryColor:"#8b5cf6",accentColor:"#06b6d4",bgPrimary:"#111827",bgSecondary:"#1f2937",bgTertiary:"#374151",bgHover:"#4b5563",textPrimary:"#ffffff",textSecondary:"#d1d5db",textMuted:"#9ca3af",textAccent:"#60a5fa",dragHandleColor:"#6b7280",dragHandleHover:"#60a5fa",borderPrimary:"#374151",borderSecondary:"#4b5563",borderFocus:"#3b82f6",navBg:"#1f2937",navBorder:"#374151",navTabActive:"#3b82f6",navTabInactive:"#9ca3af",navTabHover:"#ffffff",navTabActiveBorder:"#3b82f6",navMobileMenuBg:"#1f2937",navMobileItemHover:"#374151",success:"#10b981",successBg:"#064e3b",successText:"#34d399",warning:"#f59e0b",warningBg:"#78350f",warningText:"#fbbf24",error:"#ef4444",errorBg:"#7f1d1d",errorText:"#fca5a5",info:"#3b82f6",infoBg:"#1e3a8a",infoText:"#93c5fd",steamColor:"#1e40af",epicColor:"#7c3aed",originColor:"#ea580c",blizzardColor:"#0891b2",wsusColor:"#16a34a",riotColor:"#dc2626",cardBg:"#1f2937",cardBorder:"#374151",buttonBg:"#3b82f6",buttonHover:"#2563eb",buttonText:"#ffffff",inputBg:"#374151",inputBorder:"#4b5563",inputFocus:"#3b82f6",badgeBg:"#3b82f6",badgeText:"#ffffff",progressBar:"#3b82f6",progressBg:"#374151",iconBgBlue:"#3b82f6",iconBgGreen:"#10b981",iconBgEmerald:"#10b981",iconBgPurple:"#8b5cf6",iconBgIndigo:"#6366f1",iconBgOrange:"#f97316",iconBgYellow:"#eab308",iconBgCyan:"#06b6d4",iconBgRed:"#ef4444",chartColor1:"#3b82f6",chartColor2:"#10b981",chartColor3:"#f59e0b",chartColor4:"#ef4444",chartColor5:"#8b5cf6",chartColor6:"#06b6d4",chartColor7:"#f97316",chartColor8:"#ec4899",chartBorderColor:"#1f2937",chartGridColor:"#374151",chartTextColor:"#9ca3af",chartCacheHitColor:"#10b981",chartCacheMissColor:"#f59e0b",scrollbarTrack:"#374151",scrollbarThumb:"#6B7280",scrollbarHover:"#9CA3AF",publicAccessBg:"rgba(16, 185, 129, 0.2)",publicAccessText:"#34d399",publicAccessBorder:"rgba(16, 185, 129, 0.3)",securedAccessBg:"rgba(245, 158, 11, 0.2)",securedAccessText:"#fbbf24",securedAccessBorder:"rgba(245, 158, 11, 0.3)",customCSS:""}),A(`Theme "${t.meta.name}" created successfully`),setTimeout(()=>A(null),5e3)}catch(T){x(T.message||"Failed to create theme")}finally{c(!1)}},Be=t=>{Y(t==="dark"?s=>({...s,isDark:!0,bgPrimary:"#111827",bgSecondary:"#1f2937",bgTertiary:"#374151",bgHover:"#4b5563",textPrimary:"#ffffff",textSecondary:"#d1d5db",textMuted:"#9ca3af",dragHandleColor:"#6b7280",dragHandleHover:"#00ff00",borderPrimary:"#374151",borderSecondary:"#4b5563",navBg:"#1f2937",navBorder:"#374151",navTabActive:"#3b82f6",navTabInactive:"#9ca3af",navTabHover:"#ffffff",navTabActiveBorder:"#3b82f6",navMobileMenuBg:"#1f2937",navMobileItemHover:"#374151",cardBg:"#1f2937",cardBorder:"#374151",inputBg:"#374151",inputBorder:"#4b5563",progressBg:"#374151",successBg:"#064e3b",successText:"#34d399",warningBg:"#78350f",warningText:"#fbbf24",errorBg:"#7f1d1d",errorText:"#fca5a5",infoBg:"#1e3a8a",infoText:"#93c5fd",chartBorderColor:"#1f2937",chartGridColor:"#374151",chartTextColor:"#9ca3af",scrollbarTrack:"#374151",scrollbarThumb:"#6B7280",scrollbarHover:"#9CA3AF"}):s=>({...s,isDark:!1,bgPrimary:"#ffffff",bgSecondary:"#f9fafb",bgTertiary:"#f3f4f6",bgHover:"#e5e7eb",textPrimary:"#111827",textSecondary:"#374151",textMuted:"#6b7280",dragHandleColor:"#9ca3af",dragHandleHover:"#2563eb",borderPrimary:"#e5e7eb",borderSecondary:"#d1d5db",navBg:"#f9fafb",navBorder:"#e5e7eb",navTabActive:"#3b82f6",navTabInactive:"#6b7280",navTabHover:"#111827",navTabActiveBorder:"#3b82f6",navMobileMenuBg:"#f9fafb",navMobileItemHover:"#e5e7eb",cardBg:"#ffffff",cardBorder:"#e5e7eb",inputBg:"#ffffff",inputBorder:"#d1d5db",progressBg:"#e5e7eb",successBg:"#d1fae5",successText:"#065f46",warningBg:"#fef3c7",warningText:"#92400e",errorBg:"#fee2e2",errorText:"#991b1b",infoBg:"#dbeafe",infoText:"#1e40af",chartBorderColor:"#e5e7eb",chartGridColor:"#d1d5db",chartTextColor:"#6b7280",scrollbarTrack:"#f3f4f6",scrollbarThumb:"#9ca3af",scrollbarHover:"#6b7280"}))},dt=t=>{const s=q.exportTheme(t),f=new Blob([s],{type:"text/plain"}),m=URL.createObjectURL(f),T=document.createElement("a");T.href=m,T.download=`${t.meta.id}.toml`,T.click(),URL.revokeObjectURL(m)},mt=()=>{const t=`# Sample Theme for LANCache Manager
[meta]
name = "My Custom Theme"
id = "my-custom-theme"
description = "A beautiful custom theme"
author = "Your Name"
version = "1.0.0"
isDark = true

[colors]
# Core colors
primaryColor = "#3b82f6"
secondaryColor = "#8b5cf6"
accentColor = "#06b6d4"

# Backgrounds
bgPrimary = "#111827"
bgSecondary = "#1f2937"
bgTertiary = "#374151"
bgHover = "#4b5563"

# Text
textPrimary = "#ffffff"
textSecondary = "#d1d5db"
textMuted = "#9ca3af"
textAccent = "#60a5fa"
dragHandleColor = "#6b7280"
dragHandleHover = "#60a5fa"

# Borders
borderPrimary = "#374151"
borderSecondary = "#4b5563"
borderFocus = "#3b82f6"

# Navigation colors
navBg = "#1f2937"
navBorder = "#374151"
navTabActive = "#3b82f6"
navTabInactive = "#9ca3af"
navTabHover = "#ffffff"
navTabActiveBorder = "#3b82f6"
navMobileMenuBg = "#1f2937"
navMobileItemHover = "#374151"

# Hit Rate & Status Badge colors
hitRateHighBg = "#064e3b"
hitRateHighText = "#34d399"
hitRateMediumBg = "#1e3a8a"
hitRateMediumText = "#93c5fd"
hitRateLowBg = "#ea580c"
hitRateLowText = "#fb923c"
statusWarningBg = "#78350f"
statusWarningText = "#fbbf24"

# Action Button colors
actionResetBg = "#f59e0b"
actionResetHover = "#d97706"
actionProcessBg = "#10b981"
actionProcessHover = "#059669"
actionDeleteBg = "#ef4444"
actionDeleteHover = "#dc2626"

# Status colors
success = "#10b981"
successBg = "#064e3b"
successText = "#34d399"
warning = "#f59e0b"
warningBg = "#78350f"
warningText = "#fbbf24"
error = "#ef4444"
errorBg = "#7f1d1d"
errorText = "#fca5a5"
info = "#3b82f6"
infoBg = "#1e3a8a"
infoText = "#93c5fd"

# Service colors
steamColor = "#1e40af"
epicColor = "#7c3aed"
originColor = "#ea580c"
blizzardColor = "#0891b2"
wsusColor = "#16a34a"
riotColor = "#dc2626"

# Components
cardBg = "#1f2937"
cardBorder = "#374151"
buttonBg = "#3b82f6"
buttonHover = "#2563eb"
buttonText = "#ffffff"
inputBg = "#374151"
inputBorder = "#4b5563"
inputFocus = "#3b82f6"
badgeBg = "#3b82f6"
badgeText = "#ffffff"
progressBar = "#3b82f6"
progressBg = "#374151"

# Icon backgrounds (solid colors, no gradients)
iconBgBlue = "#3b82f6"
iconBgGreen = "#10b981"
iconBgEmerald = "#10b981"
iconBgPurple = "#8b5cf6"
iconBgIndigo = "#6366f1"
iconBgOrange = "#f97316"
iconBgYellow = "#eab308"
iconBgCyan = "#06b6d4"
iconBgRed = "#ef4444"

# Chart colors
chartColor1 = "#3b82f6"
chartColor2 = "#10b981"
chartColor3 = "#f59e0b"
chartColor4 = "#ef4444"
chartColor5 = "#8b5cf6"
chartColor6 = "#06b6d4"
chartColor7 = "#f97316"
chartColor8 = "#ec4899"
chartBorderColor = "#1f2937"
chartGridColor = "#374151"
chartTextColor = "#9ca3af"
chartCacheHitColor = "#10b981"
chartCacheMissColor = "#f59e0b"

[css]
content = """
/* Add any custom CSS here */
"""`,s=new Blob([t],{type:"text/plain"}),f=URL.createObjectURL(s),m=document.createElement("a");m.href=f,m.download="sample-theme.toml",m.click(),URL.revokeObjectURL(f)},Z=t=>["dark-default","light-default"].includes(t);return e.jsxs(e.Fragment,{children:[e.jsxs(J,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Pe,{className:"w-5 h-5 text-themed-accent"}),e.jsx("h3",{className:"text-lg font-semibold text-themed-primary",children:"Theme Management"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[l?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>I(!0),className:"p-2 rounded-lg transition-colors",style:{color:"var(--theme-text-muted)",backgroundColor:"transparent"},onMouseEnter:t=>t.currentTarget.style.backgroundColor="var(--theme-bg-hover)",onMouseLeave:t=>t.currentTarget.style.backgroundColor="transparent",title:"Create new theme",children:e.jsx(gt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:lt,disabled:r,className:"p-2 rounded-lg transition-colors",style:{color:"var(--theme-text-muted)",backgroundColor:"transparent"},onMouseEnter:t=>t.currentTarget.style.backgroundColor="var(--theme-bg-hover)",onMouseLeave:t=>t.currentTarget.style.backgroundColor="transparent",title:"Delete all custom themes",children:e.jsx(xt,{className:"w-4 h-4"})})]}):e.jsx("button",{disabled:!0,className:"p-2 rounded-lg transition-colors opacity-50 cursor-not-allowed",style:{color:"var(--theme-text-muted)",backgroundColor:"transparent"},title:"Authentication required to create themes",children:e.jsx(se,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ce(),disabled:r,className:"p-2 rounded-lg transition-colors",style:{color:"var(--theme-text-muted)",backgroundColor:"transparent"},onMouseEnter:t=>t.currentTarget.style.backgroundColor="var(--theme-bg-hover)",onMouseLeave:t=>t.currentTarget.style.backgroundColor="transparent",title:"Refresh themes",children:e.jsx(Ke,{className:`w-4 h-4 ${r?"animate-spin":""}`})})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-themed-secondary",children:"Active Theme"}),e.jsx("select",{value:b||n,onChange:t=>Q(t.target.value),className:"w-full px-3 py-2 focus:outline-none themed-input",disabled:r,children:y.map(t=>e.jsxs("option",{value:t.meta.id,children:[t.meta.name," ",t.meta.author&&t.meta.author!=="System"&&`by ${t.meta.author}`,Z(t.meta.id)&&" (System)",b===t.meta.id&&" (Preview)"]},t.meta.id))}),b&&e.jsx("p",{className:"text-xs mt-2 text-themed-warning",children:"Preview mode active. Select a theme to apply it permanently."})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("h4",{className:"text-sm font-medium mb-3 text-themed-secondary",children:["Installed Themes (",y.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:y.map(t=>e.jsxs("div",{className:"rounded p-3 flex items-center justify-between border-2 transition-colors themed-card",style:{borderColor:n===t.meta.id&&!b?"var(--theme-primary)":b===t.meta.id?"var(--theme-warning)":"transparent"},children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-themed-primary",children:t.meta.name}),t.meta.isDark?e.jsx($e,{className:"w-3 h-3 text-themed-muted"}):e.jsx(Me,{className:"w-3 h-3 text-themed-warning"}),n===t.meta.id&&!b&&e.jsx("span",{className:"px-2 py-0.5 text-xs rounded themed-button-primary",children:"Active"}),b===t.meta.id&&e.jsx("span",{className:"px-2 py-0.5 text-xs rounded bg-themed-warning text-themed-primary",children:"Preview"}),Z(t.meta.id)&&e.jsx("span",{className:"px-2 py-0.5 text-xs rounded bg-themed-hover text-themed-muted",children:"System"})]}),t.meta.description&&e.jsx("p",{className:"text-xs mt-1 text-themed-muted",children:t.meta.description}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[t.meta.author&&e.jsxs("p",{className:"text-xs text-themed-muted",children:["by ",t.meta.author]}),t.meta.version&&e.jsxs("p",{className:"text-xs text-themed-muted",children:["v",t.meta.version]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>dt(t),className:"p-2 transition-colors text-themed-muted",title:"Export theme",children:e.jsx(ie,{className:"w-4 h-4"})}),n!==t.meta.id&&e.jsx("button",{onClick:()=>Qe(t.meta.id),className:"p-2 transition-colors",style:{color:b===t.meta.id?"var(--theme-warning)":"var(--theme-text-muted)"},title:b===t.meta.id?"Stop preview":"Preview theme",children:b===t.meta.id?e.jsx(bt,{className:"w-4 h-4"}):e.jsx(Ye,{className:"w-4 h-4"})}),n!==t.meta.id&&e.jsx("button",{onClick:()=>Q(t.meta.id),className:"p-2 transition-colors text-themed-accent",title:"Apply theme",children:e.jsx(xe,{className:"w-4 h-4"})}),!Z(t.meta.id)&&l&&e.jsx("button",{onClick:()=>ct(t),disabled:r,className:"p-2 transition-colors text-themed-secondary",title:"Edit theme",children:e.jsx(yt,{className:"w-4 h-4"})}),!Z(t.meta.id)&&l&&e.jsx("button",{onClick:()=>ot(t.meta.id,t.meta.name),disabled:r,className:"p-2 transition-colors disabled:opacity-50 text-themed-error",title:"Delete theme",children:e.jsx(Ge,{className:"w-4 h-4"})})]})]},t.meta.id))})]}),l&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-sm font-medium mb-3 text-themed-secondary",children:"Upload Custom Theme"}),e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${j?"border-purple-500 bg-purple-900 bg-opacity-20":""}`,style:{borderColor:j?"var(--theme-secondary)":"var(--theme-border-secondary)"},onDragEnter:ge,onDragLeave:ge,onDragOver:ge,onDrop:rt,children:[e.jsx(vt,{className:"w-12 h-12 mx-auto mb-3 text-themed-muted"}),e.jsx("p",{className:"mb-2 text-themed-secondary",children:"Drag and drop a theme file here, or click to browse"}),e.jsx("p",{className:"text-xs mb-3 text-themed-muted",children:"TOML format, max 1MB"}),e.jsx("input",{ref:je,type:"file",accept:".toml",onChange:t=>{var s;return((s=t.target.files)==null?void 0:s[0])&&Se(t.target.files[0])},className:"hidden"}),e.jsx(R,{variant:"filled",color:"purple",onClick:()=>{var t;return(t=je.current)==null?void 0:t.click()},disabled:r,loading:r,children:"Browse Files"})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(R,{variant:"subtle",leftSection:e.jsx(ie,{className:"w-4 h-4"}),onClick:mt,children:"Download Sample TOML Theme"})})]}),!l&&e.jsx(W,{color:"yellow",children:"Authentication required to create, upload, or delete custom themes"}),$&&e.jsx(W,{color:"red",withCloseButton:!0,onClose:()=>x(null),children:$}),S&&e.jsx(W,{color:"green",withCloseButton:!0,onClose:()=>A(null),children:S})]}),e.jsx(ue,{opened:P,onClose:()=>{I(!1),he({})},title:"Create Custom Theme",size:"xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-sm font-semibold flex items-center gap-2 text-themed-primary",children:[e.jsx(Ie,{className:"w-4 h-4"}),"Theme Information"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Theme Name *"}),e.jsx("input",{type:"text",value:F.name,onChange:t=>Y({...F,name:t.target.value}),placeholder:"My Custom Theme",className:"w-full px-3 py-2 focus:outline-none themed-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Author"}),e.jsx("input",{type:"text",value:F.author,onChange:t=>Y({...F,author:t.target.value}),placeholder:"Your Name",className:"w-full px-3 py-2 focus:outline-none themed-input"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Description"}),e.jsx("input",{type:"text",value:F.description,onChange:t=>Y({...F,description:t.target.value}),placeholder:"A beautiful custom theme",className:"w-full px-3 py-2 rounded focus:outline-none themed-input"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:F.isDark,onChange:t=>Y({...F,isDark:t.target.checked}),className:"rounded"}),e.jsx("span",{className:"text-sm text-themed-secondary",children:"Dark Theme"})]}),e.jsxs("button",{onClick:()=>Be("dark"),className:"px-3 py-1 text-xs rounded-lg flex items-center gap-1 bg-themed-tertiary text-themed-secondary",children:[e.jsx($e,{className:"w-3 h-3"}),"Load Dark Preset"]}),e.jsxs("button",{onClick:()=>Be("light"),className:"px-3 py-1 text-xs rounded-lg flex items-center gap-1 bg-themed-tertiary text-themed-secondary",children:[e.jsx(Me,{className:"w-3 h-3"}),"Load Light Preset"]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(_e,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-themed-muted"}),e.jsx("input",{type:"text",value:p,onChange:t=>O(t.target.value),placeholder:"Search colors... (e.g., 'button', 'background', 'text')",className:"w-full pl-10 pr-10 py-2 themed-input"}),p&&e.jsx("button",{onClick:()=>O(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-themed-muted hover:text-themed-primary",children:e.jsx(ye,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:Ce(we,p).map(t=>{const s=t.icon,f=z.includes(t.name)||p.trim()!=="";return e.jsxs("div",{className:"border themed-card rounded-lg",children:[e.jsxs("button",{onClick:()=>ke(t.name),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-opacity-50",style:{backgroundColor:f?"var(--theme-bg-tertiary)":"transparent"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(s,{className:"w-4 h-4 text-themed-accent"}),e.jsxs("div",{className:"text-left",children:[e.jsx("h5",{className:"text-sm font-semibold capitalize text-themed-primary",children:t.name.replace(/([A-Z])/g," $1").trim()}),e.jsx("p",{className:"text-xs text-themed-muted",children:t.description})]})]}),f?e.jsx(Fe,{className:"w-4 h-4"}):e.jsx(Le,{className:"w-4 h-4"})]}),f&&e.jsx("div",{className:"p-4 border-t themed-card space-y-4",children:t.colors.map(m=>e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-themed-primary",children:m.label}),e.jsx("p",{className:"text-xs text-themed-muted",children:m.description}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:m.affects.map((T,C)=>e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded",style:{backgroundColor:"var(--theme-bg-hover)",color:"var(--theme-text-secondary)"},children:T},C))})]}),e.jsx("div",{className:"flex items-center gap-2",children:(()=>{const{hex:T,alpha:C}=oe(F[m.key]||"#000000");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"relative",children:e.jsx("input",{type:"color",value:T,onMouseDown:()=>pe(m.key),onFocus:()=>pe(m.key),onChange:M=>{const G=oe(F[m.key]).alpha;le(m.key,M.target.value,G,!0)},className:"w-12 h-8 rounded cursor-pointer",style:{backgroundColor:F[m.key]}})}),m.supportsAlpha&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(He,{className:"w-3 h-3 text-themed-muted"}),e.jsx("input",{type:"range",min:"0",max:"100",value:Math.round(C*100),onChange:M=>{const G=parseInt(M.target.value)/100;le(m.key,T,G,!0)},className:"w-16",title:`Opacity: ${Math.round(C*100)}%`}),e.jsxs("span",{className:"text-xs text-themed-muted w-8",children:[Math.round(C*100),"%"]})]}),e.jsx("input",{type:"text",value:F[m.key],onFocus:()=>pe(m.key),onChange:M=>Ze(m.key,M.target.value),className:"w-24 px-2 py-1 text-xs rounded font-mono themed-input"}),e.jsx("button",{onClick:()=>Te(F[m.key]),className:"p-1 rounded-lg hover:bg-opacity-50 bg-themed-hover",title:"Copy color",children:N===F[m.key]?e.jsx(xe,{className:"w-3 h-3",style:{color:"var(--theme-success)"}}):e.jsx(de,{className:"w-3 h-3 text-themed-muted"})}),Ne(m.key)&&e.jsx("button",{onClick:()=>et(m.key),className:"p-1 rounded-lg hover:bg-opacity-50 bg-themed-hover",title:`Restore previous color: ${Ne(m.key)}`,children:e.jsx(De,{className:"w-3 h-3 text-themed-muted"})})]})})()})]})},m.key))})]},t.name)})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Custom CSS (Optional)"}),e.jsx("textarea",{value:F.customCSS,onChange:t=>Y({...F,customCSS:t.target.value}),placeholder:"/* Add any custom CSS here */",rows:4,className:"w-full px-3 py-2 rounded font-mono text-xs focus:outline-none themed-input"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",style:{borderColor:"var(--theme-border-primary)"},children:[e.jsx(R,{variant:"default",onClick:()=>I(!1),children:"Cancel"}),e.jsx(R,{variant:"filled",leftSection:e.jsx(Re,{className:"w-4 h-4"}),onClick:it,disabled:!F.name||!l,className:"themed-button-primary",children:"Create Theme"})]})]})}),e.jsx(ue,{opened:K,onClose:()=>{_(!1),H(null),L({}),w({})},title:`Edit Theme: ${(v==null?void 0:v.meta.name)||""}`,size:"xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-sm font-semibold flex items-center gap-2 text-themed-primary",children:[e.jsx(Ie,{className:"w-4 h-4"}),"Theme Information"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Theme Name *"}),e.jsx("input",{type:"text",value:k.name||"",onChange:t=>L({...k,name:t.target.value}),placeholder:"My Custom Theme",className:"w-full px-3 py-2 focus:outline-none themed-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Author"}),e.jsx("input",{type:"text",value:k.author||"",onChange:t=>L({...k,author:t.target.value}),placeholder:"Your Name",className:"w-full px-3 py-2 focus:outline-none themed-input"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Description"}),e.jsx("input",{type:"text",value:k.description||"",onChange:t=>L({...k,description:t.target.value}),placeholder:"A beautiful custom theme",className:"w-full px-3 py-2 rounded focus:outline-none themed-input"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:k.isDark||!1,onChange:t=>L({...k,isDark:t.target.checked}),className:"rounded"}),e.jsx("span",{className:"text-sm text-themed-secondary",children:"Dark Theme"})]}),e.jsxs("span",{className:"text-xs text-themed-muted",children:["Theme ID: ",v==null?void 0:v.meta.id]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(_e,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-themed-muted"}),e.jsx("input",{type:"text",value:B,onChange:t=>D(t.target.value),placeholder:"Search colors... (e.g., 'button', 'background', 'text')",className:"w-full pl-10 pr-10 py-2 themed-input"}),B&&e.jsx("button",{onClick:()=>D(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-themed-muted hover:text-themed-primary",children:e.jsx(ye,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:Ce(we,B).map(t=>{const s=t.icon,f=z.includes(t.name)||B.trim()!=="";return e.jsxs("div",{className:"border themed-card rounded-lg",children:[e.jsxs("button",{onClick:()=>ke(t.name),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-opacity-50",style:{backgroundColor:f?"var(--theme-bg-tertiary)":"transparent"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(s,{className:"w-4 h-4 text-themed-accent"}),e.jsxs("div",{className:"text-left",children:[e.jsx("h5",{className:"text-sm font-semibold capitalize text-themed-primary",children:t.name.replace(/([A-Z])/g," $1").trim()}),e.jsx("p",{className:"text-xs text-themed-muted",children:t.description})]})]}),f?e.jsx(Fe,{className:"w-4 h-4"}):e.jsx(Le,{className:"w-4 h-4"})]}),f&&e.jsx("div",{className:"p-4 border-t themed-card space-y-4",children:t.colors.map(m=>e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-themed-primary",children:m.label}),e.jsx("p",{className:"text-xs text-themed-muted",children:m.description}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:m.affects.map((T,C)=>e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded",style:{backgroundColor:"var(--theme-bg-hover)",color:"var(--theme-text-secondary)"},children:T},C))})]}),e.jsx("div",{className:"flex items-center gap-2",children:(()=>{const{hex:T,alpha:C}=oe(k[m.key]||"#000000");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"relative",children:e.jsx("input",{type:"color",value:T,onMouseDown:()=>fe(m.key),onFocus:()=>fe(m.key),onChange:M=>{const G=oe(k[m.key]||"#000000").alpha;le(m.key,M.target.value,G,!1)},className:"w-12 h-8 rounded cursor-pointer",style:{backgroundColor:k[m.key]||"#000000"}})}),m.supportsAlpha&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(He,{className:"w-3 h-3 text-themed-muted"}),e.jsx("input",{type:"range",min:"0",max:"100",value:Math.round(C*100),onChange:M=>{const G=parseInt(M.target.value)/100;le(m.key,T,G,!1)},className:"w-16",title:`Opacity: ${Math.round(C*100)}%`}),e.jsxs("span",{className:"text-xs text-themed-muted w-8",children:[Math.round(C*100),"%"]})]}),e.jsx("input",{type:"text",value:k[m.key]||"",onFocus:()=>fe(m.key),onChange:M=>tt(m.key,M.target.value),className:"w-24 px-2 py-1 text-xs rounded font-mono themed-input",placeholder:m.key}),e.jsx("button",{onClick:()=>Te(k[m.key]||""),className:"p-1 rounded-lg hover:bg-opacity-50 bg-themed-hover",title:"Copy color",children:N===k[m.key]?e.jsx(xe,{className:"w-3 h-3",style:{color:"var(--theme-success)"}}):e.jsx(de,{className:"w-3 h-3 text-themed-muted"})}),(()=>{const M=at(m.key);return M?e.jsx("button",{onClick:()=>st(m.key),className:"p-1 rounded-lg hover:bg-opacity-50 bg-themed-hover",title:`Restore previous color: ${M}`,children:e.jsx(De,{className:"w-3 h-3 text-themed-muted"})}):null})()]})})()})]})},m.key))})]},t.name)})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Custom CSS (Optional)"}),e.jsx("textarea",{value:k.customCSS||"",onChange:t=>L({...k,customCSS:t.target.value}),placeholder:"/* Add any custom CSS here */",rows:4,className:"w-full px-3 py-2 rounded font-mono text-xs focus:outline-none themed-input"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",style:{borderColor:"var(--theme-border-primary)"},children:[e.jsx(R,{variant:"default",onClick:()=>{_(!1),H(null),L({})},children:"Cancel"}),e.jsx(R,{variant:"filled",leftSection:e.jsx(Re,{className:"w-4 h-4"}),onClick:nt,disabled:!k.name||!l||r,className:"themed-button-primary",children:"Save Changes"})]})]})})]})},Ot=({alerts:l,onClearError:y,onClearSuccess:a})=>{var n,h;return!l||!((n=l.errors)!=null&&n.length)&&!l.success?null:e.jsxs("div",{className:"space-y-4",children:[(h=l.errors)==null?void 0:h.map(r=>e.jsx(W,{color:"red",icon:e.jsx(re,{className:"w-5 h-5"}),withCloseButton:!0,onClose:()=>y(r.id),children:r.message},r.id)),l.success&&e.jsx(W,{color:"green",icon:e.jsx(ae,{className:"w-5 h-5"}),withCloseButton:!!a,onClose:a,children:l.success})]})},ze=[{type:"clients",label:"Client Statistics",description:"Export client usage data including bandwidth and cache hits",formats:["json","csv","prometheus"],icon:me},{type:"services",label:"Service Statistics",description:"Export service-level metrics (Steam, Epic, etc.)",formats:["json","csv","prometheus","influxdb"],icon:Ve},{type:"cache",label:"Cache Information",description:"Export current cache usage and storage metrics",formats:["json","prometheus"],icon:me},{type:"dashboard",label:"Dashboard Statistics",description:"Export aggregated dashboard metrics",formats:["json","prometheus","influxdb"],icon:St},{type:"downloads",label:"Download History",description:"Export recent download history (last 1000 entries)",formats:["json","csv"],icon:Bt}],Et=({isAuthenticated:l,mockMode:y,onError:a,onSuccess:n})=>{var N;const[h,r]=u.useState(!1),[c,j]=u.useState(null),[g,$]=u.useState("json"),[x,S]=u.useState({}),[A,b]=u.useState(null),[d,P]=u.useState(null);u.useEffect(()=>{fetch("/api/metrics/status").then(i=>i.json()).then(i=>P(i.requiresAuthentication)).catch(()=>P(!1))},[]);const I=i=>{if(!i||i.length===0)return"";const o=Object.keys(i[0]),w=o.join(","),p=i.map(O=>o.map(B=>{const D=O[B];return D==null?"":typeof D=="string"&&D.includes(",")?`"${D.replace(/"/g,'""')}"`:D}).join(","));return[w,...p].join(`
`)},K=(i,o)=>{const w=Date.now();let p=[];switch(o){case"clients":i.forEach(L=>{p.push("# HELP lancache_client_cache_hit_bytes Total cache hit bytes for client"),p.push("# TYPE lancache_client_cache_hit_bytes counter"),p.push(`lancache_client_cache_hit_bytes{client="${L.clientIp}"} ${L.totalCacheHitBytes} ${w}`),p.push(`lancache_client_cache_miss_bytes{client="${L.clientIp}"} ${L.totalCacheMissBytes} ${w}`),p.push(`lancache_client_download_count{client="${L.clientIp}"} ${L.totalDownloads} ${w}`)});break;case"services":i.forEach(L=>{p.push("# HELP lancache_service_cache_hit_bytes Total cache hit bytes for service"),p.push("# TYPE lancache_service_cache_hit_bytes counter"),p.push(`lancache_service_cache_hit_bytes{service="${L.service}"} ${L.totalCacheHitBytes} ${w}`),p.push(`lancache_service_cache_miss_bytes{service="${L.service}"} ${L.totalCacheMissBytes} ${w}`),p.push(`lancache_service_download_count{service="${L.service}"} ${L.totalDownloads} ${w}`),p.push(`lancache_service_hit_ratio{service="${L.service}"} ${L.cacheHitPercent/100} ${w}`)});break;case"cache":const D=i;p.push("# HELP lancache_cache_total_bytes Total cache size in bytes"),p.push("# TYPE lancache_cache_total_bytes gauge"),p.push(`lancache_cache_total_bytes ${D.totalCacheSize} ${w}`),p.push(`lancache_cache_used_bytes ${D.usedCacheSize} ${w}`),p.push(`lancache_cache_free_bytes ${D.freeCacheSize} ${w}`),p.push(`lancache_cache_usage_percent ${D.usagePercent/100} ${w}`),p.push(`lancache_cache_file_count ${D.totalFiles} ${w}`);break;case"dashboard":const k=i;p.push("# HELP lancache_bandwidth_saved_bytes Total bandwidth saved"),p.push("# TYPE lancache_bandwidth_saved_bytes counter"),p.push(`lancache_bandwidth_saved_bytes ${k.totalBandwidthSaved} ${w}`),p.push(`lancache_cache_added_bytes ${k.totalAddedToCache} ${w}`),p.push(`lancache_served_bytes ${k.totalServed} ${w}`),p.push(`lancache_hit_ratio ${k.cacheHitRatio/100} ${w}`),p.push(`lancache_active_downloads ${k.activeDownloads} ${w}`),p.push(`lancache_unique_clients ${k.uniqueClients} ${w}`);break}return p.join(`
`)},_=(i,o)=>{const w=Date.now()*1e6;let p=[];switch(o){case"services":i.forEach(D=>{p.push(`lancache,service=${D.service} cache_hit_bytes=${D.totalCacheHitBytes}i,cache_miss_bytes=${D.totalCacheMissBytes}i,total_downloads=${D.totalDownloads}i,hit_ratio=${D.cacheHitPercent/100} ${w}`)});break;case"dashboard":const B=i;p.push(`lancache_stats bandwidth_saved=${B.totalBandwidthSaved}i,cache_added=${B.totalAddedToCache}i,total_served=${B.totalServed}i,hit_ratio=${B.cacheHitRatio/100},active_downloads=${B.activeDownloads}i,unique_clients=${B.uniqueClients}i ${w}`);break}return p.join(`
`)},v=i=>{let o=0;const w=setInterval(()=>{o+=Math.random()*30,o>=95&&(o=95,clearInterval(w)),S(p=>({...p,[i]:o}))},200);return w},H=async()=>{if(!c){a==null||a("Please select data to export");return}r(!0),S({[c]:0});const i=v(c);try{let o,w,p,O;switch(c){case"clients":o=await E.getClientStats();break;case"services":o=await E.getServiceStats();break;case"cache":o=await E.getCacheInfo();break;case"dashboard":o=await E.getDashboardStats();break;case"downloads":o=await E.getLatestDownloads(void 0,1e3);break}switch(g){case"csv":O=I(Array.isArray(o)?o:[o]),p="text/csv",w=`lancache_${c}_${new Date().toISOString().split("T")[0]}.csv`;break;case"prometheus":O=K(o,c),p="text/plain",w=`lancache_${c}_metrics.txt`;break;case"influxdb":O=_(o,c),p="text/plain",w=`lancache_${c}_influx.txt`;break;case"json":default:O=JSON.stringify(o,null,2),p="application/json",w=`lancache_${c}_${new Date().toISOString().split("T")[0]}.json`;break}const B=new Blob([O],{type:p}),D=URL.createObjectURL(B),k=document.createElement("a");k.href=D,k.download=w,document.body.appendChild(k),k.click(),document.body.removeChild(k),URL.revokeObjectURL(D),clearInterval(i),S({[c]:100}),setTimeout(()=>S({}),500),n==null||n(`Exported ${c} data as ${g.toUpperCase()}`)}catch(o){clearInterval(i),S({}),a==null||a(o.message||"Failed to export data")}finally{r(!1)}},z=(i,o)=>{navigator.clipboard.writeText(i),b(o),setTimeout(()=>b(null),2e3)},U=window.location.origin;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(J,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Tt,{className:"w-5 h-5 text-themed-accent"}),e.jsx("h3",{className:"text-lg font-semibold text-themed-primary",children:"Live API Endpoints for Grafana"})]}),d!==null&&e.jsx("div",{className:`flex items-center space-x-1 px-3 py-1 rounded-full text-xs font-medium border ${d?"access-indicator-secured":"access-indicator-public"}`,children:d?e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"w-3 h-3"}),e.jsx("span",{children:"API Key Required"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ue,{className:"w-3 h-3"}),e.jsx("span",{children:"Public Access"})]})})]}),e.jsx("p",{className:"text-themed-muted text-sm mb-4",children:d?"These endpoints provide real-time metrics with API key authentication. Configure your API key in Grafana or Prometheus.":"These endpoints provide real-time metrics without authentication. Use them directly in Grafana or Prometheus."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"p-3 rounded-lg border themed-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-themed-primary",children:"Prometheus Metrics"}),e.jsx(R,{size:"xs",variant:"default",onClick:()=>z(`${U}/api/metrics`,"prometheus"),leftSection:A==="prometheus"?e.jsx(ae,{className:"w-3 h-3"}):e.jsx(de,{className:"w-3 h-3"}),children:A==="prometheus"?"Copied!":"Copy"})]}),e.jsxs("code",{className:"text-xs text-themed-muted block break-all",children:[U,"/api/metrics"]}),e.jsx("p",{className:"text-xs text-themed-muted mt-1",children:"OpenMetrics format for Prometheus scraping"})]}),e.jsxs("div",{className:"p-3 rounded-lg border themed-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-themed-primary",children:"JSON Metrics"}),e.jsx(R,{size:"xs",variant:"default",onClick:()=>z(`${U}/api/metrics/json`,"json-api"),leftSection:A==="json-api"?e.jsx(ae,{className:"w-3 h-3"}):e.jsx(de,{className:"w-3 h-3"}),children:A==="json-api"?"Copied!":"Copy"})]}),e.jsxs("code",{className:"text-xs text-themed-muted block break-all",children:[U,"/api/metrics/json"]}),e.jsx("p",{className:"text-xs text-themed-muted mt-1",children:"JSON format for direct Grafana integration"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(W,{color:"blue",children:e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Security Options:"})," By default, these endpoints are public. To require API key authentication, set ",e.jsx("code",{children:"RequireAuthForMetrics: true"})," in your config. Then add header ",e.jsx("code",{children:"X-Api-Key: your-key"})," to Grafana/Prometheus."]})})}),e.jsx("div",{className:"mt-2",children:e.jsx(W,{color:"green",children:e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Live Updates:"})," Configure Grafana to poll every 10-30 seconds for real-time monitoring. Works with both Prometheus and JSON datasource plugins."]})})})]}),e.jsxs(J,{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(ie,{className:"w-5 h-5 text-themed-accent"}),e.jsx("h3",{className:"text-lg font-semibold text-themed-primary",children:"Data Export"})]}),e.jsx("p",{className:"text-themed-muted text-sm mb-4",children:"Export cache statistics in various formats for analysis and monitoring"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-themed-primary mb-2",children:"Select Data Type"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:ze.map(i=>{const o=i.icon;return e.jsxs("button",{onClick:()=>{j(i.type),i.formats.includes(g)||$(i.formats[0])},className:`p-3 rounded-lg border-2 transition-all text-left relative overflow-hidden themed-card ${c===i.type?"bg-themed-tertiary":"hover:bg-themed-hover"}`,style:{borderColor:c===i.type?"var(--theme-primary)":"var(--theme-card-border)"},children:[e.jsxs("div",{className:"flex items-start space-x-3 relative z-10",children:[e.jsx(o,{className:"w-5 h-5 text-themed-accent mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-themed-primary",children:i.label}),e.jsx("div",{className:"text-xs text-themed-muted mt-1",children:i.description})]})]}),x[i.type]!==void 0&&e.jsx("div",{className:"absolute bottom-0 left-0 w-full h-1 bg-themed-secondary",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 to-blue-400 transition-all duration-300",style:{width:`${x[i.type]}%`}})})]},i.type)})})]}),c&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-themed-primary mb-2",children:"Export Format"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(N=ze.find(i=>i.type===c))==null?void 0:N.formats.map(i=>e.jsx(R,{onClick:()=>$(i),variant:g===i?"filled":"default",color:"blue",size:"sm",children:i.toUpperCase()},i))})]}),c&&g&&e.jsx(W,{color:"blue",children:e.jsxs("div",{className:"text-sm",children:[g==="prometheus"&&e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Prometheus Format:"})," Metrics in OpenMetrics text format. Can be scraped by Prometheus or imported into Grafana."]}),g==="influxdb"&&e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"InfluxDB Format:"})," Line protocol format for direct import into InfluxDB or Telegraf."]}),g==="csv"&&e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"CSV Format:"})," Comma-separated values for spreadsheet applications or data analysis tools."]}),g==="json"&&e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"JSON Format:"})," Structured data for programmatic processing or custom visualizations."]})]})}),e.jsx(R,{onClick:H,disabled:!c||h,loading:h,variant:"filled",color:"green",leftSection:e.jsx(ie,{className:"w-4 h-4"}),fullWidth:!0,children:"Export Data"})]})]})]})},zt=({mockMode:l,onToggle:y,disabled:a})=>e.jsxs(J,{children:[e.jsx("h3",{className:"text-lg font-semibold text-themed-primary mb-4",children:"Mock Mode"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-themed-secondary",children:"Enable mock data for demonstration"}),e.jsx("p",{className:"text-sm text-themed-muted mt-1",children:"Simulates realistic cache data and download activity"})]}),e.jsx(R,{onClick:y,disabled:a,variant:"filled",color:"blue",leftSection:l?e.jsx(At,{className:"w-5 h-5"}):e.jsx(Pt,{className:"w-5 h-5"}),children:l?"Enabled":"Disabled"})]}),l&&e.jsx("div",{className:"mt-4",children:e.jsx(W,{color:"blue",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Mock mode active - API actions disabled"})]})})})]}),Ut=({isAuthenticated:l,mockMode:y,onError:a,onSuccess:n,onDataRefresh:h})=>{const[r,c]=u.useState(!1),j=async()=>{if(!l){a==null||a("Authentication required");return}if(window.confirm("Delete all download history?")){c(!0);try{const g=await E.resetDatabase();g&&(n==null||n(g.message||"Database reset successfully"),setTimeout(()=>h==null?void 0:h(),2e3))}catch(g){a==null||a(g.message||"Failed to reset database")}finally{c(!1)}}};return e.jsxs(J,{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(me,{className:"w-5 h-5 text-themed-accent"}),e.jsx("h3",{className:"text-lg font-semibold text-themed-primary",children:"Database Management"})]}),e.jsx("p",{className:"text-themed-muted text-sm mb-4",children:"Manage download history and statistics"}),e.jsx(R,{onClick:j,disabled:r||y||!l,loading:r,variant:"filled",color:"red",leftSection:e.jsx(me,{className:"w-4 h-4"}),fullWidth:!0,children:"Reset Database"}),e.jsx("p",{className:"text-xs text-themed-muted mt-2",children:"Clears all download history (does not affect cached files)"})]})},Gt=({isAuthenticated:l,mockMode:y,onError:a,onSuccess:n,onDataRefresh:h,onBackgroundOperation:r})=>{const[c,j]=u.useState({}),[g,$]=u.useState({logPath:"/logs/access.log",services:[]}),[x,S]=u.useState(null),[A,b]=u.useState(!0),d=ve("activeServiceRemoval","serviceRemoval",30);u.useEffect(()=>{P(),I()},[]),u.useEffect(()=>{r==null||r(x)},[x,r]);const P=async()=>{try{const[v,H]=await Promise.all([E.getConfig(),E.getServiceLogCounts()]);$(v),j(H)}catch(v){console.error("Failed to load config:",v),$({logPath:"/logs/access.log",services:["steam","epic","origin","blizzard","wsus","riot"]})}finally{b(!1)}},I=async()=>{var H;const v=await d.load();(H=v==null?void 0:v.data)!=null&&H.service&&(S(v.data.service),n==null||n(`Removing ${v.data.service} entries from logs (operation resumed)...`),setTimeout(async()=>{await d.clear(),S(null);try{const[z,U]=await Promise.all([E.getConfig(),E.getServiceLogCounts()]);$(z),j(U)}catch(z){console.error("Failed to reload config:",z)}h==null||h()},1e4))},K=async v=>{var H;if(!l){a==null||a("Authentication required");return}if(window.confirm(`Remove all ${v} entries?`))try{S(v),await d.save({service:v});const z=await E.removeServiceFromLogs(v);z&&(n==null||n(z.message||`${v} entries removed successfully`)),await d.clear(),setTimeout(async()=>{S(null);try{const[U,N]=await Promise.all([E.getConfig(),E.getServiceLogCounts()]);$(U),j(N)}catch(U){console.error("Failed to reload config:",U)}h==null||h()},2e3)}catch(z){await d.clear(),S(null);const U=(H=z.message)!=null&&H.includes("read-only")?"Logs directory is read-only. Remove :ro from docker-compose volume mount.":z.message||"Action failed";a==null||a(U)}},_=g.services.length>0?g.services:[];return e.jsxs(J,{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(qe,{className:"w-5 h-5 text-themed-accent"}),e.jsx("h3",{className:"text-lg font-semibold text-themed-primary",children:"Log File Management"})]}),e.jsxs("p",{className:"text-themed-muted text-sm mb-4",children:["Remove service entries from"," ",e.jsx("code",{className:"bg-themed-tertiary px-2 py-1 rounded",children:g.logPath})]}),A?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(te,{className:"w-6 h-6 animate-spin text-themed-muted"})}):_.length>0?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:_.map(v=>{const H=x===v;return e.jsx(R,{onClick:()=>K(v),disabled:y||!!x||d.loading||!l,variant:"default",loading:H||d.loading,className:"flex flex-col items-center",fullWidth:!0,children:!H&&!d.loading?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"capitalize font-medium",children:["Clear ",v]}),c[v]!==void 0&&e.jsxs("span",{className:"text-xs text-themed-muted mt-1",children:["(",c[v].toLocaleString()," entries)"]})]}):e.jsx("span",{className:"capitalize font-medium",children:"Removing..."})},v)})}):e.jsx("div",{className:"text-center py-8 text-themed-muted",children:"No services configured"}),e.jsx("div",{className:"mt-4",children:e.jsx(W,{color:"yellow",children:e.jsxs("p",{className:"text-xs",children:[e.jsx("strong",{children:"Warning:"})," Requires write permissions to logs directory"]})})})]})},Xt=()=>{const{mockMode:l,setMockMode:y,fetchData:a}=$t(),[n,h]=u.useState(!1),[r,c]=u.useState({errors:[],success:null}),[j,g]=u.useState({}),$=u.useRef(!1),x=u.useCallback(d=>{c(P=>({...P,errors:[...P.errors,{id:Date.now(),message:d}]}))},[]),S=u.useCallback(d=>{c(P=>({...P,success:d})),setTimeout(()=>c(P=>({...P,success:null})),1e4)},[]),A=u.useCallback(d=>{c(P=>({...P,errors:P.errors.filter(I=>I.id!==d)}))},[]),b=u.useCallback(()=>{c(d=>({...d,success:null}))},[]);return u.useEffect(()=>{(async()=>{if(!$.current){const P=await ee.migrateFromLocalStorage();P>0&&S(`Migrated ${P} operations from local storage to server`),$.current=!0}})()},[S]),e.jsxs("div",{className:"space-y-6",children:[e.jsx(Lt,{onAuthChange:h,onError:x,onSuccess:S}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(Ot,{alerts:r,onClearError:A,onClearSuccess:b}),j.cacheClearing&&e.jsx(W,{color:"blue",icon:e.jsx(te,{className:"w-5 h-5 animate-spin"}),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:"Cache clearing in progress..."}),j.cacheClearing.bytesDeleted>0&&e.jsxs("p",{className:"text-sm mt-1 opacity-75",children:[ne(j.cacheClearing.bytesDeleted)," cleared"]}),e.jsxs("p",{className:"text-sm mt-1 opacity-75",children:[(j.cacheClearing.progress||0).toFixed(0),"% complete"]})]}),e.jsx(R,{variant:"filled",color:"blue",size:"sm",leftSection:e.jsx(Ye,{className:"w-4 h-4"}),onClick:j.cacheClearing.showModal,children:"View Details"})]})}),j.logProcessing&&e.jsx(W,{color:j.logProcessing.status==="complete"?"green":"yellow",icon:j.logProcessing.status==="complete"?e.jsx(ae,{className:"w-5 h-5"}):e.jsx(te,{className:"w-5 h-5 animate-spin"}),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:j.logProcessing.message}),j.logProcessing.detailMessage&&e.jsx("p",{className:"text-sm mt-1 opacity-75",children:j.logProcessing.detailMessage}),j.logProcessing.progress>0&&j.logProcessing.status!=="complete"&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"w-full progress-track rounded-full h-2",children:e.jsx("div",{className:"progress-bar-low h-2 rounded-full smooth-transition",style:{width:`${Math.min(j.logProcessing.progress,100)}%`}})}),e.jsxs("p",{className:"text-xs opacity-75 mt-1",children:[j.logProcessing.progress.toFixed(1),"% complete",j.logProcessing.estimatedTime&&` • ${j.logProcessing.estimatedTime} remaining`]})]})]}),j.logProcessing.status!=="complete"&&j.logProcessing.onCancel&&e.jsx(R,{variant:"filled",color:"red",size:"sm",leftSection:e.jsx(We,{className:"w-4 h-4"}),onClick:j.logProcessing.onCancel,children:"Cancel"})]})}),j.serviceRemoval&&e.jsx(W,{color:"orange",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(te,{className:"w-5 h-5 animate-spin"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["Removing ",j.serviceRemoval," entries from logs..."]}),e.jsx("p",{className:"text-sm mt-1",children:"This may take several minutes for large log files"})]})]})})]}),e.jsx(zt,{mockMode:l,onToggle:()=>y(!l),disabled:!1}),e.jsx(Ut,{isAuthenticated:n,mockMode:l,onError:x,onSuccess:S,onDataRefresh:a}),e.jsx(Ht,{isAuthenticated:n,mockMode:l,onError:x,onSuccess:S,onBackgroundOperation:d=>g(P=>({...P,cacheClearing:d}))}),e.jsx(Dt,{isAuthenticated:n,mockMode:l,onError:x,onSuccess:S,onDataRefresh:a,onBackgroundOperation:d=>g(P=>({...P,logProcessing:d}))}),e.jsx(Gt,{isAuthenticated:n,mockMode:l,onError:x,onSuccess:S,onDataRefresh:a,onBackgroundOperation:d=>g(P=>({...P,serviceRemoval:d}))}),e.jsx(Et,{isAuthenticated:n,mockMode:l,onError:x,onSuccess:S}),e.jsx(Rt,{isAuthenticated:n})]})};export{Xt as default};
//# sourceMappingURL=ManagementTab-BCwv5G7t.js.map

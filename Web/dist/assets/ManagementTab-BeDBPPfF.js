import{r as m,j as e,R as Ue,X as Ge,C as _,K as ge,x as We,y as le,H as qe,z as Be,B as ne,b as Q,F as Se,J as Pe,N as Me,O as Ee,P as xe,Q as Ye,V as Ke,Y as pe,_ as be,D as ye,o as Ve,E as Ae,q as se,$ as Je,a0 as _e,I as ve,a1 as re,a2 as Qe,a3 as Ze,s as Xe,a4 as et,a5 as tt,A as at,m as Ce,e as je,a6 as we,a7 as ke,a8 as st,a9 as rt,i as Te}from"./react-vendor-CRal8B6Y.js";import{a as O,A as H,t as R,b as Ne,u as ot}from"./index-B5pyjgZ1.js";import{f as Z,C as Y}from"./Card-BZR4Ifu-.js";import{A as $}from"./Alert-BjJKNMow.js";import{H as lt}from"./signalr-C7Jyn4vH.js";import"./vendor-BmYUbuLR.js";import"./tanstack-CPlEqbpz.js";async function nt(o){try{const u=await fetch(o,{signal:AbortSignal.timeout(5e3)});return u.ok?{ok:!0,data:await u.json()}:{ok:!1,error:`HTTP ${u.status}`}}catch(u){return{ok:!1,error:u.message}}}const oe={},ct=()=>{if(!(typeof import.meta<"u"&&(oe!=null&&oe.VITE_API_URL)))return""},E=ct();class it{async getState(u){const s=await nt(`${E}/api/operationstate/${u}`);return s.ok?s.data:null}async saveState(u,s,l,c=30){try{const a=await fetch(`${E}/api/operationstate`,{method:"POST",headers:{"Content-Type":"application/json",...O.getAuthHeaders()},body:JSON.stringify({key:u,type:s,data:l,expirationMinutes:c})});if(!a.ok){const i=await a.text();throw new Error(`Failed to save state: ${i}`)}return await a.json()}catch(a){throw console.error("Error saving state:",a),a}}async updateState(u,s){try{const l=`${E}/api/operationstate/${encodeURIComponent(u)}`;console.log("Updating state at:",l);const c=await fetch(l,{method:"PATCH",headers:{"Content-Type":"application/json",...O.getAuthHeaders()},body:JSON.stringify({updates:s||{}})});if(!c.ok){const a=await c.text();throw console.error("Update state response:",c.status,a),new Error(`Failed to update state: ${c.status} - ${a}`)}return await c.json()}catch(l){return console.error("Error updating state:",l),null}}async removeState(u){try{const s=await fetch(`${E}/api/operationstate/${encodeURIComponent(u)}`,{method:"DELETE",headers:O.getAuthHeaders()});if(!s.ok)throw new Error("Failed to remove state");return await s.json()}catch(s){throw console.error("Error removing state:",s),s}}async getAllStates(u=null){try{const s=u?`${E}/api/operationstate?type=${u}`:`${E}/api/operationstate`,l=await fetch(s,{headers:O.getAuthHeaders()});if(!l.ok)throw new Error("Failed to get states");return await l.json()}catch(s){return console.error("Error getting all states:",s),[]}}async migrateFromLocalStorage(){const u=["activeCacheClearOperation","activeLogProcessing","activeServiceRemoval"];let s=0;for(const l of u)try{const c=localStorage.getItem(l);if(c){const a=JSON.parse(c);let i="general";l.includes("CacheClear")?i="cacheClearing":l.includes("LogProcessing")?i="logProcessing":l.includes("ServiceRemoval")&&(i="serviceRemoval"),await this.saveState(l,i,a,120),localStorage.removeItem(l),s++,console.log(`Migrated ${l} from localStorage to backend`)}}catch(c){console.error(`Failed to migrate ${l}:`,c)}return s>0&&console.log(`Successfully migrated ${s} operations to backend storage`),s}}const J=new it,ce=(o,u="general",s=30)=>{const[l,c]=m.useState(null),[a,i]=m.useState(!1),[g,h]=m.useState(null),N=m.useCallback(async d=>{i(!0),h(null);try{await J.saveState(o,u,d,s);const n={key:o,type:u,data:d,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return c(n),n}catch(n){throw console.error(`Failed to save ${o}:`,n),h(n.message),n}finally{i(!1)}},[o,u,s]),f=m.useCallback(async()=>{i(!0),h(null);try{const d=await J.getState(o);if(d){const n=d,k={key:n.key||o,type:n.type||u,data:n.data||{},createdAt:n.createdAt||new Date().toISOString(),updatedAt:n.updatedAt||n.createdAt||new Date().toISOString()};return c(k),k}return null}catch(d){return console.error(`Failed to load ${o}:`,d),h(d.message),null}finally{i(!1)}},[o,u]),w=m.useCallback(async()=>{i(!0),h(null);try{await J.removeState(o),c(null)}catch(d){throw console.error(`Failed to clear ${o}:`,d),h(d.message),d}finally{i(!1)}},[o]),v=m.useCallback(async d=>{i(!0),h(null);try{await J.updateState(o,d),c(n=>n?{...n,data:{...n.data,...d},updatedAt:new Date().toISOString()}:null)}catch(n){throw console.error(`Failed to update ${o}:`,n),h(n.message),n}finally{i(!1)}},[o]);return m.useEffect(()=>{o&&f()},[o]),{operation:l,save:N,load:f,clear:w,update:v,loading:a,error:g}},L=({children:o,variant:u="default",color:s="blue",size:l="md",loading:c=!1,leftSection:a,rightSection:i,fullWidth:g=!1,className:h="",disabled:N,...f})=>{const w=()=>u==="filled"?{blue:"themed-button-primary",green:"action-process",red:"action-delete",yellow:"action-reset",purple:"themed-button-primary",gray:"bg-themed-hover hover:bg-themed-tertiary text-themed-primary",orange:"action-reset"}[s]:u==="subtle"?"bg-transparent hover:bg-themed-hover text-themed-secondary":u==="outline"?"border border-themed-secondary hover:bg-themed-hover text-themed-primary":"bg-themed-tertiary hover:bg-themed-hover text-themed-primary",v={xs:"px-2 py-1 text-xs",sm:"px-3 py-1.5 text-sm",md:"px-4 py-2",lg:"px-6 py-3 text-lg"};return e.jsxs("button",{className:`
        ${w()}
        ${v[l]}
        ${g?"w-full":""}
        rounded-lg font-medium
        smooth-transition
        disabled:opacity-50 disabled:cursor-not-allowed
        flex items-center justify-center gap-2
        button-press
        ${h}
      `,disabled:N||c,...f,children:[c&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current"}),a,o,i]})},X=({opened:o,onClose:u,title:s,children:l,size:c="md"})=>{const a={sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"};return Ue.useEffect(()=>(o?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[o]),o?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:`themed-card rounded-lg ${a[c]} w-full mx-4 max-h-[90vh] overflow-y-auto custom-scrollbar`,children:[s&&e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-themed-secondary",children:[e.jsx("div",{className:"text-lg font-semibold text-themed-primary",children:s}),e.jsx("button",{onClick:u,className:"p-1 hover:bg-themed-hover rounded-lg smooth-transition",children:e.jsx(Ge,{className:"w-5 h-5 text-themed-muted"})})]}),e.jsx("div",{className:"p-6",children:l})]})}):null},dt=({onAuthChange:o,onError:u,onSuccess:s})=>{const[l,c]=m.useState(!1),[a,i]=m.useState(!0),[g,h]=m.useState(!1),[N,f]=m.useState(""),[w,v]=m.useState(""),[d,n]=m.useState(!1);m.useEffect(()=>{k()},[]);const k=async()=>{i(!0);try{const C=await O.checkAuth();c(C.isAuthenticated),o==null||o(C.isAuthenticated),!C.isAuthenticated&&O.isRegistered()&&O.clearAuth()}catch(C){console.error("Auth check failed:",C),c(!1),o==null||o(!1)}finally{i(!1)}},B=async()=>{if(!N.trim()){v("Please enter an API key");return}n(!0),v("");try{const C=await O.register(N);C.success?(c(!0),o==null||o(!0),h(!1),f(""),s==null||s("Authentication successful! You can now use management features.")):v(C.message||"Authentication failed")}catch(C){console.error("Authentication error:",C),v(C.message||"Authentication failed")}finally{n(!1)}},T=async()=>{if(window.confirm(`WARNING: This will:

1. Generate a NEW API key on the server
2. Revoke ALL existing device registrations
3. Require ALL users to re-authenticate
4. You must check the container logs for the new key

This cannot be undone. Continue?`)){n(!0);try{const S=await O.regenerateApiKey();S.success?(c(!1),o==null||o(!1),h(!1),u==null||u("API KEY REGENERATED - Check container logs for new key!"),s==null||s(S.message),setTimeout(()=>{h(!0)},3e3)):u==null||u(S.message||"Failed to regenerate API key")}catch(S){console.error("Error regenerating key:",S),u==null||u("Failed to regenerate API key: "+S.message)}finally{n(!1)}}};return a?null:e.jsxs(e.Fragment,{children:[e.jsx($,{color:l?"green":"yellow",icon:l?e.jsx(We,{className:"w-5 h-5"}):e.jsx(le,{className:"w-5 h-5"}),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:l?"Authenticated":"Not Authenticated"}),e.jsx("p",{className:"text-xs mt-1 opacity-75",children:l?"Management features enabled":"Management features require API key"})]}),l?e.jsx(L,{variant:"filled",color:"red",size:"sm",leftSection:e.jsx(_,{className:"w-3 h-3"}),onClick:T,loading:d,children:"Regenerate Key"}):e.jsx(L,{variant:"filled",color:"yellow",leftSection:e.jsx(ge,{className:"w-4 h-4"}),onClick:()=>h(!0),children:"Authenticate"})]})}),e.jsx(X,{opened:g,onClose:()=>{h(!1),f(""),v("")},title:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ge,{className:"w-6 h-6 text-themed-warning"}),e.jsx("span",{children:"Authentication Required"})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-themed-secondary",children:"Management operations require authentication. Please enter your API key to continue."}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-themed-secondary mb-2",children:"API Key"}),e.jsx("input",{type:"password",value:N,onChange:C=>f(C.target.value),onKeyPress:C=>C.key==="Enter"&&B(),placeholder:"lm_xxxxxxxxxxxxxxxxxxxxx",className:"w-full px-3 py-2 themed-input text-themed-primary placeholder-themed-muted focus:outline-none",disabled:d})]}),w&&e.jsx($,{color:"red",children:w}),e.jsx($,{color:"blue",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium mb-2",children:"To find your API key:"}),e.jsxs("ol",{className:"list-decimal list-inside text-xs space-y-1",children:[e.jsx("li",{children:"SSH into your server"}),e.jsxs("li",{children:["Check the file:"," ",e.jsx("code",{className:"bg-themed-tertiary px-1 rounded",children:"/data/api_key.txt"})]}),e.jsx("li",{children:"Or check the API container logs on startup"})]})]})}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-themed-secondary",children:[e.jsx(L,{variant:"default",onClick:()=>{h(!1),f(""),v("")},disabled:d,children:"Cancel"}),e.jsx(L,{variant:"filled",color:"blue",leftSection:e.jsx(le,{className:"w-4 h-4"}),onClick:B,loading:d,disabled:!N.trim(),children:"Authenticate"})]})]})})]})},mt=({isAuthenticated:o,mockMode:u,onError:s,onSuccess:l,onBackgroundOperation:c})=>{var W;const[a,i]=m.useState(null),[g,h]=m.useState(!1),[N,f]=m.useState(!1),[w,v]=m.useState({cachePath:"/cache",logPath:"/logs/access.log",services:[]}),d=ce("activeCacheClearOperation","cacheClearing",30);m.useEffect(()=>{var b;((b=d.operation)==null?void 0:b.data)&&!g&&a&&["Running","Preparing"].includes(a.status)&&c?c({bytesDeleted:a.bytesDeleted,progress:a.percentComplete||a.progress||0,showModal:()=>h(!0)}):c&&c(null)},[d.operation,g,a,c]),m.useEffect(()=>{n(),k()},[]);const n=async()=>{try{const j=await H.getConfig();v(j)}catch(j){console.error("Failed to load config:",j)}},k=async()=>{var b;const j=await d.load();if((b=j==null?void 0:j.data)!=null&&b.operationId)try{const r=await H.getCacheClearStatus(j.data.operationId);r&&["Running","Preparing"].includes(r.status)?(i(r),B(j.data.operationId)):await d.clear()}catch{await d.clear()}},B=j=>{const b=setInterval(async()=>{try{const r=await H.getCacheClearStatus(j);i(r),["Running","Preparing"].includes(r.status)?await d.update({lastProgress:r.percentComplete||r.progress||0}):(T(r),clearInterval(b))}catch(r){console.error("Error polling cache clear status:",r),clearInterval(b)}},1e3)},T=async j=>{await d.clear(),j.status==="Completed"?(l==null||l(`Cache cleared successfully! ${Z(j.bytesDeleted||0)} freed.`),setTimeout(()=>{h(!1),i(null)},2e3)):j.status==="Failed"?(s==null||s(`Cache clearing failed: ${j.error||j.message||"Unknown error"}`),setTimeout(()=>{h(!1),i(null)},5e3)):j.status==="Cancelled"&&(l==null||l("Cache clearing cancelled"),h(!1),i(null))},C=async()=>{if(!o){s==null||s("Authentication required");return}if(window.confirm("This will clear ALL cached game files. Continue?")){f(!0);try{const j=await H.clearAllCache();j.operationId&&(await d.save({operationId:j.operationId}),i({operationId:j.operationId,status:"Preparing",statusMessage:"Starting cache clear...",percentComplete:0,bytesDeleted:0,totalBytesToDelete:0}),h(!0),B(j.operationId))}catch(j){s==null||s("Failed to start cache clearing: "+j.message)}finally{f(!1)}}},S=async()=>{var b;const j=d.operation;if((b=j==null?void 0:j.data)!=null&&b.operationId)try{i(r=>r?{...r,status:"Cancelling",statusMessage:"Cancelling operation..."}:null),await H.cancelCacheClear(j.data.operationId),await d.clear(),setTimeout(()=>{h(!1),i(null),l==null||l("Cache clearing operation cancelled")},1500)}catch(r){console.error("Failed to cancel cache clear:",r),h(!1),i(null),await d.clear()}},D=((W=d.operation)==null?void 0:W.data)&&!g&&a&&["Running","Preparing"].includes(a.status),U=(a==null?void 0:a.percentComplete)||(a==null?void 0:a.progress)||0;return e.jsxs(e.Fragment,{children:[e.jsxs(Y,{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(qe,{className:"w-5 h-5 text-themed-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-themed-primary",children:"Disk Cache Management"})]}),e.jsxs("p",{className:"text-themed-muted text-sm mb-4",children:["Manage cached game files in"," ",e.jsx("code",{className:"bg-themed-tertiary px-2 py-1 rounded",children:w.cachePath})]}),e.jsx(L,{fullWidth:!0,variant:"filled",color:"red",leftSection:e.jsx(Be,{className:"w-4 h-4"}),onClick:C,disabled:N||u||D||d.loading||!o,loading:N||d.loading,children:D?"Cache Clearing in Progress...":"Clear All Cached Files"}),e.jsx("p",{className:"text-xs text-themed-muted mt-2",children:"⚠️ This deletes ALL cached game files from disk"})]}),e.jsx(X,{opened:g&&a!==null,onClose:()=>{["Running","Preparing"].includes((a==null?void 0:a.status)||"")||(h(!1),i(null))},title:"Clearing Cache",size:"lg",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[(a==null?void 0:a.status)==="Completed"?e.jsx(ne,{className:"w-5 h-5 cache-hit"}):(a==null?void 0:a.status)==="Failed"?e.jsx(_,{className:"w-5 h-5 text-themed-error"}):e.jsx(Q,{className:"w-5 h-5 text-themed-primary animate-spin"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-themed-primary font-medium",children:a==null?void 0:a.status}),((a==null?void 0:a.statusMessage)||(a==null?void 0:a.message))&&e.jsx("p",{className:"text-sm text-themed-muted",children:(a==null?void 0:a.statusMessage)||(a==null?void 0:a.message)})]})]}),a&&["Running","Preparing"].includes(a.status)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full progress-track rounded-full h-4 relative overflow-hidden",children:[e.jsx("div",{className:"progress-bar-medium h-4 rounded-full smooth-transition",style:{width:`${Math.min(100,U)}%`}}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("span",{className:"text-xs text-themed-primary font-medium",children:[U.toFixed(0),"%"]})})]}),a.bytesDeleted!==void 0&&a.totalBytesToDelete&&a.totalBytesToDelete>0&&e.jsxs("div",{className:"text-sm text-themed-muted text-center",children:[e.jsx("span",{className:"cache-hit font-semibold",children:Z(a.bytesDeleted||0)})," / ",e.jsx("span",{className:"text-themed-primary",children:Z(a.totalBytesToDelete)})," cleared"]})]}),(a==null?void 0:a.error)&&e.jsx($,{color:"red",children:a.error}),e.jsx("div",{className:"flex justify-end space-x-3 pt-4 border-t border-themed-secondary",children:a&&["Running","Preparing"].includes(a.status)?e.jsxs(e.Fragment,{children:[e.jsx(L,{variant:"filled",color:"red",leftSection:e.jsx(Se,{className:"w-4 h-4"}),onClick:S,children:"Cancel"}),e.jsx(L,{variant:"default",onClick:()=>h(!1),children:"Run in Background"})]}):e.jsx(L,{variant:"default",onClick:()=>{h(!1),i(null)},children:"Close"})})]})}),d.error&&e.jsxs($,{color:"orange",children:["Backend storage error: ",d.error]})]})},ut=({isAuthenticated:o,mockMode:u,onError:s,onSuccess:l,onDataRefresh:c,onBackgroundOperation:a})=>{const[i,g]=m.useState(!1),[h,N]=m.useState(null),[f,w]=m.useState(!1),[v,d]=m.useState(!1),n=ce("activeLogProcessing","logProcessing",120),k=m.useRef(null),B=m.useRef(null),T=m.useRef(null);m.useEffect(()=>{i&&h&&a?a({message:h.message,detailMessage:h.detailMessage,progress:h.progress,estimatedTime:h.estimatedTime,status:h.status,onCancel:j}):a&&a(null)},[i,h,a]),m.useEffect(()=>(C(),S(),()=>{B.current&&clearInterval(B.current),T.current&&clearTimeout(T.current),k.current&&k.current.stop()}),[]);const C=async()=>{var r,A;const b=await n.load();if(b!=null&&b.data){const p=await H.getProcessingStatus().catch(()=>null);p!=null&&p.isProcessing?(g(!0),N({message:`Processing: ${((r=p.mbProcessed)==null?void 0:r.toFixed(1))||0} MB of ${((A=p.mbTotal)==null?void 0:A.toFixed(1))||0} MB`,detailMessage:p.processingRate?`Speed: ${p.processingRate.toFixed(1)} MB/s`:"",progress:p.percentComplete||p.progress||0,estimatedTime:p.estimatedTime,status:p.status||"processing"}),D()):await n.clear()}},S=async()=>{try{const b=new lt().withUrl("/hubs/downloads").withAutomaticReconnect([0,2e3,5e3,1e4,3e4]).build();b.on("ProcessingProgress",async r=>{console.log("Processing progress received:",r),N(A=>{var p,F;return(A==null?void 0:A.status)==="complete"?A:{message:`Processing: ${((p=r.mbProcessed)==null?void 0:p.toFixed(1))||0} MB of ${((F=r.mbTotal)==null?void 0:F.toFixed(1))||0} MB`,detailMessage:`${r.entriesProcessed||0} entries from ${r.linesProcessed||0} lines`,progress:r.percentComplete||r.progress||0,status:"processing"}}),g(!0),await n.update({lastProgress:r.percentComplete||r.progress||0,mbProcessed:r.mbProcessed,mbTotal:r.mbTotal,entriesProcessed:r.entriesProcessed,linesProcessed:r.linesProcessed})}),b.on("BulkProcessingComplete",async r=>{var A,p,F;console.log("Bulk processing complete:",r),B.current&&clearInterval(B.current),N({message:"Processing Complete!",detailMessage:`Successfully processed ${(A=r.entriesProcessed)==null?void 0:A.toLocaleString()} entries from ${(p=r.linesProcessed)==null?void 0:p.toLocaleString()} lines in ${(F=r.elapsed)==null?void 0:F.toFixed(1)} minutes`,progress:100,status:"complete"}),g(!0),await n.clear(),setTimeout(async()=>{g(!1),N(null),c==null||c()},1e4)}),b.onreconnecting(r=>{console.log("SignalR reconnecting:",r),d(!1)}),b.onreconnected(r=>{console.log("SignalR reconnected:",r),d(!0)}),b.onclose(r=>{console.error("SignalR disconnected:",r),d(!1),i&&(console.log("SignalR disconnected during processing, falling back to polling"),D()),T.current=setTimeout(()=>{S()},5e3)}),await b.start(),k.current=b,d(!0),console.log("SignalR connected")}catch(b){console.error("SignalR connection failed, falling back to polling:",b),d(!1),i&&D()}},D=()=>{B.current&&clearInterval(B.current);const b=async()=>{var r,A,p;try{const F=h;if((F==null?void 0:F.status)==="complete")return;const M=await H.getProcessingStatus();M!=null&&M.isProcessing?(g(!0),N({message:`Processing: ${((r=M.mbProcessed)==null?void 0:r.toFixed(1))||0} MB of ${((A=M.mbTotal)==null?void 0:A.toFixed(1))||0} MB`,detailMessage:M.processingRate?`Speed: ${M.processingRate.toFixed(1)} MB/s`:"",progress:M.percentComplete||M.progress||0,estimatedTime:M.estimatedTime,status:M.status||"processing"}),await n.update({lastProgress:M.percentComplete||M.progress||0,mbProcessed:M.mbProcessed,mbTotal:M.mbTotal})):((M==null?void 0:M.percentComplete)||(M==null?void 0:M.progress)||0)>=100?(B.current&&clearInterval(B.current),N({message:"Processing Complete!",detailMessage:`Processed ${((p=M.mbTotal)==null?void 0:p.toFixed(1))||0} MB`,progress:100,status:"complete"}),g(!0),await n.clear(),setTimeout(()=>{g(!1),N(null),c==null||c()},1e4)):(g(!1),await n.clear(),B.current&&clearInterval(B.current))}catch(F){console.error("Error checking processing status:",F)}};b(),B.current=setInterval(b,3e3)},U=async()=>{if(!o){s==null||s("Authentication required");return}w(!0);try{const b=await H.resetLogPosition();b&&(l==null||l(b.message||"Log position reset successfully"),setTimeout(()=>c==null?void 0:c(),2e3))}catch(b){s==null||s(b.message||"Failed to reset log position")}finally{w(!1)}},W=async()=>{var b;if(!o){s==null||s("Authentication required");return}if(window.confirm("Process entire log file?")){w(!0);try{const r=await H.processAllLogs();if(r){if(r.status==="empty_file"||r.status==="no_log_file"||r.status==="insufficient_data"){s==null||s(r.message),w(!1);return}r.logSizeMB>0?(await n.save({type:"processAll"}),g(!0),N({message:"Preparing to process logs...",detailMessage:`${((b=r.logSizeMB)==null?void 0:b.toFixed(1))||0} MB to process`,progress:0,estimatedTime:`Estimated: ${r.estimatedTimeMinutes} minutes`,status:"starting"}),v||setTimeout(()=>D(),5e3)):(s==null||s("Log file appears to be empty or invalid"),await n.clear())}else await n.clear()}catch(r){await n.clear(),s==null||s(r.message||"Failed to process logs")}finally{w(!1)}}},j=async()=>{if(!o){s==null||s("Authentication required");return}if(window.confirm("Cancel log processing?")){w(!0);try{await H.cancelProcessing(),g(!1),await n.clear(),B.current&&clearInterval(B.current),l==null||l("Processing cancelled"),setTimeout(()=>{N(null),c==null||c()},5e3)}catch{s==null||s("Failed to cancel processing")}finally{w(!1)}}};return e.jsxs(Y,{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(Pe,{className:"w-5 h-5 cache-hit"}),e.jsx("h3",{className:"text-lg font-semibold text-themed-primary",children:"Log Processing"})]}),e.jsx("p",{className:"text-themed-muted text-sm mb-4",children:"Control how access.log is processed for statistics"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(L,{variant:"filled",color:"yellow",leftSection:e.jsx(Me,{className:"w-4 h-4"}),onClick:U,disabled:f||i||u||n.loading||!o,fullWidth:!0,children:"Reset Log Position"}),e.jsx(L,{variant:"filled",color:"green",leftSection:e.jsx(Ee,{className:"w-4 h-4"}),onClick:W,disabled:f||i||u||n.loading||!o,loading:n.loading,fullWidth:!0,children:"Process All Logs"})]}),e.jsx("div",{className:"mt-4 p-3 bg-themed-tertiary rounded-lg",children:e.jsxs("p",{className:"text-xs text-themed-muted",children:[e.jsx("strong",{children:"Reset:"})," Start from current end of log",e.jsx("br",{}),e.jsx("strong",{children:"Process All:"})," Import entire log history"]})}),n.error&&e.jsxs($,{color:"orange",children:["Backend storage error: ",n.error]})]})},ft=({isAuthenticated:o})=>{const[u,s]=m.useState([]),[l,c]=m.useState("dark-default"),[a,i]=m.useState(!1),[g,h]=m.useState(!1),[N,f]=m.useState(null),[w,v]=m.useState(null),[d,n]=m.useState(null),[k,B]=m.useState(!1),[T,C]=m.useState(!1),[S,D]=m.useState(null),[U,W]=m.useState(["core","backgrounds","navigation"]),[j,b]=m.useState(null),[r,A]=m.useState({}),[p,F]=m.useState({name:"",description:"",author:"",version:"1.0.0",isDark:!0,primaryColor:"#3b82f6",secondaryColor:"#8b5cf6",accentColor:"#06b6d4",bgPrimary:"#111827",bgSecondary:"#1f2937",bgTertiary:"#374151",bgHover:"#4b5563",textPrimary:"#ffffff",textSecondary:"#d1d5db",textMuted:"#9ca3af",textAccent:"#60a5fa",borderPrimary:"#374151",borderSecondary:"#4b5563",borderFocus:"#3b82f6",navBg:"#1f2937",navBorder:"#374151",navTabActive:"#3b82f6",navTabInactive:"#9ca3af",navTabHover:"#ffffff",navTabActiveBorder:"#3b82f6",navMobileMenuBg:"#1f2937",navMobileItemHover:"#374151",success:"#10b981",successBg:"#064e3b",successText:"#34d399",warning:"#f59e0b",warningBg:"#78350f",warningText:"#fbbf24",error:"#ef4444",errorBg:"#7f1d1d",errorText:"#fca5a5",info:"#3b82f6",infoBg:"#1e3a8a",infoText:"#93c5fd",steamColor:"#1e40af",epicColor:"#7c3aed",originColor:"#ea580c",blizzardColor:"#0891b2",wsusColor:"#16a34a",riotColor:"#dc2626",cardBg:"#1f2937",cardBorder:"#374151",buttonBg:"#3b82f6",buttonHover:"#2563eb",buttonText:"#ffffff",inputBg:"#374151",inputBorder:"#4b5563",inputFocus:"#3b82f6",badgeBg:"#3b82f6",badgeText:"#ffffff",progressBar:"#3b82f6",progressBg:"#374151",iconBgBlue:"#3b82f6",iconBgGreen:"#10b981",iconBgEmerald:"#10b981",iconBgPurple:"#8b5cf6",iconBgIndigo:"#6366f1",iconBgOrange:"#f97316",iconBgYellow:"#eab308",iconBgCyan:"#06b6d4",iconBgRed:"#ef4444",chartColor1:"#3b82f6",chartColor2:"#10b981",chartColor3:"#f59e0b",chartColor4:"#ef4444",chartColor5:"#8b5cf6",chartColor6:"#06b6d4",chartColor7:"#f97316",chartColor8:"#ec4899",chartBorderColor:"#1f2937",chartGridColor:"#374151",chartTextColor:"#9ca3af",chartCacheHitColor:"#10b981",chartCacheMissColor:"#f59e0b",scrollbarTrack:"#374151",scrollbarThumb:"#6B7280",scrollbarHover:"#9CA3AF",customCSS:""}),M=m.useRef(null),ee=[{name:"core",icon:xe,description:"Main theme colors used throughout the interface",colors:[{key:"primaryColor",label:"Primary Color",description:"Main brand color",affects:["Buttons","Links","Active states","Focus rings"]},{key:"secondaryColor",label:"Secondary Color",description:"Complementary accent color",affects:["Secondary buttons","Highlights","Purple text elements"]},{key:"accentColor",label:"Accent Color",description:"Additional accent for special elements",affects:["Special badges","Tooltips","Notifications"]}]},{name:"backgrounds",icon:re,description:"Background colors for different UI layers",colors:[{key:"bgPrimary",label:"Primary Background",description:"Main app background",affects:["Body background","Main container"]},{key:"bgSecondary",label:"Secondary Background",description:"Card and panel backgrounds",affects:["Cards","Panels","Modals"]},{key:"bgTertiary",label:"Tertiary Background",description:"Input and nested element backgrounds",affects:["Input fields","Dropdown menus","Code blocks"]},{key:"bgHover",label:"Hover Background",description:"Background for hover states",affects:["Button hovers","List item hovers","Menu item hovers"]}]},{name:"text",icon:Qe,description:"Text colors for different content hierarchies",colors:[{key:"textPrimary",label:"Primary Text",description:"Main text color",affects:["Headings","Body text","Labels"]},{key:"textSecondary",label:"Secondary Text",description:"Less prominent text",affects:["Descriptions","Subtitles","Help text"]},{key:"textMuted",label:"Muted Text",description:"Disabled or placeholder text",affects:["Placeholders","Disabled labels","Timestamps"]},{key:"textAccent",label:"Accent Text",description:"Highlighted or linked text",affects:["Links","Highlighted values","Active menu items"]}]},{name:"borders",icon:Ze,description:"Border colors for separators and outlines",colors:[{key:"borderPrimary",label:"Primary Border",description:"Main border color",affects:["Card borders","Dividers","Table borders"]},{key:"borderSecondary",label:"Secondary Border",description:"Subtle borders",affects:["Input borders","Section dividers"]},{key:"borderFocus",label:"Focus Border",description:"Border color for focused elements",affects:["Focused inputs","Active tabs","Selected items"]}]},{name:"navigation",icon:re,description:"Colors specifically for navigation elements",colors:[{key:"navBg",label:"Navigation Background",description:"Main navigation background color",affects:["Header navigation","Navigation bar","Menu background"]},{key:"navBorder",label:"Navigation Border",description:"Navigation border and separator color",affects:["Navigation borders","Header border","Menu separators"]},{key:"navTabActive",label:"Active Tab Color",description:"Color for active navigation tabs",affects:["Active tab text","Current page indicator"]},{key:"navTabInactive",label:"Inactive Tab Color",description:"Color for inactive navigation tabs",affects:["Inactive tab text","Unselected menu items"]},{key:"navTabHover",label:"Tab Hover Color",description:"Color when hovering over navigation tabs",affects:["Tab hover text","Menu item hover text"]},{key:"navTabActiveBorder",label:"Active Tab Border",description:"Border color for active navigation tabs",affects:["Active tab underline","Current page border"]},{key:"navMobileMenuBg",label:"Mobile Menu Background",description:"Background for mobile navigation menu",affects:["Mobile menu background","Dropdown menu background"]},{key:"navMobileItemHover",label:"Mobile Item Hover",description:"Hover color for mobile navigation items",affects:["Mobile menu item hover","Dropdown item hover"]}]},{name:"status",icon:_,description:"Colors for status indicators and alerts",colors:[{key:"success",label:"Success",description:"Success state color",affects:["Success buttons","Progress bars","Online status"]},{key:"successBg",label:"Success Background",description:"Background for success elements",affects:["Success alerts","Success badges"]},{key:"successText",label:"Success Text",description:"Text color for success states",affects:["Success messages","Positive values"]},{key:"warning",label:"Warning",description:"Warning state color",affects:["Warning buttons","Caution indicators"]},{key:"warningBg",label:"Warning Background",description:"Background for warning elements",affects:["Warning alerts","Warning badges"]},{key:"warningText",label:"Warning Text",description:"Text color for warning states",affects:["Warning messages","Caution text"]},{key:"error",label:"Error",description:"Error state color",affects:["Error buttons","Delete actions","Offline status"]},{key:"errorBg",label:"Error Background",description:"Background for error elements",affects:["Error alerts","Error badges"]},{key:"errorText",label:"Error Text",description:"Text color for error states",affects:["Error messages","Validation errors"]},{key:"info",label:"Info",description:"Informational state color",affects:["Info buttons","Info indicators"]},{key:"infoBg",label:"Info Background",description:"Background for info elements",affects:["Info alerts","Info badges"]},{key:"infoText",label:"Info Text",description:"Text color for info states",affects:["Info messages","Help content"]}]},{name:"services",icon:Xe,description:"Colors for different gaming services",colors:[{key:"steamColor",label:"Steam",description:"Steam service color",affects:["Steam badges","Steam charts","Steam stats"]},{key:"epicColor",label:"Epic Games",description:"Epic Games service color",affects:["Epic badges","Epic charts","Epic stats"]},{key:"originColor",label:"Origin/EA",description:"Origin/EA service color",affects:["Origin badges","Origin charts","Origin stats"]},{key:"blizzardColor",label:"Blizzard",description:"Blizzard service color",affects:["Blizzard badges","Blizzard charts","Blizzard stats"]},{key:"wsusColor",label:"Windows Update",description:"Windows Update service color",affects:["WSUS badges","WSUS charts","WSUS stats"]},{key:"riotColor",label:"Riot Games",description:"Riot Games service color",affects:["Riot badges","Riot charts","Riot stats"]}]},{name:"components",icon:et,description:"Specific colors for UI components",colors:[{key:"cardBg",label:"Card Background",description:"Background for card components",affects:["Stat cards","Content cards","List items"]},{key:"cardBorder",label:"Card Border",description:"Border for card components",affects:["Card outlines","Panel borders"]},{key:"buttonBg",label:"Button Background",description:"Primary button background",affects:["Primary buttons","CTAs"]},{key:"buttonHover",label:"Button Hover",description:"Button hover state",affects:["Button hover effects"]},{key:"buttonText",label:"Button Text",description:"Button text color",affects:["Button labels"]},{key:"inputBg",label:"Input Background",description:"Form input background",affects:["Text inputs","Selects","Textareas"]},{key:"inputBorder",label:"Input Border",description:"Form input border",affects:["Input outlines"]},{key:"inputFocus",label:"Input Focus",description:"Focused input border",affects:["Active input borders"]},{key:"badgeBg",label:"Badge Background",description:"Badge background color",affects:["Status badges","Tags","Pills"]},{key:"badgeText",label:"Badge Text",description:"Badge text color",affects:["Badge labels"]},{key:"progressBar",label:"Progress Bar",description:"Progress indicator color",affects:["Progress bars","Loading bars"]},{key:"progressBg",label:"Progress Background",description:"Progress bar background",affects:["Progress track"]}]},{name:"icons",icon:tt,description:"Solid background colors for icon containers (no gradients)",colors:[{key:"iconBgBlue",label:"Blue Icon Background",description:"Blue icon container background",affects:["Database icons","Info icons"]},{key:"iconBgGreen",label:"Green Icon Background",description:"Green icon container background",affects:["Success icons","Online status"]},{key:"iconBgEmerald",label:"Emerald Icon Background",description:"Emerald icon container background",affects:["Trending icons","Growth indicators"]},{key:"iconBgPurple",label:"Purple Icon Background",description:"Purple icon container background",affects:["Special features","Premium indicators"]},{key:"iconBgIndigo",label:"Indigo Icon Background",description:"Indigo icon container background",affects:["Server icons","System indicators"]},{key:"iconBgOrange",label:"Orange Icon Background",description:"Orange icon container background",affects:["Download icons","Activity indicators"]},{key:"iconBgYellow",label:"Yellow Icon Background",description:"Yellow icon container background",affects:["Warning icons","Client indicators"]},{key:"iconBgCyan",label:"Cyan Icon Background",description:"Cyan icon container background",affects:["Activity icons","Performance indicators"]},{key:"iconBgRed",label:"Red Icon Background",description:"Red icon container background",affects:["Error icons","Critical indicators"]}]},{name:"scrollbar",icon:re,description:"Scrollbar appearance customization",colors:[{key:"scrollbarTrack",label:"Scrollbar Track",description:"Background track for scrollbars",affects:["All scrollbar tracks","Scrollbar corners"]},{key:"scrollbarThumb",label:"Scrollbar Thumb",description:"Scrollbar draggable thumb",affects:["Scrollbar handle","Firefox scrollbar color"]},{key:"scrollbarHover",label:"Scrollbar Hover",description:"Scrollbar thumb on hover",affects:["Hover state of scrollbar thumb"]}]},{name:"charts",icon:at,description:"Colors for data visualization and charts",colors:[{key:"chartColor1",label:"Chart Color 1",description:"Primary chart data color",affects:["First data series","Primary pie/donut slice"]},{key:"chartColor2",label:"Chart Color 2",description:"Secondary chart data color",affects:["Second data series","Secondary pie/donut slice"]},{key:"chartColor3",label:"Chart Color 3",description:"Tertiary chart data color",affects:["Third data series","Third pie/donut slice"]},{key:"chartColor4",label:"Chart Color 4",description:"Quaternary chart data color",affects:["Fourth data series","Fourth pie/donut slice"]},{key:"chartColor5",label:"Chart Color 5",description:"Fifth chart data color",affects:["Fifth data series","Fifth pie/donut slice"]},{key:"chartColor6",label:"Chart Color 6",description:"Sixth chart data color",affects:["Sixth data series","Sixth pie/donut slice"]},{key:"chartColor7",label:"Chart Color 7",description:"Seventh chart data color",affects:["Seventh data series","Seventh pie/donut slice"]},{key:"chartColor8",label:"Chart Color 8",description:"Eighth chart data color",affects:["Eighth data series","Eighth pie/donut slice"]},{key:"chartBorderColor",label:"Chart Border Color",description:"Border color between chart segments",affects:["Donut/pie borders","Bar borders"]},{key:"chartGridColor",label:"Chart Grid Color",description:"Grid lines and axes color",affects:["Grid lines","Axes","Tick marks"]},{key:"chartTextColor",label:"Chart Text Color",description:"Chart labels and legend text",affects:["Axis labels","Legend text","Data labels"]},{key:"chartCacheHitColor",label:"Cache Hit Color",description:"Color for cache hit data in charts",affects:["Cache hit ratio chart","Hit indicators"]},{key:"chartCacheMissColor",label:"Cache Miss Color",description:"Color for cache miss data in charts",affects:["Cache miss ratio chart","Miss indicators"]}]}];m.useEffect(()=>{G();const t=R.getCurrentThemeId();c(t)},[]);const G=async()=>{i(!0);try{const t=await R.loadThemes();s(t)}catch(t){console.error("Failed to load themes:",t),f("Failed to load themes")}finally{i(!1)}},q=async t=>{try{if(!t){R.clearTheme(),c(""),n(null);return}const x=await R.getTheme(t);x&&(R.applyTheme(x),c(t),n(null))}catch(x){console.error("Failed to apply theme:",x),f("Failed to apply theme")}},Ie=async t=>{if(d===t)q(l),n(null);else try{const x=await R.getTheme(t);x&&(R.applyTheme(x),n(t))}catch(x){console.error("Failed to preview theme:",x)}},ie=t=>{W(x=>x.includes(t)?x.filter(I=>I!==t):[...x,t])},de=(t,x)=>{F(I=>({...I,[t]:x}))},me=(t,x)=>{A(I=>({...I,[t]:x}))},ue=t=>{navigator.clipboard.writeText(t),b(t),setTimeout(()=>b(null),2e3)},te=t=>{t.preventDefault(),t.stopPropagation(),t.type==="dragenter"||t.type==="dragover"?h(!0):t.type==="dragleave"&&h(!1)},Fe=async t=>{t.preventDefault(),t.stopPropagation(),h(!1),t.dataTransfer.files&&t.dataTransfer.files[0]&&await fe(t.dataTransfer.files[0])},fe=async t=>{if(f(null),v(null),!t.name.endsWith(".toml")){f("Only TOML theme files are supported");return}if(t.size>1024*1024){f("Theme file too large (max 1MB)");return}i(!0);try{const x=await R.uploadTheme(t);v(`Theme "${x.meta.name}" uploaded successfully`),await G(),setTimeout(()=>v(null),5e3)}catch(x){f(x.message)}finally{i(!1)}},Le=async(t,x)=>{var y;if(["dark-default","light-default"].includes(t)){f("System themes cannot be deleted"),setTimeout(()=>f(null),5e3);return}if(!o){f("Authentication required to delete custom themes"),setTimeout(()=>f(null),5e3);return}if(window.confirm(`Delete theme "${x}"? This cannot be undone.`)){i(!0);try{const P=await fetch(`${Ne}/theme/${t}`,{method:"DELETE",headers:O.getAuthHeaders()}),z=await P.json();if(P.ok&&z.success){await G(),l===t&&q("dark-default");const V=((y=z.filesDeleted)==null?void 0:y.join(", "))||"theme files";v(`Theme "${x}" deleted successfully (removed: ${V})`),setTimeout(()=>v(null),5e3)}else if(P.status===404)f(`Theme "${x}" not found on server. ${z.details||""}`),s(V=>V.filter(ae=>ae.meta.id!==t)),l===t&&q("dark-default"),z.availableThemes&&console.log("Available themes on server:",z.availableThemes),setTimeout(()=>f(null),1e4);else{const V=z.error||z.message||"Failed to delete theme",ae=z.details?` Details: ${z.details}`:"";f(`${V}${ae}`),setTimeout(()=>f(null),7e3)}}catch(P){console.error("Delete request failed:",P),f(`Failed to delete theme: ${P.message||"Network error"}`),setTimeout(()=>f(null),7e3)}finally{i(!1)}}},$e=async()=>{if(!o){f("Authentication required to clean up themes"),setTimeout(()=>f(null),5e3);return}if(window.confirm("This will DELETE all custom themes (keeping only system themes). This cannot be undone. Continue?")){i(!0);try{const t=await fetch(`${Ne}/theme/cleanup`,{method:"POST",headers:{"Content-Type":"application/json",...O.getAuthHeaders()}});if(!t.ok)throw new Error("Failed to cleanup themes");const x=await t.json();await G(),u.map(y=>y.meta.id).includes(l)||q("dark-default"),v(x.message||"All custom themes have been deleted"),setTimeout(()=>v(null),5e3)}catch(t){f("Failed to cleanup themes: "+t.message),setTimeout(()=>f(null),5e3)}finally{i(!1)}}},Re=t=>{var x;if(!o){f("Authentication required to edit themes"),setTimeout(()=>f(null),5e3);return}if(K(t.meta.id)){f("System themes cannot be edited"),setTimeout(()=>f(null),5e3);return}D(t),A({name:t.meta.name,description:t.meta.description||"",author:t.meta.author||"",version:t.meta.version||"1.0.0",isDark:t.meta.isDark!==!1,...t.colors,customCSS:((x=t.css)==null?void 0:x.content)||""}),C(!0)},De=async()=>{if(!o||!S)return;if(!r.name.trim()){f("Theme name is required"),setTimeout(()=>f(null),5e3);return}const t={meta:{id:S.meta.id,name:r.name,description:r.description,author:r.author,version:r.version,isDark:r.isDark},colors:{...r},css:r.customCSS?{content:r.customCSS}:void 0};delete t.colors.name,delete t.colors.description,delete t.colors.author,delete t.colors.version,delete t.colors.isDark,delete t.colors.customCSS;const x=R.exportTheme(t),I=new Blob([x],{type:"text/plain"}),y=new File([I],`${t.meta.id}.toml`,{type:"text/plain"});i(!0);try{await R.uploadTheme(y),await G(),l===S.meta.id&&R.applyTheme(t),C(!1),D(null),A({}),v(`Theme "${t.meta.name}" updated successfully`),setTimeout(()=>v(null),5e3)}catch(P){f(P.message||"Failed to update theme")}finally{i(!1)}},He=async()=>{if(!o){f("Authentication required to create themes");return}if(!p.name.trim()){f("Theme name is required"),setTimeout(()=>f(null),5e3);return}const t={meta:{id:p.name.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""),name:p.name,description:p.description,author:p.author,version:p.version,isDark:p.isDark},colors:{...p},css:p.customCSS?{content:p.customCSS}:void 0};delete t.colors.name,delete t.colors.description,delete t.colors.author,delete t.colors.version,delete t.colors.isDark,delete t.colors.customCSS;const x=R.exportTheme(t),I=new Blob([x],{type:"text/plain"}),y=new File([I],`${t.meta.id}.toml`,{type:"text/plain"});i(!0);try{await R.uploadTheme(y),await G(),R.applyTheme(t),c(t.meta.id),B(!1),F({name:"",description:"",author:"",version:"1.0.0",isDark:!0,primaryColor:"#3b82f6",secondaryColor:"#8b5cf6",accentColor:"#06b6d4",bgPrimary:"#111827",bgSecondary:"#1f2937",bgTertiary:"#374151",bgHover:"#4b5563",textPrimary:"#ffffff",textSecondary:"#d1d5db",textMuted:"#9ca3af",textAccent:"#60a5fa",borderPrimary:"#374151",borderSecondary:"#4b5563",borderFocus:"#3b82f6",navBg:"#1f2937",navBorder:"#374151",navTabActive:"#3b82f6",navTabInactive:"#9ca3af",navTabHover:"#ffffff",navTabActiveBorder:"#3b82f6",navMobileMenuBg:"#1f2937",navMobileItemHover:"#374151",success:"#10b981",successBg:"#064e3b",successText:"#34d399",warning:"#f59e0b",warningBg:"#78350f",warningText:"#fbbf24",error:"#ef4444",errorBg:"#7f1d1d",errorText:"#fca5a5",info:"#3b82f6",infoBg:"#1e3a8a",infoText:"#93c5fd",steamColor:"#1e40af",epicColor:"#7c3aed",originColor:"#ea580c",blizzardColor:"#0891b2",wsusColor:"#16a34a",riotColor:"#dc2626",cardBg:"#1f2937",cardBorder:"#374151",buttonBg:"#3b82f6",buttonHover:"#2563eb",buttonText:"#ffffff",inputBg:"#374151",inputBorder:"#4b5563",inputFocus:"#3b82f6",badgeBg:"#3b82f6",badgeText:"#ffffff",progressBar:"#3b82f6",progressBg:"#374151",iconBgBlue:"#3b82f6",iconBgGreen:"#10b981",iconBgEmerald:"#10b981",iconBgPurple:"#8b5cf6",iconBgIndigo:"#6366f1",iconBgOrange:"#f97316",iconBgYellow:"#eab308",iconBgCyan:"#06b6d4",iconBgRed:"#ef4444",chartColor1:"#3b82f6",chartColor2:"#10b981",chartColor3:"#f59e0b",chartColor4:"#ef4444",chartColor5:"#8b5cf6",chartColor6:"#06b6d4",chartColor7:"#f97316",chartColor8:"#ec4899",chartBorderColor:"#1f2937",chartGridColor:"#374151",chartTextColor:"#9ca3af",chartCacheHitColor:"#10b981",chartCacheMissColor:"#f59e0b",scrollbarTrack:"#374151",scrollbarThumb:"#6B7280",scrollbarHover:"#9CA3AF",customCSS:""}),v(`Theme "${t.meta.name}" created successfully`),setTimeout(()=>v(null),5e3)}catch(P){f(P.message||"Failed to create theme")}finally{i(!1)}},he=t=>{F(t==="dark"?x=>({...x,isDark:!0,bgPrimary:"#111827",bgSecondary:"#1f2937",bgTertiary:"#374151",bgHover:"#4b5563",textPrimary:"#ffffff",textSecondary:"#d1d5db",textMuted:"#9ca3af",borderPrimary:"#374151",borderSecondary:"#4b5563",navBg:"#1f2937",navBorder:"#374151",navTabActive:"#3b82f6",navTabInactive:"#9ca3af",navTabHover:"#ffffff",navTabActiveBorder:"#3b82f6",navMobileMenuBg:"#1f2937",navMobileItemHover:"#374151",cardBg:"#1f2937",cardBorder:"#374151",inputBg:"#374151",inputBorder:"#4b5563",progressBg:"#374151",successBg:"#064e3b",successText:"#34d399",warningBg:"#78350f",warningText:"#fbbf24",errorBg:"#7f1d1d",errorText:"#fca5a5",infoBg:"#1e3a8a",infoText:"#93c5fd",chartBorderColor:"#1f2937",chartGridColor:"#374151",chartTextColor:"#9ca3af",scrollbarTrack:"#374151",scrollbarThumb:"#6B7280",scrollbarHover:"#9CA3AF"}):x=>({...x,isDark:!1,bgPrimary:"#ffffff",bgSecondary:"#f9fafb",bgTertiary:"#f3f4f6",bgHover:"#e5e7eb",textPrimary:"#111827",textSecondary:"#374151",textMuted:"#6b7280",borderPrimary:"#e5e7eb",borderSecondary:"#d1d5db",navBg:"#f9fafb",navBorder:"#e5e7eb",navTabActive:"#3b82f6",navTabInactive:"#6b7280",navTabHover:"#111827",navTabActiveBorder:"#3b82f6",navMobileMenuBg:"#f9fafb",navMobileItemHover:"#e5e7eb",cardBg:"#ffffff",cardBorder:"#e5e7eb",inputBg:"#ffffff",inputBorder:"#d1d5db",progressBg:"#e5e7eb",successBg:"#d1fae5",successText:"#065f46",warningBg:"#fef3c7",warningText:"#92400e",errorBg:"#fee2e2",errorText:"#991b1b",infoBg:"#dbeafe",infoText:"#1e40af",chartBorderColor:"#e5e7eb",chartGridColor:"#d1d5db",chartTextColor:"#6b7280",scrollbarTrack:"#f3f4f6",scrollbarThumb:"#9ca3af",scrollbarHover:"#6b7280"}))},ze=t=>{const x=R.exportTheme(t),I=new Blob([x],{type:"text/plain"}),y=URL.createObjectURL(I),P=document.createElement("a");P.href=y,P.download=`${t.meta.id}.toml`,P.click(),URL.revokeObjectURL(y)},Oe=()=>{const t=`# Sample Theme for LANCache Manager
[meta]
name = "My Custom Theme"
id = "my-custom-theme"
description = "A beautiful custom theme"
author = "Your Name"
version = "1.0.0"
isDark = true

[colors]
# Core colors
primaryColor = "#3b82f6"
secondaryColor = "#8b5cf6"
accentColor = "#06b6d4"

# Backgrounds
bgPrimary = "#111827"
bgSecondary = "#1f2937"
bgTertiary = "#374151"
bgHover = "#4b5563"

# Text
textPrimary = "#ffffff"
textSecondary = "#d1d5db"
textMuted = "#9ca3af"
textAccent = "#60a5fa"

# Borders
borderPrimary = "#374151"
borderSecondary = "#4b5563"
borderFocus = "#3b82f6"

# Navigation colors
navBg = "#1f2937"
navBorder = "#374151"
navTabActive = "#3b82f6"
navTabInactive = "#9ca3af"
navTabHover = "#ffffff"
navTabActiveBorder = "#3b82f6"
navMobileMenuBg = "#1f2937"
navMobileItemHover = "#374151"

# Hit Rate & Status Badge colors
hitRateHighBg = "#064e3b"
hitRateHighText = "#34d399"
hitRateMediumBg = "#1e3a8a"
hitRateMediumText = "#93c5fd"
hitRateLowBg = "#ea580c"
hitRateLowText = "#fb923c"
statusWarningBg = "#78350f"
statusWarningText = "#fbbf24"

# Action Button colors
actionResetBg = "#f59e0b"
actionResetHover = "#d97706"
actionProcessBg = "#10b981"
actionProcessHover = "#059669"
actionDeleteBg = "#ef4444"
actionDeleteHover = "#dc2626"

# Status colors
success = "#10b981"
successBg = "#064e3b"
successText = "#34d399"
warning = "#f59e0b"
warningBg = "#78350f"
warningText = "#fbbf24"
error = "#ef4444"
errorBg = "#7f1d1d"
errorText = "#fca5a5"
info = "#3b82f6"
infoBg = "#1e3a8a"
infoText = "#93c5fd"

# Service colors
steamColor = "#1e40af"
epicColor = "#7c3aed"
originColor = "#ea580c"
blizzardColor = "#0891b2"
wsusColor = "#16a34a"
riotColor = "#dc2626"

# Components
cardBg = "#1f2937"
cardBorder = "#374151"
buttonBg = "#3b82f6"
buttonHover = "#2563eb"
buttonText = "#ffffff"
inputBg = "#374151"
inputBorder = "#4b5563"
inputFocus = "#3b82f6"
badgeBg = "#3b82f6"
badgeText = "#ffffff"
progressBar = "#3b82f6"
progressBg = "#374151"

# Icon backgrounds (solid colors, no gradients)
iconBgBlue = "#3b82f6"
iconBgGreen = "#10b981"
iconBgEmerald = "#10b981"
iconBgPurple = "#8b5cf6"
iconBgIndigo = "#6366f1"
iconBgOrange = "#f97316"
iconBgYellow = "#eab308"
iconBgCyan = "#06b6d4"
iconBgRed = "#ef4444"

# Chart colors
chartColor1 = "#3b82f6"
chartColor2 = "#10b981"
chartColor3 = "#f59e0b"
chartColor4 = "#ef4444"
chartColor5 = "#8b5cf6"
chartColor6 = "#06b6d4"
chartColor7 = "#f97316"
chartColor8 = "#ec4899"
chartBorderColor = "#1f2937"
chartGridColor = "#374151"
chartTextColor = "#9ca3af"
chartCacheHitColor = "#10b981"
chartCacheMissColor = "#f59e0b"

[css]
content = """
/* Add any custom CSS here */
"""`,x=new Blob([t],{type:"text/plain"}),I=URL.createObjectURL(x),y=document.createElement("a");y.href=I,y.download="sample-theme.toml",y.click(),URL.revokeObjectURL(I)},K=t=>["dark-default","light-default"].includes(t);return e.jsxs(e.Fragment,{children:[e.jsxs(Y,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(xe,{className:"w-5 h-5 text-themed-accent"}),e.jsx("h3",{className:"text-lg font-semibold text-themed-primary",children:"Theme Management"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[o?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>B(!0),className:"p-2 rounded-lg transition-colors",style:{color:"var(--theme-text-muted)",backgroundColor:"transparent"},onMouseEnter:t=>t.currentTarget.style.backgroundColor="var(--theme-bg-hover)",onMouseLeave:t=>t.currentTarget.style.backgroundColor="transparent",title:"Create new theme",children:e.jsx(Ye,{className:"w-4 h-4"})}),e.jsx("button",{onClick:$e,disabled:a,className:"p-2 rounded-lg transition-colors",style:{color:"var(--theme-text-muted)",backgroundColor:"transparent"},onMouseEnter:t=>t.currentTarget.style.backgroundColor="var(--theme-bg-hover)",onMouseLeave:t=>t.currentTarget.style.backgroundColor="transparent",title:"Delete all custom themes",children:e.jsx(Ke,{className:"w-4 h-4"})})]}):e.jsx("button",{disabled:!0,className:"p-2 rounded-lg transition-colors opacity-50 cursor-not-allowed",style:{color:"var(--theme-text-muted)",backgroundColor:"transparent"},title:"Authentication required to create themes",children:e.jsx(le,{className:"w-4 h-4"})}),e.jsx("button",{onClick:G,disabled:a,className:"p-2 rounded-lg transition-colors",style:{color:"var(--theme-text-muted)",backgroundColor:"transparent"},onMouseEnter:t=>t.currentTarget.style.backgroundColor="var(--theme-bg-hover)",onMouseLeave:t=>t.currentTarget.style.backgroundColor="transparent",title:"Refresh themes",children:e.jsx(Me,{className:`w-4 h-4 ${a?"animate-spin":""}`})})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-themed-secondary",children:"Active Theme"}),e.jsx("select",{value:d||l,onChange:t=>q(t.target.value),className:"w-full px-3 py-2 focus:outline-none themed-input",disabled:a,children:u.map(t=>e.jsxs("option",{value:t.meta.id,children:[t.meta.name," ",t.meta.author&&t.meta.author!=="System"&&`by ${t.meta.author}`,K(t.meta.id)&&" (System)",d===t.meta.id&&" (Preview)"]},t.meta.id))}),d&&e.jsx("p",{className:"text-xs mt-2",style:{color:"var(--theme-warning)"},children:"Preview mode active. Select a theme to apply it permanently."})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("h4",{className:"text-sm font-medium mb-3 text-themed-secondary",children:["Installed Themes (",u.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:u.map(t=>e.jsxs("div",{className:"rounded p-3 flex items-center justify-between border-2 transition-colors themed-card",style:{borderColor:l===t.meta.id&&!d?"var(--theme-primary)":d===t.meta.id?"var(--theme-warning)":"transparent"},children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-themed-primary",children:t.meta.name}),t.meta.isDark?e.jsx(pe,{className:"w-3 h-3 text-themed-muted"}):e.jsx(be,{className:"w-3 h-3",style:{color:"var(--theme-warning)"}}),l===t.meta.id&&!d&&e.jsx("span",{className:"px-2 py-0.5 text-xs rounded themed-button-primary",children:"Active"}),d===t.meta.id&&e.jsx("span",{className:"px-2 py-0.5 text-xs rounded",style:{backgroundColor:"var(--theme-warning)",color:"var(--theme-bg-primary)"},children:"Preview"}),K(t.meta.id)&&e.jsx("span",{className:"px-2 py-0.5 text-xs rounded",style:{backgroundColor:"var(--theme-bg-hover)",color:"var(--theme-text-muted)"},children:"System"})]}),t.meta.description&&e.jsx("p",{className:"text-xs mt-1 text-themed-muted",children:t.meta.description}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[t.meta.author&&e.jsxs("p",{className:"text-xs text-themed-muted",children:["by ",t.meta.author]}),t.meta.version&&e.jsxs("p",{className:"text-xs text-themed-muted",children:["v",t.meta.version]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>ze(t),className:"p-2 transition-colors text-themed-muted",title:"Export theme",children:e.jsx(ye,{className:"w-4 h-4"})}),l!==t.meta.id&&e.jsx("button",{onClick:()=>Ie(t.meta.id),className:"p-2 transition-colors",style:{color:d===t.meta.id?"var(--theme-warning)":"var(--theme-text-muted)"},title:d===t.meta.id?"Stop preview":"Preview theme",children:d===t.meta.id?e.jsx(Ve,{className:"w-4 h-4"}):e.jsx(Ae,{className:"w-4 h-4"})}),l!==t.meta.id&&e.jsx("button",{onClick:()=>q(t.meta.id),className:"p-2 transition-colors text-themed-accent",title:"Apply theme",children:e.jsx(se,{className:"w-4 h-4"})}),!K(t.meta.id)&&o&&e.jsx("button",{onClick:()=>Re(t),disabled:a,className:"p-2 transition-colors",style:{color:"var(--theme-text-secondary)"},title:"Edit theme",children:e.jsx(Je,{className:"w-4 h-4"})}),!K(t.meta.id)&&o&&e.jsx("button",{onClick:()=>Le(t.meta.id,t.meta.name),disabled:a,className:"p-2 transition-colors disabled:opacity-50",style:{color:"var(--theme-error)"},title:"Delete theme",children:e.jsx(Be,{className:"w-4 h-4"})})]})]},t.meta.id))})]}),o&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-sm font-medium mb-3 text-themed-secondary",children:"Upload Custom Theme"}),e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${g?"border-purple-500 bg-purple-900 bg-opacity-20":""}`,style:{borderColor:g?"var(--theme-secondary)":"var(--theme-border-secondary)"},onDragEnter:te,onDragLeave:te,onDragOver:te,onDrop:Fe,children:[e.jsx(_e,{className:"w-12 h-12 mx-auto mb-3 text-themed-muted"}),e.jsx("p",{className:"mb-2 text-themed-secondary",children:"Drag and drop a theme file here, or click to browse"}),e.jsx("p",{className:"text-xs mb-3 text-themed-muted",children:"TOML format, max 1MB"}),e.jsx("input",{ref:M,type:"file",accept:".toml",onChange:t=>{var x;return((x=t.target.files)==null?void 0:x[0])&&fe(t.target.files[0])},className:"hidden"}),e.jsx(L,{variant:"filled",color:"purple",onClick:()=>{var t;return(t=M.current)==null?void 0:t.click()},disabled:a,loading:a,children:"Browse Files"})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(L,{variant:"subtle",leftSection:e.jsx(ye,{className:"w-4 h-4"}),onClick:Oe,children:"Download Sample TOML Theme"})})]}),!o&&e.jsx($,{color:"yellow",children:"Authentication required to create, upload, or delete custom themes"}),N&&e.jsx($,{color:"red",withCloseButton:!0,onClose:()=>f(null),children:N}),w&&e.jsx($,{color:"green",withCloseButton:!0,onClose:()=>v(null),children:w})]}),e.jsx(X,{opened:k,onClose:()=>B(!1),title:"Create Custom Theme",size:"xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-sm font-semibold flex items-center gap-2 text-themed-primary",children:[e.jsx(ve,{className:"w-4 h-4"}),"Theme Information"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Theme Name *"}),e.jsx("input",{type:"text",value:p.name,onChange:t=>F({...p,name:t.target.value}),placeholder:"My Custom Theme",className:"w-full px-3 py-2 focus:outline-none themed-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Author"}),e.jsx("input",{type:"text",value:p.author,onChange:t=>F({...p,author:t.target.value}),placeholder:"Your Name",className:"w-full px-3 py-2 focus:outline-none themed-input"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Description"}),e.jsx("input",{type:"text",value:p.description,onChange:t=>F({...p,description:t.target.value}),placeholder:"A beautiful custom theme",className:"w-full px-3 py-2 rounded focus:outline-none themed-input"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:p.isDark,onChange:t=>F({...p,isDark:t.target.checked}),className:"rounded"}),e.jsx("span",{className:"text-sm text-themed-secondary",children:"Dark Theme"})]}),e.jsxs("button",{onClick:()=>he("dark"),className:"px-3 py-1 text-xs rounded-lg flex items-center gap-1",style:{backgroundColor:"var(--theme-bg-tertiary)",color:"var(--theme-text-secondary)"},children:[e.jsx(pe,{className:"w-3 h-3"}),"Load Dark Preset"]}),e.jsxs("button",{onClick:()=>he("light"),className:"px-3 py-1 text-xs rounded-lg flex items-center gap-1",style:{backgroundColor:"var(--theme-bg-tertiary)",color:"var(--theme-text-secondary)"},children:[e.jsx(be,{className:"w-3 h-3"}),"Load Light Preset"]})]})]}),e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:ee.map(t=>{const x=t.icon,I=U.includes(t.name);return e.jsxs("div",{className:"border rounded-lg",style:{borderColor:"var(--theme-border-primary)"},children:[e.jsxs("button",{onClick:()=>ie(t.name),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-opacity-50",style:{backgroundColor:I?"var(--theme-bg-tertiary)":"transparent"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(x,{className:"w-4 h-4 text-themed-accent"}),e.jsxs("div",{className:"text-left",children:[e.jsx("h5",{className:"text-sm font-semibold capitalize text-themed-primary",children:t.name.replace(/([A-Z])/g," $1").trim()}),e.jsx("p",{className:"text-xs text-themed-muted",children:t.description})]})]}),I?e.jsx(Ce,{className:"w-4 h-4"}):e.jsx(je,{className:"w-4 h-4"})]}),I&&e.jsx("div",{className:"p-4 border-t space-y-4",style:{borderColor:"var(--theme-border-primary)"},children:t.colors.map(y=>e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-themed-primary",children:y.label}),e.jsx("p",{className:"text-xs text-themed-muted",children:y.description}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:y.affects.map((P,z)=>e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded",style:{backgroundColor:"var(--theme-bg-hover)",color:"var(--theme-text-secondary)"},children:P},z))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"relative",children:e.jsx("input",{type:"color",value:p[y.key],onChange:P=>de(y.key,P.target.value),className:"w-12 h-8 rounded cursor-pointer",style:{backgroundColor:p[y.key]}})}),e.jsx("input",{type:"text",value:p[y.key],onChange:P=>de(y.key,P.target.value),className:"w-24 px-2 py-1 text-xs rounded font-mono themed-input"}),e.jsx("button",{onClick:()=>ue(p[y.key]),className:"p-1 rounded-lg hover:bg-opacity-50",style:{backgroundColor:"var(--theme-bg-hover)"},title:"Copy color",children:j===p[y.key]?e.jsx(se,{className:"w-3 h-3",style:{color:"var(--theme-success)"}}):e.jsx(we,{className:"w-3 h-3 text-themed-muted"})})]})]})},y.key))})]},t.name)})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Custom CSS (Optional)"}),e.jsx("textarea",{value:p.customCSS,onChange:t=>F({...p,customCSS:t.target.value}),placeholder:"/* Add any custom CSS here */",rows:4,className:"w-full px-3 py-2 rounded font-mono text-xs focus:outline-none themed-input"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",style:{borderColor:"var(--theme-border-primary)"},children:[e.jsx(L,{variant:"default",onClick:()=>B(!1),children:"Cancel"}),e.jsx(L,{variant:"filled",leftSection:e.jsx(ke,{className:"w-4 h-4"}),onClick:He,disabled:!p.name||!o,className:"themed-button-primary",children:"Create Theme"})]})]})}),e.jsx(X,{opened:T,onClose:()=>{C(!1),D(null),A({})},title:`Edit Theme: ${(S==null?void 0:S.meta.name)||""}`,size:"xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-sm font-semibold flex items-center gap-2 text-themed-primary",children:[e.jsx(ve,{className:"w-4 h-4"}),"Theme Information"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Theme Name *"}),e.jsx("input",{type:"text",value:r.name||"",onChange:t=>A({...r,name:t.target.value}),placeholder:"My Custom Theme",className:"w-full px-3 py-2 focus:outline-none themed-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Author"}),e.jsx("input",{type:"text",value:r.author||"",onChange:t=>A({...r,author:t.target.value}),placeholder:"Your Name",className:"w-full px-3 py-2 focus:outline-none themed-input"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Description"}),e.jsx("input",{type:"text",value:r.description||"",onChange:t=>A({...r,description:t.target.value}),placeholder:"A beautiful custom theme",className:"w-full px-3 py-2 rounded focus:outline-none themed-input"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.isDark||!1,onChange:t=>A({...r,isDark:t.target.checked}),className:"rounded"}),e.jsx("span",{className:"text-sm text-themed-secondary",children:"Dark Theme"})]}),e.jsxs("span",{className:"text-xs text-themed-muted",children:["Theme ID: ",S==null?void 0:S.meta.id]})]})]}),e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:ee.map(t=>{const x=t.icon,I=U.includes(t.name);return e.jsxs("div",{className:"border rounded-lg",style:{borderColor:"var(--theme-border-primary)"},children:[e.jsxs("button",{onClick:()=>ie(t.name),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-opacity-50",style:{backgroundColor:I?"var(--theme-bg-tertiary)":"transparent"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(x,{className:"w-4 h-4 text-themed-accent"}),e.jsxs("div",{className:"text-left",children:[e.jsx("h5",{className:"text-sm font-semibold capitalize text-themed-primary",children:t.name.replace(/([A-Z])/g," $1").trim()}),e.jsx("p",{className:"text-xs text-themed-muted",children:t.description})]})]}),I?e.jsx(Ce,{className:"w-4 h-4"}):e.jsx(je,{className:"w-4 h-4"})]}),I&&e.jsx("div",{className:"p-4 border-t space-y-4",style:{borderColor:"var(--theme-border-primary)"},children:t.colors.map(y=>e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-themed-primary",children:y.label}),e.jsx("p",{className:"text-xs text-themed-muted",children:y.description}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:y.affects.map((P,z)=>e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded",style:{backgroundColor:"var(--theme-bg-hover)",color:"var(--theme-text-secondary)"},children:P},z))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"relative",children:e.jsx("input",{type:"color",value:r[y.key]||"#000000",onChange:P=>me(y.key,P.target.value),className:"w-12 h-8 rounded cursor-pointer",style:{backgroundColor:r[y.key]||"#000000"}})}),e.jsx("input",{type:"text",value:r[y.key]||"",onChange:P=>me(y.key,P.target.value),className:"w-24 px-2 py-1 text-xs rounded font-mono themed-input"}),e.jsx("button",{onClick:()=>ue(r[y.key]||""),className:"p-1 rounded-lg hover:bg-opacity-50",style:{backgroundColor:"var(--theme-bg-hover)"},title:"Copy color",children:j===r[y.key]?e.jsx(se,{className:"w-3 h-3",style:{color:"var(--theme-success)"}}):e.jsx(we,{className:"w-3 h-3 text-themed-muted"})})]})]})},y.key))})]},t.name)})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Custom CSS (Optional)"}),e.jsx("textarea",{value:r.customCSS||"",onChange:t=>A({...r,customCSS:t.target.value}),placeholder:"/* Add any custom CSS here */",rows:4,className:"w-full px-3 py-2 rounded font-mono text-xs focus:outline-none themed-input"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",style:{borderColor:"var(--theme-border-primary)"},children:[e.jsx(L,{variant:"default",onClick:()=>{C(!1),D(null),A({})},children:"Cancel"}),e.jsx(L,{variant:"filled",leftSection:e.jsx(ke,{className:"w-4 h-4"}),onClick:De,disabled:!r.name||!o||a,className:"themed-button-primary",children:"Save Changes"})]})]})})]})},ht=({alerts:o,onClearError:u,onClearSuccess:s})=>{var l,c;return!o||!((l=o.errors)!=null&&l.length)&&!o.success?null:e.jsxs("div",{className:"space-y-4",children:[(c=o.errors)==null?void 0:c.map(a=>e.jsx($,{color:"red",icon:e.jsx(_,{className:"w-5 h-5"}),withCloseButton:!0,onClose:()=>u(a.id),children:a.message},a.id)),o.success&&e.jsx($,{color:"green",icon:e.jsx(ne,{className:"w-5 h-5"}),withCloseButton:!!s,onClose:s,children:o.success})]})},gt=({mockMode:o,onToggle:u,disabled:s})=>e.jsxs(Y,{children:[e.jsx("h3",{className:"text-lg font-semibold text-themed-primary mb-4",children:"Mock Mode"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-themed-secondary",children:"Enable mock data for demonstration"}),e.jsx("p",{className:"text-sm text-themed-muted mt-1",children:"Simulates realistic cache data and download activity"})]}),e.jsx(L,{onClick:u,disabled:s,variant:"filled",color:"blue",leftSection:o?e.jsx(st,{className:"w-5 h-5"}):e.jsx(rt,{className:"w-5 h-5"}),children:o?"Enabled":"Disabled"})]}),o&&e.jsx("div",{className:"mt-4",children:e.jsx($,{color:"blue",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Mock mode active - API actions disabled"})]})})})]}),xt=({isAuthenticated:o,mockMode:u,onError:s,onSuccess:l,onDataRefresh:c})=>{const[a,i]=m.useState(!1),g=async()=>{if(!o){s==null||s("Authentication required");return}if(window.confirm("Delete all download history?")){i(!0);try{const h=await H.resetDatabase();h&&(l==null||l(h.message||"Database reset successfully"),setTimeout(()=>c==null?void 0:c(),2e3))}catch(h){s==null||s(h.message||"Failed to reset database")}finally{i(!1)}}};return e.jsxs(Y,{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(Te,{className:"w-5 h-5 text-themed-accent"}),e.jsx("h3",{className:"text-lg font-semibold text-themed-primary",children:"Database Management"})]}),e.jsx("p",{className:"text-themed-muted text-sm mb-4",children:"Manage download history and statistics"}),e.jsx(L,{onClick:g,disabled:a||u||!o,loading:a,variant:"filled",color:"red",leftSection:e.jsx(Te,{className:"w-4 h-4"}),fullWidth:!0,children:"Reset Database"}),e.jsx("p",{className:"text-xs text-themed-muted mt-2",children:"Clears all download history (does not affect cached files)"})]})},pt=({isAuthenticated:o,mockMode:u,onError:s,onSuccess:l,onDataRefresh:c,onBackgroundOperation:a})=>{const[i,g]=m.useState({}),[h,N]=m.useState({logPath:"/logs/access.log",services:[]}),[f,w]=m.useState(null),v=ce("activeServiceRemoval","serviceRemoval",30);m.useEffect(()=>{d(),n()},[]),m.useEffect(()=>{a==null||a(f)},[f,a]);const d=async()=>{try{const[T,C]=await Promise.all([H.getConfig(),H.getServiceLogCounts()]);N(T),g(C)}catch(T){console.error("Failed to load config:",T),N({logPath:"/logs/access.log",services:["steam","epic","origin","blizzard","wsus","riot"]})}},n=async()=>{var C;const T=await v.load();(C=T==null?void 0:T.data)!=null&&C.service&&(w(T.data.service),l==null||l(`Removing ${T.data.service} entries from logs (operation resumed)...`),setTimeout(async()=>{await v.clear(),w(null),d(),c==null||c()},1e4))},k=async T=>{var C;if(!o){s==null||s("Authentication required");return}if(window.confirm(`Remove all ${T} entries?`))try{w(T),await v.save({service:T});const S=await H.removeServiceFromLogs(T);S&&(l==null||l(S.message||`${T} entries removed successfully`)),await v.clear(),setTimeout(()=>{w(null),d(),c==null||c()},2e3)}catch(S){await v.clear(),w(null);const D=(C=S.message)!=null&&C.includes("read-only")?"Logs directory is read-only. Remove :ro from docker-compose volume mount.":S.message||"Action failed";s==null||s(D)}},B=h.services.length>0?h.services:["steam","epic","origin","blizzard","wsus","riot"];return e.jsxs(Y,{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(Pe,{className:"w-5 h-5 text-themed-accent"}),e.jsx("h3",{className:"text-lg font-semibold text-themed-primary",children:"Log File Management"})]}),e.jsxs("p",{className:"text-themed-muted text-sm mb-4",children:["Remove service entries from"," ",e.jsx("code",{className:"bg-themed-tertiary px-2 py-1 rounded",children:h.logPath})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:B.map(T=>{const C=f===T;return e.jsx(L,{onClick:()=>k(T),disabled:u||!!f||v.loading||!o,variant:"default",loading:C||v.loading,className:"flex flex-col items-center",fullWidth:!0,children:!C&&!v.loading?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"capitalize font-medium",children:["Clear ",T]}),i[T]!==void 0&&e.jsxs("span",{className:"text-xs text-themed-muted mt-1",children:["(",i[T].toLocaleString()," entries)"]})]}):e.jsx("span",{className:"capitalize font-medium",children:"Removing..."})},T)})}),e.jsx("div",{className:"mt-4",children:e.jsx($,{color:"yellow",children:e.jsxs("p",{className:"text-xs",children:[e.jsx("strong",{children:"Warning:"})," Requires write permissions to logs directory"]})})})]})},Tt=()=>{const{mockMode:o,setMockMode:u,fetchData:s}=ot(),[l,c]=m.useState(!1),[a,i]=m.useState({errors:[],success:null}),[g,h]=m.useState({}),N=m.useRef(!1),f=m.useCallback(n=>{i(k=>({...k,errors:[...k.errors,{id:Date.now(),message:n}]}))},[]),w=m.useCallback(n=>{i(k=>({...k,success:n})),setTimeout(()=>i(k=>({...k,success:null})),1e4)},[]),v=m.useCallback(n=>{i(k=>({...k,errors:k.errors.filter(B=>B.id!==n)}))},[]),d=m.useCallback(()=>{i(n=>({...n,success:null}))},[]);return m.useEffect(()=>{(async()=>{if(!N.current){const k=await J.migrateFromLocalStorage();k>0&&w(`Migrated ${k} operations from local storage to server`),N.current=!0}})()},[w]),e.jsxs("div",{className:"space-y-6",children:[e.jsx(dt,{onAuthChange:c,onError:f,onSuccess:w}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(ht,{alerts:a,onClearError:v,onClearSuccess:d}),g.cacheClearing&&e.jsx($,{color:"blue",icon:e.jsx(Q,{className:"w-5 h-5 animate-spin"}),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:"Cache clearing in progress..."}),g.cacheClearing.bytesDeleted>0&&e.jsxs("p",{className:"text-sm mt-1 opacity-75",children:[Z(g.cacheClearing.bytesDeleted)," cleared"]}),e.jsxs("p",{className:"text-sm mt-1 opacity-75",children:[(g.cacheClearing.progress||0).toFixed(0),"% complete"]})]}),e.jsx(L,{variant:"filled",color:"blue",size:"sm",leftSection:e.jsx(Ae,{className:"w-4 h-4"}),onClick:g.cacheClearing.showModal,children:"View Details"})]})}),g.logProcessing&&e.jsx($,{color:g.logProcessing.status==="complete"?"green":"yellow",icon:g.logProcessing.status==="complete"?e.jsx(ne,{className:"w-5 h-5"}):e.jsx(Q,{className:"w-5 h-5 animate-spin"}),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:g.logProcessing.message}),g.logProcessing.detailMessage&&e.jsx("p",{className:"text-sm mt-1 opacity-75",children:g.logProcessing.detailMessage}),g.logProcessing.progress>0&&g.logProcessing.status!=="complete"&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"w-full progress-track rounded-full h-2",children:e.jsx("div",{className:"progress-bar-low h-2 rounded-full smooth-transition",style:{width:`${Math.min(g.logProcessing.progress,100)}%`}})}),e.jsxs("p",{className:"text-xs opacity-75 mt-1",children:[g.logProcessing.progress.toFixed(1),"% complete",g.logProcessing.estimatedTime&&` • ${g.logProcessing.estimatedTime} remaining`]})]})]}),g.logProcessing.status!=="complete"&&g.logProcessing.onCancel&&e.jsx(L,{variant:"filled",color:"red",size:"sm",leftSection:e.jsx(Se,{className:"w-4 h-4"}),onClick:g.logProcessing.onCancel,children:"Cancel"})]})}),g.serviceRemoval&&e.jsx($,{color:"orange",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Q,{className:"w-5 h-5 animate-spin"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["Removing ",g.serviceRemoval," entries from logs..."]}),e.jsx("p",{className:"text-sm mt-1",children:"This may take several minutes for large log files"})]})]})})]}),e.jsx(gt,{mockMode:o,onToggle:()=>u(!o),disabled:!1}),e.jsx(xt,{isAuthenticated:l,mockMode:o,onError:f,onSuccess:w,onDataRefresh:s}),e.jsx(mt,{isAuthenticated:l,mockMode:o,onError:f,onSuccess:w,onBackgroundOperation:n=>h(k=>({...k,cacheClearing:n}))}),e.jsx(ut,{isAuthenticated:l,mockMode:o,onError:f,onSuccess:w,onDataRefresh:s,onBackgroundOperation:n=>h(k=>({...k,logProcessing:n}))}),e.jsx(pt,{isAuthenticated:l,mockMode:o,onError:f,onSuccess:w,onDataRefresh:s,onBackgroundOperation:n=>h(k=>({...k,serviceRemoval:n}))}),e.jsx(ft,{isAuthenticated:l})]})};export{Tt as default};
//# sourceMappingURL=ManagementTab-BeDBPPfF.js.map

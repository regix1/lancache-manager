{"version":3,"file":"DownloadsTab-DwUoH0Ng.js","sources":["../../src/components/common/VirtualizedList.tsx","../../src/components/downloads/DownloadsTab.tsx"],"sourcesContent":["import React, { useRef } from 'react';\r\nimport { useVirtualizer } from '@tanstack/react-virtual';\r\n\r\ninterface VirtualizedListProps<T> {\r\n  items: T[];\r\n  height: number;\r\n  itemHeight: number;\r\n  renderItem: (item: T, index: number) => React.ReactNode;\r\n  overscan?: number;\r\n  className?: string;\r\n}\r\n\r\nfunction VirtualizedList<T>({\r\n  items,\r\n  height,\r\n  itemHeight,\r\n  renderItem,\r\n  overscan = 5,\r\n  className = ''\r\n}: VirtualizedListProps<T>) {\r\n  const parentRef = useRef<HTMLDivElement>(null);\r\n\r\n  const virtualizer = useVirtualizer({\r\n    count: items.length,\r\n    getScrollElement: () => parentRef.current,\r\n    estimateSize: () => itemHeight,\r\n    overscan\r\n  });\r\n\r\n  return (\r\n    <div ref={parentRef} className={`overflow-auto ${className}`} style={{ height: `${height}px` }}>\r\n      <div\r\n        style={{\r\n          height: `${virtualizer.getTotalSize()}px`,\r\n          width: '100%',\r\n          position: 'relative'\r\n        }}\r\n      >\r\n        {virtualizer.getVirtualItems().map((virtualItem) => (\r\n          <div\r\n            key={virtualItem.key}\r\n            style={{\r\n              position: 'absolute',\r\n              top: 0,\r\n              left: 0,\r\n              width: '100%',\r\n              height: `${virtualItem.size}px`,\r\n              transform: `translateY(${virtualItem.start}px)`\r\n            }}\r\n          >\r\n            {renderItem(items[virtualItem.index], virtualItem.index)}\r\n          </div>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default VirtualizedList;\r\n","import React, { useState, useEffect, useMemo, useCallback, useRef } from 'react';\r\nimport {\r\n  ChevronRight,\r\n  ChevronDown,\r\n  Gamepad2,\r\n  ExternalLink,\r\n  Database,\r\n  CloudOff,\r\n  Check,\r\n  AlertTriangle,\r\n  Layers,\r\n  Users,\r\n  Settings,\r\n  Download as DownloadIcon,\r\n  Loader\r\n} from 'lucide-react';\r\nimport { useData } from '../../contexts/DataContext';\r\nimport { formatBytes, formatPercent } from '../../utils/formatters';\r\nimport VirtualizedList from '../common/VirtualizedList';\r\nimport { Alert } from '../ui/Alert';\r\nimport { Card } from '../ui/Card';\r\nimport type {\r\n  Download,\r\n  GameInfo,\r\n  DownloadGroup,\r\n  DownloadSettings\r\n} from '../../types';\r\n\r\n// Storage keys for persistence\r\nconst STORAGE_KEYS = {\r\n  SERVICE_FILTER: 'lancache_downloads_service',\r\n  ITEMS_PER_PAGE: 'lancache_downloads_items',\r\n  GROUP_GAMES: 'lancache_downloads_group',\r\n  SHOW_METADATA: 'lancache_downloads_metadata',\r\n  SHOW_SMALL_FILES: 'lancache_downloads_show_small'\r\n};\r\n\r\n// Enhanced Image component with built-in fallback\r\ninterface ImageWithFallbackProps {\r\n  src: string;\r\n  fallback?: React.ReactNode;\r\n  alt: string;\r\n  className?: string;\r\n  style?: React.CSSProperties;\r\n  onLoad?: () => void;\r\n  onError?: () => void;\r\n}\r\n\r\nconst ImageWithFallback: React.FC<ImageWithFallbackProps> = ({\r\n  src,\r\n  fallback,\r\n  alt,\r\n  className = '',\r\n  style = {},\r\n  onLoad,\r\n  onError\r\n}) => {\r\n  const [hasError, setHasError] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    // Reset states when src changes\r\n    setHasError(false);\r\n    setIsLoading(true);\r\n  }, [src]);\r\n\r\n  const handleLoad = () => {\r\n    setIsLoading(false);\r\n    onLoad?.();\r\n  };\r\n\r\n  const handleError = () => {\r\n    setHasError(true);\r\n    setIsLoading(false);\r\n    onError?.();\r\n  };\r\n\r\n  if (!src || hasError) {\r\n    return (\r\n      <>\r\n        {fallback || (\r\n          <div \r\n            className={`${className} flex items-center justify-center`}\r\n            style={{\r\n              ...style,\r\n              backgroundColor: 'var(--theme-bg-tertiary)',\r\n              border: '1px solid var(--theme-border-primary)'\r\n            }}\r\n          >\r\n            <Gamepad2 \r\n              className=\"w-12 h-12\"\r\n              style={{ color: 'var(--theme-text-muted)' }}\r\n            />\r\n          </div>\r\n        )}\r\n      </>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"relative\">\r\n      {isLoading && (\r\n        <div \r\n          className={`${className} flex items-center justify-center absolute inset-0`}\r\n          style={{\r\n            ...style,\r\n            backgroundColor: 'var(--theme-bg-tertiary)'\r\n          }}\r\n        >\r\n          <Loader className=\"w-6 h-6 animate-spin\" />\r\n        </div>\r\n      )}\r\n      <img\r\n        src={src}\r\n        alt={alt}\r\n        className={className}\r\n        style={{\r\n          ...style,\r\n          opacity: isLoading ? 0 : 1,\r\n          transition: 'opacity 0.3s'\r\n        }}\r\n        onLoad={handleLoad}\r\n        onError={handleError}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\n// Enhanced Dropdown with Portal rendering\r\ninterface DropdownOption {\r\n  value: string;\r\n  label: string;\r\n}\r\n\r\ninterface EnhancedDropdownProps {\r\n  options: DropdownOption[];\r\n  value: string;\r\n  onChange: (value: string) => void;\r\n  placeholder?: string;\r\n  className?: string;\r\n}\r\n\r\nconst EnhancedDropdown: React.FC<EnhancedDropdownProps> = ({\r\n  options,\r\n  value,\r\n  onChange,\r\n  placeholder = 'Select option',\r\n  className = ''\r\n}) => {\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const dropdownRef = useRef<HTMLDivElement>(null);\r\n  const buttonRef = useRef<HTMLButtonElement>(null);\r\n  \r\n  const selectedOption = options.find((opt) => opt.value === value);\r\n\r\n  // Close dropdown when clicking outside\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      if (\r\n        dropdownRef.current && \r\n        !dropdownRef.current.contains(event.target as Node) &&\r\n        buttonRef.current &&\r\n        !buttonRef.current.contains(event.target as Node)\r\n      ) {\r\n        setIsOpen(false);\r\n      }\r\n    };\r\n\r\n    const handleEscape = (event: KeyboardEvent) => {\r\n      if (event.key === 'Escape') {\r\n        setIsOpen(false);\r\n      }\r\n    };\r\n\r\n    if (isOpen) {\r\n      document.addEventListener('mousedown', handleClickOutside);\r\n      document.addEventListener('keydown', handleEscape);\r\n      return () => {\r\n        document.removeEventListener('mousedown', handleClickOutside);\r\n        document.removeEventListener('keydown', handleEscape);\r\n      };\r\n    }\r\n  }, [isOpen]);\r\n\r\n  const handleSelect = (optionValue: string) => {\r\n    onChange(optionValue);\r\n    setIsOpen(false);\r\n  };\r\n\r\n  const handleKeyDown = (event: React.KeyboardEvent) => {\r\n    if (event.key === 'Enter' || event.key === ' ') {\r\n      event.preventDefault();\r\n      setIsOpen(!isOpen);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className={`relative ${className}`}>\r\n      <button\r\n        ref={buttonRef}\r\n        type=\"button\"\r\n        onClick={() => setIsOpen(!isOpen)}\r\n        onKeyDown={handleKeyDown}\r\n        className=\"w-full px-3 py-2 themed-input text-themed-primary text-left focus:outline-none hover:bg-themed-hover transition-colors flex items-center justify-between\"\r\n        aria-haspopup=\"listbox\"\r\n        aria-expanded={isOpen}\r\n      >\r\n        <span className=\"truncate\">{selectedOption ? selectedOption.label : placeholder}</span>\r\n        <ChevronDown size={16} className={`transition-transform ${isOpen ? 'rotate-180' : ''}`} />\r\n      </button>\r\n      \r\n      {isOpen && (\r\n        <div\r\n          ref={dropdownRef}\r\n          className=\"absolute mt-1 w-full themed-card shadow-xl border border-themed-border\"\r\n          style={{\r\n            zIndex: 50,\r\n            maxHeight: '300px',\r\n            overflowY: 'auto'\r\n          }}\r\n        >\r\n          <div className=\"py-1\">\r\n            {options.map((option) => (\r\n              <button\r\n                key={option.value}\r\n                type=\"button\"\r\n                onClick={() => handleSelect(option.value)}\r\n                className={`w-full px-4 py-2 text-left text-sm hover:bg-themed-hover transition-colors ${\r\n                  option.value === value\r\n                    ? 'bg-themed-hover text-themed-accent'\r\n                    : 'text-themed-secondary'\r\n                }`}\r\n              >\r\n                {option.label}\r\n              </button>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\n// Main Downloads Tab Component\r\nconst DownloadsTab: React.FC = () => {\r\n  const { \r\n    latestDownloads = [], \r\n    loading, \r\n    mockMode, \r\n    updateMockDataCount, \r\n    updateApiDownloadCount \r\n  } = useData();\r\n\r\n  // State management\r\n  const [expandedDownload, setExpandedDownload] = useState<number | null>(null);\r\n  const [expandedGroup, setExpandedGroup] = useState<string | null>(null);\r\n  const [gameInfo, setGameInfo] = useState<Record<number, GameInfo>>({});\r\n  const [loadingGame, setLoadingGame] = useState<number | null>(null);\r\n  const [settingsOpened, setSettingsOpened] = useState(false);\r\n\r\n  const [settings, setSettings] = useState<DownloadSettings>(() => ({\r\n    showZeroBytes: localStorage.getItem(STORAGE_KEYS.SHOW_METADATA) === 'true',\r\n    showSmallFiles: localStorage.getItem(STORAGE_KEYS.SHOW_SMALL_FILES) !== 'false',\r\n    selectedService: localStorage.getItem(STORAGE_KEYS.SERVICE_FILTER) || 'all',\r\n    groupGames: localStorage.getItem(STORAGE_KEYS.GROUP_GAMES) === 'true',\r\n    itemsPerPage: \r\n      localStorage.getItem(STORAGE_KEYS.ITEMS_PER_PAGE) === 'unlimited' \r\n        ? 'unlimited' \r\n        : parseInt(localStorage.getItem(STORAGE_KEYS.ITEMS_PER_PAGE) || '50')\r\n  }));\r\n\r\n  // Helper functions\r\n  const getDownloadTypeInfo = (download: Download) => {\r\n    const totalBytes = download.totalBytes || 0;\r\n    const isMissingData = totalBytes === 0;\r\n    const cachedBytes = download.cacheHitBytes || 0;\r\n    const isCached = cachedBytes > 0;\r\n    const cachePercentage = totalBytes > 0 ? (cachedBytes / totalBytes) * 100 : 0;\r\n\r\n    if (isMissingData) {\r\n      return {\r\n        type: 'metadata' as const,\r\n        icon: Database,\r\n        iconColor: 'text-purple-400',\r\n        description: 'Metadata/Configuration',\r\n        label: 'Metadata'\r\n      };\r\n    } else if (cachePercentage === 100) {\r\n      return {\r\n        type: 'content' as const,\r\n        icon: Check,\r\n        iconColor: 'text-green-400',\r\n        description: 'Fully Cached',\r\n        label: 'Cached'\r\n      };\r\n    } else if (isCached) {\r\n      return {\r\n        type: 'content' as const,\r\n        icon: DownloadIcon,\r\n        iconColor: 'text-yellow-400',\r\n        description: `${cachePercentage.toFixed(0)}% Cached`,\r\n        label: 'Partial'\r\n      };\r\n    } else {\r\n      return {\r\n        type: 'content' as const,\r\n        icon: CloudOff,\r\n        iconColor: 'text-gray-400',\r\n        description: 'Not Cached',\r\n        label: 'Uncached'\r\n      };\r\n    }\r\n  };\r\n\r\n  const fetchGameInfo = async (download: Download) => {\r\n    if (!download.id || !download.gameName || download.service.toLowerCase() !== 'steam') {\r\n      return;\r\n    }\r\n\r\n    if (gameInfo[download.id]) {\r\n      return;\r\n    }\r\n\r\n    setLoadingGame(download.id);\r\n\r\n    try {\r\n      const response = await fetch(`/api/steam/game/${encodeURIComponent(download.gameName)}`);\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setGameInfo(prev => ({\r\n          ...prev,\r\n          [download.id!]: data\r\n        }));\r\n        \r\n        // Cache the game info\r\n        const cached = localStorage.getItem('steam_game_cache') || '{}';\r\n        const cache = JSON.parse(cached);\r\n        cache[download.gameName] = { data, timestamp: Date.now() };\r\n        localStorage.setItem('steam_game_cache', JSON.stringify(cache));\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to fetch game info:', error);\r\n    } finally {\r\n      setLoadingGame(null);\r\n    }\r\n  };\r\n\r\n  // Load cached game info on mount\r\n  useEffect(() => {\r\n    const loadCachedGameInfo = () => {\r\n      const cached = localStorage.getItem('steam_game_cache');\r\n      if (cached) {\r\n        try {\r\n          const cache = JSON.parse(cached);\r\n          const now = Date.now();\r\n          const validCache: Record<number, GameInfo> = {};\r\n          \r\n          latestDownloads.forEach(download => {\r\n            if (download.id && download.gameName && cache[download.gameName]) {\r\n              const cacheEntry = cache[download.gameName];\r\n              // Cache is valid for 24 hours\r\n              if (now - cacheEntry.timestamp < 86400000) {\r\n                validCache[download.id] = cacheEntry.data;\r\n              }\r\n            }\r\n          });\r\n          \r\n          setGameInfo(validCache);\r\n        } catch (error) {\r\n          console.error('Failed to load cached game info:', error);\r\n        }\r\n      }\r\n    };\r\n    \r\n    loadCachedGameInfo();\r\n  }, [latestDownloads]);\r\n\r\n  // Update download count when items per page changes\r\n  useEffect(() => {\r\n    const count = settings.itemsPerPage === 'unlimited' ? 10000 : settings.itemsPerPage;\r\n    if (mockMode && updateMockDataCount) {\r\n      updateMockDataCount(count);\r\n    } else if (!mockMode && updateApiDownloadCount) {\r\n      updateApiDownloadCount(count);\r\n    }\r\n  }, [settings.itemsPerPage, mockMode, updateMockDataCount, updateApiDownloadCount]);\r\n\r\n  // Persist settings\r\n  useEffect(() => {\r\n    localStorage.setItem(STORAGE_KEYS.SERVICE_FILTER, settings.selectedService);\r\n    localStorage.setItem(\r\n      STORAGE_KEYS.ITEMS_PER_PAGE, \r\n      settings.itemsPerPage === 'unlimited' ? 'unlimited' : settings.itemsPerPage.toString()\r\n    );\r\n    localStorage.setItem(STORAGE_KEYS.GROUP_GAMES, settings.groupGames.toString());\r\n    localStorage.setItem(STORAGE_KEYS.SHOW_METADATA, settings.showZeroBytes.toString());\r\n    localStorage.setItem(STORAGE_KEYS.SHOW_SMALL_FILES, settings.showSmallFiles.toString());\r\n  }, [settings]);\r\n\r\n  // Memoized values\r\n  const availableServices = useMemo(() => {\r\n    const services = new Set(latestDownloads.map((d) => d.service.toLowerCase()));\r\n    return Array.from(services).sort();\r\n  }, [latestDownloads]);\r\n\r\n  const serviceOptions = useMemo(\r\n    () => [\r\n      { value: 'all', label: 'All Services' },\r\n      ...availableServices.map((service) => ({\r\n        value: service,\r\n        label: service.charAt(0).toUpperCase() + service.slice(1)\r\n      }))\r\n    ],\r\n    [availableServices]\r\n  );\r\n\r\n  const itemsPerPageOptions = useMemo(\r\n    () => [\r\n      { value: '20', label: '20 items' },\r\n      { value: '50', label: '50 items' },\r\n      { value: '100', label: '100 items' },\r\n      { value: '200', label: '200 items' },\r\n      { value: 'unlimited', label: 'Load All' }\r\n    ],\r\n    []\r\n  );\r\n\r\n  const filteredDownloads = useMemo(() => {\r\n    let filtered = [...latestDownloads];\r\n\r\n    if (!settings.showZeroBytes) {\r\n      filtered = filtered.filter((d) => (d.totalBytes || 0) > 0);\r\n    }\r\n\r\n    if (!settings.showSmallFiles) {\r\n      filtered = filtered.filter(\r\n        (d) => (d.totalBytes || 0) === 0 || (d.totalBytes || 0) >= 1048576\r\n      );\r\n    }\r\n\r\n    if (settings.selectedService !== 'all') {\r\n      filtered = filtered.filter((d) => d.service.toLowerCase() === settings.selectedService);\r\n    }\r\n\r\n    return filtered;\r\n  }, [latestDownloads, settings]);\r\n\r\n  const groupedDownloads = useMemo((): DownloadGroup[] | null => {\r\n    if (!settings.groupGames) return null;\r\n\r\n    const groups: Record<string, DownloadGroup> = {};\r\n\r\n    filteredDownloads.forEach((download) => {\r\n      let groupKey: string;\r\n      let groupName: string;\r\n      let groupType: 'game' | 'metadata' | 'content';\r\n\r\n      if (download.gameName && download.gameName !== 'Unknown Steam Game') {\r\n        groupKey = `game-${download.gameName}`;\r\n        groupName = download.gameName;\r\n        groupType = 'game';\r\n      } else if ((download.totalBytes || 0) === 0) {\r\n        groupKey = `metadata-${download.service}`;\r\n        groupName = `${download.service} Metadata`;\r\n        groupType = 'metadata';\r\n      } else {\r\n        groupKey = `content-${download.service}`;\r\n        groupName = `${download.service} Content`;\r\n        groupType = 'content';\r\n      }\r\n\r\n      if (!groups[groupKey]) {\r\n        groups[groupKey] = {\r\n          id: groupKey,\r\n          name: groupName,\r\n          type: groupType,\r\n          service: download.service,\r\n          downloads: [],\r\n          totalBytes: 0,\r\n          cacheHitBytes: 0,\r\n          cacheMissBytes: 0,\r\n          clientsSet: new Set<string>(),\r\n          firstSeen: download.startTime,\r\n          lastSeen: download.startTime,\r\n          count: 0\r\n        };\r\n      }\r\n\r\n      groups[groupKey].downloads.push(download);\r\n      groups[groupKey].totalBytes += download.totalBytes || 0;\r\n      groups[groupKey].cacheHitBytes += download.cacheHitBytes || 0;\r\n      groups[groupKey].cacheMissBytes += download.cacheMissBytes || 0;\r\n      groups[groupKey].clientsSet.add(download.clientIp);\r\n      groups[groupKey].count++;\r\n      \r\n      // Update first and last seen times\r\n      if (download.startTime < groups[groupKey].firstSeen) {\r\n        groups[groupKey].firstSeen = download.startTime;\r\n      }\r\n      if (download.startTime > groups[groupKey].lastSeen) {\r\n        groups[groupKey].lastSeen = download.startTime;\r\n      }\r\n    });\r\n\r\n    return Object.values(groups).sort((a, b) => {\r\n      if (a.type === 'game' && b.type !== 'game') return -1;\r\n      if (a.type !== 'game' && b.type === 'game') return 1;\r\n      return b.totalBytes - a.totalBytes;\r\n    });\r\n  }, [filteredDownloads, settings.groupGames]);\r\n\r\n  const itemsToDisplay = useMemo(() => {\r\n    const items = settings.groupGames ? groupedDownloads || [] : filteredDownloads;\r\n    if (settings.itemsPerPage === 'unlimited') {\r\n      return items;\r\n    }\r\n    const limit = typeof settings.itemsPerPage === 'number' ? settings.itemsPerPage : 50;\r\n    return items.slice(0, limit);\r\n  }, [settings.groupGames, settings.itemsPerPage, groupedDownloads, filteredDownloads]);\r\n\r\n  // Event handlers\r\n  const handleDownloadClick = async (download: Download) => {\r\n    if (download.totalBytes === 0) return;\r\n    \r\n    const newExpanded = expandedDownload === download.id ? null : download.id;\r\n    setExpandedDownload(newExpanded);\r\n    \r\n    if (newExpanded && download.service.toLowerCase() === 'steam' && download.gameName) {\r\n      await fetchGameInfo(download);\r\n    }\r\n  };\r\n\r\n  const handleGroupClick = (groupId: string) => {\r\n    setExpandedGroup(expandedGroup === groupId ? null : groupId);\r\n  };\r\n\r\n  // Render functions\r\n  const renderGroup = useCallback((group: DownloadGroup) => {\r\n    const isExpanded = expandedGroup === group.id;\r\n    const hitPercent = group.totalBytes > 0 ? (group.cacheHitBytes / group.totalBytes) * 100 : 0;\r\n\r\n    return (\r\n      <Card key={group.id} padding=\"sm\">\r\n        <div onClick={() => handleGroupClick(group.id)} className=\"cursor-pointer\">\r\n          <div className=\"flex items-center justify-between py-1\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <ChevronRight\r\n                  size={16}\r\n                  className={`transition-transform ${isExpanded ? 'rotate-90' : ''}`}\r\n                />\r\n                <div className=\"w-6 h-6 rounded bg-themed-secondary flex items-center justify-center\">\r\n                  <Layers size={14} className=\"text-themed-accent\" />\r\n                </div>\r\n                <span className=\"text-sm font-medium text-themed-accent\">{group.name}</span>\r\n              </div>\r\n              <span className=\"text-xs text-themed-muted\">({group.count} items)</span>\r\n            </div>\r\n            \r\n            <div className=\"flex items-center gap-6\">\r\n              <div className=\"text-right\">\r\n                <div className=\"text-sm font-medium text-themed-primary\">\r\n                  {formatBytes(group.totalBytes)}\r\n                </div>\r\n                {group.totalBytes > 0 && (\r\n                  <div className=\"text-xs text-themed-muted\">\r\n                    {formatPercent(hitPercent)} cached\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {isExpanded && (\r\n          <>\r\n            <div className=\"border-t border-themed-secondary my-4\" />\r\n            <div className=\"max-h-96 overflow-y-auto\">\r\n              <div className=\"space-y-1\">\r\n                {group.downloads.map((d) => (\r\n                  <div key={d.id} className=\"p-3 rounded bg-themed-secondary\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <div className=\"flex items-center gap-3\">\r\n                        <span className={`text-xs font-medium service-${d.service.toLowerCase()}`}>\r\n                          {d.service}\r\n                        </span>\r\n                        <span className=\"text-xs text-themed-muted\">{d.clientIp}</span>\r\n                      </div>\r\n                      <div className=\"text-xs text-themed-muted\">\r\n                        {formatBytes(d.totalBytes || 0)}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          </>\r\n        )}\r\n      </Card>\r\n    );\r\n  }, [expandedGroup]);\r\n\r\n  const renderDownload = useCallback((download: Download) => {\r\n    const isExpanded = expandedDownload === download.id;\r\n    const isSteam = download.service.toLowerCase() === 'steam';\r\n    const hasData = (download.totalBytes || 0) > 0;\r\n    const downloadType = getDownloadTypeInfo(download);\r\n    const IconComponent = downloadType.icon;\r\n    const game = download.id ? gameInfo[download.id] : undefined;\r\n\r\n    return (\r\n      <Card key={download.id} padding=\"sm\">\r\n        <div onClick={() => handleDownloadClick(download)} className={hasData ? 'cursor-pointer' : ''}>\r\n          <div className=\"flex items-center justify-between py-1\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className=\"flex items-center gap-2\">\r\n                {hasData && (\r\n                  <ChevronRight\r\n                    size={16}\r\n                    className={`transition-transform ${isExpanded ? 'rotate-90' : ''}`}\r\n                  />\r\n                )}\r\n                <span className={`text-sm font-medium service-${download.service.toLowerCase()}`}>\r\n                  {download.service}\r\n                </span>\r\n              </div>\r\n              \r\n              {download.gameName && download.gameName !== 'Unknown Steam Game' && (\r\n                <span className=\"text-sm text-themed-primary font-medium\">\r\n                  {download.gameName}\r\n                </span>\r\n              )}\r\n              \r\n              <div className=\"flex items-center gap-2\">\r\n                <IconComponent size={14} className={downloadType.iconColor} />\r\n                <span className=\"text-xs text-themed-muted\">{downloadType.description}</span>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"flex items-center gap-6\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <Users size={14} className=\"text-themed-muted\" />\r\n                <span className=\"text-xs text-themed-muted\">{download.clientIp}</span>\r\n              </div>\r\n              \r\n              <div className=\"text-right\">\r\n                <div className=\"text-sm font-medium text-themed-primary\">\r\n                  {formatBytes(download.totalBytes || 0)}\r\n                </div>\r\n                {download.totalBytes && download.totalBytes > 0 && (\r\n                  <div className=\"text-xs text-themed-muted\">\r\n                    {formatPercent((download.cacheHitBytes || 0) / download.totalBytes * 100)} hit\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {isExpanded && game && (\r\n            <>\r\n              <div className=\"border-t border-themed-secondary my-4\" />\r\n              {loadingGame === download.id ? (\r\n                <div className=\"flex justify-center py-4\">\r\n                  <Loader className=\"w-6 h-6 animate-spin\" />\r\n                </div>\r\n              ) : (\r\n                <div className=\"flex gap-6 items-start\">\r\n                  <div className=\"flex-shrink-0\">\r\n                    <ImageWithFallback\r\n                      src={game.headerImage || ''}\r\n                      alt={game.gameName || 'Game'}\r\n                      className=\"rounded shadow-lg\"\r\n                      style={{ width: '224px', height: '107px', objectFit: 'cover' }}\r\n                      fallback={\r\n                        <div \r\n                          className=\"rounded flex items-center justify-center shadow-lg\"\r\n                          style={{ \r\n                            width: '224px',\r\n                            height: '107px',\r\n                            backgroundColor: 'var(--theme-bg-tertiary)',\r\n                            border: '1px solid var(--theme-border-primary)'\r\n                          }}\r\n                        >\r\n                          <Gamepad2 \r\n                            className=\"w-12 h-12\"\r\n                            style={{ color: 'var(--theme-text-muted)' }}\r\n                          />\r\n                        </div>\r\n                      }\r\n                    />\r\n                  </div>\r\n                  <div className=\"flex-1 min-w-0\">\r\n                    <h3 className=\"text-lg font-semibold text-themed-primary mb-3 truncate\">\r\n                      {game.gameName || 'Unknown Game'}\r\n                    </h3>\r\n                    {game.description && (\r\n                      <p className=\"text-sm text-themed-secondary mb-4 line-clamp-2\">\r\n                        {game.description}\r\n                      </p>\r\n                    )}\r\n                    <div className=\"flex flex-wrap gap-4 text-xs text-themed-muted\">\r\n                      {game.gameType && (\r\n                        <span>Type: {game.gameType}</span>\r\n                      )}\r\n                    </div>\r\n                    {isSteam && (\r\n                      <a\r\n                        href={`https://store.steampowered.com/app/${game.appId}`}\r\n                        target=\"_blank\"\r\n                        rel=\"noopener noreferrer\"\r\n                        onClick={(e) => e.stopPropagation()}\r\n                        className=\"inline-flex items-center gap-2 mt-4 px-3 py-1 rounded bg-themed-secondary hover:bg-themed-hover transition-colors text-xs text-themed-accent\"\r\n                      >\r\n                        View on Steam\r\n                        <ExternalLink size={12} />\r\n                      </a>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </>\r\n          )}\r\n        </div>\r\n      </Card>\r\n    );\r\n  }, [expandedDownload, gameInfo, loadingGame]);\r\n\r\n  const renderVirtualItem = useCallback((item: any) => {\r\n    if ('downloads' in item) {\r\n      return renderGroup(item as DownloadGroup);\r\n    }\r\n    return renderDownload(item as Download);\r\n  }, [renderGroup, renderDownload]);\r\n\r\n  // Loading state\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-[400px]\">\r\n        <Loader className=\"w-8 h-8 animate-spin\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Empty state\r\n  if (latestDownloads.length === 0) {\r\n    return (\r\n      <Alert color=\"blue\" icon={<Database className=\"w-5 h-5\" />}>\r\n        No downloads recorded yet. Downloads will appear here as clients request content.\r\n      </Alert>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      {/* Controls */}\r\n      <Card padding=\"sm\">\r\n        <div className=\"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between\">\r\n          <div className=\"flex flex-col sm:flex-row gap-2 items-start sm:items-center flex-1\">\r\n            <EnhancedDropdown\r\n              options={serviceOptions}\r\n              value={settings.selectedService}\r\n              onChange={(value) =>\r\n                setSettings({ ...settings, selectedService: value })\r\n              }\r\n              className=\"w-full sm:w-40\"\r\n            />\r\n            \r\n            <EnhancedDropdown\r\n              options={itemsPerPageOptions}\r\n              value={\r\n                settings.itemsPerPage === 'unlimited'\r\n                  ? 'unlimited'\r\n                  : settings.itemsPerPage.toString()\r\n              }\r\n              onChange={(value) =>\r\n                setSettings({\r\n                  ...settings,\r\n                  itemsPerPage: value === 'unlimited' ? 'unlimited' : parseInt(value)\r\n                })\r\n              }\r\n              className=\"w-full sm:w-32\"\r\n            />\r\n          </div>\r\n\r\n          <button\r\n            onClick={() => setSettingsOpened(!settingsOpened)}\r\n            className=\"p-2 rounded hover:bg-themed-hover transition-colors\"\r\n            title=\"Settings\"\r\n          >\r\n            <Settings size={18} />\r\n          </button>\r\n        </div>\r\n\r\n        {settingsOpened && (\r\n          <>\r\n            <div className=\"border-t border-themed-secondary my-3\" />\r\n            <div className=\"space-y-2\">\r\n              <label className=\"flex items-center gap-2 cursor-pointer\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={settings.groupGames}\r\n                  onChange={(e) =>\r\n                    setSettings({ ...settings, groupGames: e.target.checked })\r\n                  }\r\n                  className=\"themed-checkbox\"\r\n                />\r\n                <span className=\"text-sm text-themed-secondary\">Group by games</span>\r\n              </label>\r\n              \r\n              <label className=\"flex items-center gap-2 cursor-pointer\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={settings.showZeroBytes}\r\n                  onChange={(e) =>\r\n                    setSettings({ ...settings, showZeroBytes: e.target.checked })\r\n                  }\r\n                  className=\"themed-checkbox\"\r\n                />\r\n                <span className=\"text-sm text-themed-secondary\">Show metadata (0 bytes)</span>\r\n              </label>\r\n              \r\n              <label className=\"flex items-center gap-2 cursor-pointer\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={settings.showSmallFiles}\r\n                  onChange={(e) =>\r\n                    setSettings({ ...settings, showSmallFiles: e.target.checked })\r\n                  }\r\n                  className=\"themed-checkbox\"\r\n                />\r\n                <span className=\"text-sm text-themed-secondary\">Show small files (&lt; 1MB)</span>\r\n              </label>\r\n            </div>\r\n          </>\r\n        )}\r\n      </Card>\r\n\r\n      {/* Stats */}\r\n      {filteredDownloads.length !== latestDownloads.length && (\r\n        <Alert color=\"blue\" icon={<Database className=\"w-5 h-5\" />}>\r\n          Showing {filteredDownloads.length} of {latestDownloads.length} downloads\r\n          {settings.selectedService !== 'all' && ` for ${settings.selectedService}`}\r\n        </Alert>\r\n      )}\r\n\r\n      {/* Downloads list */}\r\n      <div>\r\n        {settings.itemsPerPage === 'unlimited' && itemsToDisplay.length > 100 ? (\r\n          <VirtualizedList\r\n            items={itemsToDisplay}\r\n            height={window.innerHeight - 250}\r\n            itemHeight={120}\r\n            renderItem={renderVirtualItem}\r\n          />\r\n        ) : (\r\n          <div className=\"space-y-3\">\r\n            {itemsToDisplay.map((item) => {\r\n              if ('downloads' in item) {\r\n                return renderGroup(item as DownloadGroup);\r\n              }\r\n              return renderDownload(item as Download);\r\n            })}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Performance warning */}\r\n      {settings.itemsPerPage === 'unlimited' && itemsToDisplay.length > 500 && (\r\n        <Alert color=\"yellow\" icon={<AlertTriangle className=\"w-5 h-5\" />}>\r\n          Loading {itemsToDisplay.length} items. Performance optimized with virtual scrolling.\r\n        </Alert>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default DownloadsTab;"],"names":["VirtualizedList","items","height","itemHeight","renderItem","overscan","className","parentRef","useRef","virtualizer","useVirtualizer","jsx","virtualItem","STORAGE_KEYS","ImageWithFallback","src","fallback","alt","style","onLoad","onError","hasError","setHasError","useState","isLoading","setIsLoading","useEffect","handleLoad","handleError","Gamepad2","jsxs","Loader","EnhancedDropdown","options","value","onChange","placeholder","isOpen","setIsOpen","dropdownRef","buttonRef","selectedOption","opt","handleClickOutside","event","handleEscape","handleSelect","optionValue","handleKeyDown","ChevronDown","option","DownloadsTab","latestDownloads","loading","mockMode","updateMockDataCount","updateApiDownloadCount","useData","expandedDownload","setExpandedDownload","expandedGroup","setExpandedGroup","gameInfo","setGameInfo","loadingGame","setLoadingGame","settingsOpened","setSettingsOpened","settings","setSettings","getDownloadTypeInfo","download","totalBytes","isMissingData","cachedBytes","isCached","cachePercentage","Database","Check","DownloadIcon","CloudOff","fetchGameInfo","response","data","prev","cached","cache","error","now","validCache","cacheEntry","count","availableServices","useMemo","services","d","serviceOptions","service","itemsPerPageOptions","filteredDownloads","filtered","groupedDownloads","groups","groupKey","groupName","groupType","a","b","itemsToDisplay","limit","handleDownloadClick","newExpanded","handleGroupClick","groupId","renderGroup","useCallback","group","isExpanded","hitPercent","Card","ChevronRight","Layers","formatBytes","formatPercent","Fragment","renderDownload","isSteam","hasData","downloadType","IconComponent","game","Users","e","ExternalLink","renderVirtualItem","item","Alert","Settings","AlertTriangle"],"mappings":"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"}
import{r as u,j as e,R as at,X as st,C as te,K as ke,x as Fe,y as re,H as rt,z as He,B as ee,b as Z,F as Le,J as De,N as Re,O as ot,P as Ne,Q as lt,V as ct,Y as Te,_ as Se,D as oe,o as nt,E as Oe,v as he,$ as it,a0 as dt,I as Be,a1 as fe,a2 as mt,a3 as ut,q as ht,a4 as ft,a5 as gt,A as Ee,m as Pe,e as $e,a6 as le,k as Me,a7 as Ae,a8 as xt,i as ce,T as pt,l as bt,a9 as yt,aa as vt}from"./react-vendor-CesVvHrP.js";import{a as W,A as L,t as z,b as Ie,u as jt}from"./index-CDhHlmBG.js";import{f as se,C as Y}from"./Card-yRS5xGqS.js";import{A as O}from"./Alert-CK8L5O9K.js";import{H as Ct}from"./signalr-C7Jyn4vH.js";import"./vendor-BmYUbuLR.js";import"./tanstack-CPlEqbpz.js";async function wt(c){try{const b=await fetch(c,{signal:AbortSignal.timeout(5e3)});return b.ok?{ok:!0,data:await b.json()}:{ok:!1,error:`HTTP ${b.status}`}}catch(b){return{ok:!1,error:b.message}}}const ge={},kt=()=>{if(!(typeof import.meta<"u"&&(ge!=null&&ge.VITE_API_URL)))return""},V=kt();class Nt{async getState(b){const a=await wt(`${V}/api/operationstate/${b}`);return a.ok?a.data:null}async saveState(b,a,n,h=30){try{const s=await fetch(`${V}/api/operationstate`,{method:"POST",headers:{"Content-Type":"application/json",...W.getAuthHeaders()},body:JSON.stringify({key:b,type:a,data:n,expirationMinutes:h})});if(!s.ok){const i=await s.text();throw new Error(`Failed to save state: ${i}`)}return await s.json()}catch(s){throw console.error("Error saving state:",s),s}}async updateState(b,a){try{const n=`${V}/api/operationstate/${encodeURIComponent(b)}`;console.log("Updating state at:",n);const h=await fetch(n,{method:"PATCH",headers:{"Content-Type":"application/json",...W.getAuthHeaders()},body:JSON.stringify({updates:a||{}})});if(!h.ok){const s=await h.text();throw console.error("Update state response:",h.status,s),new Error(`Failed to update state: ${h.status} - ${s}`)}return await h.json()}catch(n){return console.error("Error updating state:",n),null}}async removeState(b){try{const a=await fetch(`${V}/api/operationstate/${encodeURIComponent(b)}`,{method:"DELETE",headers:W.getAuthHeaders()});if(!a.ok)throw new Error("Failed to remove state");return await a.json()}catch(a){throw console.error("Error removing state:",a),a}}async getAllStates(b=null){try{const a=b?`${V}/api/operationstate?type=${b}`:`${V}/api/operationstate`,n=await fetch(a,{headers:W.getAuthHeaders()});if(!n.ok)throw new Error("Failed to get states");return await n.json()}catch(a){return console.error("Error getting all states:",a),[]}}async migrateFromLocalStorage(){const b=["activeCacheClearOperation","activeLogProcessing","activeServiceRemoval"];let a=0;for(const n of b)try{const h=localStorage.getItem(n);if(h){const s=JSON.parse(h);let i="general";n.includes("CacheClear")?i="cacheClearing":n.includes("LogProcessing")?i="logProcessing":n.includes("ServiceRemoval")&&(i="serviceRemoval"),await this.saveState(n,i,s,120),localStorage.removeItem(n),a++,console.log(`Migrated ${n} from localStorage to backend`)}}catch(h){console.error(`Failed to migrate ${n}:`,h)}return a>0&&console.log(`Successfully migrated ${a} operations to backend storage`),a}}const X=new Nt,xe=(c,b="general",a=30)=>{const[n,h]=u.useState(null),[s,i]=u.useState(!1),[j,f]=u.useState(null),P=u.useCallback(async p=>{i(!0),f(null);try{await X.saveState(c,b,p,a);const m={key:c,type:b,data:p,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return h(m),m}catch(m){throw console.error(`Failed to save ${c}:`,m),f(m.message),m}finally{i(!1)}},[c,b,a]),x=u.useCallback(async()=>{i(!0),f(null);try{const p=await X.getState(c);if(p){const m=p,B={key:m.key||c,type:m.type||b,data:m.data||{},createdAt:m.createdAt||new Date().toISOString(),updatedAt:m.updatedAt||m.createdAt||new Date().toISOString()};return h(B),B}return null}catch(p){return console.error(`Failed to load ${c}:`,p),f(p.message),null}finally{i(!1)}},[c,b]),N=u.useCallback(async()=>{i(!0),f(null);try{await X.removeState(c),h(null)}catch(p){throw console.error(`Failed to clear ${c}:`,p),f(p.message),p}finally{i(!1)}},[c]),S=u.useCallback(async p=>{i(!0),f(null);try{await X.updateState(c,p),h(m=>m?{...m,data:{...m.data,...p},updatedAt:new Date().toISOString()}:null)}catch(m){throw console.error(`Failed to update ${c}:`,m),f(m.message),m}finally{i(!1)}},[c]);return u.useEffect(()=>{c&&x()},[c]),{operation:n,save:P,load:x,clear:N,update:S,loading:s,error:j}},H=({children:c,variant:b="default",color:a="blue",size:n="md",loading:h=!1,leftSection:s,rightSection:i,fullWidth:j=!1,className:f="",disabled:P,...x})=>{const N=()=>b==="filled"?{blue:"themed-button-primary",green:"action-process",red:"action-delete",yellow:"action-reset",purple:"themed-button-primary",gray:"bg-themed-hover hover:bg-themed-tertiary text-themed-primary",orange:"action-reset"}[a]:b==="subtle"?"bg-transparent hover:bg-themed-hover text-themed-secondary":b==="outline"?"border border-themed-secondary hover:bg-themed-hover text-themed-primary":"bg-themed-tertiary hover:bg-themed-hover text-themed-primary",S={xs:"px-2 py-1 text-xs",sm:"px-3 py-1.5 text-sm",md:"px-4 py-2",lg:"px-6 py-3 text-lg"};return e.jsxs("button",{className:`
        ${N()}
        ${S[n]}
        ${j?"w-full":""}
        rounded-lg font-medium
        smooth-transition
        disabled:opacity-50 disabled:cursor-not-allowed
        flex items-center justify-center gap-2
        button-press
        ${f}
      `,disabled:P||h,...x,children:[h&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current"}),s,c,i]})},ne=({opened:c,onClose:b,title:a,children:n,size:h="md"})=>{const s={sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"};return at.useEffect(()=>(c?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[c]),c?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:`themed-card rounded-lg ${s[h]} w-full mx-4 max-h-[90vh] overflow-y-auto custom-scrollbar`,children:[a&&e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-themed-secondary",children:[e.jsx("div",{className:"text-lg font-semibold text-themed-primary",children:a}),e.jsx("button",{onClick:b,className:"p-1 hover:bg-themed-hover rounded-lg smooth-transition",children:e.jsx(st,{className:"w-5 h-5 text-themed-muted"})})]}),e.jsx("div",{className:"p-6",children:n})]})}):null},Tt=({onAuthChange:c,onError:b,onSuccess:a})=>{const[n,h]=u.useState(!1),[s,i]=u.useState(!0),[j,f]=u.useState(!1),[P,x]=u.useState(""),[N,S]=u.useState(""),[p,m]=u.useState(!1);u.useEffect(()=>{B()},[]);const B=async()=>{i(!0);try{const _=await W.checkAuth();h(_.isAuthenticated),c==null||c(_.isAuthenticated),!_.isAuthenticated&&W.isRegistered()&&W.clearAuth()}catch(_){console.error("Auth check failed:",_),h(!1),c==null||c(!1)}finally{i(!1)}},I=async()=>{if(!P.trim()){S("Please enter an API key");return}m(!0),S("");try{const _=await W.register(P);_.success?(h(!0),c==null||c(!0),f(!1),x(""),a==null||a("Authentication successful! You can now use management features.")):S(_.message||"Authentication failed")}catch(_){console.error("Authentication error:",_),S(_.message||"Authentication failed")}finally{m(!1)}},q=async()=>{if(window.confirm(`WARNING: This will:

1. Generate a NEW API key on the server
2. Revoke ALL existing device registrations
3. Require ALL users to re-authenticate
4. You must check the container logs for the new key

This cannot be undone. Continue?`)){m(!0);try{const v=await W.regenerateApiKey();v.success?(h(!1),c==null||c(!1),f(!1),b==null||b("API KEY REGENERATED - Check container logs for new key!"),a==null||a(v.message),setTimeout(()=>{f(!0)},3e3)):b==null||b(v.message||"Failed to regenerate API key")}catch(v){console.error("Error regenerating key:",v),b==null||b("Failed to regenerate API key: "+v.message)}finally{m(!1)}}};return s?null:e.jsxs(e.Fragment,{children:[e.jsx(O,{color:n?"green":"yellow",icon:n?e.jsx(Fe,{className:"w-5 h-5"}):e.jsx(re,{className:"w-5 h-5"}),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:n?"Authenticated":"Not Authenticated"}),e.jsx("p",{className:"text-xs mt-1 opacity-75",children:n?"Management features enabled":"Management features require API key"})]}),n?e.jsx(H,{variant:"filled",color:"red",size:"sm",leftSection:e.jsx(te,{className:"w-3 h-3"}),onClick:q,loading:p,children:"Regenerate Key"}):e.jsx(H,{variant:"filled",color:"yellow",leftSection:e.jsx(ke,{className:"w-4 h-4"}),onClick:()=>f(!0),children:"Authenticate"})]})}),e.jsx(ne,{opened:j,onClose:()=>{f(!1),x(""),S("")},title:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ke,{className:"w-6 h-6 text-themed-warning"}),e.jsx("span",{children:"Authentication Required"})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-themed-secondary",children:"Management operations require authentication. Please enter your API key to continue."}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-themed-secondary mb-2",children:"API Key"}),e.jsx("input",{type:"password",value:P,onChange:_=>x(_.target.value),onKeyPress:_=>_.key==="Enter"&&I(),placeholder:"lm_xxxxxxxxxxxxxxxxxxxxx",className:"w-full px-3 py-2 themed-input text-themed-primary placeholder-themed-muted focus:outline-none",disabled:p})]}),N&&e.jsx(O,{color:"red",children:N}),e.jsx(O,{color:"blue",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium mb-2",children:"To find your API key:"}),e.jsxs("ol",{className:"list-decimal list-inside text-xs space-y-1",children:[e.jsx("li",{children:"SSH into your server"}),e.jsxs("li",{children:["Check the file:"," ",e.jsx("code",{className:"bg-themed-tertiary px-1 rounded",children:"/data/api_key.txt"})]}),e.jsx("li",{children:"Or check the API container logs on startup"})]})]})}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-themed-secondary",children:[e.jsx(H,{variant:"default",onClick:()=>{f(!1),x(""),S("")},disabled:p,children:"Cancel"}),e.jsx(H,{variant:"filled",color:"blue",leftSection:e.jsx(re,{className:"w-4 h-4"}),onClick:I,loading:p,disabled:!P.trim(),children:"Authenticate"})]})]})})]})},St=({isAuthenticated:c,mockMode:b,onError:a,onSuccess:n,onBackgroundOperation:h})=>{var R;const[s,i]=u.useState(null),[j,f]=u.useState(!1),[P,x]=u.useState(!1),[N,S]=u.useState({cachePath:"/cache",logPath:"/logs/access.log",services:[]}),p=xe("activeCacheClearOperation","cacheClearing",30);u.useEffect(()=>{var d;((d=p.operation)==null?void 0:d.data)&&!j&&s&&["Running","Preparing"].includes(s.status)&&h?h({bytesDeleted:s.bytesDeleted,progress:s.percentComplete||s.progress||0,showModal:()=>f(!0)}):h&&h(null)},[p.operation,j,s,h]),u.useEffect(()=>{m(),B()},[]);const m=async()=>{try{const k=await L.getConfig();S(k)}catch(k){console.error("Failed to load config:",k)}},B=async()=>{var d;const k=await p.load();if((d=k==null?void 0:k.data)!=null&&d.operationId)try{const l=await L.getCacheClearStatus(k.data.operationId);l&&["Running","Preparing"].includes(l.status)?(i(l),I(k.data.operationId)):await p.clear()}catch{await p.clear()}},I=k=>{const d=setInterval(async()=>{try{const l=await L.getCacheClearStatus(k);i(l),["Running","Preparing"].includes(l.status)?await p.update({lastProgress:l.percentComplete||l.progress||0}):(q(l),clearInterval(d))}catch(l){console.error("Error polling cache clear status:",l),clearInterval(d)}},1e3)},q=async k=>{await p.clear(),k.status==="Completed"?(n==null||n(`Cache cleared successfully! ${se(k.bytesDeleted||0)} freed.`),setTimeout(()=>{f(!1),i(null)},2e3)):k.status==="Failed"?(a==null||a(`Cache clearing failed: ${k.error||k.message||"Unknown error"}`),setTimeout(()=>{f(!1),i(null)},5e3)):k.status==="Cancelled"&&(n==null||n("Cache clearing cancelled"),f(!1),i(null))},_=async()=>{if(!c){a==null||a("Authentication required");return}if(window.confirm("This will clear ALL cached game files. Continue?")){x(!0);try{const k=await L.clearAllCache();k.operationId&&(await p.save({operationId:k.operationId}),i({operationId:k.operationId,status:"Preparing",statusMessage:"Starting cache clear...",percentComplete:0,bytesDeleted:0,totalBytesToDelete:0}),f(!0),I(k.operationId))}catch(k){a==null||a("Failed to start cache clearing: "+k.message)}finally{x(!1)}}},v=async()=>{var d;const k=p.operation;if((d=k==null?void 0:k.data)!=null&&d.operationId)try{i(l=>l?{...l,status:"Cancelling",statusMessage:"Cancelling operation..."}:null),await L.cancelCacheClear(k.data.operationId),await p.clear(),setTimeout(()=>{f(!1),i(null),n==null||n("Cache clearing operation cancelled")},1500)}catch(l){console.error("Failed to cancel cache clear:",l),f(!1),i(null),await p.clear()}},F=((R=p.operation)==null?void 0:R.data)&&!j&&s&&["Running","Preparing"].includes(s.status),D=(s==null?void 0:s.percentComplete)||(s==null?void 0:s.progress)||0;return e.jsxs(e.Fragment,{children:[e.jsxs(Y,{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(rt,{className:"w-5 h-5 text-themed-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-themed-primary",children:"Disk Cache Management"})]}),e.jsxs("p",{className:"text-themed-muted text-sm mb-4",children:["Manage cached game files in"," ",e.jsx("code",{className:"bg-themed-tertiary px-2 py-1 rounded",children:N.cachePath})]}),e.jsx(H,{fullWidth:!0,variant:"filled",color:"red",leftSection:e.jsx(He,{className:"w-4 h-4"}),onClick:_,disabled:P||b||F||p.loading||!c,loading:P||p.loading,children:F?"Cache Clearing in Progress...":"Clear All Cached Files"}),e.jsx("p",{className:"text-xs text-themed-muted mt-2",children:"⚠️ This deletes ALL cached game files from disk"})]}),e.jsx(ne,{opened:j&&s!==null,onClose:()=>{["Running","Preparing"].includes((s==null?void 0:s.status)||"")||(f(!1),i(null))},title:"Clearing Cache",size:"lg",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[(s==null?void 0:s.status)==="Completed"?e.jsx(ee,{className:"w-5 h-5 cache-hit"}):(s==null?void 0:s.status)==="Failed"?e.jsx(te,{className:"w-5 h-5 text-themed-error"}):e.jsx(Z,{className:"w-5 h-5 text-themed-primary animate-spin"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-themed-primary font-medium",children:s==null?void 0:s.status}),((s==null?void 0:s.statusMessage)||(s==null?void 0:s.message))&&e.jsx("p",{className:"text-sm text-themed-muted",children:(s==null?void 0:s.statusMessage)||(s==null?void 0:s.message)})]})]}),s&&["Running","Preparing"].includes(s.status)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full progress-track rounded-full h-4 relative overflow-hidden",children:[e.jsx("div",{className:"progress-bar-medium h-4 rounded-full smooth-transition",style:{width:`${Math.min(100,D)}%`}}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("span",{className:"text-xs text-themed-primary font-medium",children:[D.toFixed(0),"%"]})})]}),s.bytesDeleted!==void 0&&s.totalBytesToDelete&&s.totalBytesToDelete>0&&e.jsxs("div",{className:"text-sm text-themed-muted text-center",children:[e.jsx("span",{className:"cache-hit font-semibold",children:se(s.bytesDeleted||0)})," / ",e.jsx("span",{className:"text-themed-primary",children:se(s.totalBytesToDelete)})," cleared"]})]}),(s==null?void 0:s.error)&&e.jsx(O,{color:"red",children:s.error}),e.jsx("div",{className:"flex justify-end space-x-3 pt-4 border-t border-themed-secondary",children:s&&["Running","Preparing"].includes(s.status)?e.jsxs(e.Fragment,{children:[e.jsx(H,{variant:"filled",color:"red",leftSection:e.jsx(Le,{className:"w-4 h-4"}),onClick:v,children:"Cancel"}),e.jsx(H,{variant:"default",onClick:()=>f(!1),children:"Run in Background"})]}):e.jsx(H,{variant:"default",onClick:()=>{f(!1),i(null)},children:"Close"})})]})}),p.error&&e.jsxs(O,{color:"orange",children:["Backend storage error: ",p.error]})]})},Bt=({isAuthenticated:c,mockMode:b,onError:a,onSuccess:n,onDataRefresh:h,onBackgroundOperation:s})=>{const[i,j]=u.useState(!1),[f,P]=u.useState(null),[x,N]=u.useState(!1),[S,p]=u.useState(!1),m=xe("activeLogProcessing","logProcessing",120),B=u.useRef(null),I=u.useRef(null),q=u.useRef(null);u.useEffect(()=>{i&&f&&s?s({message:f.message,detailMessage:f.detailMessage,progress:f.progress,estimatedTime:f.estimatedTime,status:f.status,onCancel:k}):s&&s(null)},[i,f,s]),u.useEffect(()=>(_(),v(),()=>{I.current&&clearInterval(I.current),q.current&&clearTimeout(q.current),B.current&&B.current.stop()}),[]);const _=async()=>{var l,C;const d=await m.load();if(d!=null&&d.data){const o=await L.getProcessingStatus().catch(()=>null);o!=null&&o.isProcessing?(j(!0),P({message:`Processing: ${((l=o.mbProcessed)==null?void 0:l.toFixed(1))||0} MB of ${((C=o.mbTotal)==null?void 0:C.toFixed(1))||0} MB`,detailMessage:o.processingRate?`Speed: ${o.processingRate.toFixed(1)} MB/s`:"",progress:o.percentComplete||o.progress||0,estimatedTime:o.estimatedTime,status:o.status||"processing"}),F()):await m.clear()}},v=async()=>{try{const d=new Ct().withUrl("/hubs/downloads").withAutomaticReconnect([0,2e3,5e3,1e4,3e4]).build();d.on("ProcessingProgress",async l=>{console.log("Processing progress received:",l),P(C=>{var o,$;return(C==null?void 0:C.status)==="complete"?C:{message:`Processing: ${((o=l.mbProcessed)==null?void 0:o.toFixed(1))||0} MB of ${(($=l.mbTotal)==null?void 0:$.toFixed(1))||0} MB`,detailMessage:`${l.entriesProcessed||0} entries from ${l.linesProcessed||0} lines`,progress:l.percentComplete||l.progress||0,status:"processing"}}),j(!0),await m.update({lastProgress:l.percentComplete||l.progress||0,mbProcessed:l.mbProcessed,mbTotal:l.mbTotal,entriesProcessed:l.entriesProcessed,linesProcessed:l.linesProcessed})}),d.on("BulkProcessingComplete",async l=>{var C,o,$;console.log("Bulk processing complete:",l),I.current&&clearInterval(I.current),P({message:"Processing Complete!",detailMessage:`Successfully processed ${(C=l.entriesProcessed)==null?void 0:C.toLocaleString()} entries from ${(o=l.linesProcessed)==null?void 0:o.toLocaleString()} lines in ${($=l.elapsed)==null?void 0:$.toFixed(1)} minutes`,progress:100,status:"complete"}),j(!0),await m.clear(),setTimeout(async()=>{j(!1),P(null),h==null||h()},1e4)}),d.onreconnecting(l=>{console.log("SignalR reconnecting:",l),p(!1)}),d.onreconnected(l=>{console.log("SignalR reconnected:",l),p(!0)}),d.onclose(l=>{console.error("SignalR disconnected:",l),p(!1),i&&(console.log("SignalR disconnected during processing, falling back to polling"),F()),q.current=setTimeout(()=>{v()},5e3)}),await d.start(),B.current=d,p(!0),console.log("SignalR connected")}catch(d){console.error("SignalR connection failed, falling back to polling:",d),p(!1),i&&F()}},F=()=>{I.current&&clearInterval(I.current);const d=async()=>{var l,C,o;try{const $=f;if(($==null?void 0:$.status)==="complete")return;const g=await L.getProcessingStatus();g!=null&&g.isProcessing?(j(!0),P({message:`Processing: ${((l=g.mbProcessed)==null?void 0:l.toFixed(1))||0} MB of ${((C=g.mbTotal)==null?void 0:C.toFixed(1))||0} MB`,detailMessage:g.processingRate?`Speed: ${g.processingRate.toFixed(1)} MB/s`:"",progress:g.percentComplete||g.progress||0,estimatedTime:g.estimatedTime,status:g.status||"processing"}),await m.update({lastProgress:g.percentComplete||g.progress||0,mbProcessed:g.mbProcessed,mbTotal:g.mbTotal})):((g==null?void 0:g.percentComplete)||(g==null?void 0:g.progress)||0)>=100?(I.current&&clearInterval(I.current),P({message:"Processing Complete!",detailMessage:`Processed ${((o=g.mbTotal)==null?void 0:o.toFixed(1))||0} MB`,progress:100,status:"complete"}),j(!0),await m.clear(),setTimeout(()=>{j(!1),P(null),h==null||h()},1e4)):(j(!1),await m.clear(),I.current&&clearInterval(I.current))}catch($){console.error("Error checking processing status:",$)}};d(),I.current=setInterval(d,3e3)},D=async()=>{if(!c){a==null||a("Authentication required");return}N(!0);try{const d=await L.resetLogPosition();d&&(n==null||n(d.message||"Log position reset successfully"),setTimeout(()=>h==null?void 0:h(),2e3))}catch(d){a==null||a(d.message||"Failed to reset log position")}finally{N(!1)}},R=async()=>{var d;if(!c){a==null||a("Authentication required");return}if(window.confirm("Process entire log file?")){N(!0);try{const l=await L.processAllLogs();if(l){if(l.status==="empty_file"||l.status==="no_log_file"||l.status==="insufficient_data"){a==null||a(l.message),N(!1);return}l.logSizeMB>0?(await m.save({type:"processAll"}),j(!0),P({message:"Preparing to process logs...",detailMessage:`${((d=l.logSizeMB)==null?void 0:d.toFixed(1))||0} MB to process`,progress:0,estimatedTime:`Estimated: ${l.estimatedTimeMinutes} minutes`,status:"starting"}),S||setTimeout(()=>F(),5e3)):(a==null||a("Log file appears to be empty or invalid"),await m.clear())}else await m.clear()}catch(l){await m.clear(),a==null||a(l.message||"Failed to process logs")}finally{N(!1)}}},k=async()=>{if(!c){a==null||a("Authentication required");return}if(window.confirm("Cancel log processing?")){N(!0);try{await L.cancelProcessing(),j(!1),await m.clear(),I.current&&clearInterval(I.current),n==null||n("Processing cancelled"),setTimeout(()=>{P(null),h==null||h()},5e3)}catch{a==null||a("Failed to cancel processing")}finally{N(!1)}}};return e.jsxs(Y,{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(De,{className:"w-5 h-5 cache-hit"}),e.jsx("h3",{className:"text-lg font-semibold text-themed-primary",children:"Log Processing"})]}),e.jsx("p",{className:"text-themed-muted text-sm mb-4",children:"Control how access.log is processed for statistics"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(H,{variant:"filled",color:"yellow",leftSection:e.jsx(Re,{className:"w-4 h-4"}),onClick:D,disabled:x||i||b||m.loading||!c,fullWidth:!0,children:"Reset Log Position"}),e.jsx(H,{variant:"filled",color:"green",leftSection:e.jsx(ot,{className:"w-4 h-4"}),onClick:R,disabled:x||i||b||m.loading||!c,loading:m.loading,fullWidth:!0,children:"Process All Logs"})]}),e.jsx("div",{className:"mt-4 p-3 bg-themed-tertiary rounded-lg",children:e.jsxs("p",{className:"text-xs text-themed-muted",children:[e.jsx("strong",{children:"Reset:"})," Start from current end of log",e.jsx("br",{}),e.jsx("strong",{children:"Process All:"})," Import entire log history"]})}),m.error&&e.jsxs(O,{color:"orange",children:["Backend storage error: ",m.error]})]})},Pt=({isAuthenticated:c})=>{const[b,a]=u.useState([]),[n,h]=u.useState("dark-default"),[s,i]=u.useState(!1),[j,f]=u.useState(!1),[P,x]=u.useState(null),[N,S]=u.useState(null),[p,m]=u.useState(null),[B,I]=u.useState(!1),[q,_]=u.useState(!1),[v,F]=u.useState(null),[D,R]=u.useState(["core","backgrounds","navigation"]),[k,d]=u.useState(null),[l,C]=u.useState({}),[o,$]=u.useState({}),[g,M]=u.useState({name:"",description:"",author:"",version:"1.0.0",isDark:!0,primaryColor:"#3b82f6",secondaryColor:"#8b5cf6",accentColor:"#06b6d4",bgPrimary:"#111827",bgSecondary:"#1f2937",bgTertiary:"#374151",bgHover:"#4b5563",textPrimary:"#ffffff",textSecondary:"#d1d5db",textMuted:"#9ca3af",textAccent:"#60a5fa",dragHandleColor:"#6b7280",dragHandleHover:"#60a5fa",borderPrimary:"#374151",borderSecondary:"#4b5563",borderFocus:"#3b82f6",navBg:"#1f2937",navBorder:"#374151",navTabActive:"#3b82f6",navTabInactive:"#9ca3af",navTabHover:"#ffffff",navTabActiveBorder:"#3b82f6",navMobileMenuBg:"#1f2937",navMobileItemHover:"#374151",success:"#10b981",successBg:"#064e3b",successText:"#34d399",warning:"#f59e0b",warningBg:"#78350f",warningText:"#fbbf24",error:"#ef4444",errorBg:"#7f1d1d",errorText:"#fca5a5",info:"#3b82f6",infoBg:"#1e3a8a",infoText:"#93c5fd",steamColor:"#1e40af",epicColor:"#7c3aed",originColor:"#ea580c",blizzardColor:"#0891b2",wsusColor:"#16a34a",riotColor:"#dc2626",cardBg:"#1f2937",cardBorder:"#374151",buttonBg:"#3b82f6",buttonHover:"#2563eb",buttonText:"#ffffff",inputBg:"#374151",inputBorder:"#4b5563",inputFocus:"#3b82f6",badgeBg:"#3b82f6",badgeText:"#ffffff",progressBar:"#3b82f6",progressBg:"#374151",iconBgBlue:"#3b82f6",iconBgGreen:"#10b981",iconBgEmerald:"#10b981",iconBgPurple:"#8b5cf6",iconBgIndigo:"#6366f1",iconBgOrange:"#f97316",iconBgYellow:"#eab308",iconBgCyan:"#06b6d4",iconBgRed:"#ef4444",chartColor1:"#3b82f6",chartColor2:"#10b981",chartColor3:"#f59e0b",chartColor4:"#ef4444",chartColor5:"#8b5cf6",chartColor6:"#06b6d4",chartColor7:"#f97316",chartColor8:"#ec4899",chartBorderColor:"#1f2937",chartGridColor:"#374151",chartTextColor:"#9ca3af",chartCacheHitColor:"#10b981",chartCacheMissColor:"#f59e0b",scrollbarTrack:"#374151",scrollbarThumb:"#6B7280",scrollbarHover:"#9CA3AF",customCSS:""}),G=u.useRef(null),E=[{name:"core",icon:Ne,description:"Main theme colors used throughout the interface",colors:[{key:"primaryColor",label:"Primary Color",description:"Main brand color",affects:["Buttons","Links","Active states","Focus rings"]},{key:"secondaryColor",label:"Secondary Color",description:"Complementary accent color",affects:["Secondary buttons","Highlights","Purple text elements"]},{key:"accentColor",label:"Accent Color",description:"Additional accent for special elements",affects:["Special badges","Tooltips","Notifications"]}]},{name:"backgrounds",icon:fe,description:"Background colors for different UI layers",colors:[{key:"bgPrimary",label:"Primary Background",description:"Main app background",affects:["Body background","Main container"]},{key:"bgSecondary",label:"Secondary Background",description:"Card and panel backgrounds",affects:["Cards","Panels","Modals"]},{key:"bgTertiary",label:"Tertiary Background",description:"Input and nested element backgrounds",affects:["Input fields","Dropdown menus","Code blocks"]},{key:"bgHover",label:"Hover Background",description:"Background for hover states",affects:["Button hovers","List item hovers","Menu item hovers"]}]},{name:"text",icon:mt,description:"Text colors for different content hierarchies",colors:[{key:"textPrimary",label:"Primary Text",description:"Main text color",affects:["Headings","Body text","Labels"]},{key:"textSecondary",label:"Secondary Text",description:"Less prominent text",affects:["Descriptions","Subtitles","Help text"]},{key:"textMuted",label:"Muted Text",description:"Disabled or placeholder text",affects:["Placeholders","Disabled labels","Timestamps"]},{key:"textAccent",label:"Accent Text",description:"Highlighted or linked text",affects:["Links","Highlighted values","Active menu items"]},{key:"dragHandleColor",label:"Drag Handle",description:"Color for drag/reorder indicators",affects:["Drag grips","Reorder handles"]},{key:"dragHandleHover",label:"Drag Handle Hover",description:"Color when hovering over drag handles",affects:["Drag grip hover state","Active dragging"]}]},{name:"borders",icon:ut,description:"Border colors for separators and outlines",colors:[{key:"borderPrimary",label:"Primary Border",description:"Main border color",affects:["Card borders","Dividers","Table borders"]},{key:"borderSecondary",label:"Secondary Border",description:"Subtle borders",affects:["Input borders","Section dividers"]},{key:"borderFocus",label:"Focus Border",description:"Border color for focused elements",affects:["Focused inputs","Active tabs","Selected items"]}]},{name:"navigation",icon:fe,description:"Colors specifically for navigation elements",colors:[{key:"navBg",label:"Navigation Background",description:"Main navigation background color",affects:["Header navigation","Navigation bar","Menu background"]},{key:"navBorder",label:"Navigation Border",description:"Navigation border and separator color",affects:["Navigation borders","Header border","Menu separators"]},{key:"navTabActive",label:"Active Tab Color",description:"Color for active navigation tabs",affects:["Active tab text","Current page indicator"]},{key:"navTabInactive",label:"Inactive Tab Color",description:"Color for inactive navigation tabs",affects:["Inactive tab text","Unselected menu items"]},{key:"navTabHover",label:"Tab Hover Color",description:"Color when hovering over navigation tabs",affects:["Tab hover text","Menu item hover text"]},{key:"navTabActiveBorder",label:"Active Tab Border",description:"Border color for active navigation tabs",affects:["Active tab underline","Current page border"]},{key:"navMobileMenuBg",label:"Mobile Menu Background",description:"Background for mobile navigation menu",affects:["Mobile menu background","Dropdown menu background"]},{key:"navMobileItemHover",label:"Mobile Item Hover",description:"Hover color for mobile navigation items",affects:["Mobile menu item hover","Dropdown item hover"]}]},{name:"status",icon:te,description:"Colors for status indicators and alerts",colors:[{key:"success",label:"Success",description:"Success state color",affects:["Success buttons","Progress bars","Online status"]},{key:"successBg",label:"Success Background",description:"Background for success elements",affects:["Success alerts","Success badges"]},{key:"successText",label:"Success Text",description:"Text color for success states",affects:["Success messages","Positive values"]},{key:"warning",label:"Warning",description:"Warning state color",affects:["Warning buttons","Caution indicators"]},{key:"warningBg",label:"Warning Background",description:"Background for warning elements",affects:["Warning alerts","Warning badges"]},{key:"warningText",label:"Warning Text",description:"Text color for warning states",affects:["Warning messages","Caution text"]},{key:"error",label:"Error",description:"Error state color",affects:["Error buttons","Delete actions","Offline status"]},{key:"errorBg",label:"Error Background",description:"Background for error elements",affects:["Error alerts","Error badges"]},{key:"errorText",label:"Error Text",description:"Text color for error states",affects:["Error messages","Validation errors"]},{key:"info",label:"Info",description:"Informational state color",affects:["Info buttons","Info indicators"]},{key:"infoBg",label:"Info Background",description:"Background for info elements",affects:["Info alerts","Info badges"]},{key:"infoText",label:"Info Text",description:"Text color for info states",affects:["Info messages","Help content"]}]},{name:"services",icon:ht,description:"Colors for different gaming services",colors:[{key:"steamColor",label:"Steam",description:"Steam service color",affects:["Steam badges","Steam charts","Steam stats"]},{key:"epicColor",label:"Epic Games",description:"Epic Games service color",affects:["Epic badges","Epic charts","Epic stats"]},{key:"originColor",label:"Origin/EA",description:"Origin/EA service color",affects:["Origin badges","Origin charts","Origin stats"]},{key:"blizzardColor",label:"Blizzard",description:"Blizzard service color",affects:["Blizzard badges","Blizzard charts","Blizzard stats"]},{key:"wsusColor",label:"Windows Update",description:"Windows Update service color",affects:["WSUS badges","WSUS charts","WSUS stats"]},{key:"riotColor",label:"Riot Games",description:"Riot Games service color",affects:["Riot badges","Riot charts","Riot stats"]}]},{name:"components",icon:ft,description:"Specific colors for UI components",colors:[{key:"cardBg",label:"Card Background",description:"Background for card components",affects:["Stat cards","Content cards","List items"]},{key:"cardBorder",label:"Card Border",description:"Border for card components",affects:["Card outlines","Panel borders"]},{key:"buttonBg",label:"Button Background",description:"Primary button background",affects:["Primary buttons","CTAs"]},{key:"buttonHover",label:"Button Hover",description:"Button hover state",affects:["Button hover effects"]},{key:"buttonText",label:"Button Text",description:"Button text color",affects:["Button labels"]},{key:"inputBg",label:"Input Background",description:"Form input background",affects:["Text inputs","Selects","Textareas"]},{key:"inputBorder",label:"Input Border",description:"Form input border",affects:["Input outlines"]},{key:"inputFocus",label:"Input Focus",description:"Focused input border",affects:["Active input borders"]},{key:"badgeBg",label:"Badge Background",description:"Badge background color",affects:["Status badges","Tags","Pills"]},{key:"badgeText",label:"Badge Text",description:"Badge text color",affects:["Badge labels"]},{key:"progressBar",label:"Progress Bar",description:"Progress indicator color",affects:["Progress bars","Loading bars"]},{key:"progressBg",label:"Progress Background",description:"Progress bar background",affects:["Progress track"]}]},{name:"icons",icon:gt,description:"Solid background colors for icon containers (no gradients)",colors:[{key:"iconBgBlue",label:"Blue Icon Background",description:"Blue icon container background",affects:["Database icons","Info icons"]},{key:"iconBgGreen",label:"Green Icon Background",description:"Green icon container background",affects:["Success icons","Online status"]},{key:"iconBgEmerald",label:"Emerald Icon Background",description:"Emerald icon container background",affects:["Trending icons","Growth indicators"]},{key:"iconBgPurple",label:"Purple Icon Background",description:"Purple icon container background",affects:["Special features","Premium indicators"]},{key:"iconBgIndigo",label:"Indigo Icon Background",description:"Indigo icon container background",affects:["Server icons","System indicators"]},{key:"iconBgOrange",label:"Orange Icon Background",description:"Orange icon container background",affects:["Download icons","Activity indicators"]},{key:"iconBgYellow",label:"Yellow Icon Background",description:"Yellow icon container background",affects:["Warning icons","Client indicators"]},{key:"iconBgCyan",label:"Cyan Icon Background",description:"Cyan icon container background",affects:["Activity icons","Performance indicators"]},{key:"iconBgRed",label:"Red Icon Background",description:"Red icon container background",affects:["Error icons","Critical indicators"]}]},{name:"scrollbar",icon:fe,description:"Scrollbar appearance customization",colors:[{key:"scrollbarTrack",label:"Scrollbar Track",description:"Background track for scrollbars",affects:["All scrollbar tracks","Scrollbar corners"]},{key:"scrollbarThumb",label:"Scrollbar Thumb",description:"Scrollbar draggable thumb",affects:["Scrollbar handle","Firefox scrollbar color"]},{key:"scrollbarHover",label:"Scrollbar Hover",description:"Scrollbar thumb on hover",affects:["Hover state of scrollbar thumb"]}]},{name:"charts",icon:Ee,description:"Colors for data visualization and charts",colors:[{key:"chartColor1",label:"Chart Color 1",description:"Primary chart data color",affects:["First data series","Primary pie/donut slice"]},{key:"chartColor2",label:"Chart Color 2",description:"Secondary chart data color",affects:["Second data series","Secondary pie/donut slice"]},{key:"chartColor3",label:"Chart Color 3",description:"Tertiary chart data color",affects:["Third data series","Third pie/donut slice"]},{key:"chartColor4",label:"Chart Color 4",description:"Quaternary chart data color",affects:["Fourth data series","Fourth pie/donut slice"]},{key:"chartColor5",label:"Chart Color 5",description:"Fifth chart data color",affects:["Fifth data series","Fifth pie/donut slice"]},{key:"chartColor6",label:"Chart Color 6",description:"Sixth chart data color",affects:["Sixth data series","Sixth pie/donut slice"]},{key:"chartColor7",label:"Chart Color 7",description:"Seventh chart data color",affects:["Seventh data series","Seventh pie/donut slice"]},{key:"chartColor8",label:"Chart Color 8",description:"Eighth chart data color",affects:["Eighth data series","Eighth pie/donut slice"]},{key:"chartBorderColor",label:"Chart Border Color",description:"Border color between chart segments",affects:["Donut/pie borders","Bar borders"]},{key:"chartGridColor",label:"Chart Grid Color",description:"Grid lines and axes color",affects:["Grid lines","Axes","Tick marks"]},{key:"chartTextColor",label:"Chart Text Color",description:"Chart labels and legend text",affects:["Axis labels","Legend text","Data labels"]},{key:"chartCacheHitColor",label:"Cache Hit Color",description:"Color for cache hit data in charts",affects:["Cache hit ratio chart","Hit indicators"]},{key:"chartCacheMissColor",label:"Cache Miss Color",description:"Color for cache miss data in charts",affects:["Cache miss ratio chart","Miss indicators"]}]}];u.useEffect(()=>{ae();const t=z.getCurrentThemeId();h(t),console.log("=== Color History in localStorage ==="),Object.keys(localStorage).forEach(r=>{r.startsWith("color_history_")&&console.log(`${r}: ${localStorage.getItem(r)}`)}),console.log("=====================================")},[]);const ae=async()=>{i(!0);try{const t=await z.loadThemes();a(t)}catch(t){console.error("Failed to load themes:",t),x("Failed to load themes")}finally{i(!1)}},J=async t=>{try{if(!t){z.clearTheme(),h(""),m(null);return}const r=await z.getTheme(t);r&&(z.applyTheme(r),h(t),m(null))}catch(r){console.error("Failed to apply theme:",r),x("Failed to apply theme")}},ze=async t=>{if(p===t)J(n),m(null);else try{const r=await z.getTheme(t);r&&(z.applyTheme(r),m(t))}catch(r){console.error("Failed to preview theme:",r)}},pe=t=>{R(r=>r.includes(t)?r.filter(w=>w!==t):[...r,t])},[Ue,ie]=u.useState({}),de=t=>{if(!Ue[t]){const r=g[t];r&&(localStorage.setItem(`color_history_create_${t}`,r),console.log(`Saved original create color: ${t} = ${r}`)),ie(w=>({...w,[t]:!0}))}},be=(t,r)=>{M(w=>({...w,[t]:r}))},Ge=t=>{const r=localStorage.getItem(`color_history_create_${t}`);if(r){const w=g[t];M(y=>({...y,[t]:r})),localStorage.setItem(`color_history_create_${t}`,w)}},ye=t=>localStorage.getItem(`color_history_create_${t}`),me=t=>{if(!l[t]){const r=o[t];if(r&&r.match(/^#[0-9a-fA-F]{6}$/)){const w=`color_history_${v==null?void 0:v.meta.id}_${t}`;localStorage.setItem(w,r),console.log(`Saved original color to history: ${t} = ${r}`)}C(w=>({...w,[t]:!0}))}},ve=(t,r)=>{$(w=>({...w,[t]:r}))},qe=t=>{const r=`color_history_${v==null?void 0:v.meta.id}_${t}`,w=localStorage.getItem(r);if(w){const y=o[t];console.log(`Restoring ${t}: ${y} -> ${w}`),$(T=>({...T,[t]:w})),localStorage.setItem(r,y||"")}},We=t=>{const r=`color_history_${v==null?void 0:v.meta.id}_${t}`,w=localStorage.getItem(r);return console.log(`getEditColorHistory: key=${t}, historyKey=${r}, value=${w}`),w},je=async t=>{try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(t);else{const r=document.createElement("textarea");r.value=t,r.style.position="fixed",r.style.left="-999999px",r.style.top="-999999px",document.body.appendChild(r),r.focus(),r.select(),document.execCommand("copy"),document.body.removeChild(r)}d(t),setTimeout(()=>d(null),2e3)}catch(r){console.error("Failed to copy color:",r)}},ue=t=>{t.preventDefault(),t.stopPropagation(),t.type==="dragenter"||t.type==="dragover"?f(!0):t.type==="dragleave"&&f(!1)},Ke=async t=>{t.preventDefault(),t.stopPropagation(),f(!1),t.dataTransfer.files&&t.dataTransfer.files[0]&&await Ce(t.dataTransfer.files[0])},Ce=async t=>{if(x(null),S(null),!t.name.endsWith(".toml")){x("Only TOML theme files are supported");return}if(t.size>1024*1024){x("Theme file too large (max 1MB)");return}i(!0);try{const r=await z.uploadTheme(t);await new Promise(y=>setTimeout(y,100));const w=await z.loadThemes();a(w),S(`Theme "${r.meta.name}" uploaded successfully`),setTimeout(()=>S(null),5e3)}catch(r){x(r.message)}finally{i(!1)}},Ye=async(t,r)=>{var y;if(["dark-default","light-default"].includes(t)){x("System themes cannot be deleted"),setTimeout(()=>x(null),5e3);return}if(!c){x("Authentication required to delete custom themes"),setTimeout(()=>x(null),5e3);return}if(window.confirm(`Delete theme "${r}"? This cannot be undone.`)){i(!0);try{const T=await fetch(`${Ie}/theme/${t}`,{method:"DELETE",headers:W.getAuthHeaders()}),A=await T.json();if(T.ok&&A.success){await ae(),n===t&&J("dark-default");const U=((y=A.filesDeleted)==null?void 0:y.join(", "))||"theme files";S(`Theme "${r}" deleted successfully (removed: ${U})`),setTimeout(()=>S(null),5e3)}else if(T.status===404)x(`Theme "${r}" not found on server. ${A.details||""}`),a(U=>U.filter(K=>K.meta.id!==t)),n===t&&J("dark-default"),A.availableThemes&&console.log("Available themes on server:",A.availableThemes),setTimeout(()=>x(null),1e4);else{const U=A.error||A.message||"Failed to delete theme",K=A.details?` Details: ${A.details}`:"";x(`${U}${K}`),setTimeout(()=>x(null),7e3)}}catch(T){console.error("Delete request failed:",T),x(`Failed to delete theme: ${T.message||"Network error"}`),setTimeout(()=>x(null),7e3)}finally{i(!1)}}},Je=async()=>{if(!c){x("Authentication required to clean up themes"),setTimeout(()=>x(null),5e3);return}if(window.confirm("This will DELETE all custom themes (keeping only system themes). This cannot be undone. Continue?")){i(!0);try{const t=await fetch(`${Ie}/theme/cleanup`,{method:"POST",headers:{"Content-Type":"application/json",...W.getAuthHeaders()}});if(!t.ok)throw new Error("Failed to cleanup themes");const r=await t.json();await ae(),b.map(y=>y.meta.id).includes(n)||J("dark-default"),S(r.message||"All custom themes have been deleted"),setTimeout(()=>S(null),5e3)}catch(t){x("Failed to cleanup themes: "+t.message),setTimeout(()=>x(null),5e3)}finally{i(!1)}}},Ve=t=>{var T;if(!c){x("Authentication required to edit themes"),setTimeout(()=>x(null),5e3);return}if(Q(t.meta.id)){x("System themes cannot be edited"),setTimeout(()=>x(null),5e3);return}const r=b.find(A=>A.meta.id===t.meta.id)||t;console.log("Editing theme:",r),console.log("Theme colors:",r.colors),C({}),F(r);const w={name:r.meta.name,description:r.meta.description||"",author:r.meta.author||"",version:r.meta.version||"1.0.0",isDark:r.meta.isDark!==!1,...r.colors,customCSS:((T=r.css)==null?void 0:T.content)||""};r.colors.dragHandleColor||(w.dragHandleColor=r.meta.isDark?"#6b7280":"#9ca3af"),r.colors.dragHandleHover||(w.dragHandleHover=r.meta.isDark?"#60a5fa":"#2563eb"),console.log("Theme data for editing:",w);const y=Object.keys(w).filter(A=>!["name","description","author","version","isDark","customCSS"].includes(A));console.log("Color keys and values in theme data:"),y.forEach(A=>{console.log(`  ${A}: ${w[A]}`)}),$(w),_(!0)},Qe=async()=>{if(!c||!v)return;if(!o.name.trim()){x("Theme name is required"),setTimeout(()=>x(null),5e3);return}console.log("Saving theme with colors:",o);const t={};Object.entries(o).forEach(([A,U])=>{["name","description","author","version","isDark","customCSS"].includes(A)||(t[A]=U)});const r={meta:{id:v.meta.id,name:o.name,description:o.description,author:o.author,version:o.version,isDark:o.isDark},colors:t,css:o.customCSS?{content:o.customCSS}:void 0};console.log("Theme object to save:",r);const w=z.exportTheme(r),y=new Blob([w],{type:"text/plain"}),T=new File([y],`${r.meta.id}.toml`,{type:"text/plain"});i(!0);try{await z.uploadTheme(T),await new Promise(K=>setTimeout(K,100));const A=await z.loadThemes();a(A);const U=A.find(K=>K.meta.id===r.meta.id);if(U)n===v.meta.id&&z.applyTheme(U),S(`Theme "${U.meta.name}" updated successfully`);else throw new Error("Theme was uploaded but not found on server");Object.keys(o).forEach(K=>{const tt=`color_history_${v.meta.id}_${K}`;localStorage.removeItem(tt)}),C({}),_(!1),F(null),$({}),setTimeout(()=>S(null),5e3)}catch(A){x(A.message||"Failed to update theme"),i(!1);return}i(!1)},Xe=async()=>{if(!c){x("Authentication required to create themes");return}if(!g.name.trim()){x("Theme name is required"),setTimeout(()=>x(null),5e3);return}const t={meta:{id:g.name.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""),name:g.name,description:g.description,author:g.author,version:g.version,isDark:g.isDark},colors:{...g},css:g.customCSS?{content:g.customCSS}:void 0};delete t.colors.name,delete t.colors.description,delete t.colors.author,delete t.colors.version,delete t.colors.isDark,delete t.colors.customCSS;const r=z.exportTheme(t),w=new Blob([r],{type:"text/plain"}),y=new File([w],`${t.meta.id}.toml`,{type:"text/plain"});i(!0);try{await z.uploadTheme(y),await new Promise(U=>setTimeout(U,100));const T=await z.loadThemes();a(T);const A=T.find(U=>U.meta.id===t.meta.id);A&&(z.applyTheme(A),h(A.meta.id)),I(!1),Object.keys(g).forEach(U=>{localStorage.removeItem(`color_history_create_${U}`)}),ie({}),M({name:"",description:"",author:"",version:"1.0.0",isDark:!0,primaryColor:"#3b82f6",secondaryColor:"#8b5cf6",accentColor:"#06b6d4",bgPrimary:"#111827",bgSecondary:"#1f2937",bgTertiary:"#374151",bgHover:"#4b5563",textPrimary:"#ffffff",textSecondary:"#d1d5db",textMuted:"#9ca3af",textAccent:"#60a5fa",dragHandleColor:"#6b7280",dragHandleHover:"#60a5fa",borderPrimary:"#374151",borderSecondary:"#4b5563",borderFocus:"#3b82f6",navBg:"#1f2937",navBorder:"#374151",navTabActive:"#3b82f6",navTabInactive:"#9ca3af",navTabHover:"#ffffff",navTabActiveBorder:"#3b82f6",navMobileMenuBg:"#1f2937",navMobileItemHover:"#374151",success:"#10b981",successBg:"#064e3b",successText:"#34d399",warning:"#f59e0b",warningBg:"#78350f",warningText:"#fbbf24",error:"#ef4444",errorBg:"#7f1d1d",errorText:"#fca5a5",info:"#3b82f6",infoBg:"#1e3a8a",infoText:"#93c5fd",steamColor:"#1e40af",epicColor:"#7c3aed",originColor:"#ea580c",blizzardColor:"#0891b2",wsusColor:"#16a34a",riotColor:"#dc2626",cardBg:"#1f2937",cardBorder:"#374151",buttonBg:"#3b82f6",buttonHover:"#2563eb",buttonText:"#ffffff",inputBg:"#374151",inputBorder:"#4b5563",inputFocus:"#3b82f6",badgeBg:"#3b82f6",badgeText:"#ffffff",progressBar:"#3b82f6",progressBg:"#374151",iconBgBlue:"#3b82f6",iconBgGreen:"#10b981",iconBgEmerald:"#10b981",iconBgPurple:"#8b5cf6",iconBgIndigo:"#6366f1",iconBgOrange:"#f97316",iconBgYellow:"#eab308",iconBgCyan:"#06b6d4",iconBgRed:"#ef4444",chartColor1:"#3b82f6",chartColor2:"#10b981",chartColor3:"#f59e0b",chartColor4:"#ef4444",chartColor5:"#8b5cf6",chartColor6:"#06b6d4",chartColor7:"#f97316",chartColor8:"#ec4899",chartBorderColor:"#1f2937",chartGridColor:"#374151",chartTextColor:"#9ca3af",chartCacheHitColor:"#10b981",chartCacheMissColor:"#f59e0b",scrollbarTrack:"#374151",scrollbarThumb:"#6B7280",scrollbarHover:"#9CA3AF",customCSS:""}),S(`Theme "${t.meta.name}" created successfully`),setTimeout(()=>S(null),5e3)}catch(T){x(T.message||"Failed to create theme")}finally{i(!1)}},we=t=>{M(t==="dark"?r=>({...r,isDark:!0,bgPrimary:"#111827",bgSecondary:"#1f2937",bgTertiary:"#374151",bgHover:"#4b5563",textPrimary:"#ffffff",textSecondary:"#d1d5db",textMuted:"#9ca3af",dragHandleColor:"#6b7280",dragHandleHover:"#00ff00",borderPrimary:"#374151",borderSecondary:"#4b5563",navBg:"#1f2937",navBorder:"#374151",navTabActive:"#3b82f6",navTabInactive:"#9ca3af",navTabHover:"#ffffff",navTabActiveBorder:"#3b82f6",navMobileMenuBg:"#1f2937",navMobileItemHover:"#374151",cardBg:"#1f2937",cardBorder:"#374151",inputBg:"#374151",inputBorder:"#4b5563",progressBg:"#374151",successBg:"#064e3b",successText:"#34d399",warningBg:"#78350f",warningText:"#fbbf24",errorBg:"#7f1d1d",errorText:"#fca5a5",infoBg:"#1e3a8a",infoText:"#93c5fd",chartBorderColor:"#1f2937",chartGridColor:"#374151",chartTextColor:"#9ca3af",scrollbarTrack:"#374151",scrollbarThumb:"#6B7280",scrollbarHover:"#9CA3AF"}):r=>({...r,isDark:!1,bgPrimary:"#ffffff",bgSecondary:"#f9fafb",bgTertiary:"#f3f4f6",bgHover:"#e5e7eb",textPrimary:"#111827",textSecondary:"#374151",textMuted:"#6b7280",dragHandleColor:"#9ca3af",dragHandleHover:"#2563eb",borderPrimary:"#e5e7eb",borderSecondary:"#d1d5db",navBg:"#f9fafb",navBorder:"#e5e7eb",navTabActive:"#3b82f6",navTabInactive:"#6b7280",navTabHover:"#111827",navTabActiveBorder:"#3b82f6",navMobileMenuBg:"#f9fafb",navMobileItemHover:"#e5e7eb",cardBg:"#ffffff",cardBorder:"#e5e7eb",inputBg:"#ffffff",inputBorder:"#d1d5db",progressBg:"#e5e7eb",successBg:"#d1fae5",successText:"#065f46",warningBg:"#fef3c7",warningText:"#92400e",errorBg:"#fee2e2",errorText:"#991b1b",infoBg:"#dbeafe",infoText:"#1e40af",chartBorderColor:"#e5e7eb",chartGridColor:"#d1d5db",chartTextColor:"#6b7280",scrollbarTrack:"#f3f4f6",scrollbarThumb:"#9ca3af",scrollbarHover:"#6b7280"}))},Ze=t=>{const r=z.exportTheme(t),w=new Blob([r],{type:"text/plain"}),y=URL.createObjectURL(w),T=document.createElement("a");T.href=y,T.download=`${t.meta.id}.toml`,T.click(),URL.revokeObjectURL(y)},et=()=>{const t=`# Sample Theme for LANCache Manager
[meta]
name = "My Custom Theme"
id = "my-custom-theme"
description = "A beautiful custom theme"
author = "Your Name"
version = "1.0.0"
isDark = true

[colors]
# Core colors
primaryColor = "#3b82f6"
secondaryColor = "#8b5cf6"
accentColor = "#06b6d4"

# Backgrounds
bgPrimary = "#111827"
bgSecondary = "#1f2937"
bgTertiary = "#374151"
bgHover = "#4b5563"

# Text
textPrimary = "#ffffff"
textSecondary = "#d1d5db"
textMuted = "#9ca3af"
textAccent = "#60a5fa"
dragHandleColor = "#6b7280"
dragHandleHover = "#60a5fa"

# Borders
borderPrimary = "#374151"
borderSecondary = "#4b5563"
borderFocus = "#3b82f6"

# Navigation colors
navBg = "#1f2937"
navBorder = "#374151"
navTabActive = "#3b82f6"
navTabInactive = "#9ca3af"
navTabHover = "#ffffff"
navTabActiveBorder = "#3b82f6"
navMobileMenuBg = "#1f2937"
navMobileItemHover = "#374151"

# Hit Rate & Status Badge colors
hitRateHighBg = "#064e3b"
hitRateHighText = "#34d399"
hitRateMediumBg = "#1e3a8a"
hitRateMediumText = "#93c5fd"
hitRateLowBg = "#ea580c"
hitRateLowText = "#fb923c"
statusWarningBg = "#78350f"
statusWarningText = "#fbbf24"

# Action Button colors
actionResetBg = "#f59e0b"
actionResetHover = "#d97706"
actionProcessBg = "#10b981"
actionProcessHover = "#059669"
actionDeleteBg = "#ef4444"
actionDeleteHover = "#dc2626"

# Status colors
success = "#10b981"
successBg = "#064e3b"
successText = "#34d399"
warning = "#f59e0b"
warningBg = "#78350f"
warningText = "#fbbf24"
error = "#ef4444"
errorBg = "#7f1d1d"
errorText = "#fca5a5"
info = "#3b82f6"
infoBg = "#1e3a8a"
infoText = "#93c5fd"

# Service colors
steamColor = "#1e40af"
epicColor = "#7c3aed"
originColor = "#ea580c"
blizzardColor = "#0891b2"
wsusColor = "#16a34a"
riotColor = "#dc2626"

# Components
cardBg = "#1f2937"
cardBorder = "#374151"
buttonBg = "#3b82f6"
buttonHover = "#2563eb"
buttonText = "#ffffff"
inputBg = "#374151"
inputBorder = "#4b5563"
inputFocus = "#3b82f6"
badgeBg = "#3b82f6"
badgeText = "#ffffff"
progressBar = "#3b82f6"
progressBg = "#374151"

# Icon backgrounds (solid colors, no gradients)
iconBgBlue = "#3b82f6"
iconBgGreen = "#10b981"
iconBgEmerald = "#10b981"
iconBgPurple = "#8b5cf6"
iconBgIndigo = "#6366f1"
iconBgOrange = "#f97316"
iconBgYellow = "#eab308"
iconBgCyan = "#06b6d4"
iconBgRed = "#ef4444"

# Chart colors
chartColor1 = "#3b82f6"
chartColor2 = "#10b981"
chartColor3 = "#f59e0b"
chartColor4 = "#ef4444"
chartColor5 = "#8b5cf6"
chartColor6 = "#06b6d4"
chartColor7 = "#f97316"
chartColor8 = "#ec4899"
chartBorderColor = "#1f2937"
chartGridColor = "#374151"
chartTextColor = "#9ca3af"
chartCacheHitColor = "#10b981"
chartCacheMissColor = "#f59e0b"

[css]
content = """
/* Add any custom CSS here */
"""`,r=new Blob([t],{type:"text/plain"}),w=URL.createObjectURL(r),y=document.createElement("a");y.href=w,y.download="sample-theme.toml",y.click(),URL.revokeObjectURL(w)},Q=t=>["dark-default","light-default"].includes(t);return e.jsxs(e.Fragment,{children:[e.jsxs(Y,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ne,{className:"w-5 h-5 text-themed-accent"}),e.jsx("h3",{className:"text-lg font-semibold text-themed-primary",children:"Theme Management"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[c?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>I(!0),className:"p-2 rounded-lg transition-colors",style:{color:"var(--theme-text-muted)",backgroundColor:"transparent"},onMouseEnter:t=>t.currentTarget.style.backgroundColor="var(--theme-bg-hover)",onMouseLeave:t=>t.currentTarget.style.backgroundColor="transparent",title:"Create new theme",children:e.jsx(lt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:Je,disabled:s,className:"p-2 rounded-lg transition-colors",style:{color:"var(--theme-text-muted)",backgroundColor:"transparent"},onMouseEnter:t=>t.currentTarget.style.backgroundColor="var(--theme-bg-hover)",onMouseLeave:t=>t.currentTarget.style.backgroundColor="transparent",title:"Delete all custom themes",children:e.jsx(ct,{className:"w-4 h-4"})})]}):e.jsx("button",{disabled:!0,className:"p-2 rounded-lg transition-colors opacity-50 cursor-not-allowed",style:{color:"var(--theme-text-muted)",backgroundColor:"transparent"},title:"Authentication required to create themes",children:e.jsx(re,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ae(),disabled:s,className:"p-2 rounded-lg transition-colors",style:{color:"var(--theme-text-muted)",backgroundColor:"transparent"},onMouseEnter:t=>t.currentTarget.style.backgroundColor="var(--theme-bg-hover)",onMouseLeave:t=>t.currentTarget.style.backgroundColor="transparent",title:"Refresh themes",children:e.jsx(Re,{className:`w-4 h-4 ${s?"animate-spin":""}`})})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-themed-secondary",children:"Active Theme"}),e.jsx("select",{value:p||n,onChange:t=>J(t.target.value),className:"w-full px-3 py-2 focus:outline-none themed-input",disabled:s,children:b.map(t=>e.jsxs("option",{value:t.meta.id,children:[t.meta.name," ",t.meta.author&&t.meta.author!=="System"&&`by ${t.meta.author}`,Q(t.meta.id)&&" (System)",p===t.meta.id&&" (Preview)"]},t.meta.id))}),p&&e.jsx("p",{className:"text-xs mt-2 text-themed-warning",children:"Preview mode active. Select a theme to apply it permanently."})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("h4",{className:"text-sm font-medium mb-3 text-themed-secondary",children:["Installed Themes (",b.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:b.map(t=>e.jsxs("div",{className:"rounded p-3 flex items-center justify-between border-2 transition-colors themed-card",style:{borderColor:n===t.meta.id&&!p?"var(--theme-primary)":p===t.meta.id?"var(--theme-warning)":"transparent"},children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-themed-primary",children:t.meta.name}),t.meta.isDark?e.jsx(Te,{className:"w-3 h-3 text-themed-muted"}):e.jsx(Se,{className:"w-3 h-3 text-themed-warning"}),n===t.meta.id&&!p&&e.jsx("span",{className:"px-2 py-0.5 text-xs rounded themed-button-primary",children:"Active"}),p===t.meta.id&&e.jsx("span",{className:"px-2 py-0.5 text-xs rounded bg-themed-warning text-themed-primary",children:"Preview"}),Q(t.meta.id)&&e.jsx("span",{className:"px-2 py-0.5 text-xs rounded bg-themed-hover text-themed-muted",children:"System"})]}),t.meta.description&&e.jsx("p",{className:"text-xs mt-1 text-themed-muted",children:t.meta.description}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[t.meta.author&&e.jsxs("p",{className:"text-xs text-themed-muted",children:["by ",t.meta.author]}),t.meta.version&&e.jsxs("p",{className:"text-xs text-themed-muted",children:["v",t.meta.version]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>Ze(t),className:"p-2 transition-colors text-themed-muted",title:"Export theme",children:e.jsx(oe,{className:"w-4 h-4"})}),n!==t.meta.id&&e.jsx("button",{onClick:()=>ze(t.meta.id),className:"p-2 transition-colors",style:{color:p===t.meta.id?"var(--theme-warning)":"var(--theme-text-muted)"},title:p===t.meta.id?"Stop preview":"Preview theme",children:p===t.meta.id?e.jsx(nt,{className:"w-4 h-4"}):e.jsx(Oe,{className:"w-4 h-4"})}),n!==t.meta.id&&e.jsx("button",{onClick:()=>J(t.meta.id),className:"p-2 transition-colors text-themed-accent",title:"Apply theme",children:e.jsx(he,{className:"w-4 h-4"})}),!Q(t.meta.id)&&c&&e.jsx("button",{onClick:()=>Ve(t),disabled:s,className:"p-2 transition-colors text-themed-secondary",title:"Edit theme",children:e.jsx(it,{className:"w-4 h-4"})}),!Q(t.meta.id)&&c&&e.jsx("button",{onClick:()=>Ye(t.meta.id,t.meta.name),disabled:s,className:"p-2 transition-colors disabled:opacity-50 text-themed-error",title:"Delete theme",children:e.jsx(He,{className:"w-4 h-4"})})]})]},t.meta.id))})]}),c&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-sm font-medium mb-3 text-themed-secondary",children:"Upload Custom Theme"}),e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${j?"border-purple-500 bg-purple-900 bg-opacity-20":""}`,style:{borderColor:j?"var(--theme-secondary)":"var(--theme-border-secondary)"},onDragEnter:ue,onDragLeave:ue,onDragOver:ue,onDrop:Ke,children:[e.jsx(dt,{className:"w-12 h-12 mx-auto mb-3 text-themed-muted"}),e.jsx("p",{className:"mb-2 text-themed-secondary",children:"Drag and drop a theme file here, or click to browse"}),e.jsx("p",{className:"text-xs mb-3 text-themed-muted",children:"TOML format, max 1MB"}),e.jsx("input",{ref:G,type:"file",accept:".toml",onChange:t=>{var r;return((r=t.target.files)==null?void 0:r[0])&&Ce(t.target.files[0])},className:"hidden"}),e.jsx(H,{variant:"filled",color:"purple",onClick:()=>{var t;return(t=G.current)==null?void 0:t.click()},disabled:s,loading:s,children:"Browse Files"})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(H,{variant:"subtle",leftSection:e.jsx(oe,{className:"w-4 h-4"}),onClick:et,children:"Download Sample TOML Theme"})})]}),!c&&e.jsx(O,{color:"yellow",children:"Authentication required to create, upload, or delete custom themes"}),P&&e.jsx(O,{color:"red",withCloseButton:!0,onClose:()=>x(null),children:P}),N&&e.jsx(O,{color:"green",withCloseButton:!0,onClose:()=>S(null),children:N})]}),e.jsx(ne,{opened:B,onClose:()=>{I(!1),ie({})},title:"Create Custom Theme",size:"xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-sm font-semibold flex items-center gap-2 text-themed-primary",children:[e.jsx(Be,{className:"w-4 h-4"}),"Theme Information"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Theme Name *"}),e.jsx("input",{type:"text",value:g.name,onChange:t=>M({...g,name:t.target.value}),placeholder:"My Custom Theme",className:"w-full px-3 py-2 focus:outline-none themed-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Author"}),e.jsx("input",{type:"text",value:g.author,onChange:t=>M({...g,author:t.target.value}),placeholder:"Your Name",className:"w-full px-3 py-2 focus:outline-none themed-input"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Description"}),e.jsx("input",{type:"text",value:g.description,onChange:t=>M({...g,description:t.target.value}),placeholder:"A beautiful custom theme",className:"w-full px-3 py-2 rounded focus:outline-none themed-input"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:g.isDark,onChange:t=>M({...g,isDark:t.target.checked}),className:"rounded"}),e.jsx("span",{className:"text-sm text-themed-secondary",children:"Dark Theme"})]}),e.jsxs("button",{onClick:()=>we("dark"),className:"px-3 py-1 text-xs rounded-lg flex items-center gap-1 bg-themed-tertiary text-themed-secondary",children:[e.jsx(Te,{className:"w-3 h-3"}),"Load Dark Preset"]}),e.jsxs("button",{onClick:()=>we("light"),className:"px-3 py-1 text-xs rounded-lg flex items-center gap-1 bg-themed-tertiary text-themed-secondary",children:[e.jsx(Se,{className:"w-3 h-3"}),"Load Light Preset"]})]})]}),e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:E.map(t=>{const r=t.icon,w=D.includes(t.name);return e.jsxs("div",{className:"border border-themed-secondary rounded-lg",children:[e.jsxs("button",{onClick:()=>pe(t.name),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-opacity-50",style:{backgroundColor:w?"var(--theme-bg-tertiary)":"transparent"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(r,{className:"w-4 h-4 text-themed-accent"}),e.jsxs("div",{className:"text-left",children:[e.jsx("h5",{className:"text-sm font-semibold capitalize text-themed-primary",children:t.name.replace(/([A-Z])/g," $1").trim()}),e.jsx("p",{className:"text-xs text-themed-muted",children:t.description})]})]}),w?e.jsx(Pe,{className:"w-4 h-4"}):e.jsx($e,{className:"w-4 h-4"})]}),w&&e.jsx("div",{className:"p-4 border-t border-themed-secondary space-y-4",children:t.colors.map(y=>e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-themed-primary",children:y.label}),e.jsx("p",{className:"text-xs text-themed-muted",children:y.description}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:y.affects.map((T,A)=>e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded",style:{backgroundColor:"var(--theme-bg-hover)",color:"var(--theme-text-secondary)"},children:T},A))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"relative",children:e.jsx("input",{type:"color",value:g[y.key],onMouseDown:()=>de(y.key),onFocus:()=>de(y.key),onChange:T=>be(y.key,T.target.value),className:"w-12 h-8 rounded cursor-pointer",style:{backgroundColor:g[y.key]}})}),e.jsx("input",{type:"text",value:g[y.key],onFocus:()=>de(y.key),onChange:T=>be(y.key,T.target.value),className:"w-24 px-2 py-1 text-xs rounded font-mono themed-input"}),e.jsx("button",{onClick:()=>je(g[y.key]),className:"p-1 rounded-lg hover:bg-opacity-50 bg-themed-hover",title:"Copy color",children:k===g[y.key]?e.jsx(he,{className:"w-3 h-3",style:{color:"var(--theme-success)"}}):e.jsx(le,{className:"w-3 h-3 text-themed-muted"})}),ye(y.key)&&e.jsx("button",{onClick:()=>Ge(y.key),className:"p-1 rounded-lg hover:bg-opacity-50 bg-themed-hover",title:`Restore previous color: ${ye(y.key)}`,children:e.jsx(Me,{className:"w-3 h-3 text-themed-muted"})})]})]})},y.key))})]},t.name)})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Custom CSS (Optional)"}),e.jsx("textarea",{value:g.customCSS,onChange:t=>M({...g,customCSS:t.target.value}),placeholder:"/* Add any custom CSS here */",rows:4,className:"w-full px-3 py-2 rounded font-mono text-xs focus:outline-none themed-input"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",style:{borderColor:"var(--theme-border-primary)"},children:[e.jsx(H,{variant:"default",onClick:()=>I(!1),children:"Cancel"}),e.jsx(H,{variant:"filled",leftSection:e.jsx(Ae,{className:"w-4 h-4"}),onClick:Xe,disabled:!g.name||!c,className:"themed-button-primary",children:"Create Theme"})]})]})}),e.jsx(ne,{opened:q,onClose:()=>{_(!1),F(null),$({}),C({})},title:`Edit Theme: ${(v==null?void 0:v.meta.name)||""}`,size:"xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-sm font-semibold flex items-center gap-2 text-themed-primary",children:[e.jsx(Be,{className:"w-4 h-4"}),"Theme Information"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Theme Name *"}),e.jsx("input",{type:"text",value:o.name||"",onChange:t=>$({...o,name:t.target.value}),placeholder:"My Custom Theme",className:"w-full px-3 py-2 focus:outline-none themed-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Author"}),e.jsx("input",{type:"text",value:o.author||"",onChange:t=>$({...o,author:t.target.value}),placeholder:"Your Name",className:"w-full px-3 py-2 focus:outline-none themed-input"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Description"}),e.jsx("input",{type:"text",value:o.description||"",onChange:t=>$({...o,description:t.target.value}),placeholder:"A beautiful custom theme",className:"w-full px-3 py-2 rounded focus:outline-none themed-input"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:o.isDark||!1,onChange:t=>$({...o,isDark:t.target.checked}),className:"rounded"}),e.jsx("span",{className:"text-sm text-themed-secondary",children:"Dark Theme"})]}),e.jsxs("span",{className:"text-xs text-themed-muted",children:["Theme ID: ",v==null?void 0:v.meta.id]})]})]}),e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:E.map(t=>{const r=t.icon,w=D.includes(t.name);return e.jsxs("div",{className:"border border-themed-secondary rounded-lg",children:[e.jsxs("button",{onClick:()=>pe(t.name),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-opacity-50",style:{backgroundColor:w?"var(--theme-bg-tertiary)":"transparent"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(r,{className:"w-4 h-4 text-themed-accent"}),e.jsxs("div",{className:"text-left",children:[e.jsx("h5",{className:"text-sm font-semibold capitalize text-themed-primary",children:t.name.replace(/([A-Z])/g," $1").trim()}),e.jsx("p",{className:"text-xs text-themed-muted",children:t.description})]})]}),w?e.jsx(Pe,{className:"w-4 h-4"}):e.jsx($e,{className:"w-4 h-4"})]}),w&&e.jsx("div",{className:"p-4 border-t border-themed-secondary space-y-4",children:t.colors.map(y=>e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-themed-primary",children:y.label}),e.jsx("p",{className:"text-xs text-themed-muted",children:y.description}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:y.affects.map((T,A)=>e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded",style:{backgroundColor:"var(--theme-bg-hover)",color:"var(--theme-text-secondary)"},children:T},A))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"relative",children:e.jsx("input",{type:"color",value:o[y.key]||"#000000",onMouseDown:()=>me(y.key),onFocus:()=>me(y.key),onChange:T=>ve(y.key,T.target.value),className:"w-12 h-8 rounded cursor-pointer",style:{backgroundColor:o[y.key]||"#000000"}})}),e.jsx("input",{type:"text",value:o[y.key]||"",onFocus:()=>me(y.key),onChange:T=>ve(y.key,T.target.value),className:"w-24 px-2 py-1 text-xs rounded font-mono themed-input",placeholder:y.key}),e.jsx("button",{onClick:()=>je(o[y.key]||""),className:"p-1 rounded-lg hover:bg-opacity-50 bg-themed-hover",title:"Copy color",children:k===o[y.key]?e.jsx(he,{className:"w-3 h-3",style:{color:"var(--theme-success)"}}):e.jsx(le,{className:"w-3 h-3 text-themed-muted"})}),(()=>{const T=We(y.key);return T?e.jsx("button",{onClick:()=>qe(y.key),className:"p-1 rounded-lg hover:bg-opacity-50 bg-themed-hover",title:`Restore previous color: ${T}`,children:e.jsx(Me,{className:"w-3 h-3 text-themed-muted"})}):null})()]})]})},y.key))})]},t.name)})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Custom CSS (Optional)"}),e.jsx("textarea",{value:o.customCSS||"",onChange:t=>$({...o,customCSS:t.target.value}),placeholder:"/* Add any custom CSS here */",rows:4,className:"w-full px-3 py-2 rounded font-mono text-xs focus:outline-none themed-input"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",style:{borderColor:"var(--theme-border-primary)"},children:[e.jsx(H,{variant:"default",onClick:()=>{_(!1),F(null),$({})},children:"Cancel"}),e.jsx(H,{variant:"filled",leftSection:e.jsx(Ae,{className:"w-4 h-4"}),onClick:Qe,disabled:!o.name||!c||s,className:"themed-button-primary",children:"Save Changes"})]})]})})]})},$t=({alerts:c,onClearError:b,onClearSuccess:a})=>{var n,h;return!c||!((n=c.errors)!=null&&n.length)&&!c.success?null:e.jsxs("div",{className:"space-y-4",children:[(h=c.errors)==null?void 0:h.map(s=>e.jsx(O,{color:"red",icon:e.jsx(te,{className:"w-5 h-5"}),withCloseButton:!0,onClose:()=>b(s.id),children:s.message},s.id)),c.success&&e.jsx(O,{color:"green",icon:e.jsx(ee,{className:"w-5 h-5"}),withCloseButton:!!a,onClose:a,children:c.success})]})},_e=[{type:"clients",label:"Client Statistics",description:"Export client usage data including bandwidth and cache hits",formats:["json","csv","prometheus"],icon:ce},{type:"services",label:"Service Statistics",description:"Export service-level metrics (Steam, Epic, etc.)",formats:["json","csv","prometheus","influxdb"],icon:Ee},{type:"cache",label:"Cache Information",description:"Export current cache usage and storage metrics",formats:["json","prometheus"],icon:ce},{type:"dashboard",label:"Dashboard Statistics",description:"Export aggregated dashboard metrics",formats:["json","prometheus","influxdb"],icon:pt},{type:"downloads",label:"Download History",description:"Export recent download history (last 1000 entries)",formats:["json","csv"],icon:bt}],Mt=({isAuthenticated:c,mockMode:b,onError:a,onSuccess:n})=>{var k;const[h,s]=u.useState(!1),[i,j]=u.useState(null),[f,P]=u.useState("json"),[x,N]=u.useState({}),[S,p]=u.useState(null),[m,B]=u.useState(null);u.useEffect(()=>{fetch("/api/metrics/status").then(d=>d.json()).then(d=>B(d.requiresAuthentication)).catch(()=>B(!1))},[]);const I=d=>{if(!d||d.length===0)return"";const l=Object.keys(d[0]),C=l.join(","),o=d.map($=>l.map(g=>{const M=$[g];return M==null?"":typeof M=="string"&&M.includes(",")?`"${M.replace(/"/g,'""')}"`:M}).join(","));return[C,...o].join(`
`)},q=(d,l)=>{const C=Date.now();let o=[];switch(l){case"clients":d.forEach(E=>{o.push("# HELP lancache_client_cache_hit_bytes Total cache hit bytes for client"),o.push("# TYPE lancache_client_cache_hit_bytes counter"),o.push(`lancache_client_cache_hit_bytes{client="${E.clientIp}"} ${E.totalCacheHitBytes} ${C}`),o.push(`lancache_client_cache_miss_bytes{client="${E.clientIp}"} ${E.totalCacheMissBytes} ${C}`),o.push(`lancache_client_download_count{client="${E.clientIp}"} ${E.totalDownloads} ${C}`)});break;case"services":d.forEach(E=>{o.push("# HELP lancache_service_cache_hit_bytes Total cache hit bytes for service"),o.push("# TYPE lancache_service_cache_hit_bytes counter"),o.push(`lancache_service_cache_hit_bytes{service="${E.service}"} ${E.totalCacheHitBytes} ${C}`),o.push(`lancache_service_cache_miss_bytes{service="${E.service}"} ${E.totalCacheMissBytes} ${C}`),o.push(`lancache_service_download_count{service="${E.service}"} ${E.totalDownloads} ${C}`),o.push(`lancache_service_hit_ratio{service="${E.service}"} ${E.cacheHitPercent/100} ${C}`)});break;case"cache":const M=d;o.push("# HELP lancache_cache_total_bytes Total cache size in bytes"),o.push("# TYPE lancache_cache_total_bytes gauge"),o.push(`lancache_cache_total_bytes ${M.totalCacheSize} ${C}`),o.push(`lancache_cache_used_bytes ${M.usedCacheSize} ${C}`),o.push(`lancache_cache_free_bytes ${M.freeCacheSize} ${C}`),o.push(`lancache_cache_usage_percent ${M.usagePercent/100} ${C}`),o.push(`lancache_cache_file_count ${M.totalFiles} ${C}`);break;case"dashboard":const G=d;o.push("# HELP lancache_bandwidth_saved_bytes Total bandwidth saved"),o.push("# TYPE lancache_bandwidth_saved_bytes counter"),o.push(`lancache_bandwidth_saved_bytes ${G.totalBandwidthSaved} ${C}`),o.push(`lancache_cache_added_bytes ${G.totalAddedToCache} ${C}`),o.push(`lancache_served_bytes ${G.totalServed} ${C}`),o.push(`lancache_hit_ratio ${G.cacheHitRatio/100} ${C}`),o.push(`lancache_active_downloads ${G.activeDownloads} ${C}`),o.push(`lancache_unique_clients ${G.uniqueClients} ${C}`);break}return o.join(`
`)},_=(d,l)=>{const C=Date.now()*1e6;let o=[];switch(l){case"services":d.forEach(M=>{o.push(`lancache,service=${M.service} cache_hit_bytes=${M.totalCacheHitBytes}i,cache_miss_bytes=${M.totalCacheMissBytes}i,total_downloads=${M.totalDownloads}i,hit_ratio=${M.cacheHitPercent/100} ${C}`)});break;case"dashboard":const g=d;o.push(`lancache_stats bandwidth_saved=${g.totalBandwidthSaved}i,cache_added=${g.totalAddedToCache}i,total_served=${g.totalServed}i,hit_ratio=${g.cacheHitRatio/100},active_downloads=${g.activeDownloads}i,unique_clients=${g.uniqueClients}i ${C}`);break}return o.join(`
`)},v=d=>{let l=0;const C=setInterval(()=>{l+=Math.random()*30,l>=95&&(l=95,clearInterval(C)),N(o=>({...o,[d]:l}))},200);return C},F=async()=>{if(!i){a==null||a("Please select data to export");return}s(!0),N({[i]:0});const d=v(i);try{let l,C,o,$;switch(i){case"clients":l=await L.getClientStats();break;case"services":l=await L.getServiceStats();break;case"cache":l=await L.getCacheInfo();break;case"dashboard":l=await L.getDashboardStats();break;case"downloads":l=await L.getLatestDownloads(void 0,1e3);break}switch(f){case"csv":$=I(Array.isArray(l)?l:[l]),o="text/csv",C=`lancache_${i}_${new Date().toISOString().split("T")[0]}.csv`;break;case"prometheus":$=q(l,i),o="text/plain",C=`lancache_${i}_metrics.txt`;break;case"influxdb":$=_(l,i),o="text/plain",C=`lancache_${i}_influx.txt`;break;case"json":default:$=JSON.stringify(l,null,2),o="application/json",C=`lancache_${i}_${new Date().toISOString().split("T")[0]}.json`;break}const g=new Blob([$],{type:o}),M=URL.createObjectURL(g),G=document.createElement("a");G.href=M,G.download=C,document.body.appendChild(G),G.click(),document.body.removeChild(G),URL.revokeObjectURL(M),clearInterval(d),N({[i]:100}),setTimeout(()=>N({}),500),n==null||n(`Exported ${i} data as ${f.toUpperCase()}`)}catch(l){clearInterval(d),N({}),a==null||a(l.message||"Failed to export data")}finally{s(!1)}},D=(d,l)=>{navigator.clipboard.writeText(d),p(l),setTimeout(()=>p(null),2e3)},R=window.location.origin;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Y,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(xt,{className:"w-5 h-5 text-themed-accent"}),e.jsx("h3",{className:"text-lg font-semibold text-themed-primary",children:"Live API Endpoints for Grafana"})]}),m!==null&&e.jsx("div",{className:`flex items-center space-x-1 px-3 py-1 rounded-full text-xs font-medium ${m?"bg-yellow-500/20 text-yellow-400 border border-yellow-500/30":"bg-green-500/20 text-green-400 border border-green-500/30"}`,children:m?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"w-3 h-3"}),e.jsx("span",{children:"API Key Required"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Fe,{className:"w-3 h-3"}),e.jsx("span",{children:"Public Access"})]})})]}),e.jsx("p",{className:"text-themed-muted text-sm mb-4",children:m?"These endpoints provide real-time metrics with API key authentication. Configure your API key in Grafana or Prometheus.":"These endpoints provide real-time metrics without authentication. Use them directly in Grafana or Prometheus."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"p-3 rounded-lg themed-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-themed-primary",children:"Prometheus Metrics"}),e.jsx(H,{size:"xs",variant:"default",onClick:()=>D(`${R}/api/metrics`,"prometheus"),leftSection:S==="prometheus"?e.jsx(ee,{className:"w-3 h-3"}):e.jsx(le,{className:"w-3 h-3"}),children:S==="prometheus"?"Copied!":"Copy"})]}),e.jsxs("code",{className:"text-xs text-themed-muted block break-all",children:[R,"/api/metrics"]}),e.jsx("p",{className:"text-xs text-themed-muted mt-1",children:"OpenMetrics format for Prometheus scraping"})]}),e.jsxs("div",{className:"p-3 rounded-lg themed-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-themed-primary",children:"JSON Metrics"}),e.jsx(H,{size:"xs",variant:"default",onClick:()=>D(`${R}/api/metrics/json`,"json-api"),leftSection:S==="json-api"?e.jsx(ee,{className:"w-3 h-3"}):e.jsx(le,{className:"w-3 h-3"}),children:S==="json-api"?"Copied!":"Copy"})]}),e.jsxs("code",{className:"text-xs text-themed-muted block break-all",children:[R,"/api/metrics/json"]}),e.jsx("p",{className:"text-xs text-themed-muted mt-1",children:"JSON format for direct Grafana integration"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(O,{color:"blue",children:e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Security Options:"})," By default, these endpoints are public. To require API key authentication, set ",e.jsx("code",{children:"RequireAuthForMetrics: true"})," in your config. Then add header ",e.jsx("code",{children:"X-Api-Key: your-key"})," to Grafana/Prometheus."]})})}),e.jsx("div",{className:"mt-2",children:e.jsx(O,{color:"green",children:e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Live Updates:"})," Configure Grafana to poll every 10-30 seconds for real-time monitoring. Works with both Prometheus and JSON datasource plugins."]})})})]}),e.jsxs(Y,{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(oe,{className:"w-5 h-5 text-themed-accent"}),e.jsx("h3",{className:"text-lg font-semibold text-themed-primary",children:"Data Export"})]}),e.jsx("p",{className:"text-themed-muted text-sm mb-4",children:"Export cache statistics in various formats for analysis and monitoring"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-themed-primary mb-2",children:"Select Data Type"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:_e.map(d=>{const l=d.icon;return e.jsxs("button",{onClick:()=>{j(d.type),d.formats.includes(f)||P(d.formats[0])},className:`p-3 rounded-lg transition-all text-left relative overflow-hidden themed-card ${i===d.type?"ring-2 ring-themed-accent bg-themed-tertiary":"hover:bg-themed-hover"}`,children:[e.jsxs("div",{className:"flex items-start space-x-3 relative z-10",children:[e.jsx(l,{className:"w-5 h-5 text-themed-accent mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-themed-primary",children:d.label}),e.jsx("div",{className:"text-xs text-themed-muted mt-1",children:d.description})]})]}),x[d.type]!==void 0&&e.jsx("div",{className:"absolute bottom-0 left-0 w-full h-1 bg-themed-secondary",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 to-blue-400 transition-all duration-300",style:{width:`${x[d.type]}%`}})})]},d.type)})})]}),i&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-themed-primary mb-2",children:"Export Format"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(k=_e.find(d=>d.type===i))==null?void 0:k.formats.map(d=>e.jsx(H,{onClick:()=>P(d),variant:f===d?"filled":"default",color:"blue",size:"sm",children:d.toUpperCase()},d))})]}),i&&f&&e.jsx(O,{color:"blue",children:e.jsxs("div",{className:"text-sm",children:[f==="prometheus"&&e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Prometheus Format:"})," Metrics in OpenMetrics text format. Can be scraped by Prometheus or imported into Grafana."]}),f==="influxdb"&&e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"InfluxDB Format:"})," Line protocol format for direct import into InfluxDB or Telegraf."]}),f==="csv"&&e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"CSV Format:"})," Comma-separated values for spreadsheet applications or data analysis tools."]}),f==="json"&&e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"JSON Format:"})," Structured data for programmatic processing or custom visualizations."]})]})}),e.jsx(H,{onClick:F,disabled:!i||h,loading:h,variant:"filled",color:"green",leftSection:e.jsx(oe,{className:"w-4 h-4"}),fullWidth:!0,children:"Export Data"})]})]})]})},At=({mockMode:c,onToggle:b,disabled:a})=>e.jsxs(Y,{children:[e.jsx("h3",{className:"text-lg font-semibold text-themed-primary mb-4",children:"Mock Mode"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-themed-secondary",children:"Enable mock data for demonstration"}),e.jsx("p",{className:"text-sm text-themed-muted mt-1",children:"Simulates realistic cache data and download activity"})]}),e.jsx(H,{onClick:b,disabled:a,variant:"filled",color:"blue",leftSection:c?e.jsx(yt,{className:"w-5 h-5"}):e.jsx(vt,{className:"w-5 h-5"}),children:c?"Enabled":"Disabled"})]}),c&&e.jsx("div",{className:"mt-4",children:e.jsx(O,{color:"blue",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(te,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Mock mode active - API actions disabled"})]})})})]}),It=({isAuthenticated:c,mockMode:b,onError:a,onSuccess:n,onDataRefresh:h})=>{const[s,i]=u.useState(!1),j=async()=>{if(!c){a==null||a("Authentication required");return}if(window.confirm("Delete all download history?")){i(!0);try{const f=await L.resetDatabase();f&&(n==null||n(f.message||"Database reset successfully"),setTimeout(()=>h==null?void 0:h(),2e3))}catch(f){a==null||a(f.message||"Failed to reset database")}finally{i(!1)}}};return e.jsxs(Y,{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(ce,{className:"w-5 h-5 text-themed-accent"}),e.jsx("h3",{className:"text-lg font-semibold text-themed-primary",children:"Database Management"})]}),e.jsx("p",{className:"text-themed-muted text-sm mb-4",children:"Manage download history and statistics"}),e.jsx(H,{onClick:j,disabled:s||b||!c,loading:s,variant:"filled",color:"red",leftSection:e.jsx(ce,{className:"w-4 h-4"}),fullWidth:!0,children:"Reset Database"}),e.jsx("p",{className:"text-xs text-themed-muted mt-2",children:"Clears all download history (does not affect cached files)"})]})},_t=({isAuthenticated:c,mockMode:b,onError:a,onSuccess:n,onDataRefresh:h,onBackgroundOperation:s})=>{const[i,j]=u.useState({}),[f,P]=u.useState({logPath:"/logs/access.log",services:[]}),[x,N]=u.useState(null),[S,p]=u.useState(!0),m=xe("activeServiceRemoval","serviceRemoval",30);u.useEffect(()=>{B(),I()},[]),u.useEffect(()=>{s==null||s(x)},[x,s]);const B=async()=>{try{const[v,F]=await Promise.all([L.getConfig(),L.getServiceLogCounts()]);P(v),j(F)}catch(v){console.error("Failed to load config:",v),P({logPath:"/logs/access.log",services:["steam","epic","origin","blizzard","wsus","riot"]})}finally{p(!1)}},I=async()=>{var F;const v=await m.load();(F=v==null?void 0:v.data)!=null&&F.service&&(N(v.data.service),n==null||n(`Removing ${v.data.service} entries from logs (operation resumed)...`),setTimeout(async()=>{await m.clear(),N(null);try{const[D,R]=await Promise.all([L.getConfig(),L.getServiceLogCounts()]);P(D),j(R)}catch(D){console.error("Failed to reload config:",D)}h==null||h()},1e4))},q=async v=>{var F;if(!c){a==null||a("Authentication required");return}if(window.confirm(`Remove all ${v} entries?`))try{N(v),await m.save({service:v});const D=await L.removeServiceFromLogs(v);D&&(n==null||n(D.message||`${v} entries removed successfully`)),await m.clear(),setTimeout(async()=>{N(null);try{const[R,k]=await Promise.all([L.getConfig(),L.getServiceLogCounts()]);P(R),j(k)}catch(R){console.error("Failed to reload config:",R)}h==null||h()},2e3)}catch(D){await m.clear(),N(null);const R=(F=D.message)!=null&&F.includes("read-only")?"Logs directory is read-only. Remove :ro from docker-compose volume mount.":D.message||"Action failed";a==null||a(R)}},_=f.services.length>0?f.services:[];return e.jsxs(Y,{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(De,{className:"w-5 h-5 text-themed-accent"}),e.jsx("h3",{className:"text-lg font-semibold text-themed-primary",children:"Log File Management"})]}),e.jsxs("p",{className:"text-themed-muted text-sm mb-4",children:["Remove service entries from"," ",e.jsx("code",{className:"bg-themed-tertiary px-2 py-1 rounded",children:f.logPath})]}),S?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(Z,{className:"w-6 h-6 animate-spin text-themed-muted"})}):_.length>0?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:_.map(v=>{const F=x===v;return e.jsx(H,{onClick:()=>q(v),disabled:b||!!x||m.loading||!c,variant:"default",loading:F||m.loading,className:"flex flex-col items-center",fullWidth:!0,children:!F&&!m.loading?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"capitalize font-medium",children:["Clear ",v]}),i[v]!==void 0&&e.jsxs("span",{className:"text-xs text-themed-muted mt-1",children:["(",i[v].toLocaleString()," entries)"]})]}):e.jsx("span",{className:"capitalize font-medium",children:"Removing..."})},v)})}):e.jsx("div",{className:"text-center py-8 text-themed-muted",children:"No services configured"}),e.jsx("div",{className:"mt-4",children:e.jsx(O,{color:"yellow",children:e.jsxs("p",{className:"text-xs",children:[e.jsx("strong",{children:"Warning:"})," Requires write permissions to logs directory"]})})})]})},zt=()=>{const{mockMode:c,setMockMode:b,fetchData:a}=jt(),[n,h]=u.useState(!1),[s,i]=u.useState({errors:[],success:null}),[j,f]=u.useState({}),P=u.useRef(!1),x=u.useCallback(m=>{i(B=>({...B,errors:[...B.errors,{id:Date.now(),message:m}]}))},[]),N=u.useCallback(m=>{i(B=>({...B,success:m})),setTimeout(()=>i(B=>({...B,success:null})),1e4)},[]),S=u.useCallback(m=>{i(B=>({...B,errors:B.errors.filter(I=>I.id!==m)}))},[]),p=u.useCallback(()=>{i(m=>({...m,success:null}))},[]);return u.useEffect(()=>{(async()=>{if(!P.current){const B=await X.migrateFromLocalStorage();B>0&&N(`Migrated ${B} operations from local storage to server`),P.current=!0}})()},[N]),e.jsxs("div",{className:"space-y-6",children:[e.jsx(Tt,{onAuthChange:h,onError:x,onSuccess:N}),e.jsxs("div",{className:"space-y-4",children:[e.jsx($t,{alerts:s,onClearError:S,onClearSuccess:p}),j.cacheClearing&&e.jsx(O,{color:"blue",icon:e.jsx(Z,{className:"w-5 h-5 animate-spin"}),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:"Cache clearing in progress..."}),j.cacheClearing.bytesDeleted>0&&e.jsxs("p",{className:"text-sm mt-1 opacity-75",children:[se(j.cacheClearing.bytesDeleted)," cleared"]}),e.jsxs("p",{className:"text-sm mt-1 opacity-75",children:[(j.cacheClearing.progress||0).toFixed(0),"% complete"]})]}),e.jsx(H,{variant:"filled",color:"blue",size:"sm",leftSection:e.jsx(Oe,{className:"w-4 h-4"}),onClick:j.cacheClearing.showModal,children:"View Details"})]})}),j.logProcessing&&e.jsx(O,{color:j.logProcessing.status==="complete"?"green":"yellow",icon:j.logProcessing.status==="complete"?e.jsx(ee,{className:"w-5 h-5"}):e.jsx(Z,{className:"w-5 h-5 animate-spin"}),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:j.logProcessing.message}),j.logProcessing.detailMessage&&e.jsx("p",{className:"text-sm mt-1 opacity-75",children:j.logProcessing.detailMessage}),j.logProcessing.progress>0&&j.logProcessing.status!=="complete"&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"w-full progress-track rounded-full h-2",children:e.jsx("div",{className:"progress-bar-low h-2 rounded-full smooth-transition",style:{width:`${Math.min(j.logProcessing.progress,100)}%`}})}),e.jsxs("p",{className:"text-xs opacity-75 mt-1",children:[j.logProcessing.progress.toFixed(1),"% complete",j.logProcessing.estimatedTime&&` • ${j.logProcessing.estimatedTime} remaining`]})]})]}),j.logProcessing.status!=="complete"&&j.logProcessing.onCancel&&e.jsx(H,{variant:"filled",color:"red",size:"sm",leftSection:e.jsx(Le,{className:"w-4 h-4"}),onClick:j.logProcessing.onCancel,children:"Cancel"})]})}),j.serviceRemoval&&e.jsx(O,{color:"orange",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Z,{className:"w-5 h-5 animate-spin"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["Removing ",j.serviceRemoval," entries from logs..."]}),e.jsx("p",{className:"text-sm mt-1",children:"This may take several minutes for large log files"})]})]})})]}),e.jsx(At,{mockMode:c,onToggle:()=>b(!c),disabled:!1}),e.jsx(It,{isAuthenticated:n,mockMode:c,onError:x,onSuccess:N,onDataRefresh:a}),e.jsx(St,{isAuthenticated:n,mockMode:c,onError:x,onSuccess:N,onBackgroundOperation:m=>f(B=>({...B,cacheClearing:m}))}),e.jsx(Bt,{isAuthenticated:n,mockMode:c,onError:x,onSuccess:N,onDataRefresh:a,onBackgroundOperation:m=>f(B=>({...B,logProcessing:m}))}),e.jsx(_t,{isAuthenticated:n,mockMode:c,onError:x,onSuccess:N,onDataRefresh:a,onBackgroundOperation:m=>f(B=>({...B,serviceRemoval:m}))}),e.jsx(Mt,{isAuthenticated:n,mockMode:c,onError:x,onSuccess:N}),e.jsx(Pt,{isAuthenticated:n})]})};export{zt as default};
//# sourceMappingURL=ManagementTab-DQ3pdBfr.js.map

import{j as e,r as s,a as ye,c as be,o as fe,p as Ce,I as je,A as we,U as Ne,D as De,q as Te,Z as Se,s as ke,H as Le,l as He,t as Me,b as Be,u as Re,E as Ie,L as Ee,X as Ae,G as se,v as Oe}from"./react-vendor-BKkFPE2a.js";import{u as re,A as $e,a as Pe,S as q}from"./index-BWakVz_d.js";import{f as N,C as Z,a as V,b as oe}from"./Card-DwLTxh2g.js";import{C as Ve}from"./charts-B1PwCyAI.js";import{C as _e}from"./Tooltip-B5wX8oSW.js";import"./vendor-BmYUbuLR.js";const ze=({title:d,value:x,subtitle:S,icon:D,color:y,tooltip:h})=>{const H=I=>{const f={blue:"var(--theme-icon-blue)",green:"var(--theme-icon-green)",emerald:"var(--theme-icon-emerald)",purple:"var(--theme-icon-purple)",indigo:"var(--theme-icon-indigo)",orange:"var(--theme-icon-orange)",yellow:"var(--theme-icon-yellow)",cyan:"var(--theme-icon-cyan)",red:"var(--theme-icon-red)"};return f[I]||f.blue};return e.jsx("div",{className:"rounded-lg p-4 border transition-all hover:shadow-lg relative group",style:{backgroundColor:"var(--theme-card-bg)",borderColor:"var(--theme-card-border)",cursor:h?"help":"default"},title:h,"data-stat-card":d.toLowerCase().replace(/\s+/g,""),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium inline-block transition-colors",style:{color:h?"var(--theme-text-secondary)":"var(--theme-text-muted)",borderBottom:h?"1px dotted currentColor":"none",paddingBottom:h?"1px":"0",opacity:h?"0.9":"1"},children:d}),e.jsx("p",{className:"text-2xl font-bold mt-1",style:{color:"var(--theme-text-primary)"},children:x}),S&&e.jsx("p",{className:"text-xs mt-1",style:{color:"var(--theme-text-secondary)"},children:S})]}),e.jsx("div",{className:"p-3 rounded-lg",style:{backgroundColor:H(y)},children:e.jsx(D,{className:"w-6 h-6",style:{color:"var(--theme-button-text)"}})})]})})},Fe=({serviceStats:d})=>{var R;const[x,S]=s.useState(0),[D,y]=s.useState(100),[h,H]=s.useState(0),I=s.useRef(null),f=s.useRef(null),B=s.useRef(""),T=[{name:"Service Distribution",id:"service"},{name:"Cache Hit Ratio",id:"hit-ratio"},{name:"Bandwidth Saved",id:"bandwidth"}],i=()=>{const a=getComputedStyle(document.documentElement),m=[a.getPropertyValue("--theme-chart-1").trim(),a.getPropertyValue("--theme-chart-2").trim(),a.getPropertyValue("--theme-chart-3").trim(),a.getPropertyValue("--theme-chart-4").trim(),a.getPropertyValue("--theme-chart-5").trim(),a.getPropertyValue("--theme-chart-6").trim(),a.getPropertyValue("--theme-chart-7").trim(),a.getPropertyValue("--theme-chart-8").trim()],v=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#06b6d4","#f97316","#ec4899"];return m.map((l,p)=>l||v[p])},u=s.useMemo(()=>{if(!d||d.length===0)return{labels:[],data:[],colors:[]};const a=d.reduce((l,p)=>l+(p.totalBytes||0),0);if(a===0)return{labels:[],data:[],colors:[]};const m=i(),v=d.map(l=>({name:l.service,value:l.totalBytes,percentage:l.totalBytes/a*100})).sort((l,p)=>p.value-l.value);return{labels:v.map(l=>l.name),data:v.map(l=>l.value),colors:v.map((l,p)=>m[p%m.length])}},[d]),c=s.useMemo(()=>{if(!d||d.length===0)return{labels:[],data:[],colors:[]};const a=d.reduce((j,g)=>j+(g.totalCacheHitBytes||0),0),m=d.reduce((j,g)=>j+(g.totalCacheMissBytes||0),0);if(a+m===0)return{labels:[],data:[],colors:[]};const l=getComputedStyle(document.documentElement),p=l.getPropertyValue("--theme-chart-cache-hit").trim()||"#10b981",M=l.getPropertyValue("--theme-chart-cache-miss").trim()||"#f59e0b";return{labels:["Cache Hits","Cache Misses"],data:[a,m],colors:[p,M]}},[d]),r=s.useMemo(()=>{if(!d||d.length===0)return{labels:[],data:[],colors:[]};const a=d.map(l=>({name:l.service,value:l.totalCacheHitBytes||0,percentage:0})).filter(l=>l.value>0).sort((l,p)=>p.value-l.value),m=a.reduce((l,p)=>l+p.value,0);if(m===0)return{labels:[],data:[],colors:[]};a.forEach(l=>{l.percentage=l.value/m*100});const v=i();return{labels:a.map(l=>l.name),data:a.map(l=>l.value),colors:a.map((l,p)=>v[p%v.length])}},[d]),o=s.useMemo(()=>{var a;switch((a=T[x])==null?void 0:a.id){case"service":return u;case"hit-ratio":return c;case"bandwidth":return r;default:return u}},[x,u,c,r]),b=s.useMemo(()=>{var M;const a=(M=T[x])==null?void 0:M.id,m=d.reduce((j,g)=>j+(g.totalBytes||0),0),v=d.reduce((j,g)=>j+(g.totalCacheHitBytes||0),0),l=d.reduce((j,g)=>j+(g.totalCacheMissBytes||0),0),p=m>0?(v/m*100).toFixed(1):"0";switch(a){case"service":return{title:"Total Data by Service",description:"Shows the distribution of all data transferred across different gaming services",stats:[{label:"Total Data",value:N(m)},{label:"Services",value:d.length},{label:"Hit Ratio",value:`${p}%`}]};case"hit-ratio":return{title:"Cache Performance",description:"Ratio of data served from cache (hits) vs downloaded from internet (misses)",stats:[{label:"Cache Hits",value:N(v)},{label:"Cache Misses",value:N(l)},{label:"Efficiency",value:`${p}%`}]};case"bandwidth":return{title:"Internet Bandwidth Saved",description:"Amount of internet bandwidth saved by serving cached content locally",stats:[{label:"Total Saved",value:N(v)},{label:"Downloads Avoided",value:Math.round(v/(50*1024*1024*1024))||"0"},{label:"Cache Efficiency",value:`${p}%`}]};default:return{title:"",description:"",stats:[]}}},[x,d]);s.useEffect(()=>{const a=()=>{setTimeout(()=>{f.current&&(f.current.destroy(),f.current=null,H(m=>m+1))},50)};return window.addEventListener("themechange",a),()=>window.removeEventListener("themechange",a)},[]),s.useEffect(()=>{const a=setTimeout(()=>{H(m=>m+1)},100);return()=>clearTimeout(a)},[]),s.useEffect(()=>{if(!I.current||o.labels.length===0)return;const a=JSON.stringify({labels:o.labels,data:o.data}),m=a!==B.current;B.current=a,f.current&&f.current.destroy();const v=getComputedStyle(document.documentElement),l=v.getPropertyValue("--theme-chart-border").trim()||"#1f2937",p=v.getPropertyValue("--theme-chart-text").trim()||"#9ca3af",M=v.getPropertyValue("--theme-text-primary").trim()||"#ffffff",j=I.current.getContext("2d");if(j)return f.current=new Ve(j,{type:"doughnut",data:{labels:o.labels,datasets:[{data:o.data,backgroundColor:o.colors,borderColor:l,borderWidth:2,borderRadius:0,spacing:0}]},options:{responsive:!0,maintainAspectRatio:!0,aspectRatio:1,layout:{padding:0},animation:{animateRotate:!0,animateScale:m,duration:1200,easing:"easeInOutQuart",delay:g=>g.dataIndex*50},transitions:{active:{animation:{duration:400,easing:"easeOutQuart"}},resize:{animation:{duration:400,easing:"easeInOutQuart"}},show:{animations:{colors:{from:"transparent"},visible:{duration:400}}},hide:{animations:{colors:{to:"transparent"},visible:{duration:200}}}},plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.9)",titleColor:M,bodyColor:p,borderColor:l,borderWidth:1,cornerRadius:8,padding:12,displayColors:!0,animation:{duration:200,easing:"easeOutQuart"},callbacks:{label:g=>{var F;const k=g.raw,_=g.dataset.data.reduce((Y,G)=>Y+G,0),$=(k/_*100).toFixed(1),z=(F=T[x])==null?void 0:F.id;return z==="bandwidth"?`${g.label}: ${N(k)} saved (${$}%)`:z==="hit-ratio"?`${g.label}: ${N(k)} (${$}%)`:`${g.label}: ${N(k)} (${$}%)`}}}},cutout:"50%",radius:"90%"}}),()=>{f.current&&f.current.destroy()}},[o,D,x,h]);const C=200+(D-100)*2;return e.jsxs(Z,{padding:"none",children:[e.jsxs("div",{className:"p-6 pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>S(a=>(a-1+T.length)%T.length),className:"p-1 rounded-lg transition-colors mr-2",style:{color:"var(--theme-text-muted)"},onMouseEnter:a=>a.currentTarget.style.backgroundColor="var(--theme-bg-hover)",onMouseLeave:a=>a.currentTarget.style.backgroundColor="transparent",children:e.jsx(ye,{className:"w-4 h-4"})}),e.jsx("div",{className:"w-48 text-center",children:e.jsx("h3",{className:"text-lg font-semibold text-themed-primary truncate",children:(R=T[x])==null?void 0:R.name})}),e.jsx("button",{onClick:()=>S(a=>(a+1)%T.length),className:"p-1 rounded-lg transition-colors ml-2",style:{color:"var(--theme-text-muted)"},onMouseEnter:a=>a.currentTarget.style.backgroundColor="var(--theme-bg-hover)",onMouseLeave:a=>a.currentTarget.style.backgroundColor="transparent",children:e.jsx(be,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>y(Math.max(60,D-10)),className:"p-1 rounded-lg transition-colors",style:{color:"var(--theme-text-muted)"},onMouseEnter:a=>a.currentTarget.style.backgroundColor="var(--theme-bg-hover)",onMouseLeave:a=>a.currentTarget.style.backgroundColor="transparent",children:e.jsx(fe,{className:"w-4 h-4"})}),e.jsxs("span",{className:"text-xs text-themed-muted",children:[D,"%"]}),e.jsx("button",{onClick:()=>y(Math.min(140,D+10)),className:"p-1 rounded-lg transition-colors",style:{color:"var(--theme-text-muted)"},onMouseEnter:a=>a.currentTarget.style.backgroundColor="var(--theme-bg-hover)",onMouseLeave:a=>a.currentTarget.style.backgroundColor="transparent",children:e.jsx(Ce,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"flex space-x-1",children:T.map((a,m)=>e.jsx("button",{onClick:()=>S(m),className:"h-1 flex-1 rounded-full transition-all duration-300 ease-out hover:h-1.5",style:{backgroundColor:m===x?"var(--theme-primary)":"var(--theme-bg-hover)",transform:m===x?"scaleY(1.5)":"scaleY(1)",opacity:m===x?1:.5}},m))})]}),e.jsx("div",{className:"px-6 pb-6",children:o.labels.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-center items-center transition-all duration-500 ease-in-out",style:{height:`${C}px`,width:"100%"},children:e.jsx("div",{className:"transition-all duration-500 ease-in-out",style:{width:`${Math.min(C,400)}px`,height:`${Math.min(C,400)}px`,transform:"scale(1)",opacity:1},children:e.jsx("canvas",{ref:I,className:"transition-opacity duration-300",style:{maxHeight:"100%",maxWidth:"100%",opacity:1}},h)})}),o.labels.length>0&&e.jsx("div",{className:"mt-4 flex flex-wrap justify-center gap-3",children:o.labels.map((a,m)=>{const v=o.data[m],l=o.data.reduce((M,j)=>M+j,0),p=(v/l*100).toFixed(1);return e.jsxs("div",{className:"flex items-center space-x-1 transition-all duration-300 hover:scale-105",style:{animation:`fadeInUp 0.5s ease-out ${m*.1}s both`},children:[e.jsx("div",{className:"w-3 h-3 rounded transition-transform duration-300 hover:scale-125",style:{backgroundColor:o.colors[m]}}),e.jsxs("span",{className:"text-xs text-themed-muted",children:[a,":"]}),e.jsxs("span",{className:"text-xs text-themed-primary font-medium",children:[p,"%"]})]},a)})}),e.jsxs("div",{className:"mt-6 pt-4 border-t",style:{borderColor:"var(--theme-border-primary)"},children:[e.jsxs("div",{className:"flex items-start gap-2 mb-3",children:[e.jsx(je,{className:"w-4 h-4 text-themed-muted mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium text-themed-secondary mb-1",children:b.title}),e.jsx("p",{className:"text-xs text-themed-muted leading-relaxed",children:b.description})]})]}),b.stats.length>0&&e.jsx("div",{className:"grid grid-cols-3 gap-4 mt-4",children:b.stats.map((a,m)=>e.jsxs("div",{className:"text-center transition-all duration-300 hover:transform hover:scale-110",style:{animation:`fadeIn 0.6s ease-out ${.4+m*.1}s both`},children:[e.jsx("div",{className:"text-xs text-themed-muted mb-0.5",children:a.label}),e.jsx("div",{className:"text-sm font-semibold text-themed-secondary transition-colors duration-200 hover:text-themed-primary",children:a.value})]},m))})]})]}):e.jsx("div",{className:"flex items-center justify-center h-48",children:e.jsx("p",{className:"text-themed-muted",children:"No data available"})})})]})},ne=s.memo(({timeRange:d="live"})=>{const[x,S]=s.useState([]),[D,y]=s.useState(!0),{getTimeRangeParams:h}=re();s.useEffect(()=>{(async()=>{try{y(!0);const{startTime:u,endTime:c}=h(),r=await $e.getLatestDownloads(void 0,"unlimited",u,c);S(r)}catch(u){console.error("Failed to fetch all downloads for Recent Downloads Panel:",u),S([])}finally{y(!1)}})()},[d,h]);const H=s.useMemo(()=>({"15m":"Last 15 Minutes","30m":"Last 30 Minutes","1h":"Last Hour","6h":"Last 6 Hours","12h":"Last 12 Hours","24h":"Last 24 Hours","7d":"Last 7 Days","30d":"Last 30 Days","90d":"Last 90 Days",live:"Live Data"})[d]||"Recent",[d]),I=i=>{const u={},c=[];return i.forEach(r=>{let o,b,C;if(r.gameName&&r.gameName!=="Unknown Steam Game"&&!r.gameName.match(/^Steam App \d+$/))o=`game-${r.gameName}`,b=r.gameName,C="game";else if(r.gameName&&r.gameName.match(/^Steam App \d+$/))o="unmapped-steam-apps",b="Unmapped Steam Apps",C="content";else if(r.service.toLowerCase()!=="steam")o=`service-${r.service.toLowerCase()}`,b=`${r.service} Downloads`,C=r.totalBytes===0?"metadata":"content";else{c.push(r);return}u[o]||(u[o]={id:o,name:b,type:C,service:r.service,downloads:[],totalBytes:0,cacheHitBytes:0,cacheMissBytes:0,clientsSet:new Set,firstSeen:r.startTime,lastSeen:r.startTime,count:0}),u[o].downloads.push(r),u[o].totalBytes+=r.totalBytes||0,u[o].cacheHitBytes+=r.cacheHitBytes||0,u[o].cacheMissBytes+=r.cacheMissBytes||0,u[o].clientsSet.add(r.clientIp),u[o].count++,r.startTime<u[o].firstSeen&&(u[o].firstSeen=r.startTime),r.startTime>u[o].lastSeen&&(u[o].lastSeen=r.startTime)}),{groups:Object.values(u),individuals:c}},f=10,B=s.useMemo(()=>{const{groups:i,individuals:u}=I(x),c=[...i,...u];return c.sort((r,o)=>{const b="downloads"in r?Math.max(...r.downloads.map(R=>new Date(R.startTime).getTime())):new Date(r.startTime).getTime();return("downloads"in o?Math.max(...o.downloads.map(R=>new Date(R.startTime).getTime())):new Date(o.startTime).getTime())-b}),{displayedItems:c.slice(0,f),totalGroups:c.length}},[x]),T=s.useMemo(()=>{const i=x.length,u=x.reduce((o,b)=>o+(b.totalBytes||0),0),c=x.reduce((o,b)=>o+(b.cacheHitBytes||0),0),r=u>0?c/u*100:0;return{totalDownloads:i,totalBytes:u,totalCacheHits:c,overallHitRate:r}},[x]);return e.jsxs(Z,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-themed-primary",children:"Recent Downloads"}),e.jsxs("div",{className:"flex items-center gap-3",children:[!D&&x.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-xs text-themed-muted",children:[T.totalDownloads," total"]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded ${T.overallHitRate>50?"hit-rate-high":"hit-rate-warning"}`,children:[V(T.overallHitRate)," hit"]})]}),e.jsx("span",{className:"text-xs text-themed-muted",children:H})]})]}),e.jsx("div",{className:"space-y-3 max-h-[400px] overflow-y-auto",children:D?e.jsx("div",{className:"flex items-center justify-center h-32 text-themed-muted",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-themed-accent"}),e.jsx("span",{children:"Loading all downloads..."})]})}):B.displayedItems.length>0?B.displayedItems.map((i,u)=>{const c="downloads"in i,r=c?{service:i.service,name:i.name,totalBytes:i.totalBytes,cacheHitBytes:i.cacheHitBytes,cacheMissBytes:i.cacheMissBytes,cacheHitPercent:i.totalBytes>0?i.cacheHitBytes/i.totalBytes*100:0,startTime:i.lastSeen,clientIp:`${i.clientsSet.size} client${i.clientsSet.size!==1?"s":""}`,count:i.count,type:i.type}:{service:i.service,name:i.gameName||"Individual Download",totalBytes:i.totalBytes,cacheHitBytes:i.cacheHitBytes,cacheMissBytes:i.cacheMissBytes,cacheHitPercent:i.cacheHitPercent,startTime:i.startTime,clientIp:i.clientIp,count:1};return e.jsxs("div",{className:"rounded-lg p-3 border transition-all duration-200 themed-card hover:shadow-lg",style:{backgroundColor:"var(--theme-bg-primary)",borderColor:"var(--theme-border-primary)"},onMouseEnter:o=>o.currentTarget.style.borderColor="var(--theme-border-secondary)",onMouseLeave:o=>o.currentTarget.style.borderColor="var(--theme-border-primary)",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("span",{className:"font-medium text-sm text-themed-accent",children:r.service}),e.jsx("span",{className:"text-xs text-themed-muted",children:oe(r.startTime)})]}),e.jsx("div",{className:"text-xs text-themed-muted",children:r.clientIp}),e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsx("div",{className:"text-sm font-medium text-themed-primary truncate",children:r.name}),c&&e.jsxs("span",{className:"text-xs px-2 py-0.5 rounded bg-themed-tertiary text-themed-secondary ml-2",children:[r.count," downloads"]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-themed-primary text-sm",children:N(r.totalBytes)}),e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsxs("span",{className:"cache-hit",children:["â†“ ",N(r.cacheHitBytes)]}),e.jsxs("span",{className:"cache-miss",children:["â†‘ ",N(r.cacheMissBytes)]})]})]}),e.jsxs("span",{className:`text-xs px-2 py-1 rounded hit-rate-badge ${r.cacheHitPercent>75?"high":r.cacheHitPercent>50?"medium":r.cacheHitPercent>25?"low":"warning"}`,children:[V(r.cacheHitPercent)," Hit"]})]})]},c?i.id:i.id||u)}):e.jsxs("div",{className:"flex items-center justify-center h-32 text-themed-muted",children:["No downloads in the ",H.toLowerCase()]})}),B.totalGroups>f&&e.jsx("div",{className:"mt-3 pt-3 border-t text-center",style:{borderColor:"var(--theme-border-primary)"},children:e.jsxs("span",{className:"text-xs text-themed-muted",children:["Showing ",Math.min(f,B.displayedItems.length)," of ",B.totalGroups," groups (",x.length," downloads)"]})})]})});ne.displayName="RecentDownloadsPanel";const le=s.memo(({clientStats:d=[],timeRange:x="live"})=>{const S=s.useMemo(()=>({"15m":"Last 15 Minutes","30m":"Last 30 Minutes","1h":"Last Hour","6h":"Last 6 Hours","12h":"Last 12 Hours","24h":"Last 24 Hours","7d":"Last 7 Days","30d":"Last 30 Days","90d":"Last 90 Days",live:"Live Data"})[x]||"Live Data",[x]),D=s.useMemo(()=>d.slice(0,10),[d]);return e.jsxs(Z,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-themed-primary flex items-center gap-2",children:["Top Clients",e.jsx(_e,{})]}),e.jsx("span",{className:"text-xs text-themed-muted",children:S})]}),D.length>0?e.jsx("div",{className:"overflow-x-auto -mx-2 px-2",children:e.jsxs("table",{className:"w-full min-w-[600px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-xs text-themed-muted uppercase tracking-wider",children:[e.jsx("th",{className:"pb-3 min-w-[120px]",children:"Client IP"}),e.jsx("th",{className:"pb-3 hidden sm:table-cell",children:"Total Downloaded"}),e.jsx("th",{className:"pb-3 hidden md:table-cell",children:"Cache Hits"}),e.jsx("th",{className:"pb-3 hidden md:table-cell",children:"Cache Misses"}),e.jsx("th",{className:"pb-3 min-w-[100px]",children:"Hit Rate"}),e.jsx("th",{className:"pb-3 hidden lg:table-cell",children:"Last Seen"})]})}),e.jsx("tbody",{className:"text-sm",children:D.map((y,h)=>e.jsxs("tr",{className:"hover:bg-themed-hover transition-colors",children:[e.jsx("td",{className:"py-3 text-themed-primary whitespace-nowrap",children:y.clientIp}),e.jsx("td",{className:"py-3 text-themed-secondary hidden sm:table-cell whitespace-nowrap",children:N(y.totalBytes)}),e.jsx("td",{className:"py-3 cache-hit hidden md:table-cell whitespace-nowrap",children:N(y.totalCacheHitBytes)}),e.jsx("td",{className:"py-3 cache-miss hidden md:table-cell whitespace-nowrap",children:N(y.totalCacheMissBytes)}),e.jsx("td",{className:"py-3",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs hit-rate-badge ${y.cacheHitPercent>50?"high":"warning"}`,children:V(y.cacheHitPercent)})}),e.jsx("td",{className:"py-3 text-themed-muted hidden lg:table-cell whitespace-nowrap",children:oe(y.lastSeen)})]},`${y.clientIp}-${h}`))})]})}):e.jsx("div",{className:"flex items-center justify-center h-32 text-themed-muted",children:"No client data available for selected time range"})]})});le.displayName="TopClientsTable";const Q={totalCache:!0,usedSpace:!0,bandwidthSaved:!0,addedToCache:!0,totalServed:!0,activeDownloads:!0,activeClients:!0,cacheHitRatio:!0},W=["totalCache","usedSpace","bandwidthSaved","addedToCache","totalServed","activeDownloads","activeClients","cacheHitRatio"],O={totalCache:"Total storage capacity of your LANCache system",usedSpace:"Amount of storage currently occupied by cached content",bandwidthSaved:"Amount of internet bandwidth saved by serving files from local cache instead of downloading them again",addedToCache:"New content downloaded and stored in cache for future use",totalServed:"Total amount of data delivered to clients (cache hits + new downloads)",activeDownloads:"Number of downloads currently in progress",activeClients:"Number of unique client devices that have accessed the cache",cacheHitRatio:"Percentage of requests served from cache vs downloaded from internet. Higher is better!"},We=()=>{const{cacheInfo:d,activeDownloads:x,latestDownloads:S,clientStats:D,serviceStats:y,dashboardStats:h}=Pe(),{timeRange:H}=re(),[I]=s.useState(!1),[f,B]=s.useState(!1),[T,i]=s.useState(""),u=s.useRef(null),[c,r]=s.useState(null),[o,b]=s.useState(null),[C,R]=s.useState(!1),[a,m]=s.useState(null),[v,l]=s.useState(()=>localStorage.getItem("dashboard-hide-drag-hint")!=="true"),p=s.useRef(0),[M,j]=s.useState(()=>{const t=localStorage.getItem(q.DASHBOARD_CARD_ORDER);if(t)try{const n=JSON.parse(t);if(W.every(w=>n.includes(w)))return n}catch(n){console.error("Failed to parse card order:",n)}return W});s.useEffect(()=>{localStorage.setItem(q.DASHBOARD_CARD_ORDER,JSON.stringify(M))},[M]);const g=s.useCallback(()=>{switch(H){case"1h":return"Last hour";case"6h":return"Last 6 hours";case"12h":return"Last 12 hours";case"24h":return"Last 24 hours";case"7d":return"Last 7 days";case"30d":return"Last 30 days";case"live":return"Live data";case"custom":return"Custom range";default:return"Last 24 hours"}},[H]),[k,_]=s.useState(()=>{const t=localStorage.getItem(q.DASHBOARD_CARD_VISIBILITY);if(t)try{return{...Q,...JSON.parse(t)}}catch(n){return console.error("Failed to parse card visibility settings:",n),Q}return Q});s.useEffect(()=>{localStorage.setItem(q.DASHBOARD_CARD_VISIBILITY,JSON.stringify(k))},[k]),s.useEffect(()=>{const t=n=>{u.current&&!u.current.contains(n.target)&&(B(!1),i(""))};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]);const $=s.useCallback(t=>{_(n=>({...n,[t]:!n[t]}))},[]),z=s.useCallback((t,n)=>{r(n),t.dataTransfer.effectAllowed="move"},[]),F=s.useCallback(()=>{r(null),b(null),R(!1),p.current=0},[]),Y=s.useCallback(t=>{const n=setTimeout(()=>{c&&c!==t?(j(L=>{const w=[...L],A=w.indexOf(c),P=w.indexOf(t);return w.splice(A,1),w.splice(P,0,c),w}),navigator.vibrate&&navigator.vibrate([50,50,50]),r(null),R(!1)):(R(!0),r(t),navigator.vibrate&&navigator.vibrate(50))},500);m(n)},[c]),G=s.useCallback(()=>{a&&(clearTimeout(a),m(null))},[a]),ce=s.useCallback(t=>{C&&c&&(t!==c&&(j(n=>{const L=[...n],w=L.indexOf(c),A=L.indexOf(t);return L.splice(w,1),L.splice(A,0,c),L}),navigator.vibrate&&navigator.vibrate([50,50,50])),r(null),R(!1),b(null))},[C,c]),ie=s.useCallback(t=>{t.preventDefault(),t.dataTransfer.dropEffect="move"},[]),de=s.useCallback((t,n)=>{t.preventDefault(),p.current++,n&&n!==c&&b(n)},[c]),me=s.useCallback(()=>{p.current--,p.current===0&&b(null)},[]),he=s.useCallback((t,n)=>{t.preventDefault(),t.stopPropagation(),c&&n&&c!==n&&j(L=>{const w=[...L],A=w.indexOf(c),P=w.indexOf(n);return w.splice(A,1),w.splice(P,0,c),w}),b(null),p.current=0},[c]),ue=s.useCallback(()=>{j(W)},[]),pe=s.useCallback(()=>{l(!1),localStorage.setItem("dashboard-hide-drag-hint","true")},[]),E=s.useMemo(()=>{var w,A,P,ae;const t=[...new Set(x.map(J=>J.clientIp))].length,n=x.length,L=y.reduce((J,ve)=>J+(ve.totalDownloads||0),0);return{activeClients:t,totalActiveDownloads:n,totalDownloads:L,bandwidthSaved:((w=h==null?void 0:h.period)==null?void 0:w.bandwidthSaved)||0,addedToCache:((A=h==null?void 0:h.period)==null?void 0:A.addedToCache)||0,totalServed:((P=h==null?void 0:h.period)==null?void 0:P.totalServed)||0,cacheHitRatio:((ae=h==null?void 0:h.period)==null?void 0:ae.hitRatio)||0,uniqueClients:(h==null?void 0:h.uniqueClients)||D.length}},[x,y,h,D]),X=s.useMemo(()=>{var t;return{totalCache:{key:"totalCache",title:"Total Cache",value:d?N(d.totalCacheSize):"0 B",subtitle:"Drive capacity",icon:He,color:"blue",visible:k.totalCache,tooltip:O.totalCache},usedSpace:{key:"usedSpace",title:"Used Space",value:d?N(d.usedCacheSize):"0 B",subtitle:d?V(d.usagePercent):"0%",icon:Le,color:"green",visible:k.usedSpace,tooltip:O.usedSpace},bandwidthSaved:{key:"bandwidthSaved",title:"Bandwidth Saved",value:N(E.bandwidthSaved),subtitle:g().toLowerCase(),icon:ke,color:"emerald",visible:k.bandwidthSaved,tooltip:O.bandwidthSaved},addedToCache:{key:"addedToCache",title:"Added to Cache",value:N(E.addedToCache),subtitle:g().toLowerCase(),icon:Se,color:"purple",visible:k.addedToCache,tooltip:O.addedToCache},totalServed:{key:"totalServed",title:"Total Served",value:N(E.totalServed),subtitle:g().toLowerCase(),icon:Te,color:"indigo",visible:k.totalServed,tooltip:O.totalServed},activeDownloads:{key:"activeDownloads",title:"Active Downloads",value:E.totalActiveDownloads,subtitle:`${((t=h==null?void 0:h.period)==null?void 0:t.downloads)||S.length} in period`,icon:De,color:"orange",visible:k.activeDownloads,tooltip:O.activeDownloads},activeClients:{key:"activeClients",title:"Active Clients",value:E.uniqueClients,subtitle:`${E.totalDownloads} downloads`,icon:Ne,color:"yellow",visible:k.activeClients,tooltip:O.activeClients},cacheHitRatio:{key:"cacheHitRatio",title:"Cache Hit Ratio",value:V(E.cacheHitRatio*100),subtitle:g().toLowerCase(),icon:we,color:"cyan",visible:k.cacheHitRatio,tooltip:O.cacheHitRatio}}},[d,k,E,H,g,h,S]),K=s.useMemo(()=>M.map(t=>X[t]).filter(t=>t!==void 0),[M,X]),xe=K.filter(t=>t.visible),ee=K.filter(t=>!t.visible),U=ee.length,te=ee.filter(t=>t.title.toLowerCase().includes(T.toLowerCase())||t.subtitle&&t.subtitle.toLowerCase().includes(T.toLowerCase())),ge=t=>({backgroundColor:{blue:"var(--theme-icon-blue)",green:"var(--theme-icon-green)",emerald:"var(--theme-icon-emerald)",purple:"var(--theme-icon-purple)",indigo:"var(--theme-icon-indigo)",orange:"var(--theme-icon-orange)",yellow:"var(--theme-icon-yellow)",cyan:"var(--theme-icon-cyan)"}[t]||"var(--theme-icon-gray)"});return e.jsxs("div",{className:"space-y-6",onClick:t=>{C&&!t.target.closest("[data-card-key]")&&G()},children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-themed-primary tracking-tight hidden md:block",children:"Dashboard"}),e.jsx("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 w-full sm:w-auto",children:e.jsxs("button",{onClick:ue,className:"flex items-center gap-2 px-3 py-2 text-sm transition-colors rounded-lg border order-2 sm:order-1 w-full sm:w-auto justify-center sm:justify-start",style:{color:"var(--theme-text-secondary)",backgroundColor:"var(--theme-bg-secondary)",borderColor:"var(--theme-border-primary)"},onMouseEnter:t=>{t.currentTarget.style.backgroundColor="var(--theme-bg-hover)",t.currentTarget.style.color="var(--theme-text-primary)"},onMouseLeave:t=>{t.currentTarget.style.backgroundColor="var(--theme-bg-secondary)",t.currentTarget.style.color="var(--theme-text-secondary)"},title:"Reset card layout to default order",children:[e.jsx(Me,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Reset Layout"}),e.jsx("span",{className:"sm:hidden",children:"Reset Card Layout"})]})})]}),U>0&&e.jsxs("div",{className:"relative",ref:u,children:[e.jsxs("div",{className:"rounded-lg px-4 py-2 border flex items-center justify-between",style:{backgroundColor:"var(--theme-bg-secondary)",borderColor:"var(--theme-border-primary)"},children:[e.jsxs("span",{className:"text-sm text-themed-muted",children:[U," stat card",U!==1?"s":""," hidden"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>B(!f),className:"flex items-center gap-1 text-xs text-themed-accent transition-colors px-2 py-1 rounded-lg",onMouseEnter:t=>t.currentTarget.style.backgroundColor="var(--theme-bg-hover)",onMouseLeave:t=>t.currentTarget.style.backgroundColor="transparent",children:["Add cards",e.jsx(Be,{className:`w-3 h-3 transition-transform ${f?"rotate-180":""}`})]}),e.jsx("button",{onClick:()=>_(Q),className:"text-xs text-themed-accent transition-colors px-2 py-1 rounded-lg",onMouseEnter:t=>t.currentTarget.style.backgroundColor="var(--theme-bg-hover)",onMouseLeave:t=>t.currentTarget.style.backgroundColor="transparent",children:"Show all"})]})]}),f&&e.jsxs("div",{className:"absolute right-0 mt-2 w-80 rounded-lg border shadow-xl z-50",style:{backgroundColor:"var(--theme-bg-secondary)",borderColor:"var(--theme-border-primary)"},children:[e.jsx("div",{className:"p-3 border-b",style:{borderColor:"var(--theme-border-primary)"},children:e.jsxs("div",{className:"relative",children:[e.jsx(Re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-themed-muted"}),e.jsx("input",{type:"text",value:T,onChange:t=>i(t.target.value),placeholder:"Search hidden cards...",className:"w-full pl-10 pr-3 py-2 rounded-lg focus:outline-none text-sm themed-input",style:{backgroundColor:"var(--theme-bg-hover)",color:"var(--theme-text-primary)",border:"2px solid var(--theme-primary)"},autoFocus:!0})]})}),e.jsx("div",{className:"max-h-96 overflow-y-auto p-2",children:te.length>0?te.map(t=>{const n=t.icon;return e.jsxs("button",{onClick:()=>{$(t.key),U===1&&(B(!1),i(""))},className:"w-full p-3 rounded-lg transition-colors flex items-center gap-3 group",onMouseEnter:L=>L.currentTarget.style.backgroundColor="var(--theme-bg-hover)",onMouseLeave:L=>L.currentTarget.style.backgroundColor="transparent",children:[e.jsx("div",{className:"p-2 rounded-lg group-hover:scale-110 transition-transform",style:ge(t.color),children:e.jsx(n,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("div",{className:"text-sm text-themed-secondary font-medium",children:t.title}),e.jsx("div",{className:"text-xs text-themed-muted",children:t.subtitle})]}),e.jsx(Ie,{className:"w-4 h-4 text-themed-muted group-hover:text-themed-accent transition-colors"})]},t.key)}):e.jsxs("div",{className:"px-3 py-6 text-center text-themed-muted text-sm",children:['No hidden cards match "',T,'"']})})]})]}),I&&e.jsx("div",{className:"text-center py-4",children:e.jsxs("div",{className:"inline-flex items-center gap-2 text-themed-muted",children:[e.jsx(Ee,{className:"animate-spin h-5 w-5"}),e.jsxs("span",{children:["Loading ",g().toLowerCase()," data..."]})]})}),v&&e.jsx("div",{className:"md:hidden",children:C?e.jsx("div",{className:"text-center py-2 px-4 rounded-lg bg-primary text-white text-sm animate-pulse",children:"ðŸ”„ Drag mode active - Tap another card to move here, or tap anywhere to cancel"}):e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-themed-secondary text-themed-muted text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ’¡"}),e.jsx("span",{children:"Hold any card for 0.5 seconds to select it, then tap another card to swap positions"})]}),e.jsx("button",{onClick:pe,className:"ml-2 p-1 rounded hover:bg-themed-hover transition-colors flex-shrink-0",style:{color:"var(--theme-text-muted)"},title:"Hide this hint",children:e.jsx(Ae,{className:"w-4 h-4"})})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:xe.map(t=>e.jsxs("div",{"data-card-key":t.key,className:`relative group transition-all duration-200 ${C&&c===t.key?"scale-105 shadow-lg":""} ${C&&o===t.key?"transform translate-y-1":""}`,style:{boxShadow:o===t.key?"0 0 0 2px var(--theme-primary)":"none",cursor:c===t.key?"grabbing":"default",opacity:C&&c===t.key?.8:1},draggable:!C,onDragStart:n=>z(n,t.key),onDragEnd:F,onDragOver:ie,onDragEnter:n=>de(n,t.key),onDragLeave:me,onDrop:n=>he(n,t.key),onTouchStart:()=>Y(t.key),onTouchEnd:G,onClick:()=>ce(t.key),children:[e.jsx("div",{className:"absolute top-2 left-2 opacity-0 group-hover:opacity-100 transition-all p-1 rounded hidden md:block",style:{cursor:"grab",zIndex:5},title:"Drag to reorder",onMouseEnter:n=>{n.currentTarget.style.backgroundColor="var(--theme-bg-hover)"},onMouseLeave:n=>{n.currentTarget.style.backgroundColor="transparent"},children:e.jsx(se,{className:"w-4 h-4 transition-colors",style:{color:"var(--theme-drag-handle)"},onMouseEnter:n=>{n.currentTarget.style.color="var(--theme-drag-handle-hover)"},onMouseLeave:n=>{n.currentTarget.style.color="var(--theme-drag-handle)"}})}),e.jsx("div",{className:"absolute top-2 left-2 transition-all p-1 rounded md:hidden opacity-60",style:{cursor:"grab",zIndex:5,backgroundColor:"transparent"},title:"Hold to reorder",children:e.jsx(se,{className:"w-4 h-4 transition-colors",style:{color:"var(--theme-drag-handle)"}})}),C&&c===t.key&&e.jsx("div",{className:"absolute inset-0 rounded-lg border-2 border-dashed md:hidden",style:{borderColor:"var(--theme-primary)",backgroundColor:"rgba(var(--theme-primary-rgb), 0.1)",zIndex:5}}),e.jsx(ze,{title:t.title,value:t.value,subtitle:t.subtitle,icon:t.icon,color:t.color,tooltip:t.tooltip}),e.jsx("button",{onClick:()=>$(t.key),className:"absolute top-2 right-2 p-1.5 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity",style:{backgroundColor:"var(--theme-bg-hover)"},title:"Hide this card",children:e.jsx(Oe,{className:"w-3.5 h-3.5 text-themed-muted"})})]},t.key))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(Fe,{serviceStats:y||[],timeRange:H}),e.jsx(ne,{downloads:S||[],timeRange:H})]}),e.jsx(le,{clientStats:D||[],downloads:S||[],timeRange:H})]})};export{We as default};
//# sourceMappingURL=Dashboard-BLfxoDu_.js.map

var Ot=Object.defineProperty;var zt=(o,i,a)=>i in o?Ot(o,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[i]=a;var ee=(o,i,a)=>zt(o,typeof i!="symbol"?i+"":i,a);import{r as c,n as Et,j as e,X as Be,g as Me,K as et,J as xt,N as ce,H as Wt,O as bt,i as he,L as ue,P as yt,Q as vt,V as jt,W as tt,l as We,Y as st,_ as at,$ as rt,a0 as ke,a1 as ot,a2 as lt,a3 as nt,a4 as qt,a5 as Oe,v as Ut,E as wt,a6 as ct,D as Ne,a7 as _t,I as ze,a8 as Gt,a9 as Te,aa as Qt,ab as Kt,A as it,w as Vt,ac as Yt,U as Jt,q as Xt,S as Zt,ad as es,u as dt,b as mt,c as ut,ae as ht,af as Ae,ag as pt,ah as ft,ai as ts,aj as ss,ak as as}from"./react-vendor-BKkFPE2a.js";import{b as J,B as H,A as U,t as E,c as gt,a as rs}from"./index-BWakVz_d.js";import{f as Se,C as te}from"./Card-DwLTxh2g.js";import{A as q}from"./Alert-z41paNou.js";import{H as os}from"./signalr-C7Jyn4vH.js";import"./vendor-BmYUbuLR.js";async function ls(o){try{const i=await fetch(o,{signal:AbortSignal.timeout(5e3)});return i.ok?{ok:!0,data:await i.json()}:{ok:!1,error:`HTTP ${i.status}`}}catch(i){return{ok:!1,error:i.message}}}const Ee={},ns=()=>{if(!(typeof import.meta<"u"&&(Ee!=null&&Ee.VITE_API_URL)))return""},ne=ns();class cs{constructor(){ee(this,"requestQueue",[]);ee(this,"activeRequests",0);ee(this,"MAX_CONCURRENT_REQUESTS",3);ee(this,"REQUEST_DELAY_MS",100);ee(this,"updateDebounceTimers",new Map);ee(this,"UPDATE_DEBOUNCE_MS",500)}async getState(i){const a=await ls(`${ne}/api/operationstate/${i}`);return a.ok?a.data:null}async saveState(i,a,n,f=30){return this.queueRequest(async()=>{try{const r=await this.fetchWithRetry(`${ne}/api/operationstate`,{method:"POST",headers:{"Content-Type":"application/json",...J.getAuthHeaders()},body:JSON.stringify({key:i,type:a,data:n,expirationMinutes:f})});if(!r.ok){const d=await r.text();throw new Error(`Failed to save state: ${d}`)}return await r.json()}catch(r){throw console.error("Error saving state:",r),r}})}async updateState(i,a){return new Promise(n=>{const f=this.updateDebounceTimers.get(i);f&&clearTimeout(f);const r=setTimeout(()=>{this.updateDebounceTimers.delete(i),this.queueRequest(async()=>{try{const d=`${ne}/api/operationstate/${encodeURIComponent(i)}`,h=await fetch(d,{method:"PATCH",headers:{"Content-Type":"application/json",...J.getAuthHeaders()},body:JSON.stringify({updates:a||{}})});if(!h.ok){const x=await h.text();throw console.error("Update state response:",h.status,x),new Error(`Failed to update state: ${h.status} - ${x}`)}return await h.json()}catch(d){return console.error("Error updating state:",d),null}}).then(n)},this.UPDATE_DEBOUNCE_MS);this.updateDebounceTimers.set(i,r)})}async removeState(i){return this.queueRequest(async()=>{try{const a=await this.fetchWithRetry(`${ne}/api/operationstate/${encodeURIComponent(i)}`,{method:"DELETE",headers:J.getAuthHeaders()});if(!a.ok)throw new Error("Failed to remove state");return await a.json()}catch(a){throw console.error("Error removing state:",a),a}})}async getAllStates(i=null){try{const a=i?`${ne}/api/operationstate?type=${i}`:`${ne}/api/operationstate`,n=await fetch(a,{headers:J.getAuthHeaders()});if(!n.ok)throw new Error("Failed to get states");return await n.json()}catch(a){return console.error("Error getting all states:",a),[]}}async migrateFromLocalStorage(){const i=["activeCacheClearOperation","activeLogProcessing","activeServiceRemoval"];let a=0;for(const n of i)try{const f=localStorage.getItem(n);if(f){const r=JSON.parse(f);let d="general";n.includes("CacheClear")?d="cacheClearing":n.includes("LogProcessing")?d="logProcessing":n.includes("ServiceRemoval")&&(d="serviceRemoval"),await this.saveState(n,d,r,120),localStorage.removeItem(n),a++}}catch(f){console.error(`Failed to migrate ${n}:`,f)}return a}async queueRequest(i){return new Promise((a,n)=>{const f={execute:i,resolve:a,reject:n};this.requestQueue.push(f),this.processQueue()})}async processQueue(){if(this.activeRequests>=this.MAX_CONCURRENT_REQUESTS||this.requestQueue.length===0)return;const i=this.requestQueue.shift();if(i){this.activeRequests++;try{await new Promise(n=>setTimeout(n,this.REQUEST_DELAY_MS));const a=await i.execute();i.resolve(a)}catch(a){i.reject(a)}finally{this.activeRequests--,this.processQueue()}}}async fetchWithRetry(i,a,n=3,f=1e3){let r;for(let d=0;d<n;d++){try{const h=await fetch(i,a);if(h.ok||h.status<500)return h;r=new Error(`HTTP ${h.status}`)}catch(h){if(r=h,h.name==="TypeError"&&h.message.includes("Failed to fetch"))console.log(`Retry attempt ${d+1}/${n} after network error`);else throw h}if(d<n-1){const h=f*Math.pow(2,d);await new Promise(x=>setTimeout(x,h))}}throw r}}const me=new cs,qe=(o,i="general",a=30)=>{const[n,f]=c.useState(null),[r,d]=c.useState(!1),[h,x]=c.useState(null),C=c.useCallback(async y=>{d(!0),x(null);try{await me.saveState(o,i,y,a);const m={key:o,type:i,data:y,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return f(m),m}catch(m){throw console.error(`Failed to save ${o}:`,m),x(m.message),m}finally{d(!1)}},[o,i,a]),g=c.useCallback(async()=>{d(!0),x(null);try{const y=await me.getState(o);if(y){const m=y,B={key:m.key||o,type:m.type||i,data:m.data||{},createdAt:m.createdAt||new Date().toISOString(),updatedAt:m.updatedAt||m.createdAt||new Date().toISOString()};return f(B),B}return null}catch(y){return console.error(`Failed to load ${o}:`,y),x(y.message),null}finally{d(!1)}},[o,i]),S=c.useCallback(async()=>{d(!0),x(null);try{await me.removeState(o),f(null)}catch(y){throw console.error(`Failed to clear ${o}:`,y),x(y.message),y}finally{d(!1)}},[o]),R=c.useCallback(async y=>{d(!0),x(null);try{await me.updateState(o,y),f(m=>m?{...m,data:{...m.data,...y},updatedAt:new Date().toISOString()}:null)}catch(m){throw console.error(`Failed to update ${o}:`,m),x(m.message),m}finally{d(!1)}},[o]);return c.useEffect(()=>{o&&g()},[o]),{operation:n,save:C,load:g,clear:S,update:R,loading:r,error:h}},Pe=({opened:o,onClose:i,title:a,children:n,size:f="md"})=>{const r={sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"};return Et.useEffect(()=>(o?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[o]),o?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:`themed-card rounded-lg ${r[f]} w-full mx-4 max-h-[90vh] overflow-y-auto custom-scrollbar`,children:[a&&e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-themed-secondary",children:[e.jsx("div",{className:"text-lg font-semibold text-themed-primary",children:a}),e.jsx("button",{onClick:i,className:"p-1 hover:bg-themed-hover rounded-lg smooth-transition",children:e.jsx(Be,{className:"w-5 h-5 text-themed-muted"})})]}),e.jsx("div",{className:"p-6",children:n})]})}):null},is=({onAuthChange:o,onError:i,onSuccess:a})=>{const[n,f]=c.useState(!1),[r,d]=c.useState(!0),[h,x]=c.useState(!1),[C,g]=c.useState(""),[S,R]=c.useState(""),[y,m]=c.useState(!1);c.useEffect(()=>{B()},[]);const B=async()=>{d(!0);try{const L=await J.checkAuth();f(L.isAuthenticated),o==null||o(L.isAuthenticated),!L.isAuthenticated&&J.isRegistered()&&J.clearAuth()}catch(L){console.error("Auth check failed:",L),f(!1),o==null||o(!1)}finally{d(!1)}},_=async()=>{if(!C.trim()){R("Please enter an API key");return}m(!0),R("");try{const L=await J.register(C);L.success?(f(!0),o==null||o(!0),x(!1),g(""),a==null||a("Authentication successful! You can now use management features.")):R(L.message||"Authentication failed")}catch(L){console.error("Authentication error:",L),R(L.message||"Authentication failed")}finally{m(!1)}},K=async()=>{if(window.confirm(`WARNING: This will:

1. Generate a NEW API key on the server
2. Revoke ALL existing device registrations
3. Require ALL users to re-authenticate
4. You must check the container logs for the new key

This cannot be undone. Continue?`)){m(!0);try{const b=await J.regenerateApiKey();b.success?(f(!1),o==null||o(!1),x(!1),i==null||i("API KEY REGENERATED - Check container logs for new key!"),a==null||a(b.message),setTimeout(()=>{x(!0)},3e3)):i==null||i(b.message||"Failed to regenerate API key")}catch(b){console.error("Error regenerating key:",b),i==null||i("Failed to regenerate API key: "+b.message)}finally{m(!1)}}};return r?null:e.jsxs(e.Fragment,{children:[e.jsx(q,{color:n?"green":"yellow",icon:n?e.jsx(xt,{className:"w-5 h-5"}):e.jsx(ce,{className:"w-5 h-5"}),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:n?"Authenticated":"Not Authenticated"}),e.jsx("p",{className:"text-xs mt-1 opacity-75",children:n?"Management features enabled":"Management features require API key"})]}),n?e.jsx(H,{variant:"filled",color:"red",size:"sm",leftSection:e.jsx(Me,{className:"w-3 h-3"}),onClick:K,loading:y,children:"Regenerate Key"}):e.jsx(H,{variant:"filled",color:"yellow",leftSection:e.jsx(et,{className:"w-4 h-4"}),onClick:()=>x(!0),children:"Authenticate"})]})}),e.jsx(Pe,{opened:h,onClose:()=>{x(!1),g(""),R("")},title:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(et,{className:"w-6 h-6 text-themed-warning"}),e.jsx("span",{children:"Authentication Required"})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-themed-secondary",children:"Management operations require authentication. Please enter your API key to continue."}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-themed-secondary mb-2",children:"API Key"}),e.jsx("input",{type:"password",value:C,onChange:L=>g(L.target.value),onKeyPress:L=>L.key==="Enter"&&_(),placeholder:"lm_xxxxxxxxxxxxxxxxxxxxx",className:"w-full px-3 py-2 themed-input text-themed-primary placeholder-themed-muted focus:outline-none",disabled:y})]}),S&&e.jsx(q,{color:"red",children:S}),e.jsx(q,{color:"blue",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium mb-2",children:"To find your API key:"}),e.jsxs("ol",{className:"list-decimal list-inside text-xs space-y-1",children:[e.jsx("li",{children:"SSH into your server"}),e.jsxs("li",{children:["Check the file:"," ",e.jsx("code",{className:"bg-themed-tertiary px-1 rounded",children:"/data/api_key.txt"})]}),e.jsx("li",{children:"Or check the API container logs on startup"})]})]})}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-themed-secondary",children:[e.jsx(H,{variant:"default",onClick:()=>{x(!1),g(""),R("")},disabled:y,children:"Cancel"}),e.jsx(H,{variant:"filled",color:"blue",leftSection:e.jsx(ce,{className:"w-4 h-4"}),onClick:_,loading:y,disabled:!C.trim(),children:"Authenticate"})]})]})})]})},ds=({isAuthenticated:o,mockMode:i,onError:a,onSuccess:n,onBackgroundOperation:f})=>{var Q;const[r,d]=c.useState(null),[h,x]=c.useState(!1),[C,g]=c.useState(!1),[S,R]=c.useState({cachePath:"/cache",logPath:"/logs/access.log",services:[]}),y=qe("activeCacheClearOperation","cacheClearing",30),m=c.useRef(f);c.useEffect(()=>{m.current=f}),c.useEffect(()=>{var $;(($=y.operation)==null?void 0:$.data)&&!h&&r&&["Running","Preparing"].includes(r.status)&&m.current?m.current({bytesDeleted:r.bytesDeleted,progress:r.percentComplete||r.progress||0,showModal:()=>x(!0)}):m.current&&m.current(null)},[y.operation,h,r]),c.useEffect(()=>{B(),_()},[]);const B=async()=>{try{const N=await U.getConfig();R(N)}catch(N){console.error("Failed to load config:",N)}},_=async()=>{var $;const N=await y.load();if(($=N==null?void 0:N.data)!=null&&$.operationId)try{const P=await U.getCacheClearStatus(N.data.operationId);P&&["Running","Preparing"].includes(P.status)?(d(P),K(N.data.operationId)):await y.clear()}catch{await y.clear()}},K=N=>{const $=setInterval(async()=>{try{const P=await U.getCacheClearStatus(N);d(P),["Running","Preparing"].includes(P.status)?await y.update({lastProgress:P.percentComplete||P.progress||0}):(L(P),clearInterval($))}catch(P){console.error("Error polling cache clear status:",P),clearInterval($)}},1e3)},L=async N=>{await y.clear(),N.status==="Completed"?(n==null||n(`Cache cleared successfully! ${Se(N.bytesDeleted||0)} freed.`),setTimeout(()=>{x(!1),d(null)},2e3)):N.status==="Failed"?(a==null||a(`Cache clearing failed: ${N.error||N.message||"Unknown error"}`),setTimeout(()=>{x(!1),d(null)},5e3)):N.status==="Cancelled"&&(n==null||n("Cache clearing cancelled"),x(!1),d(null))},b=async()=>{if(!o){a==null||a("Authentication required");return}if(window.confirm("This will clear ALL cached game files. Continue?")){g(!0);try{const N=await U.clearAllCache();N.operationId&&(await y.save({operationId:N.operationId}),d({operationId:N.operationId,status:"Preparing",statusMessage:"Starting cache clear...",percentComplete:0,bytesDeleted:0,totalBytesToDelete:0}),x(!0),K(N.operationId))}catch(N){a==null||a("Failed to start cache clearing: "+N.message)}finally{g(!1)}}},T=async()=>{var $;const N=y.operation;if(($=N==null?void 0:N.data)!=null&&$.operationId)try{d(P=>P?{...P,status:"Cancelling",statusMessage:"Cancelling operation..."}:null),await U.cancelCacheClear(N.data.operationId),await y.clear(),setTimeout(()=>{x(!1),d(null),n==null||n("Cache clearing operation cancelled")},1500)}catch(P){console.error("Failed to cancel cache clear:",P),x(!1),d(null),await y.clear()}},W=((Q=y.operation)==null?void 0:Q.data)&&!h&&r&&["Running","Preparing"].includes(r.status),F=(r==null?void 0:r.percentComplete)||(r==null?void 0:r.progress)||0;return e.jsxs(e.Fragment,{children:[e.jsxs(te,{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(Wt,{className:"w-5 h-5 text-themed-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-themed-primary",children:"Disk Cache Management"})]}),e.jsxs("p",{className:"text-themed-muted text-sm mb-4",children:["Manage cached game files in"," ",e.jsx("code",{className:"bg-themed-tertiary px-2 py-1 rounded",children:S.cachePath})]}),e.jsx(H,{fullWidth:!0,variant:"filled",color:"red",leftSection:e.jsx(bt,{className:"w-4 h-4"}),onClick:b,disabled:C||i||W||y.loading||!o,loading:C||y.loading,children:W?"Cache Clearing in Progress...":"Clear All Cached Files"}),e.jsx("p",{className:"text-xs text-themed-muted mt-2",children:"⚠️ This deletes ALL cached game files from disk"})]}),e.jsx(Pe,{opened:h&&r!==null,onClose:()=>{["Running","Preparing"].includes((r==null?void 0:r.status)||"")||(x(!1),d(null))},title:"Clearing Cache",size:"lg",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[(r==null?void 0:r.status)==="Completed"?e.jsx(he,{className:"w-5 h-5 cache-hit"}):(r==null?void 0:r.status)==="Failed"?e.jsx(Me,{className:"w-5 h-5 text-themed-error"}):e.jsx(ue,{className:"w-5 h-5 text-themed-primary animate-spin"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-themed-primary font-medium",children:r==null?void 0:r.status}),((r==null?void 0:r.statusMessage)||(r==null?void 0:r.message))&&e.jsx("p",{className:"text-sm text-themed-muted",children:(r==null?void 0:r.statusMessage)||(r==null?void 0:r.message)})]})]}),r&&["Running","Preparing"].includes(r.status)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full progress-track rounded-full h-4 relative overflow-hidden",children:[e.jsx("div",{className:"progress-bar-medium h-4 rounded-full smooth-transition",style:{width:`${Math.min(100,F)}%`}}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("span",{className:"text-xs text-themed-primary font-medium",children:[F.toFixed(0),"%"]})})]}),r.bytesDeleted!==void 0&&r.totalBytesToDelete&&r.totalBytesToDelete>0&&e.jsxs("div",{className:"text-sm text-themed-muted text-center",children:[e.jsx("span",{className:"cache-hit font-semibold",children:Se(r.bytesDeleted||0)})," / ",e.jsx("span",{className:"text-themed-primary",children:Se(r.totalBytesToDelete)})," cleared"]})]}),(r==null?void 0:r.error)&&e.jsx(q,{color:"red",children:r.error}),e.jsx("div",{className:"flex justify-end space-x-3 pt-4 border-t border-themed-secondary",children:r&&["Running","Preparing"].includes(r.status)?e.jsxs(e.Fragment,{children:[e.jsx(H,{variant:"filled",color:"red",leftSection:e.jsx(yt,{className:"w-4 h-4"}),onClick:T,children:"Cancel"}),e.jsx(H,{variant:"default",onClick:()=>x(!1),children:"Run in Background"})]}):e.jsx(H,{variant:"default",onClick:()=>{x(!1),d(null)},children:"Close"})})]})}),y.error&&e.jsxs(q,{color:"orange",children:["Backend storage error: ",y.error]})]})},ms=({isAuthenticated:o,mockMode:i,onError:a,onSuccess:n,onDataRefresh:f,onBackgroundOperation:r})=>{const[d,h]=c.useState(!1),[x,C]=c.useState(null),[g,S]=c.useState(!1),[R,y]=c.useState(!1),[m,B]=c.useState(null),[_,K]=c.useState(!1),[L,b]=c.useState(60),T=qe("activeLogProcessing","logProcessing",120),W=c.useRef(null),F=c.useRef(null),Q=c.useRef(null),N=c.useRef(null),$=c.useRef(null),P=c.useRef(r);c.useEffect(()=>{P.current=r}),c.useEffect(()=>{d&&x&&P.current?P.current({message:x.message,detailMessage:x.detailMessage,progress:x.progress,estimatedTime:x.estimatedTime,status:x.status,onCancel:fe}):P.current&&P.current(null)},[d,x]),c.useEffect(()=>(pe(),ie(),re(),()=>{F.current&&clearInterval(F.current),Q.current&&clearTimeout(Q.current),N.current&&clearInterval(N.current),$.current&&clearInterval($.current),W.current&&W.current.stop()}),[]);const pe=async()=>{var p,O;const k=await T.load();if(k!=null&&k.data){const D=await U.getProcessingStatus().catch(()=>null);D!=null&&D.isProcessing?(h(!0),C({message:`Processing: ${((p=D.mbProcessed)==null?void 0:p.toFixed(1))||0} MB of ${((O=D.mbTotal)==null?void 0:O.toFixed(1))||0} MB`,detailMessage:D.processingRate?`Speed: ${D.processingRate.toFixed(1)} MB/s`:"",progress:D.percentComplete||D.progress||0,estimatedTime:D.estimatedTime,status:D.status||"processing"}),se()):await T.clear()}},ie=async()=>{try{const k=new os().withUrl("/hubs/downloads").withAutomaticReconnect([0,2e3,5e3,1e4,3e4]).build();k.on("ProcessingProgress",async p=>{C(O=>{var G,w;if((O==null?void 0:O.status)==="complete")return O;const D=p.percentComplete||p.progress||0;return D>=100?(F.current&&clearInterval(F.current),{message:"Processing Complete!",detailMessage:`Successfully processed ${p.entriesProcessed||0} entries from ${p.linesProcessed||0} lines`,progress:100,status:"complete"}):{message:`Processing: ${((G=p.mbProcessed)==null?void 0:G.toFixed(1))||0} MB of ${((w=p.mbTotal)==null?void 0:w.toFixed(1))||0} MB`,detailMessage:`${p.entriesProcessed||0} entries from ${p.linesProcessed||0} lines`,progress:D,status:"processing"}}),h(!0),await T.update({lastProgress:p.percentComplete||p.progress||0,mbProcessed:p.mbProcessed,mbTotal:p.mbTotal,entriesProcessed:p.entriesProcessed,linesProcessed:p.linesProcessed})}),k.on("BulkProcessingComplete",async p=>{var D,G,w;F.current&&clearInterval(F.current);const O=p.depotMappingsProcessed??0;C({message:"Processing Complete!",detailMessage:`Successfully processed ${(D=p.entriesProcessed)==null?void 0:D.toLocaleString()} entries from ${(G=p.linesProcessed)==null?void 0:G.toLocaleString()} lines in ${(w=p.elapsed)==null?void 0:w.toFixed(1)} minutes. Applied ${O.toLocaleString()} depot mappings automatically.`,progress:100,status:"complete"}),h(!0),await T.clear(),O>0&&(n==null||n(`Depot mappings applied to ${O.toLocaleString()} downloads.`)),setTimeout(async()=>{h(!1),C(null),f==null||f()},3e3)}),k.on("DepotPostProcessingFailed",p=>{a==null||a(p!=null&&p.error?`Depot mapping post-processing failed: ${p.error}`:"Depot mapping post-processing failed.")}),k.onreconnecting(()=>{y(!1)}),k.onreconnected(()=>{y(!0)}),k.onclose(p=>{console.error("SignalR disconnected:",p),y(!1),d&&se(),Q.current=setTimeout(()=>{ie()},5e3)}),await k.start(),W.current=k,y(!0)}catch(k){console.error("SignalR connection failed, falling back to polling:",k),y(!1),d&&se()}},se=()=>{F.current&&clearInterval(F.current);const k=async()=>{var p,O,D;try{const G=x;if((G==null?void 0:G.status)==="complete"){F.current&&clearInterval(F.current);return}const w=await U.getProcessingStatus();w!=null&&w.isProcessing?(h(!0),C({message:`Processing: ${((p=w.mbProcessed)==null?void 0:p.toFixed(1))||0} MB of ${((O=w.mbTotal)==null?void 0:O.toFixed(1))||0} MB`,detailMessage:w.processingRate?`Speed: ${w.processingRate.toFixed(1)} MB/s`:"",progress:w.percentComplete||w.progress||0,estimatedTime:w.estimatedTime,status:w.status||"processing"}),await T.update({lastProgress:w.percentComplete||w.progress||0,mbProcessed:w.mbProcessed,mbTotal:w.mbTotal})):(F.current&&clearInterval(F.current),((w==null?void 0:w.percentComplete)||(w==null?void 0:w.progress)||0)>=100||(w==null?void 0:w.status)==="complete"||(w==null?void 0:w.currentPosition)&&(w==null?void 0:w.totalSize)&&w.currentPosition>=w.totalSize?(C({message:"Processing Complete!",detailMessage:`Processed ${((D=w.mbTotal)==null?void 0:D.toFixed(1))||0} MB`,progress:100,status:"complete"}),h(!0),await T.clear(),setTimeout(()=>{h(!1),C(null),f==null||f()},3e3)):(h(!1),C(null),await T.clear()))}catch(G){console.error("Error checking processing status:",G)}};k(),F.current=setInterval(k,3e3)},ae=async()=>{if(!o){a==null||a("Authentication required");return}S(!0);try{const k=await U.resetLogPosition();k&&(n==null||n(k.message||"Log position reset successfully"),setTimeout(()=>f==null?void 0:f(),2e3))}catch(k){a==null||a(k.message||"Failed to reset log position")}finally{S(!1)}},Z=async()=>{var k;if(!o){a==null||a("Authentication required");return}if(window.confirm("Process entire log file?")){S(!0);try{const p=await U.processAllLogs();if(p){if(p.status==="empty_file"||p.status==="no_log_file"||p.status==="insufficient_data"){a==null||a(p.message),S(!1);return}if(p.logSizeMB>0){await T.save({type:"processAll",resume:p.resume});const O=typeof p.remainingMB=="number"?p.remainingMB:p.logSizeMB||0,D=Math.max(0,(p.logSizeMB||0)-O),G=p.resume&&(p.logSizeMB||0)>0?Math.min(99,Math.max(0,D/(p.logSizeMB||1)*100)):0;h(!0),C({message:p.resume?"Resuming log processing...":"Preparing to process logs...",detailMessage:p.resume?`${O.toFixed(1)} MB remaining to import`:`${((k=p.logSizeMB)==null?void 0:k.toFixed(1))||0} MB to process`,progress:G,estimatedTime:p.estimatedTimeMinutes?`Estimated: ${p.estimatedTimeMinutes} minutes`:void 0,status:"starting"}),p.message&&(n==null||n(p.message)),R||setTimeout(()=>se(),5e3)}else a==null||a("Log file appears to be empty or invalid"),await T.clear()}else await T.clear()}catch(p){await T.clear(),a==null||a(p.message||"Failed to process logs")}finally{S(!1)}}},fe=async()=>{if(!o){a==null||a("Authentication required");return}if(window.confirm("Cancel log processing?")){S(!0);try{await U.cancelProcessing(),h(!1),await T.clear(),F.current&&clearInterval(F.current),n==null||n("Processing cancelled"),setTimeout(()=>{C(null),f==null||f()},5e3)}catch{a==null||a("Failed to cancel processing")}finally{S(!1)}}},re=()=>{const k=async()=>{try{const p=await fetch("/api/gameinfo/steamkit/progress");if(p.ok){const O=await p.json(),D=m==null?void 0:m.isRunning;B(O),D&&!O.isRunning&&O.status==="Complete"&&(K(!0),b(60),ge())}}catch(p){console.error("Failed to fetch depot status:",p)}};k(),N.current=setInterval(k,3e3)},ge=()=>{$.current&&clearInterval($.current),$.current=setInterval(()=>{b(k=>k<=1?(K(!1),$.current&&clearInterval($.current),0):k-1)},1e3)},X=()=>{K(!1),$.current&&clearInterval($.current)},xe=()=>{X(),Z()},oe=async()=>{if(!o){a==null||a("Authentication required");return}if(window.confirm("Reapply Depot Mappings to existing download data? This will update all downloads with the latest depot information.")){S(!0);try{const k=await fetch("/api/management/post-process-depot-mappings",{method:"POST",headers:{"Content-Type":"application/json"}});if(k.ok){const p=await k.json();n==null||n(p.message||`Successfully processed ${p.mappingsProcessed} downloads`),setTimeout(()=>f==null?void 0:f(),2e3)}else{const p=await k.json();a==null||a(p.error||"Failed to process depot mappings")}}catch(k){a==null||a(k.message||"Failed to process depot mappings")}finally{S(!1)}}};return e.jsxs(e.Fragment,{children:[e.jsxs(te,{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(vt,{className:"w-5 h-5 cache-hit"}),e.jsx("h3",{className:"text-lg font-semibold text-themed-primary",children:"Log Processing"})]}),e.jsx("p",{className:"text-themed-muted text-sm mb-4",children:"Control how access.log is processed for statistics"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(H,{variant:"filled",color:"yellow",leftSection:e.jsx(jt,{className:"w-4 h-4"}),onClick:ae,disabled:g||d||(m==null?void 0:m.isRunning)||i||T.loading||!o,fullWidth:!0,children:"Reset Log Position"}),e.jsx(H,{variant:"filled",color:"green",leftSection:e.jsx(tt,{className:"w-4 h-4"}),onClick:Z,disabled:g||d||(m==null?void 0:m.isRunning)||i||T.loading||!o,loading:T.loading,fullWidth:!0,children:"Process All Logs"})]}),e.jsx(H,{variant:"filled",color:"blue",leftSection:e.jsx(We,{className:"w-4 h-4"}),onClick:oe,disabled:g||d||(m==null?void 0:m.isRunning)||i||!o,fullWidth:!0,children:"Reapply Depot Mappings"})]}),(m==null?void 0:m.isRunning)&&e.jsx("div",{className:"mt-4 p-3 rounded-lg border",style:{backgroundColor:"var(--theme-info-bg)",borderColor:"var(--theme-info)",color:"var(--theme-info-text)"},children:e.jsxs("p",{className:"text-xs",children:[e.jsx("strong",{children:"Depot Processing Active:"})," Log processing is disabled while Steam PICS depot mapping is running. Progress: ",Math.round(m.progressPercent),"% (",m.processedBatches,"/",m.totalBatches," batches)"]})}),e.jsx("div",{className:"mt-4 p-3 bg-themed-tertiary rounded-lg",children:e.jsxs("p",{className:"text-xs text-themed-muted",children:[e.jsx("strong",{children:"Reset:"})," Start from current end of log",e.jsx("br",{}),e.jsx("strong",{children:"Process All:"})," Import entire log history",e.jsx("br",{}),e.jsx("strong",{children:"Reapply Depot Mappings:"})," Manually rerun depot mapping if needed. Log processing now applies mappings automatically after completion."]})}),T.error&&e.jsxs(q,{color:"orange",children:["Backend storage error: ",T.error]})]}),_&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"rounded-lg shadow-xl p-6 max-w-md w-full mx-4",style:{backgroundColor:"var(--theme-bg-primary)",border:"1px solid var(--theme-border-primary)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-themed-primary",children:"Depot Processing Complete"}),e.jsx("button",{onClick:X,className:"text-themed-muted hover:text-themed-primary transition-colors",children:e.jsx(Be,{className:"w-5 h-5"})})]}),e.jsx("p",{className:"text-themed-secondary mb-6",children:"Steam depot mapping has finished! Would you like to process all logs now to update download statistics with the new depot mappings?"}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(H,{variant:"filled",color:"green",leftSection:e.jsx(tt,{className:"w-4 h-4"}),onClick:xe,disabled:!o||i,fullWidth:!0,children:"Process All Logs"}),e.jsx(H,{variant:"outline",onClick:X,fullWidth:!0,children:"Maybe Later"})]}),e.jsx("div",{className:"mt-4 text-center",children:e.jsxs("span",{className:"text-xs text-themed-muted",children:["This popup will close in ",L," seconds"]})})]})})]})},us=({isAuthenticated:o})=>{const[i,a]=c.useState([]),[n,f]=c.useState("dark-default"),[r,d]=c.useState(!1),[h,x]=c.useState(!1),[C,g]=c.useState(null),[S,R]=c.useState(null),[y,m]=c.useState(null),[B,_]=c.useState(!1),[K,L]=c.useState(!1),[b,T]=c.useState(null),[W,F]=c.useState(["foundation"]),[Q,N]=c.useState("themes"),[$,P]=c.useState(null),[pe,ie]=c.useState(null),[se,ae]=c.useState({}),[Z,fe]=c.useState(""),[re,ge]=c.useState(""),[X,xe]=c.useState("category"),[oe,k]=c.useState("all"),[p,O]=c.useState("category"),[D,G]=c.useState("all"),[w,Ie]=c.useState(!1),[M,V]=c.useState({}),[I,Y]=c.useState({name:"",description:"",author:"",version:"1.0.0",isDark:!0,customCSS:""}),Ue=c.useRef(null),Ct=(t,s=1)=>{const u=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);if(!u)return t;const l=parseInt(u[1],16),j=parseInt(u[2],16),v=parseInt(u[3],16);return`rgba(${l}, ${j}, ${v}, ${s})`},be=t=>{const s=t.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)/);if(s){const u=parseInt(s[1]),l=parseInt(s[2]),j=parseInt(s[3]),v=s[4]?parseFloat(s[4]):1;return{hex:"#"+[u,l,j].map(z=>z.toString(16).padStart(2,"0")).join(""),alpha:v}}return{hex:t,alpha:1}},ye=(t,s,u,l=!1)=>{const j=u<1?Ct(s,u):s;l?Y(v=>({...v,[t]:j})):V(v=>({...v,[t]:j}))},kt=(t,s)=>{if(!s.trim())return t;const u=s.toLowerCase();return t.map(l=>{const j=l.colors.filter(v=>v.label.toLowerCase().includes(u)||v.description.toLowerCase().includes(u)||v.affects.some(A=>A.toLowerCase().includes(u))||v.key.toLowerCase().includes(u));return l.name.toLowerCase().includes(u)||l.description.toLowerCase().includes(u)?l:{...l,colors:j}}).filter(l=>l.colors.length>0)},Nt=(t,s)=>s==="all"?t:t.map(u=>{const l=u.colors.filter(j=>{var v;return(v=j.pages)==null?void 0:v.includes(s)});return{...u,colors:l}}).filter(u=>u.colors.length>0),_e=c.useCallback((t,s,u=!1)=>{let l=t;return(u?p:X)==="page"&&(l=Nt(l,u?D:oe)),s.trim()&&(l=kt(l,s)),l},[X,oe,p,D]),Ge=[{name:"all",label:"All Pages",icon:ke,description:"Colors used across all pages"},{name:"dashboard",label:"Dashboard",icon:Yt,description:"Main dashboard and overview page"},{name:"downloads",label:"Downloads",icon:Ne,description:"Downloads and active transfers"},{name:"clients",label:"Clients",icon:Jt,description:"Client connections and statistics"},{name:"services",label:"Services",icon:Xt,description:"Service status and statistics"},{name:"management",label:"Management",icon:Zt,description:"Cache and theme management"},{name:"charts",label:"Charts & Graphs",icon:es,description:"Data visualizations and charts"}],ve=[{name:"foundation",icon:st,description:"Core brand colors that define your theme's identity",colors:[{key:"primaryColor",label:"Primary Brand Color",description:"Main brand color used throughout",affects:["Primary buttons","Links","Active states","Focus rings"],supportsAlpha:!0,pages:["dashboard","downloads","clients","services","management"]},{key:"secondaryColor",label:"Secondary Brand Color",description:"Complementary brand accent",affects:["Secondary buttons","Highlights","Accents"],supportsAlpha:!0,pages:["dashboard","downloads","management"]},{key:"accentColor",label:"Accent Color",description:"Tertiary accent for special elements",affects:["Special badges","Tooltips","Info elements"],supportsAlpha:!0,pages:["dashboard","downloads","clients","services","management"]}]},{name:"content",icon:Gt,description:"Text colors for content hierarchy and readability",colors:[{key:"textPrimary",label:"Primary Text",description:"Main content text color",affects:["Headings","Body text","Labels"],supportsAlpha:!0,pages:["dashboard","downloads","clients","services","management"]},{key:"textSecondary",label:"Secondary Text",description:"Supporting content text",affects:["Descriptions","Subtitles","Help text"],supportsAlpha:!0,pages:["dashboard","downloads","clients","services","management"]},{key:"textMuted",label:"Muted Text",description:"De-emphasized text",affects:["Disabled text","Timestamps","Minor labels"],supportsAlpha:!0,pages:["dashboard","downloads","clients","services","management"]},{key:"textAccent",label:"Accent Text",description:"Highlighted or linked text",affects:["Links","Highlighted values","Active menu items"],supportsAlpha:!0,pages:["dashboard","downloads","clients","services","management"]},{key:"textPlaceholder",label:"Placeholder Text",description:"Input placeholder text color",affects:["Form placeholders","Search hints","Empty states"],supportsAlpha:!0,pages:["downloads","management"]}]},{name:"layout",icon:Te,description:"Background colors for UI surfaces and layers",colors:[{key:"bgPrimary",label:"Base Background",description:"Main application background",affects:["Body","Main container","Base layer"],supportsAlpha:!0,pages:["dashboard","downloads","clients","services","management"]},{key:"bgSecondary",label:"Surface Background",description:"Elevated surface backgrounds",affects:["Cards","Panels","Modals","Dialogs"],supportsAlpha:!0,pages:["dashboard","downloads","clients","services","management"]},{key:"bgTertiary",label:"Recessed Background",description:"Sunken or nested elements",affects:["Input fields","Wells","Code blocks"],supportsAlpha:!0,pages:["downloads","management"]},{key:"bgHover",label:"Hover State",description:"Interactive hover backgrounds",affects:["Button hovers","List hovers","Menu hovers"],supportsAlpha:!0,pages:["dashboard","downloads","clients","services","management"]},{key:"cardBg",label:"Card Background",description:"Card component background",affects:["Stat cards","Content cards","Widget backgrounds"],supportsAlpha:!0,pages:["dashboard","downloads","clients","services"]},{key:"cardBorder",label:"Card Border",description:"Card component borders",affects:["Card outlines","Panel borders"],supportsAlpha:!0,pages:["dashboard","downloads","clients","services"]}]},{name:"interactive",icon:Qt,description:"Interactive elements like buttons, inputs, and forms",colors:[{key:"buttonBg",label:"Button Background",description:"Primary button fill color",affects:["Primary buttons","Submit buttons","CTAs"],supportsAlpha:!0,pages:["management","downloads"]},{key:"buttonHover",label:"Button Hover",description:"Button hover state color",affects:["Button hover effects","Active button states"],supportsAlpha:!0},{key:"buttonText",label:"Button Text",description:"Button label color",affects:["Button labels","Button icons"],supportsAlpha:!0},{key:"inputBg",label:"Input Background",description:"Form input background",affects:["Text inputs","Textareas","Select boxes"],supportsAlpha:!0,pages:["management","downloads"]},{key:"inputBorder",label:"Input Border",description:"Form input border",affects:["Input outlines","Field borders"],supportsAlpha:!0},{key:"inputFocus",label:"Input Focus",description:"Focused input indicator",affects:["Active input borders","Focus rings"],supportsAlpha:!0},{key:"checkboxAccent",label:"Checkbox Accent",description:"Checkbox checked state color",affects:["Checkbox checkmarks","Checkbox backgrounds"],supportsAlpha:!1,pages:["downloads","management"]},{key:"checkboxBorder",label:"Checkbox Border",description:"Checkbox border color when unchecked",affects:["Checkbox borders","Unchecked state"],supportsAlpha:!0},{key:"sliderAccent",label:"Slider Accent",description:"Range slider accent color",affects:["Slider thumbs","Slider filled tracks"],supportsAlpha:!1,pages:["management"]},{key:"sliderThumb",label:"Slider Thumb",description:"Range slider thumb/handle",affects:["Slider drag handles"],supportsAlpha:!0},{key:"sliderTrack",label:"Slider Track",description:"Range slider track background",affects:["Slider backgrounds","Progress tracks"],supportsAlpha:!0},{key:"dragHandleColor",label:"Drag Handle",description:"Drag and reorder controls",affects:["Drag grips","Reorder handles","Move indicators"],supportsAlpha:!0},{key:"dragHandleHover",label:"Drag Handle Hover",description:"Active drag handle state",affects:["Drag grip hover","Active dragging"],supportsAlpha:!0}]},{name:"borders",icon:Kt,description:"Border colors for separators and outlines",colors:[{key:"borderPrimary",label:"Primary Border",description:"Main divider and border color",affects:["Card borders","Dividers","Separators"],supportsAlpha:!0},{key:"borderSecondary",label:"Secondary Border",description:"Subtle borders and dividers",affects:["Input borders","Section dividers","Subtle lines"],supportsAlpha:!0},{key:"borderFocus",label:"Focus Border",description:"Active focus indicators",affects:["Focus rings","Active borders","Selected outlines"],supportsAlpha:!0}]},{name:"feedback",icon:Me,description:"Status indicators, alerts, notifications, banners, and feedback colors",colors:[{key:"success",label:"Success Primary",description:"Success state primary color (border for alerts)",affects:["Success icons","Success buttons","Positive actions","Alert borders","Success notifications"],supportsAlpha:!0},{key:"successBg",label:"Success Background",description:"Success state background (alert background)",affects:["Success alerts","Success badges","Success cards","Alert backgrounds","Success banners"],supportsAlpha:!0},{key:"successText",label:"Success Text",description:"Success state text color (alert text)",affects:["Success messages","Positive values","Alert text","Success notifications"],supportsAlpha:!0},{key:"warning",label:"Warning Primary",description:"Warning state primary color (border for alerts)",affects:["Warning icons","Caution buttons","Alert borders","Warning notifications"],supportsAlpha:!0},{key:"warningBg",label:"Warning Background",description:"Warning state background (alert background)",affects:["Warning alerts","Warning badges","Alert backgrounds","Caution banners"],supportsAlpha:!0},{key:"warningText",label:"Warning Text",description:"Warning state text color (alert text)",affects:["Warning messages","Caution text","Alert text","Warning notifications"],supportsAlpha:!0},{key:"error",label:"Error Primary",description:"Error state primary color (border for alerts)",affects:["Error icons","Delete buttons","Critical actions","Alert borders","Error notifications"],supportsAlpha:!0},{key:"errorBg",label:"Error Background",description:"Error state background (alert background)",affects:["Error alerts","Error badges","Alert backgrounds","Error banners","Danger zones"],supportsAlpha:!0},{key:"errorText",label:"Error Text",description:"Error state text color (alert text)",affects:["Error messages","Validation errors","Alert text","Error notifications"],supportsAlpha:!0},{key:"info",label:"Info Primary",description:"Information state primary color (border for alerts)",affects:["Info icons","Info buttons","Alert borders","Info notifications"],supportsAlpha:!0},{key:"infoBg",label:"Info Background",description:"Information state background (alert background)",affects:["Info alerts","Info cards","Alert backgrounds","Notification panels","Info banners"],supportsAlpha:!0},{key:"infoText",label:"Info Text",description:"Information state text color (alert text)",affects:["Info messages","Help content","Alert text","Notification text"],supportsAlpha:!0}]},{name:"navigation",icon:Te,description:"Navigation bar and menu styling",colors:[{key:"navBg",label:"Navigation Background",description:"Navigation bar background (header background)",affects:["Header","Nav bar","Menu background","Top bar","App header"],supportsAlpha:!0},{key:"navBorder",label:"Navigation Border",description:"Navigation separators (header border)",affects:["Nav borders","Menu dividers","Header separator","Top bar border"],supportsAlpha:!0},{key:"navTabActive",label:"Active Tab",description:"Active navigation item",affects:["Current page","Active tab"],supportsAlpha:!0},{key:"navTabInactive",label:"Inactive Tab",description:"Inactive navigation items",affects:["Unselected tabs","Inactive menu items"],supportsAlpha:!0},{key:"navTabHover",label:"Tab Hover",description:"Navigation hover state",affects:["Tab hovers","Menu hovers"],supportsAlpha:!0},{key:"navTabActiveBorder",label:"Active Tab Indicator",description:"Active tab underline/border",affects:["Tab indicators","Active borders"],supportsAlpha:!0},{key:"navMobileMenuBg",label:"Mobile Menu Background",description:"Mobile navigation background",affects:["Mobile menu","Dropdown menus"],supportsAlpha:!0},{key:"navMobileItemHover",label:"Mobile Menu Hover",description:"Mobile menu item hover",affects:["Mobile hovers","Dropdown hovers"],supportsAlpha:!0}]},{name:"dataDisplay",icon:it,description:"Data visualization and display elements",colors:[{key:"badgeBg",label:"Badge Background",description:"Badge and pill backgrounds",affects:["Status badges","Tags","Labels"],supportsAlpha:!0},{key:"badgeText",label:"Badge Text",description:"Badge text color",affects:["Badge labels","Tag text"],supportsAlpha:!0},{key:"progressBar",label:"Progress Bar Fill",description:"Progress indicator color",affects:["Progress bars","Loading bars","Completion indicators"],supportsAlpha:!0},{key:"progressBg",label:"Progress Track",description:"Progress bar background",affects:["Progress tracks","Empty progress state"],supportsAlpha:!0},{key:"chartColor1",label:"Chart Primary",description:"Primary chart color",affects:["First data series","Main chart color"],supportsAlpha:!0},{key:"chartColor2",label:"Chart Secondary",description:"Secondary chart color",affects:["Second data series"],supportsAlpha:!0},{key:"chartColor3",label:"Chart Tertiary",description:"Third chart color",affects:["Third data series"],supportsAlpha:!0},{key:"chartColor4",label:"Chart Quaternary",description:"Fourth chart color",affects:["Fourth data series"],supportsAlpha:!0},{key:"chartCacheHitColor",label:"Cache Hit Color",description:"Cache hit visualization",affects:["Hit rate charts","Success indicators"],supportsAlpha:!0},{key:"chartCacheMissColor",label:"Cache Miss Color",description:"Cache miss visualization",affects:["Miss rate charts","Warning indicators"],supportsAlpha:!0},{key:"chartGridColor",label:"Chart Grid",description:"Chart grid lines",affects:["Grid lines","Axes"],supportsAlpha:!0},{key:"chartTextColor",label:"Chart Text",description:"Chart labels and legends",affects:["Axis labels","Legends"],supportsAlpha:!0}]},{name:"accessControl",icon:ce,description:"Security and access control indicators",colors:[{key:"publicAccessBg",label:"Public Access Background",description:"Public/open access indicator",affects:["Public badges","Open access indicators"],supportsAlpha:!0},{key:"publicAccessText",label:"Public Access Text",description:"Public access text color",affects:["Public labels","Open text"],supportsAlpha:!0},{key:"publicAccessBorder",label:"Public Access Border",description:"Public access border",affects:["Public badge borders"],supportsAlpha:!0},{key:"securedAccessBg",label:"Secured Access Background",description:"Secured/locked access indicator",affects:["Security badges","Locked indicators"],supportsAlpha:!0},{key:"securedAccessText",label:"Secured Access Text",description:"Secured access text color",affects:["Security labels","Locked text"],supportsAlpha:!0},{key:"securedAccessBorder",label:"Secured Access Border",description:"Secured access border",affects:["Security badge borders"],supportsAlpha:!0}]},{name:"platforms",icon:Vt,description:"Gaming platform and service colors",colors:[{key:"steamColor",label:"Steam",description:"Steam platform color",affects:["Steam badges","Steam charts"],supportsAlpha:!0,pages:["dashboard","downloads","clients","services","charts"]},{key:"epicColor",label:"Epic Games",description:"Epic Games platform color",affects:["Epic badges","Epic charts"],supportsAlpha:!0,pages:["dashboard","downloads","clients","services","charts"]},{key:"originColor",label:"Origin/EA",description:"EA/Origin platform color",affects:["Origin badges","EA charts"],pages:["dashboard","downloads","clients","services","charts"],supportsAlpha:!0},{key:"blizzardColor",label:"Blizzard",description:"Blizzard platform color",affects:["Blizzard badges","Battle.net charts"],supportsAlpha:!0,pages:["dashboard","downloads","clients","services","charts"]},{key:"wsusColor",label:"Windows Update",description:"Windows Update service color",affects:["WSUS badges","Update charts"],supportsAlpha:!0,pages:["dashboard","downloads","clients","services","charts"]},{key:"riotColor",label:"Riot Games",description:"Riot Games platform color",affects:["Riot badges","Riot charts"],supportsAlpha:!0,pages:["dashboard","downloads","clients","services","charts"]}]},{name:"performance",icon:it,description:"Performance indicators and cache hit rate colors",colors:[{key:"hitRateHighBg",label:"High Hit Rate Background",description:"Background for high cache hit rates",affects:["90%+ hit rate badges","Success indicators"],supportsAlpha:!0,pages:["dashboard","downloads","clients","services"]},{key:"hitRateHighText",label:"High Hit Rate Text",description:"Text color for high hit rates",affects:["High hit rate labels"],supportsAlpha:!0,pages:["dashboard","downloads","clients","services"]},{key:"hitRateMediumBg",label:"Medium Hit Rate Background",description:"Background for medium cache hit rates",affects:["50-89% hit rate badges"],supportsAlpha:!0,pages:["dashboard","downloads","clients","services"]},{key:"hitRateMediumText",label:"Medium Hit Rate Text",description:"Text color for medium hit rates",affects:["Medium hit rate labels"],supportsAlpha:!0,pages:["dashboard","downloads","clients","services"]},{key:"hitRateLowBg",label:"Low Hit Rate Background",description:"Background for low cache hit rates",affects:["0-49% hit rate badges"],supportsAlpha:!0,pages:["dashboard","downloads","clients","services"]},{key:"hitRateLowText",label:"Low Hit Rate Text",description:"Text color for low hit rates",affects:["Low hit rate labels"],supportsAlpha:!0,pages:["dashboard","downloads","clients","services"]},{key:"hitRateWarningBg",label:"Warning Hit Rate Background",description:"Background for warning hit rates",affects:["Critical performance warnings"],supportsAlpha:!0,pages:["dashboard","downloads"]},{key:"hitRateWarningText",label:"Warning Hit Rate Text",description:"Text color for warning hit rates",affects:["Warning labels"],supportsAlpha:!0,pages:["dashboard","downloads"]}]},{name:"actions",icon:rt,description:"Action button colors for operations",colors:[{key:"actionResetBg",label:"Reset Button Background",description:"Reset action button background",affects:["Reset buttons","Clear actions"],supportsAlpha:!0,pages:["management"]},{key:"actionResetHover",label:"Reset Button Hover",description:"Reset button hover state",affects:["Reset button hover"],supportsAlpha:!0,pages:["management"]},{key:"actionProcessBg",label:"Process Button Background",description:"Process action button background",affects:["Process buttons","Start actions"],supportsAlpha:!0,pages:["management"]},{key:"actionProcessHover",label:"Process Button Hover",description:"Process button hover state",affects:["Process button hover"],supportsAlpha:!0,pages:["management"]},{key:"actionDeleteBg",label:"Delete Button Background",description:"Delete action button background",affects:["Delete buttons","Remove actions"],supportsAlpha:!0,pages:["management"]},{key:"actionDeleteHover",label:"Delete Button Hover",description:"Delete button hover state",affects:["Delete button hover"],supportsAlpha:!0,pages:["management"]}]},{name:"utilities",icon:ot,description:"Utility colors for specialized UI elements",colors:[{key:"scrollbarTrack",label:"Scrollbar Track",description:"Scrollbar background track",affects:["Scrollbar tracks","Scroll gutters"],supportsAlpha:!0},{key:"scrollbarThumb",label:"Scrollbar Thumb",description:"Scrollbar draggable element",affects:["Scrollbar handles"],supportsAlpha:!0},{key:"scrollbarHover",label:"Scrollbar Hover",description:"Scrollbar hover state",affects:["Scrollbar hover effects"],supportsAlpha:!0},{key:"iconBgBlue",label:"Blue Icon Background",description:"Blue icon container",affects:["Database icons","Info icons"],supportsAlpha:!0},{key:"iconBgGreen",label:"Green Icon Background",description:"Green icon container",affects:["Success icons","Online status"],supportsAlpha:!0},{key:"iconBgEmerald",label:"Emerald Icon Background",description:"Emerald icon container",affects:["Trending icons","Growth indicators"],supportsAlpha:!0},{key:"iconBgPurple",label:"Purple Icon Background",description:"Purple icon container",affects:["Special features","Premium indicators"],supportsAlpha:!0},{key:"iconBgIndigo",label:"Indigo Icon Background",description:"Indigo icon container",affects:["Server icons","System indicators"],supportsAlpha:!0},{key:"iconBgOrange",label:"Orange Icon Background",description:"Orange icon container",affects:["Download icons","Activity indicators"],supportsAlpha:!0},{key:"iconBgYellow",label:"Yellow Icon Background",description:"Yellow icon container",affects:["Warning icons","Client indicators"],supportsAlpha:!0},{key:"iconBgCyan",label:"Cyan Icon Background",description:"Cyan icon container",affects:["Activity icons","Performance indicators"],supportsAlpha:!0},{key:"iconBgRed",label:"Red Icon Background",description:"Red icon container",affects:["Error icons","Critical indicators"],supportsAlpha:!0}]}];c.useEffect(()=>{je();const t=E.getCurrentThemeId();f(t),Ie(E.getSharpCorners())},[]),c.useEffect(()=>{if(B){const t=getComputedStyle(document.documentElement),s=(u,l)=>t.getPropertyValue(u).trim()||l;Y(u=>({...u,primaryColor:s("--theme-primary","#3b82f6"),secondaryColor:s("--theme-secondary","#8b5cf6"),accentColor:s("--theme-accent","#06b6d4"),bgPrimary:s("--theme-bg-primary","#111827"),bgSecondary:s("--theme-bg-secondary","#1f2937"),bgTertiary:s("--theme-bg-tertiary","#374151"),bgHover:s("--theme-bg-hover","#4b5563"),textPrimary:s("--theme-text-primary","#ffffff"),textSecondary:s("--theme-text-secondary","#d1d5db"),textMuted:s("--theme-text-muted","#9ca3af"),textAccent:s("--theme-text-accent","#60a5fa"),textPlaceholder:s("--theme-text-placeholder","#6b7280"),dragHandleColor:s("--theme-drag-handle-color","#6b7280"),dragHandleHover:s("--theme-drag-handle-hover","#60a5fa"),borderPrimary:s("--theme-border-primary","#374151"),borderSecondary:s("--theme-border-secondary","#4b5563"),borderFocus:s("--theme-border-focus","#3b82f6"),navBg:s("--theme-nav-bg","#1f2937"),navBorder:s("--theme-nav-border","#374151"),navTabActive:s("--theme-nav-tab-active","#3b82f6"),navTabInactive:s("--theme-nav-tab-inactive","#9ca3af"),navTabHover:s("--theme-nav-tab-hover","#ffffff"),navTabActiveBorder:s("--theme-nav-tab-active-border","#3b82f6"),navMobileMenuBg:s("--theme-nav-mobile-menu-bg","#1f2937"),navMobileItemHover:s("--theme-nav-mobile-item-hover","#374151"),success:s("--theme-success","#10b981"),successBg:s("--theme-success-bg","#064e3b"),successText:s("--theme-success-text","#34d399"),warning:s("--theme-warning","#f59e0b"),warningBg:s("--theme-warning-bg","#78350f"),warningText:s("--theme-warning-text","#fbbf24"),error:s("--theme-error","#ef4444"),errorBg:s("--theme-error-bg","#7f1d1d"),errorText:s("--theme-error-text","#fca5a5"),info:s("--theme-info","#3b82f6"),infoBg:s("--theme-info-bg","#1e3a8a"),infoText:s("--theme-info-text","#93c5fd"),steamColor:s("--theme-steam-color","#1e40af"),epicColor:s("--theme-epic-color","#7c3aed"),originColor:s("--theme-origin-color","#ea580c"),blizzardColor:s("--theme-blizzard-color","#0891b2"),wsusColor:s("--theme-wsus-color","#16a34a"),riotColor:s("--theme-riot-color","#dc2626"),cardBg:s("--theme-card-bg","#1f2937"),cardBorder:s("--theme-card-border","#374151"),buttonBg:s("--theme-button-bg","#3b82f6"),buttonHover:s("--theme-button-hover","#2563eb"),buttonText:s("--theme-button-text",s("--theme-text-primary","#ffffff")),inputBg:s("--theme-input-bg","#374151"),inputBorder:s("--theme-input-border","#4b5563"),inputFocus:s("--theme-input-focus","#3b82f6"),checkboxAccent:s("--theme-checkbox-accent",s("--theme-primary","#3b82f6")),checkboxBorder:s("--theme-checkbox-border",s("--theme-border-secondary","#4b5563")),sliderAccent:s("--theme-slider-accent",s("--theme-primary","#3b82f6")),sliderThumb:s("--theme-slider-thumb",s("--theme-primary","#3b82f6")),sliderTrack:s("--theme-slider-track",s("--theme-bg-tertiary","#374151")),badgeBg:s("--theme-badge-bg","#3b82f6"),badgeText:s("--theme-badge-text",s("--theme-text-primary","#ffffff")),progressBar:s("--theme-progress-bar","#3b82f6"),progressBg:s("--theme-progress-bg","#374151"),iconBgBlue:s("--theme-icon-bg-blue","#3b82f6"),iconBgGreen:s("--theme-icon-bg-green","#10b981"),iconBgEmerald:s("--theme-icon-bg-emerald","#10b981"),iconBgPurple:s("--theme-icon-bg-purple","#8b5cf6"),iconBgIndigo:s("--theme-icon-bg-indigo","#6366f1"),iconBgOrange:s("--theme-icon-bg-orange","#f97316"),iconBgYellow:s("--theme-icon-bg-yellow","#eab308"),iconBgCyan:s("--theme-icon-bg-cyan","#06b6d4"),iconBgRed:s("--theme-icon-bg-red","#ef4444"),chartColor1:s("--theme-chart-color-1","#3b82f6"),chartColor2:s("--theme-chart-color-2","#10b981"),chartColor3:s("--theme-chart-color-3","#f59e0b"),chartColor4:s("--theme-chart-color-4","#ef4444"),chartColor5:s("--theme-chart-color-5","#8b5cf6"),chartColor6:s("--theme-chart-color-6","#06b6d4"),chartColor7:s("--theme-chart-color-7","#f97316"),chartColor8:s("--theme-chart-color-8","#ec4899"),chartBorderColor:s("--theme-chart-border-color","#1f2937"),chartGridColor:s("--theme-chart-grid-color","#374151"),chartTextColor:s("--theme-chart-text-color","#9ca3af"),chartCacheHitColor:s("--theme-chart-cache-hit-color","#10b981"),chartCacheMissColor:s("--theme-chart-cache-miss-color","#f59e0b"),scrollbarThumb:s("--theme-scrollbar-thumb","#4b5563"),scrollbarTrack:s("--theme-scrollbar-track","#1f2937"),scrollbarThumbHover:s("--theme-scrollbar-thumb-hover","#6b7280"),scrollbarHover:s("--theme-scrollbar-hover","#9CA3AF"),hitRateHighBg:s("--theme-hit-rate-high-bg","#064e3b"),hitRateHighText:s("--theme-hit-rate-high-text","#34d399"),hitRateMediumBg:s("--theme-hit-rate-medium-bg","#1e3a8a"),hitRateMediumText:s("--theme-hit-rate-medium-text","#93c5fd"),hitRateLowBg:s("--theme-hit-rate-low-bg","#44403c"),hitRateLowText:s("--theme-hit-rate-low-text","#fbbf24"),hitRateWarningBg:s("--theme-hit-rate-warning-bg","#44403c"),hitRateWarningText:s("--theme-hit-rate-warning-text","#fcd34d"),actionResetBg:s("--theme-action-reset-bg","#f59e0b"),actionResetHover:s("--theme-action-reset-hover","#d97706"),actionProcessBg:s("--theme-action-process-bg","#10b981"),actionProcessHover:s("--theme-action-process-hover","#059669"),actionDeleteBg:s("--theme-action-delete-bg","#ef4444"),actionDeleteHover:s("--theme-action-delete-hover","#dc2626"),publicAccessBg:s("--theme-public-access-bg","rgba(16, 185, 129, 0.2)"),publicAccessText:s("--theme-public-access-text","#34d399"),publicAccessBorder:s("--theme-public-access-border","rgba(16, 185, 129, 0.3)"),securedAccessBg:s("--theme-secured-access-bg","rgba(245, 158, 11, 0.2)"),securedAccessText:s("--theme-secured-access-text","#fbbf24"),securedAccessBorder:s("--theme-secured-access-border","rgba(245, 158, 11, 0.3)")}))}},[B]);const je=c.useCallback(async()=>{d(!0);try{const t=await E.loadThemes();a(t)}catch(t){console.error("Failed to load themes:",t),g("Failed to load themes")}finally{d(!1)}},[]),le=async t=>{try{if(!t){E.clearTheme(),f(""),m(null);return}const s=await E.getTheme(t);s&&(E.applyTheme(s),f(t),m(null))}catch(s){console.error("Failed to apply theme:",s),g("Failed to apply theme")}},Tt=async t=>{if(y===t)le(n),m(null);else try{const s=await E.getTheme(t);s&&(E.applyTheme(s),m(t))}catch(s){console.error("Failed to preview theme:",s)}},Qe=t=>{F(s=>s.includes(t)?s.filter(u=>u!==t):[...s,t])},[St,Re]=c.useState({}),De=t=>{if(!St[t]){const s=I[t];s&&localStorage.setItem(`color_history_create_${t}`,s),Re(u=>({...u,[t]:!0}))}},Bt=(t,s)=>{Y(u=>({...u,[t]:s}))},At=t=>{const s=localStorage.getItem(`color_history_create_${t}`);if(s){const u=I[t];Y(l=>({...l,[t]:s})),localStorage.setItem(`color_history_create_${t}`,u)}},Ke=t=>localStorage.getItem(`color_history_create_${t}`),He=t=>{if(!se[t]){const s=M[t];if(s&&s.match(/^#[0-9a-fA-F]{6}$/)){const u=`color_history_${b==null?void 0:b.meta.id}_${t}`;localStorage.setItem(u,s)}ae(u=>({...u,[t]:!0}))}},Pt=(t,s)=>{V(u=>({...u,[t]:s}))},Mt=t=>{const s=`color_history_${b==null?void 0:b.meta.id}_${t}`,u=localStorage.getItem(s);if(u){const l=M[t];V(j=>({...j,[t]:u})),localStorage.setItem(s,l||"")}},It=t=>{const s=`color_history_${b==null?void 0:b.meta.id}_${t}`;return localStorage.getItem(s)},Ve=async t=>{try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(t);else{const s=document.createElement("textarea");s.value=t,s.style.position="fixed",s.style.left="-999999px",s.style.top="-999999px",document.body.appendChild(s),s.focus(),s.select(),document.execCommand("copy"),document.body.removeChild(s)}ie(t),setTimeout(()=>ie(null),2e3)}catch(s){console.error("Failed to copy color:",s)}},Le=t=>{t.preventDefault(),t.stopPropagation(),t.type==="dragenter"||t.type==="dragover"?x(!0):t.type==="dragleave"&&x(!1)},Rt=async t=>{t.preventDefault(),t.stopPropagation(),x(!1),t.dataTransfer.files&&t.dataTransfer.files[0]&&await Ye(t.dataTransfer.files[0])},Ye=async t=>{if(g(null),R(null),!t.name.endsWith(".toml")){g("Only TOML theme files are supported");return}if(t.size>1024*1024){g("Theme file too large (max 1MB)");return}d(!0);try{const s=await E.uploadTheme(t);await new Promise(l=>setTimeout(l,100));const u=await E.loadThemes();a(u),R(`Theme "${s.meta.name}" uploaded successfully`),setTimeout(()=>R(null),5e3)}catch(s){g(s.message)}finally{d(!1)}},Dt=async(t,s)=>{var l;if(["dark-default","light-default"].includes(t)){g("System themes cannot be deleted"),setTimeout(()=>g(null),5e3);return}if(!o){g("Authentication required to delete custom themes"),setTimeout(()=>g(null),5e3);return}if(window.confirm(`Delete theme "${s}"? This cannot be undone.`)){d(!0);try{const j=await fetch(`${gt}/theme/${t}`,{method:"DELETE",headers:J.getAuthHeaders()}),v=await j.json();if(j.ok&&v.success){await je(),n===t&&le("dark-default");const A=((l=v.filesDeleted)==null?void 0:l.join(", "))||"theme files";R(`Theme "${s}" deleted successfully (removed: ${A})`),setTimeout(()=>R(null),5e3)}else if(j.status===404)g(`Theme "${s}" not found on server. ${v.details||""}`),a(A=>A.filter(z=>z.meta.id!==t)),n===t&&le("dark-default"),v.availableThemes,setTimeout(()=>g(null),1e4);else{const A=v.error||v.message||"Failed to delete theme",z=v.details?` Details: ${v.details}`:"";g(`${A}${z}`),setTimeout(()=>g(null),7e3)}}catch(j){console.error("Delete request failed:",j),g(`Failed to delete theme: ${j.message||"Network error"}`),setTimeout(()=>g(null),7e3)}finally{d(!1)}}},Ht=async()=>{if(!o){g("Authentication required to clean up themes"),setTimeout(()=>g(null),5e3);return}if(window.confirm("This will DELETE all custom themes (keeping only system themes). This cannot be undone. Continue?")){d(!0);try{const t=await fetch(`${gt}/theme/cleanup`,{method:"POST",headers:{"Content-Type":"application/json",...J.getAuthHeaders()}});if(!t.ok)throw new Error("Failed to cleanup themes");const s=await t.json();await je(),i.map(l=>l.meta.id).includes(n)||le("dark-default"),R(s.message||"All custom themes have been deleted"),setTimeout(()=>R(null),5e3)}catch(t){g("Failed to cleanup themes: "+t.message),setTimeout(()=>g(null),5e3)}finally{d(!1)}}},Je=t=>{var l;if(!o){g("Authentication required to edit themes"),setTimeout(()=>g(null),5e3);return}if(we(t.meta.id)){g("System themes cannot be edited"),setTimeout(()=>g(null),5e3);return}const s=i.find(j=>j.meta.id===t.meta.id)||t;ae({}),T(s);const u={name:s.meta.name,description:s.meta.description||"",author:s.meta.author||"",version:s.meta.version||"1.0.0",isDark:s.meta.isDark!==!1,...s.colors,customCSS:((l=s.css)==null?void 0:l.content)||""};s.colors.dragHandleColor||(u.dragHandleColor=s.meta.isDark?"#6b7280":"#9ca3af"),s.colors.dragHandleHover||(u.dragHandleHover=s.meta.isDark?"#60a5fa":"#2563eb"),V(u),L(!0)},Lt=async()=>{if(!o||!b)return;if(!M.name.trim()){g("Theme name is required"),setTimeout(()=>g(null),5e3);return}const t={};Object.entries(M).forEach(([v,A])=>{["name","description","author","version","isDark","customCSS"].includes(v)||(t[v]=A)});const s={meta:{id:b.meta.id,name:M.name,description:M.description,author:M.author,version:M.version,isDark:M.isDark},colors:t,css:M.customCSS?{content:M.customCSS}:void 0},u=E.exportTheme(s),l=new Blob([u],{type:"text/plain"}),j=new File([l],`${s.meta.id}.toml`,{type:"text/plain"});d(!0);try{await E.uploadTheme(j),await new Promise(z=>setTimeout(z,100));const v=await E.loadThemes();a(v);const A=v.find(z=>z.meta.id===s.meta.id);if(A)n===b.meta.id&&E.applyTheme(A),R(`Theme "${A.meta.name}" updated successfully`);else throw new Error("Theme was uploaded but not found on server");Object.keys(M).forEach(z=>{const Ce=`color_history_${b.meta.id}_${z}`;localStorage.removeItem(Ce)}),ae({}),L(!1),T(null),V({}),setTimeout(()=>R(null),5e3)}catch(v){g(v.message||"Failed to update theme"),d(!1);return}d(!1)},Ft=async()=>{if(!o){g("Authentication required to create themes");return}if(!I.name.trim()){g("Theme name is required"),setTimeout(()=>g(null),5e3);return}const t={meta:{id:I.name.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""),name:I.name,description:I.description,author:I.author,version:I.version,isDark:I.isDark},colors:{...I},css:I.customCSS?{content:I.customCSS}:void 0};delete t.colors.name,delete t.colors.description,delete t.colors.author,delete t.colors.version,delete t.colors.isDark,delete t.colors.customCSS;const s=E.exportTheme(t),u=new Blob([s],{type:"text/plain"}),l=new File([u],`${t.meta.id}.toml`,{type:"text/plain"});d(!0);try{await E.uploadTheme(l),await new Promise(A=>setTimeout(A,100));const j=await E.loadThemes();a(j);const v=j.find(A=>A.meta.id===t.meta.id);v&&(E.applyTheme(v),f(v.meta.id)),_(!1),Object.keys(I).forEach(A=>{localStorage.removeItem(`color_history_create_${A}`)}),Re({}),Y({name:"",description:"",author:"",version:"1.0.0",isDark:!0,primaryColor:"#3b82f6",secondaryColor:"#8b5cf6",accentColor:"#06b6d4",bgPrimary:"#111827",bgSecondary:"#1f2937",bgTertiary:"#374151",bgHover:"#4b5563",textPrimary:"#ffffff",textSecondary:"#d1d5db",textMuted:"#9ca3af",textAccent:"#60a5fa",dragHandleColor:"#6b7280",dragHandleHover:"#60a5fa",borderPrimary:"#374151",borderSecondary:"#4b5563",borderFocus:"#3b82f6",navBg:"#1f2937",navBorder:"#374151",navTabActive:"#3b82f6",navTabInactive:"#9ca3af",navTabHover:"#ffffff",navTabActiveBorder:"#3b82f6",navMobileMenuBg:"#1f2937",navMobileItemHover:"#374151",success:"#10b981",successBg:"#064e3b",successText:"#34d399",warning:"#f59e0b",warningBg:"#78350f",warningText:"#fbbf24",error:"#ef4444",errorBg:"#7f1d1d",errorText:"#fca5a5",info:"#3b82f6",infoBg:"#1e3a8a",infoText:"#93c5fd",steamColor:"#1e40af",epicColor:"#7c3aed",originColor:"#ea580c",blizzardColor:"#0891b2",wsusColor:"#16a34a",riotColor:"#dc2626",cardBg:"#1f2937",cardBorder:"#374151",buttonBg:"#3b82f6",buttonHover:"#2563eb",buttonText:"#ffffff",inputBg:"#374151",inputBorder:"#4b5563",inputFocus:"#3b82f6",badgeBg:"#3b82f6",badgeText:"#ffffff",progressBar:"#3b82f6",progressBg:"#374151",iconBgBlue:"#3b82f6",iconBgGreen:"#10b981",iconBgEmerald:"#10b981",iconBgPurple:"#8b5cf6",iconBgIndigo:"#6366f1",iconBgOrange:"#f97316",iconBgYellow:"#eab308",iconBgCyan:"#06b6d4",iconBgRed:"#ef4444",chartColor1:"#3b82f6",chartColor2:"#10b981",chartColor3:"#f59e0b",chartColor4:"#ef4444",chartColor5:"#8b5cf6",chartColor6:"#06b6d4",chartColor7:"#f97316",chartColor8:"#ec4899",chartBorderColor:"#1f2937",chartGridColor:"#374151",chartTextColor:"#9ca3af",chartCacheHitColor:"#10b981",chartCacheMissColor:"#f59e0b",scrollbarTrack:"#374151",scrollbarThumb:"#6B7280",scrollbarHover:"#9CA3AF",publicAccessBg:"rgba(16, 185, 129, 0.2)",publicAccessText:"#34d399",publicAccessBorder:"rgba(16, 185, 129, 0.3)",securedAccessBg:"rgba(245, 158, 11, 0.2)",securedAccessText:"#fbbf24",securedAccessBorder:"rgba(245, 158, 11, 0.3)",customCSS:""}),R(`Theme "${t.meta.name}" created successfully`),setTimeout(()=>R(null),5e3)}catch(j){g(j.message||"Failed to create theme")}finally{d(!1)}},Xe=t=>{Y(t==="dark"?s=>({...s,isDark:!0,bgPrimary:"#111827",bgSecondary:"#1f2937",bgTertiary:"#374151",bgHover:"#4b5563",textPrimary:"#ffffff",textSecondary:"#d1d5db",textMuted:"#9ca3af",dragHandleColor:"#6b7280",dragHandleHover:"#00ff00",borderPrimary:"#374151",borderSecondary:"#4b5563",navBg:"#1f2937",navBorder:"#374151",navTabActive:"#3b82f6",navTabInactive:"#9ca3af",navTabHover:"#ffffff",navTabActiveBorder:"#3b82f6",navMobileMenuBg:"#1f2937",navMobileItemHover:"#374151",cardBg:"#1f2937",cardBorder:"#374151",inputBg:"#374151",inputBorder:"#4b5563",progressBg:"#374151",successBg:"#064e3b",successText:"#34d399",warningBg:"#78350f",warningText:"#fbbf24",errorBg:"#7f1d1d",errorText:"#fca5a5",infoBg:"#1e3a8a",infoText:"#93c5fd",chartBorderColor:"#1f2937",chartGridColor:"#374151",chartTextColor:"#9ca3af",scrollbarTrack:"#374151",scrollbarThumb:"#6B7280",scrollbarHover:"#9CA3AF"}):s=>({...s,isDark:!1,bgPrimary:"#ffffff",bgSecondary:"#f9fafb",bgTertiary:"#f3f4f6",bgHover:"#e5e7eb",textPrimary:"#111827",textSecondary:"#374151",textMuted:"#6b7280",dragHandleColor:"#9ca3af",dragHandleHover:"#2563eb",borderPrimary:"#e5e7eb",borderSecondary:"#d1d5db",navBg:"#f9fafb",navBorder:"#e5e7eb",navTabActive:"#3b82f6",navTabInactive:"#6b7280",navTabHover:"#111827",navTabActiveBorder:"#3b82f6",navMobileMenuBg:"#f9fafb",navMobileItemHover:"#e5e7eb",cardBg:"#ffffff",cardBorder:"#e5e7eb",buttonBg:"#3b82f6",buttonHover:"#2563eb",buttonText:"#ffffff",inputBg:"#ffffff",inputBorder:"#d1d5db",inputFocus:"#3b82f6",checkboxAccent:"#3b82f6",checkboxBorder:"#d1d5db",sliderAccent:"#3b82f6",sliderThumb:"#3b82f6",sliderTrack:"#e5e7eb",badgeBg:"#3b82f6",badgeText:"#ffffff",progressBar:"#3b82f6",progressBg:"#e5e7eb",successBg:"#d1fae5",successText:"#065f46",warningBg:"#fef3c7",warningText:"#92400e",errorBg:"#fee2e2",errorText:"#991b1b",infoBg:"#dbeafe",infoText:"#1e40af",chartBorderColor:"#e5e7eb",chartGridColor:"#d1d5db",chartTextColor:"#6b7280",scrollbarTrack:"#f3f4f6",scrollbarThumb:"#9ca3af",scrollbarHover:"#6b7280"}))},$t=t=>{const s=E.exportTheme(t),u=new Blob([s],{type:"text/plain"}),l=URL.createObjectURL(u),j=document.createElement("a");j.href=l,j.download=`${t.meta.id}.toml`,j.click(),URL.revokeObjectURL(l)},Ze=()=>{const t=`# Sample Theme for LANCache Manager
[meta]
name = "My Custom Theme"
id = "my-custom-theme"
description = "A beautiful custom theme"
author = "Your Name"
version = "1.0.0"
isDark = true

[colors]
# Core colors
primaryColor = "#3b82f6"
secondaryColor = "#8b5cf6"
accentColor = "#06b6d4"

# Backgrounds
bgPrimary = "#111827"
bgSecondary = "#1f2937"
bgTertiary = "#374151"
bgHover = "#4b5563"

# Text
textPrimary = "#ffffff"
textSecondary = "#d1d5db"
textMuted = "#9ca3af"
textAccent = "#60a5fa"
dragHandleColor = "#6b7280"
dragHandleHover = "#60a5fa"

# Borders
borderPrimary = "#374151"
borderSecondary = "#4b5563"
borderFocus = "#3b82f6"

# Navigation colors
navBg = "#1f2937"
navBorder = "#374151"
navTabActive = "#3b82f6"
navTabInactive = "#9ca3af"
navTabHover = "#ffffff"
navTabActiveBorder = "#3b82f6"
navMobileMenuBg = "#1f2937"
navMobileItemHover = "#374151"

# Hit Rate & Status Badge colors
hitRateHighBg = "#064e3b"
hitRateHighText = "#34d399"
hitRateMediumBg = "#1e3a8a"
hitRateMediumText = "#93c5fd"
hitRateLowBg = "#ea580c"
hitRateLowText = "#fb923c"
statusWarningBg = "#78350f"
statusWarningText = "#fbbf24"

# Action Button colors
actionResetBg = "#f59e0b"
actionResetHover = "#d97706"
actionProcessBg = "#10b981"
actionProcessHover = "#059669"
actionDeleteBg = "#ef4444"
actionDeleteHover = "#dc2626"

# Status colors
success = "#10b981"
successBg = "#064e3b"
successText = "#34d399"
warning = "#f59e0b"
warningBg = "#78350f"
warningText = "#fbbf24"
error = "#ef4444"
errorBg = "#7f1d1d"
errorText = "#fca5a5"
info = "#3b82f6"
infoBg = "#1e3a8a"
infoText = "#93c5fd"

# Service colors
steamColor = "#1e40af"
epicColor = "#7c3aed"
originColor = "#ea580c"
blizzardColor = "#0891b2"
wsusColor = "#16a34a"
riotColor = "#dc2626"

# Components
cardBg = "#1f2937"
cardBorder = "#374151"
buttonBg = "#3b82f6"
buttonHover = "#2563eb"
buttonText = "#ffffff"
inputBg = "#374151"
inputBorder = "#4b5563"
inputFocus = "#3b82f6"
badgeBg = "#3b82f6"
badgeText = "#ffffff"
progressBar = "#3b82f6"
progressBg = "#374151"

# Icon backgrounds (solid colors, no gradients)
iconBgBlue = "#3b82f6"
iconBgGreen = "#10b981"
iconBgEmerald = "#10b981"
iconBgPurple = "#8b5cf6"
iconBgIndigo = "#6366f1"
iconBgOrange = "#f97316"
iconBgYellow = "#eab308"
iconBgCyan = "#06b6d4"
iconBgRed = "#ef4444"

# Chart colors
chartColor1 = "#3b82f6"
chartColor2 = "#10b981"
chartColor3 = "#f59e0b"
chartColor4 = "#ef4444"
chartColor5 = "#8b5cf6"
chartColor6 = "#06b6d4"
chartColor7 = "#f97316"
chartColor8 = "#ec4899"
chartBorderColor = "#1f2937"
chartGridColor = "#374151"
chartTextColor = "#9ca3af"
chartCacheHitColor = "#10b981"
chartCacheMissColor = "#f59e0b"

[css]
content = """
/* Add any custom CSS here */
"""`,s=new Blob([t],{type:"text/plain"}),u=URL.createObjectURL(s),l=document.createElement("a");l.href=u,l.download="sample-theme.toml",l.click(),URL.revokeObjectURL(u)},we=t=>["dark-default","light-default"].includes(t);return e.jsxs(e.Fragment,{children:[e.jsxs(te,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(st,{className:"w-5 h-5 text-themed-accent"}),e.jsx("h3",{className:"text-lg font-semibold text-themed-primary",children:"Theme Management"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[o?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>_(!0),className:"p-2 rounded-lg transition-colors",style:{color:"var(--theme-text-muted)",backgroundColor:"transparent"},onMouseEnter:t=>t.currentTarget.style.backgroundColor="var(--theme-bg-hover)",onMouseLeave:t=>t.currentTarget.style.backgroundColor="transparent",title:"Create new theme",children:e.jsx(at,{className:"w-4 h-4"})}),e.jsx("button",{onClick:Ht,disabled:r,className:"p-2 rounded-lg transition-colors",style:{color:"var(--theme-text-muted)",backgroundColor:"transparent"},onMouseEnter:t=>t.currentTarget.style.backgroundColor="var(--theme-bg-hover)",onMouseLeave:t=>t.currentTarget.style.backgroundColor="transparent",title:"Delete all custom themes",children:e.jsx(rt,{className:"w-4 h-4"})})]}):e.jsx("button",{disabled:!0,className:"p-2 rounded-lg transition-colors opacity-50 cursor-not-allowed",style:{color:"var(--theme-text-muted)",backgroundColor:"transparent"},title:"Authentication required to create themes",children:e.jsx(ce,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>je(),disabled:r,className:"p-2 rounded-lg transition-colors",style:{color:"var(--theme-text-muted)",backgroundColor:"transparent"},onMouseEnter:t=>t.currentTarget.style.backgroundColor="var(--theme-bg-hover)",onMouseLeave:t=>t.currentTarget.style.backgroundColor="transparent",title:"Refresh themes",children:e.jsx(jt,{className:`w-4 h-4 ${r?"animate-spin":""}`})})]})]}),e.jsxs("div",{className:"flex gap-2 mb-6 border-b",style:{borderColor:"var(--theme-border)"},children:[e.jsxs("button",{onClick:()=>N("themes"),className:`px-4 py-2 font-medium transition-colors ${Q==="themes"?"text-themed-accent":"text-themed-muted hover:text-themed-primary"}`,style:Q==="themes"?{borderBottom:"2px solid var(--theme-primary)"}:{},children:[e.jsx(ke,{className:"w-4 h-4 inline-block mr-2"}),"Themes (",i.length,")"]}),e.jsxs("button",{onClick:()=>N("customize"),className:`px-4 py-2 font-medium transition-colors ${Q==="customize"?"text-themed-accent":"text-themed-muted hover:text-themed-primary"}`,style:Q==="customize"?{borderBottom:"2px solid var(--theme-primary)"}:{},children:[e.jsx(ot,{className:"w-4 h-4 inline-block mr-2"}),"Customize"]})]}),Q==="themes"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6 p-4 rounded-lg bg-themed-tertiary",children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-themed-secondary",children:"Active Theme"}),e.jsx("select",{value:y||n,onChange:t=>le(t.target.value),className:"w-full px-3 py-2 focus:outline-none themed-input",disabled:r,children:i.map(t=>e.jsxs("option",{value:t.meta.id,children:[t.meta.name," ",t.meta.author&&t.meta.author!=="System"&&`by ${t.meta.author}`,we(t.meta.id)&&" (System)",y===t.meta.id&&" (Preview)"]},t.meta.id))}),y&&e.jsx("p",{className:"text-xs mt-2 text-themed-warning",children:"Preview mode active. Select a theme to apply it permanently."})]}),e.jsx("div",{className:"mb-6 p-4 rounded-lg bg-themed-tertiary",children:e.jsxs("label",{className:"flex items-center justify-between cursor-pointer",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-themed-secondary",children:"Sharp Corners"}),e.jsx("p",{className:"text-xs text-themed-muted mt-1",children:"Use sharp corners instead of rounded ones throughout the interface"})]}),e.jsx("input",{type:"checkbox",checked:w,onChange:t=>{const s=t.target.checked;Ie(s),E.setSharpCorners(s)},className:"themed-checkbox ml-3"})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-sm font-medium mb-3 text-themed-secondary",children:"Installed Themes"}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:i.map(t=>{const s=n===t.meta.id&&!y,u=y===t.meta.id,l=we(t.meta.id);return e.jsxs("div",{className:"rounded-lg p-4 transition-all hover:shadow-lg themed-card relative",style:{border:`2px solid ${s?"var(--theme-primary)":u?"var(--theme-warning)":"var(--theme-border-primary)"}`},children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold text-themed-primary",children:t.meta.name}),t.meta.isDark?e.jsx(lt,{className:"w-3 h-3 text-themed-muted"}):e.jsx(nt,{className:"w-3 h-3 text-themed-warning"}),s&&e.jsx("span",{className:"px-2 py-0.5 text-xs rounded themed-button-primary",children:"Active"}),u&&e.jsx("span",{className:"px-2 py-0.5 text-xs rounded bg-themed-warning text-themed-primary",children:"Preview"}),l&&e.jsx(ce,{className:"w-3 h-3 text-themed-muted"})]}),t.meta.description&&e.jsx("p",{className:"text-xs text-themed-muted mb-1",children:t.meta.description}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-themed-muted",children:[t.meta.author&&e.jsxs("span",{children:["by ",t.meta.author]}),t.meta.version&&e.jsxs("span",{children:["v",t.meta.version]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>P($===t.meta.id?null:t.meta.id),className:"p-1 rounded hover:bg-themed-hover transition-colors",children:e.jsx(qt,{className:"w-4 h-4 text-themed-muted"})}),$===t.meta.id&&e.jsxs("div",{className:"absolute right-0 mt-1 w-40 bg-themed-secondary rounded-lg shadow-lg z-10",style:{border:"1px solid var(--theme-border-primary)"},children:[!s&&e.jsxs("button",{onClick:()=>{le(t.meta.id),P(null)},className:"w-full px-3 py-2 text-left text-sm hover:bg-themed-hover flex items-center gap-2",children:[e.jsx(Oe,{className:"w-3 h-3"}),"Apply Theme"]}),e.jsxs("button",{onClick:()=>{Tt(t.meta.id),P(null)},className:"w-full px-3 py-2 text-left text-sm hover:bg-themed-hover flex items-center gap-2",children:[u?e.jsx(Ut,{className:"w-3 h-3"}):e.jsx(wt,{className:"w-3 h-3"}),u?"Stop Preview":"Preview"]}),!l&&o&&e.jsxs("button",{onClick:()=>{Je(t),P(null)},className:"w-full px-3 py-2 text-left text-sm hover:bg-themed-hover flex items-center gap-2",children:[e.jsx(ct,{className:"w-3 h-3"}),"Edit Theme"]}),e.jsxs("button",{onClick:()=>{$t(t),P(null)},className:"w-full px-3 py-2 text-left text-sm hover:bg-themed-hover flex items-center gap-2",children:[e.jsx(Ne,{className:"w-3 h-3"}),"Export"]}),!l&&o&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-t my-1",style:{borderColor:"var(--theme-border-primary)"}}),e.jsxs("button",{onClick:()=>{Dt(t.meta.id,t.meta.name),P(null)},className:"w-full px-3 py-2 text-left text-sm hover:bg-red-500/10 text-red-500 flex items-center gap-2",children:[e.jsx(bt,{className:"w-3 h-3"}),"Delete"]})]})]})]})]}),e.jsxs("div",{className:"flex gap-1 mt-3",children:[e.jsx("div",{className:"flex-1 h-6 rounded",style:{backgroundColor:t.colors.primaryColor||"#3b82f6"},title:"Primary"}),e.jsx("div",{className:"flex-1 h-6 rounded",style:{backgroundColor:t.colors.secondaryColor||"#8b5cf6"},title:"Secondary"}),e.jsx("div",{className:"flex-1 h-6 rounded",style:{backgroundColor:t.colors.accentColor||"#06b6d4"},title:"Accent"}),e.jsx("div",{className:"flex-1 h-6 rounded",style:{backgroundColor:t.colors.bgPrimary||"#111827"},title:"Background"}),e.jsx("div",{className:"flex-1 h-6 rounded",style:{border:"1px solid var(--theme-border)",backgroundColor:t.colors.textPrimary||"#ffffff"},title:"Text"})]})]},t.meta.id)})})]}),o&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-sm font-medium mb-3 text-themed-secondary",children:"Upload Custom Theme"}),e.jsxs("div",{className:`border-dashed rounded-lg p-8 text-center transition-colors ${h?"bg-purple-900 bg-opacity-20":""}`,style:{border:h?"2px dashed var(--theme-primary)":"2px dashed var(--theme-border-secondary)"},onDragEnter:Le,onDragLeave:Le,onDragOver:Le,onDrop:Rt,children:[e.jsx(_t,{className:"w-12 h-12 mx-auto mb-3 text-themed-muted"}),e.jsx("p",{className:"mb-2 text-themed-secondary",children:"Drag and drop a theme file here, or click to browse"}),e.jsx("p",{className:"text-xs mb-3 text-themed-muted",children:"TOML format, max 1MB"}),e.jsx("input",{ref:Ue,type:"file",accept:".toml",onChange:t=>{var s;return((s=t.target.files)==null?void 0:s[0])&&Ye(t.target.files[0])},className:"hidden"}),e.jsx(H,{variant:"filled",color:"purple",onClick:()=>{var t;return(t=Ue.current)==null?void 0:t.click()},disabled:r,loading:r,children:"Browse Files"})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(H,{variant:"subtle",leftSection:e.jsx(Ne,{className:"w-4 h-4"}),onClick:Ze,children:"Download Sample TOML Theme"})})]}),!o&&e.jsx(q,{color:"yellow",children:"Authentication required to create, upload, or delete custom themes"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(q,{color:"blue",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"w-4 h-4"}),e.jsx("span",{children:"Select a theme above and click Edit to customize its colors"})]})}),e.jsxs("div",{className:"p-4 rounded-lg bg-themed-tertiary",children:[e.jsx("h4",{className:"text-sm font-semibold text-themed-primary mb-2",children:"Quick Actions"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(H,{variant:"default",size:"sm",leftSection:e.jsx(at,{className:"w-4 h-4"}),onClick:()=>_(!0),disabled:!o,children:"Create New Theme"}),e.jsx(H,{variant:"default",size:"sm",leftSection:e.jsx(Ne,{className:"w-4 h-4"}),onClick:Ze,children:"Download Sample"}),i.find(t=>t.meta.id===n)&&!we(n)&&e.jsx(H,{variant:"default",size:"sm",leftSection:e.jsx(ct,{className:"w-4 h-4"}),onClick:()=>Je(i.find(t=>t.meta.id===n)),disabled:!o,children:"Edit Current Theme"})]})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-themed-tertiary",children:[e.jsx("h4",{className:"text-sm font-semibold text-themed-primary mb-3",children:"Color Groups Overview"}),e.jsxs("div",{className:"text-xs text-themed-muted mb-3",children:["Themes contain ",ve.reduce((t,s)=>t+s.colors.length,0)," customizable colors organized into groups:"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:ve.map(t=>{const s=t.icon;return e.jsxs("div",{className:"flex items-start gap-2 text-sm p-2 rounded hover:bg-themed-hover transition-colors",children:[e.jsx(s,{className:"w-4 h-4 text-themed-accent mt-0.5"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-themed-primary font-medium capitalize",children:t.name.replace(/([A-Z])/g," $1").trim()}),e.jsxs("span",{className:"text-themed-muted text-xs block",children:[t.colors.length," colors - ",t.description]})]})]},t.name)})})]})]}),C&&e.jsx(q,{color:"red",withCloseButton:!0,onClose:()=>g(null),children:C}),S&&e.jsx(q,{color:"green",withCloseButton:!0,onClose:()=>R(null),children:S})]}),e.jsx(Pe,{opened:B,onClose:()=>{_(!1),Re({})},title:"Create Custom Theme",size:"xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-sm font-semibold flex items-center gap-2 text-themed-primary",children:[e.jsx(ze,{className:"w-4 h-4"}),"Theme Information"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Theme Name *"}),e.jsx("input",{type:"text",value:I.name,onChange:t=>Y({...I,name:t.target.value}),placeholder:"My Custom Theme",className:"w-full px-3 py-2 focus:outline-none themed-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Author"}),e.jsx("input",{type:"text",value:I.author,onChange:t=>Y({...I,author:t.target.value}),placeholder:"Your Name",className:"w-full px-3 py-2 focus:outline-none themed-input"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Description"}),e.jsx("input",{type:"text",value:I.description,onChange:t=>Y({...I,description:t.target.value}),placeholder:"A beautiful custom theme",className:"w-full px-3 py-2 rounded focus:outline-none themed-input"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:I.isDark,onChange:t=>Y({...I,isDark:t.target.checked}),className:"rounded"}),e.jsx("span",{className:"text-sm text-themed-secondary",children:"Dark Theme"})]}),e.jsxs("button",{onClick:()=>Xe("dark"),className:"px-3 py-1 text-xs rounded-lg flex items-center gap-1 bg-themed-tertiary text-themed-secondary",children:[e.jsx(lt,{className:"w-3 h-3"}),"Load Dark Preset"]}),e.jsxs("button",{onClick:()=>Xe("light"),className:"px-3 py-1 text-xs rounded-lg flex items-center gap-1 bg-themed-tertiary text-themed-secondary",children:[e.jsx(nt,{className:"w-3 h-3"}),"Load Light Preset"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>xe("category"),className:`flex-1 px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200 ${X==="category"?"bg-primary text-themed-button":"bg-themed-tertiary text-themed-secondary hover:bg-themed-hover"}`,children:[e.jsx(ke,{className:"w-4 h-4 inline-block mr-2"}),"By Category"]}),e.jsxs("button",{onClick:()=>xe("page"),className:`flex-1 px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200 ${X==="page"?"bg-primary text-themed-button":"bg-themed-tertiary text-themed-secondary hover:bg-themed-hover"}`,children:[e.jsx(Te,{className:"w-4 h-4 inline-block mr-2"}),"By Page"]})]}),e.jsxs("div",{className:`transition-all duration-300 overflow-hidden ${X==="page"?"max-h-40 opacity-100 mt-4":"max-h-0 opacity-0"}`,children:[e.jsx("label",{className:"block text-sm font-medium text-themed-primary mb-2",children:"Select Page"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:Ge.map(t=>{const s=t.icon;return e.jsxs("button",{onClick:()=>k(t.name),className:`px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200 flex items-center gap-2 ${oe===t.name?"bg-primary":"bg-themed-tertiary text-themed-secondary hover:bg-themed-hover"}`,style:{color:oe===t.name?"var(--theme-button-text)":void 0},title:t.description,children:[e.jsx(s,{className:"w-4 h-4"}),t.label]},t.name)})})]}),e.jsxs("div",{className:"relative mt-4",children:[e.jsx(dt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-themed-muted"}),e.jsx("input",{type:"text",value:Z,onChange:t=>fe(t.target.value),placeholder:"Search colors... (e.g., 'alert', 'header', 'button', 'background')",className:"w-full pl-10 pr-10 py-2 themed-input"}),Z&&e.jsx("button",{onClick:()=>fe(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-themed-muted hover:text-themed-primary",children:e.jsx(Be,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:_e(ve,Z).map(t=>{const s=t.icon,u=W.includes(t.name)||Z.trim()!=="";return e.jsxs("div",{className:"themed-card rounded-lg",style:{border:"1px solid var(--theme-border)"},children:[e.jsxs("button",{onClick:()=>Qe(t.name),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-opacity-50",style:{backgroundColor:u?"var(--theme-bg-tertiary)":"transparent"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(s,{className:"w-4 h-4 text-themed-accent"}),e.jsxs("div",{className:"text-left",children:[e.jsx("h5",{className:"text-sm font-semibold capitalize text-themed-primary",children:t.name.replace(/([A-Z])/g," $1").trim()}),e.jsx("p",{className:"text-xs text-themed-muted",children:t.description})]})]}),u?e.jsx(mt,{className:"w-4 h-4"}):e.jsx(ut,{className:"w-4 h-4"})]}),u&&e.jsx("div",{className:"p-4 themed-card space-y-4",style:{borderTop:"1px solid var(--theme-border)"},children:t.colors.map(l=>e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-themed-primary",children:l.label}),e.jsx("p",{className:"text-xs text-themed-muted",children:l.description}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:l.affects.map((j,v)=>e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded",style:{backgroundColor:"var(--theme-bg-hover)",color:"var(--theme-text-secondary)"},children:j},v))})]}),e.jsx("div",{className:"flex items-center gap-2",children:(()=>{const j=getComputedStyle(document.documentElement),A={primaryColor:"--theme-primary",secondaryColor:"--theme-secondary",accentColor:"--theme-accent",bgPrimary:"--theme-bg-primary",bgSecondary:"--theme-bg-secondary",bgTertiary:"--theme-bg-tertiary",bgHover:"--theme-bg-hover",textPrimary:"--theme-text-primary",textSecondary:"--theme-text-secondary",textMuted:"--theme-text-muted",textAccent:"--theme-text-accent",borderPrimary:"--theme-border-primary",borderSecondary:"--theme-border-secondary",borderFocus:"--theme-border-focus",success:"--theme-success",warning:"--theme-warning",error:"--theme-error",info:"--theme-info",buttonBg:"--theme-button-bg",buttonHover:"--theme-button-hover",inputBg:"--theme-input-bg",inputBorder:"--theme-input-border",inputFocus:"--theme-input-focus",checkboxAccent:"--theme-checkbox-accent",checkboxBorder:"--theme-checkbox-border",sliderAccent:"--theme-slider-accent",sliderThumb:"--theme-slider-thumb",sliderTrack:"--theme-slider-track",cardBg:"--theme-card-bg",cardBorder:"--theme-card-border",badgeBg:"--theme-badge-bg",progressBar:"--theme-progress-bar",iconBgBlue:"--theme-icon-bg-blue",iconBgGreen:"--theme-icon-bg-green",iconBgPurple:"--theme-icon-bg-purple",chartColor1:"--theme-chart-color-1",chartColor2:"--theme-chart-color-2",chartColor3:"--theme-chart-color-3",chartColor4:"--theme-chart-color-4",chartColor5:"--theme-chart-color-5",chartColor6:"--theme-chart-color-6"}[l.key]||`--theme-${l.key.replace(/([A-Z])/g,"-$1").toLowerCase()}`,z=j.getPropertyValue(A).trim()||"#3b82f6",{hex:Ce,alpha:Fe}=be(I[l.key]||z);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"relative",children:e.jsx("input",{type:"color",value:Ce,onMouseDown:()=>De(l.key),onFocus:()=>De(l.key),onChange:de=>{const $e=be(I[l.key]||z).alpha;ye(l.key,de.target.value,$e,!0)},className:"w-12 h-8 rounded cursor-pointer",style:{backgroundColor:I[l.key]||z}})}),l.supportsAlpha&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ht,{className:"w-3 h-3 text-themed-muted"}),e.jsx("input",{type:"range",min:"0",max:"100",value:Math.round(Fe*100),onChange:de=>{const $e=parseInt(de.target.value)/100;ye(l.key,Ce,$e,!0)},className:"w-16",title:`Opacity: ${Math.round(Fe*100)}%`}),e.jsxs("span",{className:"text-xs text-themed-muted w-8",children:[Math.round(Fe*100),"%"]})]}),e.jsx("input",{type:"text",value:I[l.key]||z,onFocus:()=>De(l.key),onChange:de=>Bt(l.key,de.target.value),className:"w-24 px-2 py-1 text-xs rounded font-mono themed-input"}),e.jsx("button",{onClick:()=>Ve(I[l.key]||z),className:"p-1 rounded-lg hover:bg-opacity-50 bg-themed-hover",title:"Copy color",children:pe===(I[l.key]||z)?e.jsx(Oe,{className:"w-3 h-3",style:{color:"var(--theme-success)"}}):e.jsx(Ae,{className:"w-3 h-3 text-themed-muted"})}),Ke(l.key)&&e.jsx("button",{onClick:()=>At(l.key),className:"p-1 rounded-lg hover:bg-opacity-50 bg-themed-hover",title:`Restore previous color: ${Ke(l.key)}`,children:e.jsx(pt,{className:"w-3 h-3 text-themed-muted"})})]})})()})]})},l.key))})]},t.name)})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Custom CSS (Optional)"}),e.jsx("textarea",{value:I.customCSS,onChange:t=>Y({...I,customCSS:t.target.value}),placeholder:"/* Add any custom CSS here */",rows:4,className:"w-full px-3 py-2 rounded font-mono text-xs focus:outline-none themed-input"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",style:{borderColor:"var(--theme-border-primary)"},children:[e.jsx(H,{variant:"default",onClick:()=>_(!1),children:"Cancel"}),e.jsx(H,{variant:"filled",leftSection:e.jsx(ft,{className:"w-4 h-4"}),onClick:Ft,disabled:!I.name||!o,className:"themed-button-primary",children:"Create Theme"})]})]})}),e.jsx(Pe,{opened:K,onClose:()=>{L(!1),T(null),V({}),ae({})},title:`Edit Theme: ${(b==null?void 0:b.meta.name)||""}`,size:"xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-sm font-semibold flex items-center gap-2 text-themed-primary",children:[e.jsx(ze,{className:"w-4 h-4"}),"Theme Information"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Theme Name *"}),e.jsx("input",{type:"text",value:M.name||"",onChange:t=>V({...M,name:t.target.value}),placeholder:"My Custom Theme",className:"w-full px-3 py-2 focus:outline-none themed-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Author"}),e.jsx("input",{type:"text",value:M.author||"",onChange:t=>V({...M,author:t.target.value}),placeholder:"Your Name",className:"w-full px-3 py-2 focus:outline-none themed-input"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Description"}),e.jsx("input",{type:"text",value:M.description||"",onChange:t=>V({...M,description:t.target.value}),placeholder:"A beautiful custom theme",className:"w-full px-3 py-2 rounded focus:outline-none themed-input"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:M.isDark||!1,onChange:t=>V({...M,isDark:t.target.checked}),className:"rounded"}),e.jsx("span",{className:"text-sm text-themed-secondary",children:"Dark Theme"})]}),e.jsxs("span",{className:"text-xs text-themed-muted",children:["Theme ID: ",b==null?void 0:b.meta.id]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>O("category"),className:`flex-1 px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200 ${p==="category"?"bg-primary text-themed-button":"bg-themed-tertiary text-themed-secondary hover:bg-themed-hover"}`,children:[e.jsx(ke,{className:"w-4 h-4 inline-block mr-2"}),"By Category"]}),e.jsxs("button",{onClick:()=>O("page"),className:`flex-1 px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200 ${p==="page"?"bg-primary text-themed-button":"bg-themed-tertiary text-themed-secondary hover:bg-themed-hover"}`,children:[e.jsx(Te,{className:"w-4 h-4 inline-block mr-2"}),"By Page"]})]}),e.jsxs("div",{className:`transition-all duration-300 overflow-hidden ${p==="page"?"max-h-40 opacity-100 mt-4":"max-h-0 opacity-0"}`,children:[e.jsx("label",{className:"block text-sm font-medium text-themed-primary mb-2",children:"Select Page"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:Ge.map(t=>{const s=t.icon;return e.jsxs("button",{onClick:()=>G(t.name),className:`px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200 flex items-center gap-2 ${D===t.name?"bg-primary":"bg-themed-tertiary text-themed-secondary hover:bg-themed-hover"}`,style:{color:D===t.name?"var(--theme-button-text)":void 0},title:t.description,children:[e.jsx(s,{className:"w-4 h-4"}),t.label]},t.name)})})]}),e.jsxs("div",{className:"relative mt-4",children:[e.jsx(dt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-themed-muted"}),e.jsx("input",{type:"text",value:re,onChange:t=>ge(t.target.value),placeholder:"Search colors... (e.g., 'alert', 'header', 'button', 'background')",className:"w-full pl-10 pr-10 py-2 themed-input"}),re&&e.jsx("button",{onClick:()=>ge(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-themed-muted hover:text-themed-primary",children:e.jsx(Be,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:_e(ve,re,!0).map(t=>{const s=t.icon,u=W.includes(t.name)||re.trim()!=="";return e.jsxs("div",{className:"themed-card rounded-lg",style:{border:"1px solid var(--theme-border)"},children:[e.jsxs("button",{onClick:()=>Qe(t.name),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-opacity-50",style:{backgroundColor:u?"var(--theme-bg-tertiary)":"transparent"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(s,{className:"w-4 h-4 text-themed-accent"}),e.jsxs("div",{className:"text-left",children:[e.jsx("h5",{className:"text-sm font-semibold capitalize text-themed-primary",children:t.name.replace(/([A-Z])/g," $1").trim()}),e.jsx("p",{className:"text-xs text-themed-muted",children:t.description})]})]}),u?e.jsx(mt,{className:"w-4 h-4"}):e.jsx(ut,{className:"w-4 h-4"})]}),u&&e.jsx("div",{className:"p-4 themed-card space-y-4",style:{borderTop:"1px solid var(--theme-border)"},children:t.colors.map(l=>e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-themed-primary",children:l.label}),e.jsx("p",{className:"text-xs text-themed-muted",children:l.description}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:l.affects.map((j,v)=>e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded",style:{backgroundColor:"var(--theme-bg-hover)",color:"var(--theme-text-secondary)"},children:j},v))})]}),e.jsx("div",{className:"flex items-center gap-2",children:(()=>{const{hex:j,alpha:v}=be(M[l.key]||"#000000");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"relative",children:e.jsx("input",{type:"color",value:j,onMouseDown:()=>He(l.key),onFocus:()=>He(l.key),onChange:A=>{const z=be(M[l.key]||"#000000").alpha;ye(l.key,A.target.value,z,!1)},className:"w-12 h-8 rounded cursor-pointer",style:{backgroundColor:M[l.key]||"#000000"}})}),l.supportsAlpha&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ht,{className:"w-3 h-3 text-themed-muted"}),e.jsx("input",{type:"range",min:"0",max:"100",value:Math.round(v*100),onChange:A=>{const z=parseInt(A.target.value)/100;ye(l.key,j,z,!1)},className:"w-16",title:`Opacity: ${Math.round(v*100)}%`}),e.jsxs("span",{className:"text-xs text-themed-muted w-8",children:[Math.round(v*100),"%"]})]}),e.jsx("input",{type:"text",value:M[l.key]||"",onFocus:()=>He(l.key),onChange:A=>Pt(l.key,A.target.value),className:"w-24 px-2 py-1 text-xs rounded font-mono themed-input",placeholder:l.key}),e.jsx("button",{onClick:()=>Ve(M[l.key]||""),className:"p-1 rounded-lg hover:bg-opacity-50 bg-themed-hover",title:"Copy color",children:pe===M[l.key]?e.jsx(Oe,{className:"w-3 h-3",style:{color:"var(--theme-success)"}}):e.jsx(Ae,{className:"w-3 h-3 text-themed-muted"})}),(()=>{const A=It(l.key);return A?e.jsx("button",{onClick:()=>Mt(l.key),className:"p-1 rounded-lg hover:bg-opacity-50 bg-themed-hover",title:`Restore previous color: ${A}`,children:e.jsx(pt,{className:"w-3 h-3 text-themed-muted"})}):null})()]})})()})]})},l.key))})]},t.name)})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-themed-secondary",children:"Custom CSS (Optional)"}),e.jsx("textarea",{value:M.customCSS||"",onChange:t=>V({...M,customCSS:t.target.value}),placeholder:"/* Add any custom CSS here */",rows:4,className:"w-full px-3 py-2 rounded font-mono text-xs focus:outline-none themed-input"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",style:{borderColor:"var(--theme-border-primary)"},children:[e.jsx(H,{variant:"default",onClick:()=>{L(!1),T(null),V({})},children:"Cancel"}),e.jsx(H,{variant:"filled",leftSection:e.jsx(ft,{className:"w-4 h-4"}),onClick:Lt,disabled:!M.name||!o||r,className:"themed-button-primary",children:"Save Changes"})]})]})})]})},hs=({alerts:o,onClearError:i,onClearSuccess:a})=>{var n,f;return!o||!((n=o.errors)!=null&&n.length)&&!o.success?null:e.jsxs("div",{className:"space-y-4",children:[(f=o.errors)==null?void 0:f.map(r=>e.jsx(q,{color:"red",icon:e.jsx(Me,{className:"w-5 h-5"}),withCloseButton:!0,onClose:()=>i(r.id),children:r.message},r.id)),o.success&&e.jsx(q,{color:"green",icon:e.jsx(he,{className:"w-5 h-5"}),withCloseButton:!!a,onClose:a,children:o.success})]})},ps=()=>{const[o,i]=c.useState(null),[a,n]=c.useState(null);c.useEffect(()=>{fetch("/api/metrics/status").then(d=>d.json()).then(d=>n(d.requiresAuthentication)).catch(()=>n(!1))},[]);const f=async(d,h)=>{try{await navigator.clipboard.writeText(d),i(h),setTimeout(()=>i(null),2e3)}catch{const C=document.createElement("textarea");C.value=d,C.style.position="fixed",C.style.left="-999999px",C.style.top="-999999px",document.body.appendChild(C),C.focus(),C.select();try{document.execCommand("copy"),i(h),setTimeout(()=>i(null),2e3)}catch(g){console.error("Failed to copy text: ",g)}finally{document.body.removeChild(C)}}},r=window.location.origin;return e.jsxs(te,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ts,{className:"w-5 h-5 text-themed-accent"}),e.jsx("h3",{className:"text-lg font-semibold text-themed-primary",children:"Live API Endpoints for Grafana"})]}),a!==null&&e.jsx("div",{className:`flex items-center space-x-1 px-3 py-1 rounded-full text-xs font-medium ${a?"access-indicator-secured":"access-indicator-public"}`,style:{border:"1px solid var(--theme-border)"},children:a?e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"w-3 h-3"}),e.jsx("span",{children:"API Key Required"})]}):e.jsxs(e.Fragment,{children:[e.jsx(xt,{className:"w-3 h-3"}),e.jsx("span",{children:"Public Access"})]})})]}),e.jsx("p",{className:"text-themed-muted text-sm mb-4",children:a?"These endpoints provide real-time metrics with API key authentication. Configure your API key in Grafana or Prometheus.":"These endpoints provide real-time metrics without authentication. Use them directly in Grafana or Prometheus."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"p-3 rounded-lg themed-card",style:{border:"1px solid var(--theme-border)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-themed-primary",children:"Prometheus Metrics"}),e.jsx(H,{size:"xs",variant:"default",onClick:()=>f(`${r}/api/metrics`,"prometheus"),leftSection:o==="prometheus"?e.jsx(he,{className:"w-3 h-3"}):e.jsx(Ae,{className:"w-3 h-3"}),children:o==="prometheus"?"Copied!":"Copy"})]}),e.jsxs("code",{className:"text-xs text-themed-muted block break-all",children:[r,"/api/metrics"]}),e.jsx("p",{className:"text-xs text-themed-muted mt-1",children:"OpenMetrics format for Prometheus scraping"})]}),e.jsxs("div",{className:"p-3 rounded-lg themed-card",style:{border:"1px solid var(--theme-border)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-themed-primary",children:"JSON Metrics"}),e.jsx(H,{size:"xs",variant:"default",onClick:()=>f(`${r}/api/metrics/json`,"json-api"),leftSection:o==="json-api"?e.jsx(he,{className:"w-3 h-3"}):e.jsx(Ae,{className:"w-3 h-3"}),children:o==="json-api"?"Copied!":"Copy"})]}),e.jsxs("code",{className:"text-xs text-themed-muted block break-all",children:[r,"/api/metrics/json"]}),e.jsx("p",{className:"text-xs text-themed-muted mt-1",children:"JSON format for direct Grafana integration"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(q,{color:"blue",children:e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Security Options:"})," By default, these endpoints are public. To require API key authentication, set ",e.jsx("code",{children:"RequireAuthForMetrics: true"})," in your config. Then add header ",e.jsx("code",{children:"X-Api-Key: your-key"})," to Grafana/Prometheus."]})})}),e.jsx("div",{className:"mt-2",children:e.jsx(q,{color:"green",children:e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Live Updates:"})," Configure Grafana to poll every 10-30 seconds for real-time monitoring. Works with both Prometheus and JSON datasource plugins."]})})})]})},fs=({mockMode:o,onToggle:i,disabled:a})=>e.jsxs(te,{children:[e.jsx("h3",{className:"text-lg font-semibold text-themed-primary mb-4",children:"Mock Mode"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-themed-secondary",children:"Enable mock data for demonstration"}),e.jsx("p",{className:"text-sm text-themed-muted mt-1",children:"Simulates realistic cache data and download activity"})]}),e.jsx(H,{onClick:i,disabled:a,variant:"filled",color:"blue",leftSection:o?e.jsx(ss,{className:"w-5 h-5"}):e.jsx(as,{className:"w-5 h-5"}),className:"w-full sm:w-auto",children:o?"Enabled":"Disabled"})]}),o&&e.jsx("div",{className:"mt-4",children:e.jsx(q,{color:"blue",children:e.jsx("span",{className:"text-sm",children:"Mock mode active - API actions disabled"})})})]}),gs=({isAuthenticated:o,mockMode:i,onError:a,onSuccess:n,onDataRefresh:f})=>{const[r,d]=c.useState(!1),h=async()=>{if(!o){a==null||a("Authentication required");return}if(window.confirm("Delete all download history?")){d(!0);try{const x=await U.resetDatabase();x&&(n==null||n(x.message||"Database reset successfully"),setTimeout(()=>f==null?void 0:f(),2e3))}catch(x){a==null||a(x.message||"Failed to reset database")}finally{d(!1)}}};return e.jsxs(te,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(We,{className:"w-5 h-5 text-themed-accent flex-shrink-0"}),e.jsx("h3",{className:"text-lg font-semibold text-themed-primary",children:"Database Management"})]}),e.jsx("p",{className:"text-themed-muted text-sm mb-4 break-words",children:"Manage download history and statistics"}),e.jsx(H,{onClick:h,disabled:r||i||!o,loading:r,variant:"filled",color:"red",leftSection:e.jsx(We,{className:"w-4 h-4"}),fullWidth:!0,children:"Reset Database"}),e.jsx("p",{className:"text-xs text-themed-muted mt-2",children:"Clears all download history (does not affect cached files)"})]})},xs=({isAuthenticated:o,mockMode:i,onError:a,onSuccess:n,onDataRefresh:f,onBackgroundOperation:r})=>{const[d,h]=c.useState({}),[x,C]=c.useState({logPath:"/logs/access.log",services:[]}),[g,S]=c.useState(null),[R,y]=c.useState(!0),m=qe("activeServiceRemoval","serviceRemoval",30);c.useEffect(()=>{B(),_()},[]),c.useEffect(()=>{r==null||r(g)},[g]);const B=async()=>{try{const[b,T]=await Promise.all([U.getConfig(),U.getServiceLogCounts()]);C(b),h(T)}catch(b){console.error("Failed to load config:",b),C({logPath:"/logs/access.log",services:["steam","epic","origin","blizzard","wsus","riot"]})}finally{y(!1)}},_=async()=>{var T;const b=await m.load();(T=b==null?void 0:b.data)!=null&&T.service&&(S(b.data.service),n==null||n(`Removing ${b.data.service} entries from logs (operation resumed)...`),setTimeout(async()=>{await m.clear(),S(null);try{const[W,F]=await Promise.all([U.getConfig(),U.getServiceLogCounts()]);C(W),h(F)}catch(W){console.error("Failed to reload config:",W)}f==null||f()},1e4))},K=async b=>{var T;if(!o){a==null||a("Authentication required");return}if(window.confirm(`Remove all ${b} entries?`))try{S(b),await m.save({service:b});const W=await U.removeServiceFromLogs(b);W&&(n==null||n(W.message||`${b} entries removed successfully`)),await m.clear(),setTimeout(async()=>{S(null);try{const[F,Q]=await Promise.all([U.getConfig(),U.getServiceLogCounts()]);C(F),h(Q)}catch(F){console.error("Failed to reload config:",F)}f==null||f()},2e3)}catch(W){await m.clear(),S(null);const F=(T=W.message)!=null&&T.includes("read-only")?"Logs directory is read-only. Remove :ro from docker-compose volume mount.":W.message||"Action failed";a==null||a(F)}},L=x.services.filter(b=>d[b]!==void 0&&d[b]>0);return e.jsxs(te,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(vt,{className:"w-5 h-5 text-themed-accent flex-shrink-0"}),e.jsx("h3",{className:"text-lg font-semibold text-themed-primary",children:"Log File Management"})]}),e.jsxs("p",{className:"text-themed-muted text-sm mb-4 break-words",children:["Remove service entries from"," ",e.jsx("code",{className:"bg-themed-tertiary px-2 py-1 rounded text-xs break-all",children:x.logPath})]}),R?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(ue,{className:"w-6 h-6 animate-spin text-themed-muted"})}):L.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:L.map(b=>{const T=g===b;return e.jsx(H,{onClick:()=>K(b),disabled:i||!!g||m.loading||!o,variant:"default",loading:T||m.loading,className:"flex flex-col items-center min-h-[60px] justify-center",fullWidth:!0,children:!T&&!m.loading?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"capitalize font-medium text-sm sm:text-base",children:["Clear ",b]}),d[b]!==void 0&&e.jsxs("span",{className:"text-xs text-themed-muted mt-1",children:["(",d[b].toLocaleString()," entries)"]})]}):e.jsx("span",{className:"capitalize font-medium text-sm sm:text-base",children:"Removing..."})},b)})}):e.jsxs("div",{className:"text-center py-8 text-themed-muted",children:[e.jsx("div",{className:"mb-2",children:"No services with log entries found"}),e.jsx("div",{className:"text-xs",children:"Services appear here when they have downloadable content in the logs"})]}),e.jsx("div",{className:"mt-4",children:e.jsx(q,{color:"yellow",children:e.jsxs("p",{className:"text-xs",children:[e.jsx("strong",{children:"Warning:"})," Requires write permissions to logs directory"]})})})]})},Ns=()=>{const{mockMode:o,setMockMode:i,fetchData:a}=rs(),[n,f]=c.useState(!1),[r,d]=c.useState({errors:[],success:null}),[h,x]=c.useState({}),C=c.useRef(!1),g=c.useCallback(m=>{d(B=>({...B,errors:[...B.errors,{id:Date.now(),message:m}]}))},[]),S=c.useCallback(m=>{d(B=>({...B,success:m})),setTimeout(()=>d(B=>({...B,success:null})),1e4)},[]),R=c.useCallback(m=>{d(B=>({...B,errors:B.errors.filter(_=>_.id!==m)}))},[]),y=c.useCallback(()=>{d(m=>({...m,success:null}))},[]);return c.useEffect(()=>{(async()=>{if(!C.current){const B=await me.migrateFromLocalStorage();B>0&&S(`Migrated ${B} operations from local storage to server`),C.current=!0}})()},[S]),e.jsxs("div",{className:"space-y-6",children:[e.jsx(is,{onAuthChange:f,onError:g,onSuccess:S}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(hs,{alerts:r,onClearError:R,onClearSuccess:y}),h.cacheClearing&&e.jsx(q,{color:"blue",icon:e.jsx(ue,{className:"w-5 h-5 animate-spin"}),children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:"Cache clearing in progress..."}),h.cacheClearing.bytesDeleted>0&&e.jsxs("p",{className:"text-sm mt-1 opacity-75",children:[Se(h.cacheClearing.bytesDeleted)," cleared"]}),e.jsxs("p",{className:"text-sm mt-1 opacity-75",children:[(h.cacheClearing.progress||0).toFixed(0),"% complete"]})]}),e.jsx(H,{variant:"filled",color:"blue",size:"sm",leftSection:e.jsx(wt,{className:"w-4 h-4"}),onClick:h.cacheClearing.showModal,className:"w-full sm:w-auto",children:"View Details"})]})}),h.logProcessing&&e.jsx(q,{color:h.logProcessing.status==="complete"?"green":"yellow",icon:h.logProcessing.status==="complete"?e.jsx(he,{className:"w-5 h-5"}):e.jsx(ue,{className:"w-5 h-5 animate-spin"}),children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium break-words",children:h.logProcessing.message}),h.logProcessing.detailMessage&&e.jsx("p",{className:"text-sm mt-1 opacity-75 break-words",children:h.logProcessing.detailMessage}),h.logProcessing.progress>0&&h.logProcessing.status!=="complete"&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"w-full progress-track rounded-full h-2",children:e.jsx("div",{className:"progress-bar-low h-2 rounded-full smooth-transition",style:{width:`${Math.min(h.logProcessing.progress,100)}%`}})}),e.jsxs("p",{className:"text-xs opacity-75 mt-1 break-words",children:[h.logProcessing.progress.toFixed(1),"% complete",h.logProcessing.estimatedTime&&` • ${h.logProcessing.estimatedTime} remaining`]})]})]}),h.logProcessing.status!=="complete"&&h.logProcessing.onCancel&&e.jsx(H,{variant:"filled",color:"red",size:"sm",leftSection:e.jsx(yt,{className:"w-4 h-4"}),onClick:h.logProcessing.onCancel,className:"w-full sm:w-auto",children:"Cancel"})]})}),h.serviceRemoval&&e.jsx(q,{color:"orange",icon:e.jsx(ue,{className:"w-5 h-5 animate-spin"}),children:e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["Removing ",h.serviceRemoval," entries from logs..."]}),e.jsx("p",{className:"text-sm mt-1",children:"This may take several minutes for large log files"})]})})]}),e.jsx(fs,{mockMode:o,onToggle:()=>i(!o),disabled:!1}),e.jsx(gs,{isAuthenticated:n,mockMode:o,onError:g,onSuccess:S,onDataRefresh:a}),e.jsx(ds,{isAuthenticated:n,mockMode:o,onError:g,onSuccess:S,onBackgroundOperation:m=>x(B=>({...B,cacheClearing:m}))}),e.jsx(ms,{isAuthenticated:n,mockMode:o,onError:g,onSuccess:S,onDataRefresh:a,onBackgroundOperation:m=>x(B=>({...B,logProcessing:m}))}),e.jsx(xs,{isAuthenticated:n,mockMode:o,onError:g,onSuccess:S,onDataRefresh:a,onBackgroundOperation:m=>x(B=>({...B,serviceRemoval:m}))}),e.jsx(ps,{}),e.jsx(us,{isAuthenticated:n})]})};export{Ns as default};
//# sourceMappingURL=ManagementTab-CHYNHKQ0.js.map
